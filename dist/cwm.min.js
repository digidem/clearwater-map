d3=function(){function t(t){return null!=t&&!isNaN(t)}function n(t){return t.length}function e(t){for(var n=1;t*n%1;)n*=10;return n}function r(t,n){try{for(var e in n)Object.defineProperty(t.prototype,e,{value:n[e],enumerable:!1})}catch(r){t.prototype=n}}function o(){}function i(){}function a(t,n,e){return function(){var r=e.apply(n,arguments);return r===n?t:r}}function u(t,n){if(n in t)return n;n=n.charAt(0).toUpperCase()+n.substring(1);for(var e=0,r=po.length;r>e;++e){var o=po[e]+n;if(o in t)return o}}function s(){}function c(){}function l(t){function n(){for(var n,r=e,o=-1,i=r.length;i>++o;)(n=r[o].on)&&n.apply(this,arguments);return t}var e=[],r=new o;return n.on=function(n,o){var i,a=r.get(n);return 2>arguments.length?a&&a.on:(a&&(a.on=null,e=e.slice(0,i=e.indexOf(a)).concat(e.slice(i+1)),r.remove(n)),o&&e.push(r.set(n,{on:o})),t)},n}function f(){eo.event.preventDefault()}function h(){for(var t,n=eo.event;t=n.sourceEvent;)n=t;return n}function d(t){for(var n=new c,e=0,r=arguments.length;r>++e;)n[arguments[e]]=l(n);return n.of=function(e,r){return function(o){try{var i=o.sourceEvent=eo.event;o.target=t,eo.event=o,n[o.type].apply(e,r)}finally{eo.event=i}}},n}function p(t){return go(t,Mo),t}function m(t){return"function"==typeof t?t:function(){return vo(t,this)}}function g(t){return"function"==typeof t?t:function(){return yo(t,this)}}function v(t,n){function e(){this.removeAttribute(t)}function r(){this.removeAttributeNS(t.space,t.local)}function o(){this.setAttribute(t,n)}function i(){this.setAttributeNS(t.space,t.local,n)}function a(){var e=n.apply(this,arguments);null==e?this.removeAttribute(t):this.setAttribute(t,e)}function u(){var e=n.apply(this,arguments);null==e?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,e)}return t=eo.ns.qualify(t),null==n?t.local?r:e:"function"==typeof n?t.local?u:a:t.local?i:o}function y(t){return t.trim().replace(/\s+/g," ")}function w(t){return RegExp("(?:^|\\s+)"+eo.requote(t)+"(?:\\s+|$)","g")}function b(t,n){function e(){for(var e=-1;o>++e;)t[e](this,n)}function r(){for(var e=-1,r=n.apply(this,arguments);o>++e;)t[e](this,r)}t=t.trim().split(/\s+/).map(M);var o=t.length;return"function"==typeof n?r:e}function M(t){var n=w(t);return function(e,r){if(o=e.classList)return r?o.add(t):o.remove(t);var o=e.getAttribute("class")||"";r?(n.lastIndex=0,n.test(o)||e.setAttribute("class",y(o+" "+t))):e.setAttribute("class",y(o.replace(n," ")))}}function _(t,n,e){function r(){this.style.removeProperty(t)}function o(){this.style.setProperty(t,n,e)}function i(){var r=n.apply(this,arguments);null==r?this.style.removeProperty(t):this.style.setProperty(t,r,e)}return null==n?r:"function"==typeof n?i:o}function x(t,n){function e(){delete this[t]}function r(){this[t]=n}function o(){var e=n.apply(this,arguments);null==e?delete this[t]:this[t]=e}return null==n?e:"function"==typeof n?o:r}function z(t){return"function"==typeof t?t:(t=eo.ns.qualify(t)).local?function(){return this.ownerDocument.createElementNS(t.space,t.local)}:function(){return this.ownerDocument.createElementNS(this.namespaceURI,t)}}function C(t){return{__data__:t}}function E(t){return function(){return bo(this,t)}}function k(t){return arguments.length||(t=eo.ascending),function(n,e){return n&&e?t(n.__data__,e.__data__):!n-!e}}function S(t,n){for(var e=0,r=t.length;r>e;e++)for(var o,i=t[e],a=0,u=i.length;u>a;a++)(o=i[a])&&n(o,a,e);return t}function T(t){return go(t,xo),t}function L(t){var n,e;return function(r,o,i){var a,u=t[i].update,s=u.length;for(i!=e&&(e=i,n=0),o>=n&&(n=o+1);!(a=u[n])&&s>++n;);return a}}function P(){var t=this.__transition__;t&&++t.active}function A(t,n,e){function r(){var n=this[a];n&&(this.removeEventListener(t,n,n.$),delete this[a])}function o(){var o=c(n,so(arguments));r.call(this),this.addEventListener(t,this[a]=o,o.$=e),o._=n}function i(){var n,e=RegExp("^__on([^.]+)"+eo.requote(t)+"$");for(var r in this)if(n=r.match(e)){var o=this[r];this.removeEventListener(n[1],o,o.$),delete this[r]}}var a="__on"+t,u=t.indexOf("."),c=j;u>0&&(t=t.substring(0,u));var l=Co.get(t);return l&&(t=l,c=q),u?n?o:r:n?s:i}function j(t,n){return function(e){var r=eo.event;eo.event=e,n[0]=this.__data__;try{t.apply(this,n)}finally{eo.event=r}}}function q(t,n){var e=j(t,n);return function(t){var n=this,r=t.relatedTarget;r&&(r===n||8&r.compareDocumentPosition(n))||e.call(n,t)}}function F(){var t=".dragsuppress-"+ ++ko,n="click"+t,e=eo.select(fo).on("touchmove"+t,f).on("dragstart"+t,f).on("selectstart"+t,f);if(Eo){var r=lo.style,o=r[Eo];r[Eo]="none"}return function(i){function a(){e.on(n,null)}e.on(t,null),Eo&&(r[Eo]=o),i&&(e.on(n,function(){f(),a()},!0),setTimeout(a,0))}}function I(t,n){n.changedTouches&&(n=n.changedTouches[0]);var e=t.ownerSVGElement||t;if(e.createSVGPoint){var r=e.createSVGPoint();if(0>So&&(fo.scrollX||fo.scrollY)){e=eo.select("body").append("svg").style({position:"absolute",top:0,left:0,margin:0,padding:0,border:"none"},"important");var o=e[0][0].getScreenCTM();So=!(o.f||o.e),e.remove()}return So?(r.x=n.pageX,r.y=n.pageY):(r.x=n.clientX,r.y=n.clientY),r=r.matrixTransform(t.getScreenCTM().inverse()),[r.x,r.y]}var i=t.getBoundingClientRect();return[n.clientX-i.left-t.clientLeft,n.clientY-i.top-t.clientTop]}function O(t){return"function"==typeof t?t:function(){return t}}function N(){var t=D(),n=R()-t;n>24?(isFinite(n)&&(clearTimeout(Ao),Ao=setTimeout(N,n)),Po=0):(Po=1,qo(N))}function D(){var t=Date.now();for(jo=To;jo;)t>=jo.t&&(jo.f=jo.c(t-jo.t)),jo=jo.n;return t}function R(){for(var t,n=To,e=1/0;n;)n.f?n=t?t.n=n.n:To=n.n:(e>n.t&&(e=n.t),n=(t=n).n);return Lo=t,e}function B(){this._=new Date(arguments.length>1?Date.UTC.apply(this,arguments):arguments[0])}function H(t,n,e){function r(n){var e=t(n),r=i(e,1);return r-n>n-e?e:r}function o(e){return n(e=t(new Io(e-1)),1),e}function i(t,e){return n(t=new Io(+t),e),t}function a(t,r,i){var a=o(t),u=[];if(i>1)for(;r>a;)e(a)%i||u.push(new Date(+a)),n(a,1);else for(;r>a;)u.push(new Date(+a)),n(a,1);return u}function u(t,n,e){try{Io=B;var r=new B;return r._=t,a(r,n,e)}finally{Io=Date}}t.floor=t,t.round=r,t.ceil=o,t.offset=i,t.range=a;var s=t.utc=U(t);return s.floor=s,s.round=U(r),s.ceil=U(o),s.offset=U(i),s.range=u,t}function U(t){return function(n,e){try{Io=B;var r=new B;return r._=n,t(r,e)._}finally{Io=Date}}}function Y(t){function n(n){for(var r,o,i,a=[],u=-1,s=0;e>++u;)37===t.charCodeAt(u)&&(a.push(t.substring(s,u)),null!=(o=ni[r=t.charAt(++u)])&&(r=t.charAt(++u)),(i=ei[r])&&(r=i(n,null==o?"e"===r?" ":"0":o)),a.push(r),s=u+1);return a.push(t.substring(s,u)),a.join("")}var e=t.length;return n.parse=function(n){var e={y:1900,m:0,d:1,H:0,M:0,S:0,L:0,Z:null},r=X(e,t,n,0);if(r!=n.length)return null;"p"in e&&(e.H=e.H%12+12*e.p);var o=null!=e.Z&&Io!==B,i=new(o?B:Io);return"j"in e?i.setFullYear(e.y,0,e.j):"w"in e&&("W"in e||"U"in e)?(i.setFullYear(e.y,0,1),i.setFullYear(e.y,0,"W"in e?(e.w+6)%7+7*e.W-(i.getDay()+5)%7:e.w+7*e.U-(i.getDay()+6)%7)):i.setFullYear(e.y,e.m,e.d),i.setHours(e.H+Math.floor(e.Z/100),e.M+e.Z%100,e.S,e.L),o?i._:i},n.toString=function(){return t},n}function X(t,n,e,r){for(var o,i,a,u=0,s=n.length,c=e.length;s>u;){if(r>=c)return-1;if(o=n.charCodeAt(u++),37===o){if(a=n.charAt(u++),i=ri[a in ni?n.charAt(u++):a],!i||0>(r=i(t,e,r)))return-1}else if(o!=e.charCodeAt(r++))return-1}return r}function Z(t){return RegExp("^(?:"+t.map(eo.requote).join("|")+")","i")}function K(t){for(var n=new o,e=-1,r=t.length;r>++e;)n.set(t[e].toLowerCase(),e);return n}function W(t,n,e){var r=0>t?"-":"",o=(r?-t:t)+"",i=o.length;return r+(e>i?Array(e-i+1).join(n)+o:o)}function G(t,n,e){Wo.lastIndex=0;var r=Wo.exec(n.substring(e));return r?(t.w=Go.get(r[0].toLowerCase()),e+r[0].length):-1}function Q(t,n,e){Zo.lastIndex=0;var r=Zo.exec(n.substring(e));return r?(t.w=Ko.get(r[0].toLowerCase()),e+r[0].length):-1}function $(t,n,e){oi.lastIndex=0;var r=oi.exec(n.substring(e,e+1));return r?(t.w=+r[0],e+r[0].length):-1}function V(t,n,e){oi.lastIndex=0;var r=oi.exec(n.substring(e));return r?(t.U=+r[0],e+r[0].length):-1}function J(t,n,e){oi.lastIndex=0;var r=oi.exec(n.substring(e));return r?(t.W=+r[0],e+r[0].length):-1}function tn(t,n,e){Vo.lastIndex=0;var r=Vo.exec(n.substring(e));return r?(t.m=Jo.get(r[0].toLowerCase()),e+r[0].length):-1}function nn(t,n,e){Qo.lastIndex=0;var r=Qo.exec(n.substring(e));return r?(t.m=$o.get(r[0].toLowerCase()),e+r[0].length):-1}function en(t,n,e){return X(t,""+ei.c,n,e)}function rn(t,n,e){return X(t,""+ei.x,n,e)}function on(t,n,e){return X(t,""+ei.X,n,e)}function an(t,n,e){oi.lastIndex=0;var r=oi.exec(n.substring(e,e+4));return r?(t.y=+r[0],e+r[0].length):-1}function un(t,n,e){oi.lastIndex=0;var r=oi.exec(n.substring(e,e+2));return r?(t.y=cn(+r[0]),e+r[0].length):-1}function sn(t,n,e){return/^[+-]\d{4}$/.test(n=n.substring(e,e+5))?(t.Z=+n,e+5):-1}function cn(t){return t+(t>68?1900:2e3)}function ln(t,n,e){oi.lastIndex=0;var r=oi.exec(n.substring(e,e+2));return r?(t.m=r[0]-1,e+r[0].length):-1}function fn(t,n,e){oi.lastIndex=0;var r=oi.exec(n.substring(e,e+2));return r?(t.d=+r[0],e+r[0].length):-1}function hn(t,n,e){oi.lastIndex=0;var r=oi.exec(n.substring(e,e+3));return r?(t.j=+r[0],e+r[0].length):-1}function dn(t,n,e){oi.lastIndex=0;var r=oi.exec(n.substring(e,e+2));return r?(t.H=+r[0],e+r[0].length):-1}function pn(t,n,e){oi.lastIndex=0;var r=oi.exec(n.substring(e,e+2));return r?(t.M=+r[0],e+r[0].length):-1}function mn(t,n,e){oi.lastIndex=0;var r=oi.exec(n.substring(e,e+2));return r?(t.S=+r[0],e+r[0].length):-1}function gn(t,n,e){oi.lastIndex=0;var r=oi.exec(n.substring(e,e+3));return r?(t.L=+r[0],e+r[0].length):-1}function vn(t,n,e){var r=ii.get(n.substring(e,e+=2).toLowerCase());return null==r?-1:(t.p=r,e)}function yn(t){var n=t.getTimezoneOffset(),e=n>0?"-":"+",r=~~(oo(n)/60),o=oo(n)%60;return e+W(r,"0",2)+W(o,"0",2)}function wn(t,n,e){ti.lastIndex=0;var r=ti.exec(n.substring(e,e+1));return r?e+r[0].length:-1}function bn(t){function n(t){try{Io=B;var n=new Io;return n._=t,e(n)}finally{Io=Date}}var e=Y(t);return n.parse=function(t){try{Io=B;var n=e.parse(t);return n&&n._}finally{Io=Date}},n.toString=e.toString,n}function Mn(t){return t.toISOString()}function _n(){return!0}function xn(){}function zn(t,n,e){return new Cn(t,n,e)}function Cn(t,n,e){this.h=t,this.s=n,this.l=e}function En(t,n,e){function r(t){return t>360?t-=360:0>t&&(t+=360),60>t?i+(a-i)*t/60:180>t?a:240>t?i+(a-i)*(240-t)/60:i}function o(t){return Math.round(255*r(t))}var i,a;return t=isNaN(t)?0:0>(t%=360)?t+360:t,n=isNaN(n)?0:0>n?0:n>1?1:n,e=0>e?0:e>1?1:e,a=.5>=e?e*(1+n):e+n-e*n,i=2*e-a,Rn(o(t+120),o(t),o(t-120))}function kn(t){return t>1?0:-1>t?si:Math.acos(t)}function Sn(t){return t>1?li:-1>t?-li:Math.asin(t)}function Tn(t,n,e){return new Ln(t,n,e)}function Ln(t,n,e){this.h=t,this.c=n,this.l=e}function Pn(t,n,e){return isNaN(t)&&(t=0),isNaN(n)&&(n=0),An(e,Math.cos(t*=di)*n,Math.sin(t)*n)}function An(t,n,e){return new jn(t,n,e)}function jn(t,n,e){this.l=t,this.a=n,this.b=e}function qn(t,n,e){var r=(t+16)/116,o=r+n/500,i=r-e/200;return o=In(o)*vi,r=In(r)*yi,i=In(i)*wi,Rn(Nn(3.2404542*o-1.5371385*r-.4985314*i),Nn(-.969266*o+1.8760108*r+.041556*i),Nn(.0556434*o-.2040259*r+1.0572252*i))}function Fn(t,n,e){return t>0?Tn(Math.atan2(e,n)*pi,Math.sqrt(n*n+e*e),t):Tn(0/0,0/0,t)}function In(t){return t>.206893034?t*t*t:(t-4/29)/7.787037}function On(t){return t>.008856?Math.pow(t,1/3):7.787037*t+4/29}function Nn(t){return Math.round(255*(.00304>=t?12.92*t:1.055*Math.pow(t,1/2.4)-.055))}function Dn(t){return Rn(t>>16,255&t>>8,255&t)}function Rn(t,n,e){return new Bn(t,n,e)}function Bn(t,n,e){this.r=t,this.g=n,this.b=e}function Hn(t){return 16>t?"0"+Math.max(0,t).toString(16):Math.min(255,t).toString(16)}function Un(t,n,e){var r,o,i,a=0,u=0,s=0;if(r=/([a-z]+)\((.*)\)/i.exec(t))switch(o=r[2].split(","),r[1]){case"hsl":return e(parseFloat(o[0]),parseFloat(o[1])/100,parseFloat(o[2])/100);case"rgb":return n(Kn(o[0]),Kn(o[1]),Kn(o[2]))}return(i=_i.get(t))?n(i.r,i.g,i.b):(null!=t&&"#"===t.charAt(0)&&(4===t.length?(a=t.charAt(1),a+=a,u=t.charAt(2),u+=u,s=t.charAt(3),s+=s):7===t.length&&(a=t.substring(1,3),u=t.substring(3,5),s=t.substring(5,7)),a=parseInt(a,16),u=parseInt(u,16),s=parseInt(s,16)),n(a,u,s))}function Yn(t,n,e){var r,o,i=Math.min(t/=255,n/=255,e/=255),a=Math.max(t,n,e),u=a-i,s=(a+i)/2;return u?(o=.5>s?u/(a+i):u/(2-a-i),r=t==a?(n-e)/u+(e>n?6:0):n==a?(e-t)/u+2:(t-n)/u+4,r*=60):(r=0/0,o=s>0&&1>s?0:r),zn(r,o,s)}function Xn(t,n,e){t=Zn(t),n=Zn(n),e=Zn(e);var r=On((.4124564*t+.3575761*n+.1804375*e)/vi),o=On((.2126729*t+.7151522*n+.072175*e)/yi),i=On((.0193339*t+.119192*n+.9503041*e)/wi);return An(116*o-16,500*(r-o),200*(o-i))}function Zn(t){return.04045>=(t/=255)?t/12.92:Math.pow((t+.055)/1.055,2.4)}function Kn(t){var n=parseFloat(t);return"%"===t.charAt(t.length-1)?Math.round(2.55*n):n}function Wn(t,n){t=eo.rgb(t),n=eo.rgb(n);var e=t.r,r=t.g,o=t.b,i=n.r-e,a=n.g-r,u=n.b-o;return function(t){return"#"+Hn(Math.round(e+i*t))+Hn(Math.round(r+a*t))+Hn(Math.round(o+u*t))}}function Gn(t,n){var e,r={},o={};for(e in t)e in n?r[e]=Jn(t[e],n[e]):o[e]=t[e];for(e in n)e in t||(o[e]=n[e]);return function(t){for(e in r)o[e]=r[e](t);return o}}function Qn(t,n){var e,r=[],o=[],i=t.length,a=n.length,u=Math.min(t.length,n.length);for(e=0;u>e;++e)r.push(Jn(t[e],n[e]));for(;i>e;++e)o[e]=t[e];for(;a>e;++e)o[e]=n[e];return function(t){for(e=0;u>e;++e)o[e]=r[e](t);return o}}function $n(t,n){return n-=t=+t,function(e){return t+n*e}}function Vn(t,n){var e,r,o,i,a,u=0,s=0,c=[],l=[];for(t+="",n+="",xi.lastIndex=0,r=0;e=xi.exec(n);++r)e.index&&c.push(n.substring(u,s=e.index)),l.push({i:c.length,x:e[0]}),c.push(null),u=xi.lastIndex;for(n.length>u&&c.push(n.substring(u)),r=0,i=l.length;(e=xi.exec(t))&&i>r;++r)if(a=l[r],a.x==e[0]){if(a.i)if(null==c[a.i+1])for(c[a.i-1]+=a.x,c.splice(a.i,1),o=r+1;i>o;++o)l[o].i--;else for(c[a.i-1]+=a.x+c[a.i+1],c.splice(a.i,2),o=r+1;i>o;++o)l[o].i-=2;else if(null==c[a.i+1])c[a.i]=a.x;else for(c[a.i]=a.x+c[a.i+1],c.splice(a.i+1,1),o=r+1;i>o;++o)l[o].i--;l.splice(r,1),i--,r--}else a.x=$n(parseFloat(e[0]),parseFloat(a.x));for(;i>r;)a=l.pop(),null==c[a.i+1]?c[a.i]=a.x:(c[a.i]=a.x+c[a.i+1],c.splice(a.i+1,1)),i--;return 1===c.length?null==c[0]?(a=l[0].x,function(t){return a(t)+""}):function(){return n}:function(t){for(r=0;i>r;++r)c[(a=l[r]).i]=a.x(t);return c.join("")}}function Jn(t,n){for(var e,r=eo.interpolators.length;--r>=0&&!(e=eo.interpolators[r](t,n)););return e}function te(t,n){return n-=t,function(e){return Math.round(t+n*e)}}function ne(t,n){return n=n-(t=+t)?1/(n-t):0,function(e){return(e-t)*n}}function ee(t,n){return n=n-(t=+t)?1/(n-t):0,function(e){return Math.max(0,Math.min(1,(e-t)*n))}}function re(t){return t}function oe(t,n){var e=Math.pow(10,3*oo(8-n));return{scale:n>8?function(t){return t/e}:function(t){return t*e},symbol:t}}function ie(t,n){return n-(t?Math.ceil(Math.log(t)/Math.LN10):1)}function ae(t){return t+""}function ue(t,n,e,r){var o=e(t[0],t[1]),i=r(n[0],n[1]);return function(t){return i(o(t))}}function se(t,n){var e,r=0,o=t.length-1,i=t[r],a=t[o];return i>a&&(e=r,r=o,o=e,e=i,i=a,a=e),t[r]=n.floor(i),t[o]=n.ceil(a),t}function ce(t){return t?{floor:function(n){return Math.floor(n/t)*t},ceil:function(n){return Math.ceil(n/t)*t}}:ji}function le(t,n,e,r){var o=[],i=[],a=0,u=Math.min(t.length,n.length)-1;for(t[u]<t[0]&&(t=t.slice().reverse(),n=n.slice().reverse());u>=++a;)o.push(e(t[a-1],t[a])),i.push(r(n[a-1],n[a]));return function(n){var e=eo.bisect(t,n,1,u)-1;return i[e](o[e](n))}}function fe(t){var n=t[0],e=t[t.length-1];return e>n?[n,e]:[e,n]}function he(t,n,e,r){function o(){var o=Math.min(t.length,n.length)>2?le:ue,s=r?ee:ne;return a=o(t,n,s,e),u=o(n,t,s,Jn),i}function i(t){return a(t)}var a,u;return i.invert=function(t){return u(t)},i.domain=function(n){return arguments.length?(t=n.map(Number),o()):t},i.range=function(t){return arguments.length?(n=t,o()):n},i.rangeRound=function(t){return i.range(t).interpolate(te)},i.clamp=function(t){return arguments.length?(r=t,o()):r},i.interpolate=function(t){return arguments.length?(e=t,o()):e},i.ticks=function(n){return ge(t,n)},i.tickFormat=function(n,e){return ve(t,n,e)},i.nice=function(n){return pe(t,n),o()},i.copy=function(){return he(t,n,e,r)},o()}function de(t,n){return eo.rebind(t,n,"range","rangeRound","interpolate","clamp")}function pe(t,n){return se(t,ce(me(t,n)[2]))}function me(t,n){null==n&&(n=10);var e=fe(t),r=e[1]-e[0],o=Math.pow(10,Math.floor(Math.log(r/n)/Math.LN10)),i=n/r*o;return.15>=i?o*=10:.35>=i?o*=5:.75>=i&&(o*=2),e[0]=Math.ceil(e[0]/o)*o,e[1]=Math.floor(e[1]/o)*o+.5*o,e[2]=o,e}function ge(t,n){return eo.range.apply(eo,me(t,n))}function ve(t,n,e){var r=me(t,n);return eo.format(e?e.replace(Ti,function(t,n,e,o,i,a,u,s,c,l){return[n,e,o,i,a,u,s,c||"."+we(l,r),l].join("")}):",."+ye(r[2])+"f")}function ye(t){return-Math.floor(Math.log(t)/Math.LN10+.01)}function we(t,n){var e=ye(n[2]);return t in qi?Math.abs(e-ye(Math.max(Math.abs(n[0]),Math.abs(n[1]))))+ +("e"!==t):e-2*("%"===t)}function be(t,n,e){function r(n){return t(n)}function o(t,e){var r=t[1]-t[0],o=r/e,i=eo.bisect(Fi,o);return i==Fi.length?[n.year,me(t.map(function(t){return t/31536e6}),e)[2]]:i?n[o/Fi[i-1]<Fi[i]/o?i-1:i]:[Di,me(t,e)[2]]}return r.invert=function(n){return Me(t.invert(n))},r.domain=function(n){return arguments.length?(t.domain(n),r):t.domain().map(Me)},r.nice=function(t,n){function e(e){return!isNaN(e)&&!t.range(e,Me(+e+1),n).length}var i=r.domain(),a=fe(i),u=null==t?o(a,10):"number"==typeof t&&o(a,t);return u&&(t=u[0],n=u[1]),r.domain(se(i,n>1?{floor:function(n){for(;e(n=t.floor(n));)n=Me(n-1);return n},ceil:function(n){for(;e(n=t.ceil(n));)n=Me(+n+1);return n}}:t))},r.ticks=function(t,n){var e=fe(r.domain()),i=null==t?o(e,10):"number"==typeof t?o(e,t):!t.range&&[{range:t},n];return i&&(t=i[0],n=i[1]),t.range(e[0],Me(+e[1]+1),1>n?1:n)},r.tickFormat=function(){return e},r.copy=function(){return be(t.copy(),n,e)},de(r,t)}function Me(t){return new Date(t)}function _e(t){return function(n){for(var e=t.length-1,r=t[e];!r[1](n);)r=t[--e];return r[0](n)}}function xe(t){return[Math.atan2(t[1],t[0]),Sn(t[2])]}function ze(t,n){return fi>oo(t[0]-n[0])&&fi>oo(t[1]-n[1])}function Ce(t,n,e,r,o){var i=[],a=[];if(t.forEach(function(t){if(!(0>=(n=t.length-1))){var n,e=t[0],r=t[n];if(ze(e,r)){o.lineStart();for(var u=0;n>u;++u)o.point((e=t[u])[0],e[1]);return o.lineEnd(),void 0}var s=new ke(e,t,null,!0),c=new ke(e,null,s,!1);s.o=c,i.push(s),a.push(c),s=new ke(r,t,null,!1),c=new ke(r,null,s,!0),s.o=c,i.push(s),a.push(c)}}),a.sort(n),Ee(i),Ee(a),i.length){for(var u=0,s=e,c=a.length;c>u;++u)a[u].e=s=!s;for(var l,f,h=i[0];;){for(var d=h,p=!0;d.v;)if((d=d.n)===h)return;l=d.z,o.lineStart();do{if(d.v=d.o.v=!0,d.e){if(p)for(var u=0,c=l.length;c>u;++u)o.point((f=l[u])[0],f[1]);else r(d.x,d.n.x,1,o);d=d.n}else{if(p){l=d.p.z;for(var u=l.length-1;u>=0;--u)o.point((f=l[u])[0],f[1])}else r(d.x,d.p.x,-1,o);d=d.p}d=d.o,l=d.z,p=!p}while(!d.v);o.lineEnd()}}}function Ee(t){if(n=t.length){for(var n,e,r=0,o=t[0];n>++r;)o.n=e=t[r],e.p=o,o=e;o.n=e=t[0],e.p=o}}function ke(t,n,e,r){this.x=t,this.z=n,this.o=e,this.e=r,this.v=!1,this.n=this.p=null}function Se(t,n,e,r){return function(o,i){function a(n,e){var r=o(n,e);t(n=r[0],e=r[1])&&i.point(n,e)}function u(t,n){var e=o(t,n);g.point(e[0],e[1])}function s(){y.point=u,g.lineStart()}function c(){y.point=a,g.lineEnd()}function l(t,n){m.push([t,n]);var e=o(t,n);b.point(e[0],e[1])}function f(){b.lineStart(),m=[]}function h(){l(m[0][0],m[0][1]),b.lineEnd();var t,n=b.clean(),e=w.buffer(),r=e.length;if(m.pop(),p.push(m),m=null,r){if(1&n){t=e[0];var o,r=t.length-1,a=-1;for(i.lineStart();r>++a;)i.point((o=t[a])[0],o[1]);return i.lineEnd(),void 0}r>1&&2&n&&e.push(e.pop().concat(e.shift())),d.push(e.filter(Te))}}var d,p,m,g=n(i),v=o.invert(r[0],r[1]),y={point:a,lineStart:s,lineEnd:c,polygonStart:function(){y.point=l,y.lineStart=f,y.lineEnd=h,d=[],p=[],i.polygonStart()},polygonEnd:function(){y.point=a,y.lineStart=s,y.lineEnd=c,d=eo.merge(d);var t=Ye(v,p);d.length?Ce(d,Pe,t,e,i):t&&(i.lineStart(),e(null,null,1,i),i.lineEnd()),i.polygonEnd(),d=p=null},sphere:function(){i.polygonStart(),i.lineStart(),e(null,null,1,i),i.lineEnd(),i.polygonEnd()}},w=Le(),b=n(w);return y}}function Te(t){return t.length>1}function Le(){var t,n=[];return{lineStart:function(){n.push(t=[])},point:function(n,e){t.push([n,e])},lineEnd:s,buffer:function(){var e=n;return n=[],t=null,e},rejoin:function(){n.length>1&&n.push(n.pop().concat(n.shift()))}}}function Pe(t,n){return(0>(t=t.x)[0]?t[1]-li-fi:li-t[1])-(0>(n=n.x)[0]?n[1]-li-fi:li-n[1])}function Ae(){}function je(t,n,e){var r=e.s=t+n,o=r-t,i=r-o;e.t=t-i+(n-o)}function qe(t,n){t&&Xi.hasOwnProperty(t.type)&&Xi[t.type](t,n)}function Fe(t,n,e){var r,o=-1,i=t.length-e;for(n.lineStart();i>++o;)r=t[o],n.point(r[0],r[1],r[2]);n.lineEnd()}function Ie(t,n){var e=-1,r=t.length;for(n.polygonStart();r>++e;)Fe(t[e],n,1);n.polygonEnd()}function Oe(){function t(t,n){t*=di,n=n*di/2+si/4;var e=t-r,a=Math.cos(n),u=Math.sin(n),s=i*u,c=o*a+s*Math.cos(e),l=s*Math.sin(e);Ki.add(Math.atan2(l,c)),r=t,o=a,i=u}var n,e,r,o,i;Wi.point=function(a,u){Wi.point=t,r=(n=a)*di,o=Math.cos(u=(e=u)*di/2+si/4),i=Math.sin(u)},Wi.lineEnd=function(){t(n,e)}}function Ne(t){var n=t[0],e=t[1],r=Math.cos(e);return[r*Math.cos(n),r*Math.sin(n),Math.sin(e)]}function De(t,n){return t[0]*n[0]+t[1]*n[1]+t[2]*n[2]}function Re(t,n){return[t[1]*n[2]-t[2]*n[1],t[2]*n[0]-t[0]*n[2],t[0]*n[1]-t[1]*n[0]]}function Be(t,n){t[0]+=n[0],t[1]+=n[1],t[2]+=n[2]}function He(t,n){return[t[0]*n,t[1]*n,t[2]*n]}function Ue(t){var n=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]/=n,t[1]/=n,t[2]/=n}function Ye(t,n){var e=t[0],r=t[1],o=[Math.sin(e),-Math.cos(e),0],i=0,a=0;Ki.reset();for(var u=0,s=n.length;s>u;++u){var c=n[u],l=c.length;if(l)for(var f=c[0],h=f[0],d=f[1]/2+si/4,p=Math.sin(d),m=Math.cos(d),g=1;;){g===l&&(g=0),t=c[g];var v=t[0],y=t[1]/2+si/4,w=Math.sin(y),b=Math.cos(y),M=v-h,_=oo(M)>si,x=p*w;if(Ki.add(Math.atan2(x*Math.sin(M),m*b+x*Math.cos(M))),i+=_?M+(M>=0?ci:-ci):M,_^h>=e^v>=e){var z=Re(Ne(f),Ne(t));Ue(z);var C=Re(o,z);Ue(C);var E=(_^M>=0?-1:1)*Sn(C[2]);(r>E||r===E&&(z[0]||z[1]))&&(a+=_^M>=0?1:-1)}if(!g++)break;h=v,p=w,m=b,f=t}}return(-fi>i||fi>i&&0>Ki)^1&a}function Xe(t){var n,e=0/0,r=0/0,o=0/0;return{lineStart:function(){t.lineStart(),n=1},point:function(i,a){var u=i>0?si:-si,s=oo(i-e);fi>oo(s-si)?(t.point(e,r=(r+a)/2>0?li:-li),t.point(o,r),t.lineEnd(),t.lineStart(),t.point(u,r),t.point(i,r),n=0):o!==u&&s>=si&&(fi>oo(e-o)&&(e-=o*fi),fi>oo(i-u)&&(i-=u*fi),r=Ze(e,r,i,a),t.point(o,r),t.lineEnd(),t.lineStart(),t.point(u,r),n=0),t.point(e=i,r=a),o=u},lineEnd:function(){t.lineEnd(),e=r=0/0},clean:function(){return 2-n}}}function Ze(t,n,e,r){var o,i,a=Math.sin(t-e);return oo(a)>fi?Math.atan((Math.sin(n)*(i=Math.cos(r))*Math.sin(e)-Math.sin(r)*(o=Math.cos(n))*Math.sin(t))/(o*i*a)):(n+r)/2}function Ke(t,n,e,r){var o;if(null==t)o=e*li,r.point(-si,o),r.point(0,o),r.point(si,o),r.point(si,0),r.point(si,-o),r.point(0,-o),r.point(-si,-o),r.point(-si,0),r.point(-si,o);else if(oo(t[0]-n[0])>fi){var i=t[0]<n[0]?si:-si;o=e*i/2,r.point(-i,o),r.point(0,o),r.point(i,o)}else r.point(n[0],n[1])}function We(t,n){return[t,n]}function Ge(t,n){return[t>si?t-ci:-si>t?t+ci:t,n]}function Qe(t,n,e){return t?n||e?ir(Ve(t),Je(n,e)):Ve(t):n||e?Je(n,e):Ge}function $e(t){return function(n,e){return n+=t,[n>si?n-ci:-si>n?n+ci:n,e]}}function Ve(t){var n=$e(t);return n.invert=$e(-t),n}function Je(t,n){function e(t,n){var e=Math.cos(n),u=Math.cos(t)*e,s=Math.sin(t)*e,c=Math.sin(n),l=c*r+u*o;return[Math.atan2(s*i-l*a,u*r-c*o),Sn(l*i+s*a)]}var r=Math.cos(t),o=Math.sin(t),i=Math.cos(n),a=Math.sin(n);return e.invert=function(t,n){var e=Math.cos(n),u=Math.cos(t)*e,s=Math.sin(t)*e,c=Math.sin(n),l=c*i-s*a;return[Math.atan2(s*i+c*a,u*r+l*o),Sn(l*r-u*o)]},e}function tr(t,n){var e=Math.cos(t),r=Math.sin(t);return function(o,i,a,u){var s=a*n;null!=o?(o=nr(e,o),i=nr(e,i),(a>0?i>o:o>i)&&(o+=a*ci)):(o=t+a*ci,i=t-.5*s);for(var c,l=o;a>0?l>i:i>l;l-=s)u.point((c=xe([e,-r*Math.cos(l),-r*Math.sin(l)]))[0],c[1])}}function nr(t,n){var e=Ne(n);e[0]-=t,Ue(e);var r=kn(-e[1]);return((0>-e[2]?-r:r)+2*Math.PI-fi)%(2*Math.PI)}function er(t){function n(t,n){return Math.cos(t)*Math.cos(n)>i}function e(t){var e,i,s,c,l;return{lineStart:function(){c=s=!1,l=1},point:function(f,h){var d,p=[f,h],m=n(f,h),g=a?m?0:o(f,h):m?o(f+(0>f?si:-si),h):0;if(!e&&(c=s=m)&&t.lineStart(),m!==s&&(d=r(e,p),(ze(e,d)||ze(p,d))&&(p[0]+=fi,p[1]+=fi,m=n(p[0],p[1]))),m!==s)l=0,m?(t.lineStart(),d=r(p,e),t.point(d[0],d[1])):(d=r(e,p),t.point(d[0],d[1]),t.lineEnd()),e=d;else if(u&&e&&a^m){var v;g&i||!(v=r(p,e,!0))||(l=0,a?(t.lineStart(),t.point(v[0][0],v[0][1]),t.point(v[1][0],v[1][1]),t.lineEnd()):(t.point(v[1][0],v[1][1]),t.lineEnd(),t.lineStart(),t.point(v[0][0],v[0][1])))}!m||e&&ze(e,p)||t.point(p[0],p[1]),e=p,s=m,i=g},lineEnd:function(){s&&t.lineEnd(),e=null},clean:function(){return l|(c&&s)<<1}}}function r(t,n,e){var r=Ne(t),o=Ne(n),a=[1,0,0],u=Re(r,o),s=De(u,u),c=u[0],l=s-c*c;if(!l)return!e&&t;var f=i*s/l,h=-i*c/l,d=Re(a,u),p=He(a,f),m=He(u,h);Be(p,m);var g=d,v=De(p,g),y=De(g,g),w=v*v-y*(De(p,p)-1);if(!(0>w)){var b=Math.sqrt(w),M=He(g,(-v-b)/y);if(Be(M,p),M=xe(M),!e)return M;var _,x=t[0],z=n[0],C=t[1],E=n[1];x>z&&(_=x,x=z,z=_);var k=z-x,S=fi>oo(k-si),T=S||fi>k;if(!S&&C>E&&(_=C,C=E,E=_),T?S?C+E>0^M[1]<(fi>oo(M[0]-x)?C:E):M[1]>=C&&E>=M[1]:k>si^(M[0]>=x&&z>=M[0])){var L=He(g,(-v+b)/y);return Be(L,p),[M,xe(L)]}}}function o(n,e){var r=a?t:si-t,o=0;return-r>n?o|=1:n>r&&(o|=2),-r>e?o|=4:e>r&&(o|=8),o}var i=Math.cos(t),a=i>0,u=oo(i)>fi,s=tr(t,6*di);return Se(n,e,s,a?[0,-t]:[-si,t-si])}function rr(t,n,e,r){return function(o){var i,a=o.a,u=o.b,s=a.x,c=a.y,l=u.x,f=u.y,h=0,d=1,p=l-s,m=f-c;if(i=t-s,p||!(i>0)){if(i/=p,0>p){if(h>i)return;d>i&&(d=i)}else if(p>0){if(i>d)return;i>h&&(h=i)}if(i=e-s,p||!(0>i)){if(i/=p,0>p){if(i>d)return;i>h&&(h=i)}else if(p>0){if(h>i)return;d>i&&(d=i)}if(i=n-c,m||!(i>0)){if(i/=m,0>m){if(h>i)return;d>i&&(d=i)}else if(m>0){if(i>d)return;i>h&&(h=i)}if(i=r-c,m||!(0>i)){if(i/=m,0>m){if(i>d)return;i>h&&(h=i)}else if(m>0){if(h>i)return;d>i&&(d=i)}return h>0&&(o.a={x:s+h*p,y:c+h*m}),1>d&&(o.b={x:s+d*p,y:c+d*m}),o}}}}}}function or(t,n,e,r){function o(r,o){return fi>oo(r[0]-t)?o>0?0:3:fi>oo(r[0]-e)?o>0?2:1:fi>oo(r[1]-n)?o>0?1:0:o>0?3:2}function i(t,n){return a(t.x,n.x)}function a(t,n){var e=o(t,1),r=o(n,1);return e!==r?e-r:0===e?n[1]-t[1]:1===e?t[0]-n[0]:2===e?t[1]-n[1]:n[0]-t[0]}return function(u){function s(t){for(var n=0,e=v.length,r=t[1],o=0;e>o;++o)for(var i,a=1,u=v[o],s=u.length,l=u[0];s>a;++a)i=u[a],r>=l[1]?i[1]>r&&c(l,i,t)>0&&++n:r>=i[1]&&0>c(l,i,t)&&--n,l=i;return 0!==n}function c(t,n,e){return(n[0]-t[0])*(e[1]-t[1])-(e[0]-t[0])*(n[1]-t[1])}function l(i,u,s,c){var l=0,f=0;if(null==i||(l=o(i,s))!==(f=o(u,s))||0>a(i,u)^s>0){do c.point(0===l||3===l?t:e,l>1?r:n);while((l=(l+s+4)%4)!==f)}else c.point(u[0],u[1])}function f(o,i){return o>=t&&e>=o&&i>=n&&r>=i}function h(t,n){f(t,n)&&u.point(t,n)}function d(){L.point=m,v&&v.push(y=[]),C=!0,z=!1,_=x=0/0}function p(){g&&(m(w,b),M&&z&&S.rejoin(),g.push(S.buffer())),L.point=h,z&&u.lineEnd()}function m(t,n){t=Math.max(-Qi,Math.min(Qi,t)),n=Math.max(-Qi,Math.min(Qi,n));var e=f(t,n);if(v&&y.push([t,n]),C)w=t,b=n,M=e,C=!1,e&&(u.lineStart(),u.point(t,n));else if(e&&z)u.point(t,n);else{var r={a:{x:_,y:x},b:{x:t,y:n}};T(r)?(z||(u.lineStart(),u.point(r.a.x,r.a.y)),u.point(r.b.x,r.b.y),e||u.lineEnd(),E=!1):e&&(u.lineStart(),u.point(t,n),E=!1)}_=t,x=n,z=e}var g,v,y,w,b,M,_,x,z,C,E,k=u,S=Le(),T=rr(t,n,e,r),L={point:h,lineStart:d,lineEnd:p,polygonStart:function(){u=S,g=[],v=[],E=!0},polygonEnd:function(){u=k,g=eo.merge(g);var n=s([t,r]),e=E&&n,o=g.length;(e||o)&&(u.polygonStart(),e&&(u.lineStart(),l(null,null,1,u),u.lineEnd()),o&&Ce(g,i,n,l,u),u.polygonEnd()),g=v=y=null}};return L}}function ir(t,n){function e(e,r){return e=t(e,r),n(e[0],e[1])}return t.invert&&n.invert&&(e.invert=function(e,r){return e=n.invert(e,r),e&&t.invert(e[0],e[1])}),e}function ar(t){function n(t){return(u?r:e)(t)}function e(n){return sr(n,function(e,r){e=t(e,r),n.point(e[0],e[1])})}function r(n){function e(e,r){e=t(e,r),n.point(e[0],e[1])}function r(){w=0/0,z.point=i,n.lineStart()}function i(e,r){var i=Ne([e,r]),a=t(e,r);o(w,b,y,M,_,x,w=a[0],b=a[1],y=e,M=i[0],_=i[1],x=i[2],u,n),n.point(w,b)}function a(){z.point=e,n.lineEnd()}function s(){r(),z.point=c,z.lineEnd=l}function c(t,n){i(f=t,h=n),d=w,p=b,m=M,g=_,v=x,z.point=i}function l(){o(w,b,y,M,_,x,d,p,f,m,g,v,u,n),z.lineEnd=a,a()}var f,h,d,p,m,g,v,y,w,b,M,_,x,z={point:e,lineStart:r,lineEnd:a,polygonStart:function(){n.polygonStart(),z.lineStart=s},polygonEnd:function(){n.polygonEnd(),z.lineStart=r}};return z}function o(n,e,r,u,s,c,l,f,h,d,p,m,g,v){var y=l-n,w=f-e,b=y*y+w*w;if(b>4*i&&g--){var M=u+d,_=s+p,x=c+m,z=Math.sqrt(M*M+_*_+x*x),C=Math.asin(x/=z),E=fi>oo(oo(x)-1)||fi>oo(r-h)?(r+h)/2:Math.atan2(_,M),k=t(E,C),S=k[0],T=k[1],L=S-n,P=T-e,A=w*L-y*P;(A*A/b>i||oo((y*L+w*P)/b-.5)>.3||a>u*d+s*p+c*m)&&(o(n,e,r,u,s,c,S,T,E,M/=z,_/=z,x,g,v),v.point(S,T),o(S,T,E,M,_,x,l,f,h,d,p,m,g,v))}}var i=.5,a=Math.cos(30*di),u=16;return n.precision=function(t){return arguments.length?(u=(i=t*t)>0&&16,n):Math.sqrt(i)},n}function ur(t){this.stream=t}function sr(t,n){return{point:n,sphere:function(){t.sphere()},lineStart:function(){t.lineStart()},lineEnd:function(){t.lineEnd()},polygonStart:function(){t.polygonStart()},polygonEnd:function(){t.polygonEnd()}}}function cr(t){return lr(function(){return t})()}function lr(t){function n(t){return t=u(t[0]*di,t[1]*di),[t[0]*h+s,c-t[1]*h]}function e(t){return t=u.invert((t[0]-s)/h,(c-t[1])/h),t&&[t[0]*pi,t[1]*pi]}function r(){u=ir(a=Qe(v,y,w),i);var t=i(m,g);return s=d-t[0]*h,c=p+t[1]*h,o()}function o(){return l&&(l.valid=!1,l=null),n}var i,a,u,s,c,l,f=ar(function(t,n){return t=i(t,n),[t[0]*h+s,c-t[1]*h]}),h=150,d=480,p=250,m=0,g=0,v=0,y=0,w=0,b=Gi,M=re,_=null,x=null;return n.stream=function(t){return l&&(l.valid=!1),l=fr(b(a,f(M(t)))),l.valid=!0,l},n.clipAngle=function(t){return arguments.length?(b=null==t?(_=t,Gi):er((_=+t)*di),o()):_},n.clipExtent=function(t){return arguments.length?(x=t,M=t?or(t[0][0],t[0][1],t[1][0],t[1][1]):re,o()):x},n.scale=function(t){return arguments.length?(h=+t,r()):h},n.translate=function(t){return arguments.length?(d=+t[0],p=+t[1],r()):[d,p]},n.center=function(t){return arguments.length?(m=t[0]%360*di,g=t[1]%360*di,r()):[m*pi,g*pi]},n.rotate=function(t){return arguments.length?(v=t[0]%360*di,y=t[1]%360*di,w=t.length>2?t[2]%360*di:0,r()):[v*pi,y*pi,w*pi]},eo.rebind(n,f,"precision"),function(){return i=t.apply(this,arguments),n.invert=i.invert&&e,r()}}function fr(t){return sr(t,function(n,e){t.point(n*di,e*di)})}function hr(t){var n=0,e=si/3,r=lr(t),o=r(n,e);return o.parallels=function(t){return arguments.length?r(n=t[0]*si/180,e=t[1]*si/180):[180*(n/si),180*(e/si)]},o}function dr(t,n){function e(t,n){var e=Math.sqrt(i-2*o*Math.sin(n))/o;return[e*Math.sin(t*=o),a-e*Math.cos(t)]}var r=Math.sin(t),o=(r+Math.sin(n))/2,i=1+r*(2*o-r),a=Math.sqrt(i)/o;return e.invert=function(t,n){var e=a-n;return[Math.atan2(t,e)/o,Sn((i-(t*t+e*e)*o*o)/(2*o))]},e}function pr(t,n){t*=di;var e=Math.cos(n*=di);mr(e*Math.cos(t),e*Math.sin(t),Math.sin(n))}function mr(t,n,e){++$i,Ji+=(t-Ji)/$i,ta+=(n-ta)/$i,na+=(e-na)/$i}function gr(){function t(t,o){t*=di;var i=Math.cos(o*=di),a=i*Math.cos(t),u=i*Math.sin(t),s=Math.sin(o),c=Math.atan2(Math.sqrt((c=e*s-r*u)*c+(c=r*a-n*s)*c+(c=n*u-e*a)*c),n*a+e*u+r*s);Vi+=c,ea+=c*(n+(n=a)),ra+=c*(e+(e=u)),oa+=c*(r+(r=s)),mr(n,e,r)}var n,e,r;pa.point=function(o,i){o*=di;var a=Math.cos(i*=di);n=a*Math.cos(o),e=a*Math.sin(o),r=Math.sin(i),pa.point=t,mr(n,e,r)}}function vr(){pa.point=pr}function yr(){function t(t,n){t*=di;var e=Math.cos(n*=di),a=e*Math.cos(t),u=e*Math.sin(t),s=Math.sin(n),c=o*s-i*u,l=i*a-r*s,f=r*u-o*a,h=Math.sqrt(c*c+l*l+f*f),d=r*a+o*u+i*s,p=h&&-kn(d)/h,m=Math.atan2(h,d);ia+=p*c,aa+=p*l,ua+=p*f,Vi+=m,ea+=m*(r+(r=a)),ra+=m*(o+(o=u)),oa+=m*(i+(i=s)),mr(r,o,i)}var n,e,r,o,i;pa.point=function(a,u){n=a,e=u,pa.point=t,a*=di;var s=Math.cos(u*=di);r=s*Math.cos(a),o=s*Math.sin(a),i=Math.sin(u),mr(r,o,i)},pa.lineEnd=function(){t(n,e),pa.lineEnd=vr,pa.point=pr
}}function wr(){function t(t,n){ca+=o*t-r*n,r=t,o=n}var n,e,r,o;ma.point=function(i,a){ma.point=t,n=r=i,e=o=a},ma.lineEnd=function(){t(n,e)}}function br(t,n){la>t&&(la=t),t>ha&&(ha=t),fa>n&&(fa=n),n>da&&(da=n)}function Mr(){function t(t,n){a.push("M",t,",",n,i)}function n(t,n){a.push("M",t,",",n),u.point=e}function e(t,n){a.push("L",t,",",n)}function r(){u.point=t}function o(){a.push("Z")}var i=_r(4.5),a=[],u={point:t,lineStart:function(){u.point=n},lineEnd:r,polygonStart:function(){u.lineEnd=o},polygonEnd:function(){u.lineEnd=r,u.point=t},pointRadius:function(t){return i=_r(t),u},result:function(){if(a.length){var t=a.join("");return a=[],t}}};return u}function _r(t){return"m0,"+t+"a"+t+","+t+" 0 1,1 0,"+-2*t+"a"+t+","+t+" 0 1,1 0,"+2*t+"z"}function xr(t,n){Ji+=t,ta+=n,++na}function zr(){function t(t,r){var o=t-n,i=r-e,a=Math.sqrt(o*o+i*i);ea+=a*(n+t)/2,ra+=a*(e+r)/2,oa+=a,xr(n=t,e=r)}var n,e;va.point=function(r,o){va.point=t,xr(n=r,e=o)}}function Cr(){va.point=xr}function Er(){function t(t,n){var e=t-r,i=n-o,a=Math.sqrt(e*e+i*i);ea+=a*(r+t)/2,ra+=a*(o+n)/2,oa+=a,a=o*t-r*n,ia+=a*(r+t),aa+=a*(o+n),ua+=3*a,xr(r=t,o=n)}var n,e,r,o;va.point=function(i,a){va.point=t,xr(n=r=i,e=o=a)},va.lineEnd=function(){t(n,e)}}function kr(t){function n(n,e){t.moveTo(n,e),t.arc(n,e,a,0,ci)}function e(n,e){t.moveTo(n,e),u.point=r}function r(n,e){t.lineTo(n,e)}function o(){u.point=n}function i(){t.closePath()}var a=4.5,u={point:n,lineStart:function(){u.point=e},lineEnd:o,polygonStart:function(){u.lineEnd=i},polygonEnd:function(){u.lineEnd=o,u.point=n},pointRadius:function(t){return a=t,u},result:s};return u}function Sr(t){var n=ar(function(n,e){return t([n*pi,e*pi])});return function(t){return fr(n(t))}}function Tr(t){return function(n){return 0>=n?0:n>=1?1:t(n)}}function Lr(t){return function(n){return 1-t(1-n)}}function Pr(t){return function(n){return.5*(.5>n?t(2*n):2-t(2-2*n))}}function Ar(t){return t*t}function jr(t){return t*t*t}function qr(t){if(0>=t)return 0;if(t>=1)return 1;var n=t*t,e=n*t;return 4*(.5>t?e:3*(t-n)+e-.75)}function Fr(t){return function(n){return Math.pow(n,t)}}function Ir(t){return 1-Math.cos(t*li)}function Or(t){return Math.pow(2,10*(t-1))}function Nr(t){return 1-Math.sqrt(1-t*t)}function Dr(t,n){var e;return 2>arguments.length&&(n=.45),arguments.length?e=n/ci*Math.asin(1/t):(t=1,e=n/4),function(r){return 1+t*Math.pow(2,-10*r)*Math.sin((r-e)*ci/n)}}function Rr(t){return t||(t=1.70158),function(n){return n*n*((t+1)*n-t)}}function Br(t){return 1/2.75>t?7.5625*t*t:2/2.75>t?7.5625*(t-=1.5/2.75)*t+.75:2.5/2.75>t?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375}function Hr(t,n){return go(t,xa),t.id=n,t}function Ur(t){var n=[t.a,t.b],e=[t.c,t.d],r=Xr(n),o=Yr(n,e),i=Xr(Zr(e,n,-o))||0;n[0]*e[1]<e[0]*n[1]&&(n[0]*=-1,n[1]*=-1,r*=-1,o*=-1),this.rotate=(r?Math.atan2(n[1],n[0]):Math.atan2(-e[0],e[1]))*pi,this.translate=[t.e,t.f],this.scale=[r,i],this.skew=i?Math.atan2(o,i)*pi:0}function Yr(t,n){return t[0]*n[0]+t[1]*n[1]}function Xr(t){var n=Math.sqrt(Yr(t,t));return n&&(t[0]/=n,t[1]/=n),n}function Zr(t,n,e){return t[0]+=e*n[0],t[1]+=e*n[1],t}function Kr(t,n){var e,r=[],o=[],i=eo.transform(t),a=eo.transform(n),u=i.translate,s=a.translate,c=i.rotate,l=a.rotate,f=i.skew,h=a.skew,d=i.scale,p=a.scale;return u[0]!=s[0]||u[1]!=s[1]?(r.push("translate(",null,",",null,")"),o.push({i:1,x:$n(u[0],s[0])},{i:3,x:$n(u[1],s[1])})):s[0]||s[1]?r.push("translate("+s+")"):r.push(""),c!=l?(c-l>180?l+=360:l-c>180&&(c+=360),o.push({i:r.push(r.pop()+"rotate(",null,")")-2,x:$n(c,l)})):l&&r.push(r.pop()+"rotate("+l+")"),f!=h?o.push({i:r.push(r.pop()+"skewX(",null,")")-2,x:$n(f,h)}):h&&r.push(r.pop()+"skewX("+h+")"),d[0]!=p[0]||d[1]!=p[1]?(e=r.push(r.pop()+"scale(",null,",",null,")"),o.push({i:e-4,x:$n(d[0],p[0])},{i:e-2,x:$n(d[1],p[1])})):(1!=p[0]||1!=p[1])&&r.push(r.pop()+"scale("+p+")"),e=o.length,function(t){for(var n,i=-1;e>++i;)r[(n=o[i]).i]=n.x(t);return r.join("")}}function Wr(t,n,e,r){var o=t.id;return S(t,"function"==typeof e?function(t,i,a){t.__transition__[o].tween.set(n,r(e.call(t,t.__data__,i,a)))}:(e=r(e),function(t){t.__transition__[o].tween.set(n,e)}))}function Gr(t){return null==t&&(t=""),function(){this.textContent=t}}function Qr(t,n,e,r){var i=t.__transition__||(t.__transition__={active:0,count:0}),a=i[e];if(!a){var u=r.time;a=i[e]={tween:new o,time:u,ease:r.ease,delay:r.delay,duration:r.duration},++i.count,eo.timer(function(r){function o(r){return i.active>e?c():(i.active=e,a.event&&a.event.start.call(t,l,n),a.tween.forEach(function(e,r){(r=r.call(t,l,n))&&m.push(r)}),eo.timer(function(){return p.c=s(r||1)?_n:s,1},0,u),void 0)}function s(r){if(i.active!==e)return c();for(var o=r/d,u=f(o),s=m.length;s>0;)m[--s].call(t,u);return o>=1?(a.event&&a.event.end.call(t,l,n),c()):void 0}function c(){return--i.count?delete i[e]:delete t.__transition__,1}var l=t.__data__,f=a.ease,h=a.delay,d=a.duration,p=jo,m=[];return p.t=h+u,r>=h?o(r-h):(p.c=o,void 0)},0,u)}}function $r(t){return function(n,e,r){return 2===arguments.length&&"function"==typeof e&&(r=e,e=null),Vr(n,e,t,r)}}function Vr(t,n,e,r){function o(){var t,n=s.status;if(!n&&s.responseText||n>=200&&300>n||304===n){try{t=e.call(i,s)}catch(r){return a.error.call(i,r),void 0}a.load.call(i,t)}else a.error.call(i,s)}var i={},a=eo.dispatch("beforesend","progress","load","error"),u={},s=new XMLHttpRequest,c=null;return!fo.XDomainRequest||"withCredentials"in s||!/^(http(s)?:)?\/\//.test(t)||(s=new XDomainRequest),"onload"in s?s.onload=s.onerror=o:s.onreadystatechange=function(){s.readyState>3&&o()},s.onprogress=function(t){var n=eo.event;eo.event=t;try{a.progress.call(i,s)}finally{eo.event=n}},i.header=function(t,n){return t=(t+"").toLowerCase(),2>arguments.length?u[t]:(null==n?delete u[t]:u[t]=n+"",i)},i.mimeType=function(t){return arguments.length?(n=null==t?null:t+"",i):n},i.responseType=function(t){return arguments.length?(c=t,i):c},i.response=function(t){return e=t,i},["get","post"].forEach(function(t){i[t]=function(){return i.send.apply(i,[t].concat(so(arguments)))}}),i.send=function(e,r,o){if(2===arguments.length&&"function"==typeof r&&(o=r,r=null),s.open(e,t,!0),null==n||"accept"in u||(u.accept=n+",*/*"),s.setRequestHeader)for(var l in u)s.setRequestHeader(l,u[l]);return null!=n&&s.overrideMimeType&&s.overrideMimeType(n),null!=c&&(s.responseType=c),null!=o&&i.on("error",o).on("load",function(t){o(null,t)}),a.beforesend.call(i,s),s.send(null==r?null:r),i},i.abort=function(){return s.abort(),i},eo.rebind(i,a,"on"),null==r?i:i.get(Jr(r))}function Jr(t){return 1===t.length?function(n,e){t(null==n?e:null)}:t}function to(t){return JSON.parse(t.responseText)}function no(t){var n=co.createRange();return n.selectNode(co.body),n.createContextualFragment(t.responseText)}var eo={version:"3.3.10"};eo.ascending=function(t,n){return n>t?-1:t>n?1:t>=n?0:0/0},eo.descending=function(t,n){return t>n?-1:n>t?1:n>=t?0:0/0},eo.min=function(t,n){var e,r,o=-1,i=t.length;if(1===arguments.length){for(;i>++o&&!(null!=(e=t[o])&&e>=e);)e=void 0;for(;i>++o;)null!=(r=t[o])&&e>r&&(e=r)}else{for(;i>++o&&!(null!=(e=n.call(t,t[o],o))&&e>=e);)e=void 0;for(;i>++o;)null!=(r=n.call(t,t[o],o))&&e>r&&(e=r)}return e},eo.max=function(t,n){var e,r,o=-1,i=t.length;if(1===arguments.length){for(;i>++o&&!(null!=(e=t[o])&&e>=e);)e=void 0;for(;i>++o;)null!=(r=t[o])&&r>e&&(e=r)}else{for(;i>++o&&!(null!=(e=n.call(t,t[o],o))&&e>=e);)e=void 0;for(;i>++o;)null!=(r=n.call(t,t[o],o))&&r>e&&(e=r)}return e},eo.extent=function(t,n){var e,r,o,i=-1,a=t.length;if(1===arguments.length){for(;a>++i&&!(null!=(e=o=t[i])&&e>=e);)e=o=void 0;for(;a>++i;)null!=(r=t[i])&&(e>r&&(e=r),r>o&&(o=r))}else{for(;a>++i&&!(null!=(e=o=n.call(t,t[i],i))&&e>=e);)e=void 0;for(;a>++i;)null!=(r=n.call(t,t[i],i))&&(e>r&&(e=r),r>o&&(o=r))}return[e,o]},eo.sum=function(t,n){var e,r=0,o=t.length,i=-1;if(1===arguments.length)for(;o>++i;)isNaN(e=+t[i])||(r+=e);else for(;o>++i;)isNaN(e=+n.call(t,t[i],i))||(r+=e);return r},eo.mean=function(n,e){var r,o=n.length,i=0,a=-1,u=0;if(1===arguments.length)for(;o>++a;)t(r=n[a])&&(i+=(r-i)/++u);else for(;o>++a;)t(r=e.call(n,n[a],a))&&(i+=(r-i)/++u);return u?i:void 0},eo.quantile=function(t,n){var e=(t.length-1)*n+1,r=Math.floor(e),o=+t[r-1],i=e-r;return i?o+i*(t[r]-o):o},eo.median=function(n,e){return arguments.length>1&&(n=n.map(e)),n=n.filter(t),n.length?eo.quantile(n.sort(eo.ascending),.5):void 0},eo.bisector=function(t){return{left:function(n,e,r,o){for(3>arguments.length&&(r=0),4>arguments.length&&(o=n.length);o>r;){var i=r+o>>>1;e>t.call(n,n[i],i)?r=i+1:o=i}return r},right:function(n,e,r,o){for(3>arguments.length&&(r=0),4>arguments.length&&(o=n.length);o>r;){var i=r+o>>>1;t.call(n,n[i],i)>e?o=i:r=i+1}return r}}};var ro=eo.bisector(function(t){return t});eo.bisectLeft=ro.left,eo.bisect=eo.bisectRight=ro.right,eo.shuffle=function(t){for(var n,e,r=t.length;r;)e=0|Math.random()*r--,n=t[r],t[r]=t[e],t[e]=n;return t},eo.permute=function(t,n){for(var e=n.length,r=Array(e);e--;)r[e]=t[n[e]];return r},eo.pairs=function(t){for(var n,e=0,r=t.length-1,o=t[0],i=Array(0>r?0:r);r>e;)i[e]=[n=o,o=t[++e]];return i},eo.zip=function(){if(!(o=arguments.length))return[];for(var t=-1,e=eo.min(arguments,n),r=Array(e);e>++t;)for(var o,i=-1,a=r[t]=Array(o);o>++i;)a[i]=arguments[i][t];return r},eo.transpose=function(t){return eo.zip.apply(eo,t)},eo.keys=function(t){var n=[];for(var e in t)n.push(e);return n},eo.values=function(t){var n=[];for(var e in t)n.push(t[e]);return n},eo.entries=function(t){var n=[];for(var e in t)n.push({key:e,value:t[e]});return n},eo.merge=function(t){for(var n,e,r,o=t.length,i=-1,a=0;o>++i;)a+=t[i].length;for(e=Array(a);--o>=0;)for(r=t[o],n=r.length;--n>=0;)e[--a]=r[n];return e};var oo=Math.abs;eo.range=function(t,n,r){if(3>arguments.length&&(r=1,2>arguments.length&&(n=t,t=0)),1/0===(n-t)/r)throw Error("infinite range");var o,i=[],a=e(oo(r)),u=-1;if(t*=a,n*=a,r*=a,0>r)for(;(o=t+r*++u)>n;)i.push(o/a);else for(;n>(o=t+r*++u);)i.push(o/a);return i},eo.map=function(t){var n=new o;if(t instanceof o)t.forEach(function(t,e){n.set(t,e)});else for(var e in t)n.set(e,t[e]);return n},r(o,{has:function(t){return io+t in this},get:function(t){return this[io+t]},set:function(t,n){return this[io+t]=n},remove:function(t){return t=io+t,t in this&&delete this[t]},keys:function(){var t=[];return this.forEach(function(n){t.push(n)}),t},values:function(){var t=[];return this.forEach(function(n,e){t.push(e)}),t},entries:function(){var t=[];return this.forEach(function(n,e){t.push({key:n,value:e})}),t},forEach:function(t){for(var n in this)n.charCodeAt(0)===ao&&t.call(this,n.substring(1),this[n])}});var io="\0",ao=io.charCodeAt(0);eo.nest=function(){function t(n,u,s){if(s>=a.length)return r?r.call(i,u):e?u.sort(e):u;for(var c,l,f,h,d=-1,p=u.length,m=a[s++],g=new o;p>++d;)(h=g.get(c=m(l=u[d])))?h.push(l):g.set(c,[l]);return n?(l=n(),f=function(e,r){l.set(e,t(n,r,s))}):(l={},f=function(e,r){l[e]=t(n,r,s)}),g.forEach(f),l}function n(t,e){if(e>=a.length)return t;var r=[],o=u[e++];return t.forEach(function(t,o){r.push({key:t,values:n(o,e)})}),o?r.sort(function(t,n){return o(t.key,n.key)}):r}var e,r,i={},a=[],u=[];return i.map=function(n,e){return t(e,n,0)},i.entries=function(e){return n(t(eo.map,e,0),0)},i.key=function(t){return a.push(t),i},i.sortKeys=function(t){return u[a.length-1]=t,i},i.sortValues=function(t){return e=t,i},i.rollup=function(t){return r=t,i},i},eo.set=function(t){var n=new i;if(t)for(var e=0,r=t.length;r>e;++e)n.add(t[e]);return n},r(i,{has:function(t){return io+t in this},add:function(t){return this[io+t]=!0,t},remove:function(t){return t=io+t,t in this&&delete this[t]},values:function(){var t=[];return this.forEach(function(n){t.push(n)}),t},forEach:function(t){for(var n in this)n.charCodeAt(0)===ao&&t.call(this,n.substring(1))}}),eo.behavior={};var uo=[].slice,so=function(t){return uo.call(t)},co=document,lo=co.documentElement,fo=window;try{so(lo.childNodes)[0].nodeType}catch(ho){so=function(t){for(var n=t.length,e=Array(n);n--;)e[n]=t[n];return e}}eo.rebind=function(t,n){for(var e,r=1,o=arguments.length;o>++r;)t[e=arguments[r]]=a(t,n,n[e]);return t};var po=["webkit","ms","moz","Moz","o","O"];eo.dispatch=function(){for(var t=new c,n=-1,e=arguments.length;e>++n;)t[arguments[n]]=l(t);return t},c.prototype.on=function(t,n){var e=t.indexOf("."),r="";if(e>=0&&(r=t.substring(e+1),t=t.substring(0,e)),t)return 2>arguments.length?this[t].on(r):this[t].on(r,n);if(2===arguments.length){if(null==n)for(t in this)this.hasOwnProperty(t)&&this[t].on(r,null);return this}},eo.event=null,eo.requote=function(t){return t.replace(mo,"\\$&")};var mo=/[\\\^\$\*\+\?\|\[\]\(\)\.\{\}]/g,go={}.__proto__?function(t,n){t.__proto__=n}:function(t,n){for(var e in n)t[e]=n[e]},vo=function(t,n){return n.querySelector(t)},yo=function(t,n){return n.querySelectorAll(t)},wo=lo[u(lo,"matchesSelector")],bo=function(t,n){return wo.call(t,n)};"function"==typeof Sizzle&&(vo=function(t,n){return Sizzle(t,n)[0]||null},yo=function(t,n){return Sizzle.uniqueSort(Sizzle(t,n))},bo=Sizzle.matchesSelector),eo.selection=function(){return zo};var Mo=eo.selection.prototype=[];Mo.select=function(t){var n,e,r,o,i=[];t=m(t);for(var a=-1,u=this.length;u>++a;){i.push(n=[]),n.parentNode=(r=this[a]).parentNode;for(var s=-1,c=r.length;c>++s;)(o=r[s])?(n.push(e=t.call(o,o.__data__,s,a)),e&&"__data__"in o&&(e.__data__=o.__data__)):n.push(null)}return p(i)},Mo.selectAll=function(t){var n,e,r=[];t=g(t);for(var o=-1,i=this.length;i>++o;)for(var a=this[o],u=-1,s=a.length;s>++u;)(e=a[u])&&(r.push(n=so(t.call(e,e.__data__,u,o))),n.parentNode=e);return p(r)};var _o={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};eo.ns={prefix:_o,qualify:function(t){var n=t.indexOf(":"),e=t;return n>=0&&(e=t.substring(0,n),t=t.substring(n+1)),_o.hasOwnProperty(e)?{space:_o[e],local:t}:t}},Mo.attr=function(t,n){if(2>arguments.length){if("string"==typeof t){var e=this.node();return t=eo.ns.qualify(t),t.local?e.getAttributeNS(t.space,t.local):e.getAttribute(t)}for(n in t)this.each(v(n,t[n]));return this}return this.each(v(t,n))},Mo.classed=function(t,n){if(2>arguments.length){if("string"==typeof t){var e=this.node(),r=(t=t.trim().split(/^|\s+/g)).length,o=-1;if(n=e.classList){for(;r>++o;)if(!n.contains(t[o]))return!1}else for(n=e.getAttribute("class");r>++o;)if(!w(t[o]).test(n))return!1;return!0}for(n in t)this.each(b(n,t[n]));return this}return this.each(b(t,n))},Mo.style=function(t,n,e){var r=arguments.length;if(3>r){if("string"!=typeof t){2>r&&(n="");for(e in t)this.each(_(e,t[e],n));return this}if(2>r)return fo.getComputedStyle(this.node(),null).getPropertyValue(t);e=""}return this.each(_(t,n,e))},Mo.property=function(t,n){if(2>arguments.length){if("string"==typeof t)return this.node()[t];for(n in t)this.each(x(n,t[n]));return this}return this.each(x(t,n))},Mo.text=function(t){return arguments.length?this.each("function"==typeof t?function(){var n=t.apply(this,arguments);this.textContent=null==n?"":n}:null==t?function(){this.textContent=""}:function(){this.textContent=t}):this.node().textContent},Mo.html=function(t){return arguments.length?this.each("function"==typeof t?function(){var n=t.apply(this,arguments);this.innerHTML=null==n?"":n}:null==t?function(){this.innerHTML=""}:function(){this.innerHTML=t}):this.node().innerHTML},Mo.append=function(t){return t=z(t),this.select(function(){return this.appendChild(t.apply(this,arguments))})},Mo.insert=function(t,n){return t=z(t),n=m(n),this.select(function(){return this.insertBefore(t.apply(this,arguments),n.apply(this,arguments)||null)})},Mo.remove=function(){return this.each(function(){var t=this.parentNode;t&&t.removeChild(this)})},Mo.data=function(t,n){function e(t,e){var r,i,a,u=t.length,f=e.length,h=Math.min(u,f),d=Array(f),p=Array(f),m=Array(u);if(n){var g,v=new o,y=new o,w=[];for(r=-1;u>++r;)g=n.call(i=t[r],i.__data__,r),v.has(g)?m[r]=i:v.set(g,i),w.push(g);for(r=-1;f>++r;)g=n.call(e,a=e[r],r),(i=v.get(g))?(d[r]=i,i.__data__=a):y.has(g)||(p[r]=C(a)),y.set(g,a),v.remove(g);for(r=-1;u>++r;)v.has(w[r])&&(m[r]=t[r])}else{for(r=-1;h>++r;)i=t[r],a=e[r],i?(i.__data__=a,d[r]=i):p[r]=C(a);for(;f>r;++r)p[r]=C(e[r]);for(;u>r;++r)m[r]=t[r]}p.update=d,p.parentNode=d.parentNode=m.parentNode=t.parentNode,s.push(p),c.push(d),l.push(m)}var r,i,a=-1,u=this.length;if(!arguments.length){for(t=Array(u=(r=this[0]).length);u>++a;)(i=r[a])&&(t[a]=i.__data__);return t}var s=T([]),c=p([]),l=p([]);if("function"==typeof t)for(;u>++a;)e(r=this[a],t.call(r,r.parentNode.__data__,a));else for(;u>++a;)e(r=this[a],t);return c.enter=function(){return s},c.exit=function(){return l},c},Mo.datum=function(t){return arguments.length?this.property("__data__",t):this.property("__data__")},Mo.filter=function(t){var n,e,r,o=[];"function"!=typeof t&&(t=E(t));for(var i=0,a=this.length;a>i;i++){o.push(n=[]),n.parentNode=(e=this[i]).parentNode;for(var u=0,s=e.length;s>u;u++)(r=e[u])&&t.call(r,r.__data__,u,i)&&n.push(r)}return p(o)},Mo.order=function(){for(var t=-1,n=this.length;n>++t;)for(var e,r=this[t],o=r.length-1,i=r[o];--o>=0;)(e=r[o])&&(i&&i!==e.nextSibling&&i.parentNode.insertBefore(e,i),i=e);return this},Mo.sort=function(t){t=k.apply(this,arguments);for(var n=-1,e=this.length;e>++n;)this[n].sort(t);return this.order()},Mo.each=function(t){return S(this,function(n,e,r){t.call(n,n.__data__,e,r)})},Mo.call=function(t){var n=so(arguments);return t.apply(n[0]=this,n),this},Mo.empty=function(){return!this.node()},Mo.node=function(){for(var t=0,n=this.length;n>t;t++)for(var e=this[t],r=0,o=e.length;o>r;r++){var i=e[r];if(i)return i}return null},Mo.size=function(){var t=0;return this.each(function(){++t}),t};var xo=[];eo.selection.enter=T,eo.selection.enter.prototype=xo,xo.append=Mo.append,xo.empty=Mo.empty,xo.node=Mo.node,xo.call=Mo.call,xo.size=Mo.size,xo.select=function(t){for(var n,e,r,o,i,a=[],u=-1,s=this.length;s>++u;){r=(o=this[u]).update,a.push(n=[]),n.parentNode=o.parentNode;for(var c=-1,l=o.length;l>++c;)(i=o[c])?(n.push(r[c]=e=t.call(o.parentNode,i.__data__,c,u)),e.__data__=i.__data__):n.push(null)}return p(a)},xo.insert=function(t,n){return 2>arguments.length&&(n=L(this)),Mo.insert.call(this,t,n)},Mo.transition=function(){for(var t,n,e=Ma||++za,r=[],o=_a||{time:Date.now(),ease:qr,delay:0,duration:250},i=-1,a=this.length;a>++i;){r.push(t=[]);for(var u=this[i],s=-1,c=u.length;c>++s;)(n=u[s])&&Qr(n,s,e,o),t.push(n)}return Hr(r,e)},Mo.interrupt=function(){return this.each(P)},eo.select=function(t){var n=["string"==typeof t?vo(t,co):t];return n.parentNode=lo,p([n])},eo.selectAll=function(t){var n=so("string"==typeof t?yo(t,co):t);return n.parentNode=lo,p([n])};var zo=eo.select(lo);Mo.on=function(t,n,e){var r=arguments.length;if(3>r){if("string"!=typeof t){2>r&&(n=!1);for(e in t)this.each(A(e,t[e],n));return this}if(2>r)return(r=this.node()["__on"+t])&&r._;e=!1}return this.each(A(t,n,e))};var Co=eo.map({mouseenter:"mouseover",mouseleave:"mouseout"});Co.forEach(function(t){"on"+t in co&&Co.remove(t)});var Eo="onselectstart"in co?null:u(lo.style,"userSelect"),ko=0;eo.mouse=function(t){return I(t,h())};var So=/WebKit/.test(fo.navigator.userAgent)?-1:0;eo.touches=function(t,n){return 2>arguments.length&&(n=h().touches),n?so(n).map(function(n){var e=I(t,n);return e.identifier=n.identifier,e}):[]},eo.behavior.drag=function(){function t(){this.on("mousedown.drag",a).on("touchstart.drag",u)}function n(){return eo.event.changedTouches[0].identifier}function e(t,n){return eo.touches(t).filter(function(t){return t.identifier===n})[0]}function r(t,n,e,r){return function(){function a(){var t=n(l,d),e=t[0]-m[0],r=t[1]-m[1];g|=e|r,m=t,f({type:"drag",x:t[0]+s[0],y:t[1]+s[1],dx:e,dy:r})}function u(){v.on(e+"."+p,null).on(r+"."+p,null),y(g&&eo.event.target===h),f({type:"dragend"})}var s,c=this,l=c.parentNode,f=o.of(c,arguments),h=eo.event.target,d=t(),p=null==d?"drag":"drag-"+d,m=n(l,d),g=0,v=eo.select(fo).on(e+"."+p,a).on(r+"."+p,u),y=F();i?(s=i.apply(c,arguments),s=[s.x-m[0],s.y-m[1]]):s=[0,0],f({type:"dragstart"})}}var o=d(t,"drag","dragstart","dragend"),i=null,a=r(s,eo.mouse,"mousemove","mouseup"),u=r(n,e,"touchmove","touchend");return t.origin=function(n){return arguments.length?(i=n,t):i},eo.rebind(t,o,"on")},eo.functor=O;var To,Lo,Po,Ao,jo,qo=fo[u(fo,"requestAnimationFrame")]||function(t){setTimeout(t,17)};eo.timer=function(t,n,e){var r=arguments.length;2>r&&(n=0),3>r&&(e=Date.now());var o=e+n,i={c:t,t:o,f:!1,n:null};Lo?Lo.n=i:To=i,Lo=i,Po||(Ao=clearTimeout(Ao),Po=1,qo(N))},eo.timer.flush=function(){D(),R()};var Fo=eo.time={},Io=Date,Oo=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];B.prototype={getDate:function(){return this._.getUTCDate()},getDay:function(){return this._.getUTCDay()},getFullYear:function(){return this._.getUTCFullYear()},getHours:function(){return this._.getUTCHours()},getMilliseconds:function(){return this._.getUTCMilliseconds()},getMinutes:function(){return this._.getUTCMinutes()},getMonth:function(){return this._.getUTCMonth()},getSeconds:function(){return this._.getUTCSeconds()},getTime:function(){return this._.getTime()},getTimezoneOffset:function(){return 0},valueOf:function(){return this._.valueOf()},setDate:function(){No.setUTCDate.apply(this._,arguments)},setDay:function(){No.setUTCDay.apply(this._,arguments)},setFullYear:function(){No.setUTCFullYear.apply(this._,arguments)},setHours:function(){No.setUTCHours.apply(this._,arguments)},setMilliseconds:function(){No.setUTCMilliseconds.apply(this._,arguments)},setMinutes:function(){No.setUTCMinutes.apply(this._,arguments)},setMonth:function(){No.setUTCMonth.apply(this._,arguments)},setSeconds:function(){No.setUTCSeconds.apply(this._,arguments)},setTime:function(){No.setTime.apply(this._,arguments)}};var No=Date.prototype,Do="%a %b %e %X %Y",Ro="%m/%d/%Y",Bo="%H:%M:%S",Ho=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],Uo=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],Yo=["January","February","March","April","May","June","July","August","September","October","November","December"],Xo=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];Fo.year=H(function(t){return t=Fo.day(t),t.setMonth(0,1),t},function(t,n){t.setFullYear(t.getFullYear()+n)},function(t){return t.getFullYear()}),Fo.years=Fo.year.range,Fo.years.utc=Fo.year.utc.range,Fo.day=H(function(t){var n=new Io(2e3,0);return n.setFullYear(t.getFullYear(),t.getMonth(),t.getDate()),n},function(t,n){t.setDate(t.getDate()+n)},function(t){return t.getDate()-1}),Fo.days=Fo.day.range,Fo.days.utc=Fo.day.utc.range,Fo.dayOfYear=function(t){var n=Fo.year(t);return Math.floor((t-n-6e4*(t.getTimezoneOffset()-n.getTimezoneOffset()))/864e5)},Oo.forEach(function(t,n){t=t.toLowerCase(),n=7-n;var e=Fo[t]=H(function(t){return(t=Fo.day(t)).setDate(t.getDate()-(t.getDay()+n)%7),t},function(t,n){t.setDate(t.getDate()+7*Math.floor(n))},function(t){var e=Fo.year(t).getDay();return Math.floor((Fo.dayOfYear(t)+(e+n)%7)/7)-(e!==n)});Fo[t+"s"]=e.range,Fo[t+"s"].utc=e.utc.range,Fo[t+"OfYear"]=function(t){var e=Fo.year(t).getDay();return Math.floor((Fo.dayOfYear(t)+(e+n)%7)/7)}}),Fo.week=Fo.sunday,Fo.weeks=Fo.sunday.range,Fo.weeks.utc=Fo.sunday.utc.range,Fo.weekOfYear=Fo.sundayOfYear,Fo.format=Y;var Zo=Z(Ho),Ko=K(Ho),Wo=Z(Uo),Go=K(Uo),Qo=Z(Yo),$o=K(Yo),Vo=Z(Xo),Jo=K(Xo),ti=/^%/,ni={"-":"",_:" ",0:"0"},ei={a:function(t){return Uo[t.getDay()]},A:function(t){return Ho[t.getDay()]},b:function(t){return Xo[t.getMonth()]},B:function(t){return Yo[t.getMonth()]},c:Y(Do),d:function(t,n){return W(t.getDate(),n,2)},e:function(t,n){return W(t.getDate(),n,2)},H:function(t,n){return W(t.getHours(),n,2)},I:function(t,n){return W(t.getHours()%12||12,n,2)},j:function(t,n){return W(1+Fo.dayOfYear(t),n,3)},L:function(t,n){return W(t.getMilliseconds(),n,3)},m:function(t,n){return W(t.getMonth()+1,n,2)},M:function(t,n){return W(t.getMinutes(),n,2)},p:function(t){return t.getHours()>=12?"PM":"AM"},S:function(t,n){return W(t.getSeconds(),n,2)},U:function(t,n){return W(Fo.sundayOfYear(t),n,2)},w:function(t){return t.getDay()},W:function(t,n){return W(Fo.mondayOfYear(t),n,2)},x:Y(Ro),X:Y(Bo),y:function(t,n){return W(t.getFullYear()%100,n,2)},Y:function(t,n){return W(t.getFullYear()%1e4,n,4)},Z:yn,"%":function(){return"%"}},ri={a:G,A:Q,b:tn,B:nn,c:en,d:fn,e:fn,H:dn,I:dn,j:hn,L:gn,m:ln,M:pn,p:vn,S:mn,U:V,w:$,W:J,x:rn,X:on,y:un,Y:an,Z:sn,"%":wn},oi=/^\s*\d+/,ii=eo.map({am:0,pm:1});Y.utc=bn;var ai=bn("%Y-%m-%dT%H:%M:%S.%LZ");Y.iso=Date.prototype.toISOString&&+new Date("2000-01-01T00:00:00.000Z")?Mn:ai,Mn.parse=function(t){var n=new Date(t);return isNaN(n)?null:n},Mn.toString=ai.toString,Fo.second=H(function(t){return new Io(1e3*Math.floor(t/1e3))},function(t,n){t.setTime(t.getTime()+1e3*Math.floor(n))},function(t){return t.getSeconds()}),Fo.seconds=Fo.second.range,Fo.seconds.utc=Fo.second.utc.range,Fo.minute=H(function(t){return new Io(6e4*Math.floor(t/6e4))},function(t,n){t.setTime(t.getTime()+6e4*Math.floor(n))},function(t){return t.getMinutes()}),Fo.minutes=Fo.minute.range,Fo.minutes.utc=Fo.minute.utc.range,Fo.hour=H(function(t){var n=t.getTimezoneOffset()/60;return new Io(36e5*(Math.floor(t/36e5-n)+n))},function(t,n){t.setTime(t.getTime()+36e5*Math.floor(n))},function(t){return t.getHours()}),Fo.hours=Fo.hour.range,Fo.hours.utc=Fo.hour.utc.range,Fo.month=H(function(t){return t=Fo.day(t),t.setDate(1),t},function(t,n){t.setMonth(t.getMonth()+n)},function(t){return t.getMonth()}),Fo.months=Fo.month.range,Fo.months.utc=Fo.month.utc.range,xn.prototype.toString=function(){return this.rgb()+""},eo.hsl=function(t,n,e){return 1===arguments.length?t instanceof Cn?zn(t.h,t.s,t.l):Un(""+t,Yn,zn):zn(+t,+n,+e)};var ui=Cn.prototype=new xn;ui.brighter=function(t){return t=Math.pow(.7,arguments.length?t:1),zn(this.h,this.s,this.l/t)},ui.darker=function(t){return t=Math.pow(.7,arguments.length?t:1),zn(this.h,this.s,t*this.l)},ui.rgb=function(){return En(this.h,this.s,this.l)};var si=Math.PI,ci=2*si,li=si/2,fi=1e-6,hi=fi*fi,di=si/180,pi=180/si;eo.hcl=function(t,n,e){return 1===arguments.length?t instanceof Ln?Tn(t.h,t.c,t.l):t instanceof jn?Fn(t.l,t.a,t.b):Fn((t=Xn((t=eo.rgb(t)).r,t.g,t.b)).l,t.a,t.b):Tn(+t,+n,+e)};var mi=Ln.prototype=new xn;mi.brighter=function(t){return Tn(this.h,this.c,Math.min(100,this.l+gi*(arguments.length?t:1)))},mi.darker=function(t){return Tn(this.h,this.c,Math.max(0,this.l-gi*(arguments.length?t:1)))},mi.rgb=function(){return Pn(this.h,this.c,this.l).rgb()},eo.lab=function(t,n,e){return 1===arguments.length?t instanceof jn?An(t.l,t.a,t.b):t instanceof Ln?Pn(t.l,t.c,t.h):Xn((t=eo.rgb(t)).r,t.g,t.b):An(+t,+n,+e)};var gi=18,vi=.95047,yi=1,wi=1.08883,bi=jn.prototype=new xn;bi.brighter=function(t){return An(Math.min(100,this.l+gi*(arguments.length?t:1)),this.a,this.b)},bi.darker=function(t){return An(Math.max(0,this.l-gi*(arguments.length?t:1)),this.a,this.b)},bi.rgb=function(){return qn(this.l,this.a,this.b)},eo.rgb=function(t,n,e){return 1===arguments.length?t instanceof Bn?Rn(t.r,t.g,t.b):Un(""+t,Rn,En):Rn(~~t,~~n,~~e)};var Mi=Bn.prototype=new xn;Mi.brighter=function(t){t=Math.pow(.7,arguments.length?t:1);var n=this.r,e=this.g,r=this.b,o=30;return n||e||r?(n&&o>n&&(n=o),e&&o>e&&(e=o),r&&o>r&&(r=o),Rn(Math.min(255,~~(n/t)),Math.min(255,~~(e/t)),Math.min(255,~~(r/t)))):Rn(o,o,o)},Mi.darker=function(t){return t=Math.pow(.7,arguments.length?t:1),Rn(~~(t*this.r),~~(t*this.g),~~(t*this.b))},Mi.hsl=function(){return Yn(this.r,this.g,this.b)},Mi.toString=function(){return"#"+Hn(this.r)+Hn(this.g)+Hn(this.b)};var _i=eo.map({aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074});_i.forEach(function(t,n){_i.set(t,Dn(n))}),eo.interpolateRgb=Wn,eo.interpolateObject=Gn,eo.interpolateArray=Qn,eo.interpolateNumber=$n,eo.interpolateString=Vn;var xi=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g;eo.interpolate=Jn,eo.interpolators=[function(t,n){var e=typeof n;return("string"===e?_i.has(n)||/^(#|rgb\(|hsl\()/.test(n)?Wn:Vn:n instanceof xn?Wn:"object"===e?Array.isArray(n)?Qn:Gn:$n)(t,n)}],eo.interpolateRound=te;var zi=".",Ci=",",Ei=[3,3],ki="$",Si=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"].map(oe);eo.formatPrefix=function(t,n){var e=0;return t&&(0>t&&(t*=-1),n&&(t=eo.round(t,ie(t,n))),e=1+Math.floor(1e-12+Math.log(t)/Math.LN10),e=Math.max(-24,Math.min(24,3*Math.floor((0>=e?e+1:e-1)/3)))),Si[8+e/3]},eo.round=function(t,n){return n?Math.round(t*(n=Math.pow(10,n)))/n:Math.round(t)},eo.format=function(t){var n=Ti.exec(t),e=n[1]||" ",r=n[2]||">",o=n[3]||"",i=n[4]||"",a=n[5],u=+n[6],s=n[7],c=n[8],l=n[9],f=1,h="",d=!1;switch(c&&(c=+c.substring(1)),(a||"0"===e&&"="===r)&&(a=e="0",r="=",s&&(u-=Math.floor((u-1)/4))),l){case"n":s=!0,l="g";break;case"%":f=100,h="%",l="f";break;case"p":f=100,h="%",l="r";break;case"b":case"o":case"x":case"X":"#"===i&&(i="0"+l.toLowerCase());case"c":case"d":d=!0,c=0;break;case"s":f=-1,l="r"}"#"===i?i="":"$"===i&&(i=ki),"r"!=l||c||(l="g"),null!=c&&("g"==l?c=Math.max(1,Math.min(21,c)):("e"==l||"f"==l)&&(c=Math.max(0,Math.min(20,c)))),l=Li.get(l)||ae;var p=a&&s;return function(t){if(d&&t%1)return"";var n=0>t||0===t&&0>1/t?(t=-t,"-"):o;if(0>f){var m=eo.formatPrefix(t,c);t=m.scale(t),h=m.symbol}else t*=f;t=l(t,c);var g=t.lastIndexOf("."),v=0>g?t:t.substring(0,g),y=0>g?"":zi+t.substring(g+1);!a&&s&&(v=Pi(v));var w=i.length+v.length+y.length+(p?0:n.length),b=u>w?Array(w=u-w+1).join(e):"";return p&&(v=Pi(b+v)),n+=i,t=v+y,("<"===r?n+t+b:">"===r?b+n+t:"^"===r?b.substring(0,w>>=1)+n+t+b.substring(w):n+(p?t:b+t))+h
}};var Ti=/(?:([^{])?([<>=^]))?([+\- ])?([$#])?(0)?(\d+)?(,)?(\.-?\d+)?([a-z%])?/i,Li=eo.map({b:function(t){return t.toString(2)},c:function(t){return String.fromCharCode(t)},o:function(t){return t.toString(8)},x:function(t){return t.toString(16)},X:function(t){return t.toString(16).toUpperCase()},g:function(t,n){return t.toPrecision(n)},e:function(t,n){return t.toExponential(n)},f:function(t,n){return t.toFixed(n)},r:function(t,n){return(t=eo.round(t,ie(t,n))).toFixed(Math.max(0,Math.min(20,ie(t*(1+1e-15),n))))}}),Pi=re;if(Ei){var Ai=Ei.length;Pi=function(t){for(var n=t.length,e=[],r=0,o=Ei[0];n>0&&o>0;)e.push(t.substring(n-=o,n+o)),o=Ei[r=(r+1)%Ai];return e.reverse().join(Ci)}}var ji={floor:re,ceil:re};eo.scale={},eo.scale.linear=function(){return he([0,1],[0,1],Jn,!1)};var qi={s:1,g:1,p:1,r:1,e:1},Fi=[1e3,5e3,15e3,3e4,6e4,3e5,9e5,18e5,36e5,108e5,216e5,432e5,864e5,1728e5,6048e5,2592e6,7776e6,31536e6],Ii=[[Fo.second,1],[Fo.second,5],[Fo.second,15],[Fo.second,30],[Fo.minute,1],[Fo.minute,5],[Fo.minute,15],[Fo.minute,30],[Fo.hour,1],[Fo.hour,3],[Fo.hour,6],[Fo.hour,12],[Fo.day,1],[Fo.day,2],[Fo.week,1],[Fo.month,1],[Fo.month,3],[Fo.year,1]],Oi=[[Y("%Y"),_n],[Y("%B"),function(t){return t.getMonth()}],[Y("%b %d"),function(t){return 1!=t.getDate()}],[Y("%a %d"),function(t){return t.getDay()&&1!=t.getDate()}],[Y("%I %p"),function(t){return t.getHours()}],[Y("%I:%M"),function(t){return t.getMinutes()}],[Y(":%S"),function(t){return t.getSeconds()}],[Y(".%L"),function(t){return t.getMilliseconds()}]],Ni=_e(Oi);Ii.year=Fo.year,Fo.scale=function(){return be(eo.scale.linear(),Ii,Ni)};var Di={range:function(t,n,e){return eo.range(+t,+n,e).map(Me)}},Ri=Ii.map(function(t){return[t[0].utc,t[1]]}),Bi=[[bn("%Y"),_n],[bn("%B"),function(t){return t.getUTCMonth()}],[bn("%b %d"),function(t){return 1!=t.getUTCDate()}],[bn("%a %d"),function(t){return t.getUTCDay()&&1!=t.getUTCDate()}],[bn("%I %p"),function(t){return t.getUTCHours()}],[bn("%I:%M"),function(t){return t.getUTCMinutes()}],[bn(":%S"),function(t){return t.getUTCSeconds()}],[bn(".%L"),function(t){return t.getUTCMilliseconds()}]],Hi=_e(Bi);Ri.year=Fo.year.utc,Fo.scale.utc=function(){return be(eo.scale.linear(),Ri,Hi)},eo.geo={},Ae.prototype={s:0,t:0,add:function(t){je(t,this.t,Ui),je(Ui.s,this.s,this),this.s?this.t+=Ui.t:this.s=Ui.t},reset:function(){this.s=this.t=0},valueOf:function(){return this.s}};var Ui=new Ae;eo.geo.stream=function(t,n){t&&Yi.hasOwnProperty(t.type)?Yi[t.type](t,n):qe(t,n)};var Yi={Feature:function(t,n){qe(t.geometry,n)},FeatureCollection:function(t,n){for(var e=t.features,r=-1,o=e.length;o>++r;)qe(e[r].geometry,n)}},Xi={Sphere:function(t,n){n.sphere()},Point:function(t,n){t=t.coordinates,n.point(t[0],t[1],t[2])},MultiPoint:function(t,n){for(var e=t.coordinates,r=-1,o=e.length;o>++r;)t=e[r],n.point(t[0],t[1],t[2])},LineString:function(t,n){Fe(t.coordinates,n,0)},MultiLineString:function(t,n){for(var e=t.coordinates,r=-1,o=e.length;o>++r;)Fe(e[r],n,0)},Polygon:function(t,n){Ie(t.coordinates,n)},MultiPolygon:function(t,n){for(var e=t.coordinates,r=-1,o=e.length;o>++r;)Ie(e[r],n)},GeometryCollection:function(t,n){for(var e=t.geometries,r=-1,o=e.length;o>++r;)qe(e[r],n)}};eo.geo.area=function(t){return Zi=0,eo.geo.stream(t,Wi),Zi};var Zi,Ki=new Ae,Wi={sphere:function(){Zi+=4*si},point:s,lineStart:s,lineEnd:s,polygonStart:function(){Ki.reset(),Wi.lineStart=Oe},polygonEnd:function(){var t=2*Ki;Zi+=0>t?4*si+t:t,Wi.lineStart=Wi.lineEnd=Wi.point=s}},Gi=Se(_n,Xe,Ke,[-si,-si/2]);(eo.geo.equirectangular=function(){return cr(We)}).raw=We.invert=We,eo.geo.rotation=function(t){function n(n){return n=t(n[0]*di,n[1]*di),n[0]*=pi,n[1]*=pi,n}return t=Qe(t[0]%360*di,t[1]*di,t.length>2?t[2]*di:0),n.invert=function(n){return n=t.invert(n[0]*di,n[1]*di),n[0]*=pi,n[1]*=pi,n},n},Ge.invert=We,eo.geo.circle=function(){function t(){var t="function"==typeof r?r.apply(this,arguments):r,n=Qe(-t[0]*di,-t[1]*di,0).invert,o=[];return e(null,null,1,{point:function(t,e){o.push(t=n(t,e)),t[0]*=pi,t[1]*=pi}}),{type:"Polygon",coordinates:[o]}}var n,e,r=[0,0],o=6;return t.origin=function(n){return arguments.length?(r=n,t):r},t.angle=function(r){return arguments.length?(e=tr((n=+r)*di,o*di),t):n},t.precision=function(r){return arguments.length?(e=tr(n*di,(o=+r)*di),t):o},t.angle(90)};var Qi=1e9;eo.geo.clipExtent=function(){var t,n,e,r,o,i,a={stream:function(t){return o&&(o.valid=!1),o=i(t),o.valid=!0,o},extent:function(u){return arguments.length?(i=or(t=+u[0][0],n=+u[0][1],e=+u[1][0],r=+u[1][1]),o&&(o.valid=!1,o=null),a):[[t,n],[e,r]]}};return a.extent([[0,0],[960,500]])},eo.geo.transform=function(t){return{stream:function(n){var e=new ur(n);for(var r in t)e[r]=t[r];return e}}},ur.prototype={point:function(t,n){this.stream.point(t,n)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}},eo.geo.projection=cr,eo.geo.projectionMutator=lr,(eo.geo.conicEqualArea=function(){return hr(dr)}).raw=dr,eo.geo.albers=function(){return eo.geo.conicEqualArea().rotate([96,0]).center([-.6,38.7]).parallels([29.5,45.5]).scale(1070)},eo.geo.albersUsa=function(){function t(t){var i=t[0],a=t[1];return n=null,e(i,a),n||(r(i,a),n)||o(i,a),n}var n,e,r,o,i=eo.geo.albers(),a=eo.geo.conicEqualArea().rotate([154,0]).center([-2,58.5]).parallels([55,65]),u=eo.geo.conicEqualArea().rotate([157,0]).center([-3,19.9]).parallels([8,18]),s={point:function(t,e){n=[t,e]}};return t.invert=function(t){var n=i.scale(),e=i.translate(),r=(t[0]-e[0])/n,o=(t[1]-e[1])/n;return(o>=.12&&.234>o&&r>=-.425&&-.214>r?a:o>=.166&&.234>o&&r>=-.214&&-.115>r?u:i).invert(t)},t.stream=function(t){var n=i.stream(t),e=a.stream(t),r=u.stream(t);return{point:function(t,o){n.point(t,o),e.point(t,o),r.point(t,o)},sphere:function(){n.sphere(),e.sphere(),r.sphere()},lineStart:function(){n.lineStart(),e.lineStart(),r.lineStart()},lineEnd:function(){n.lineEnd(),e.lineEnd(),r.lineEnd()},polygonStart:function(){n.polygonStart(),e.polygonStart(),r.polygonStart()},polygonEnd:function(){n.polygonEnd(),e.polygonEnd(),r.polygonEnd()}}},t.precision=function(n){return arguments.length?(i.precision(n),a.precision(n),u.precision(n),t):i.precision()},t.scale=function(n){return arguments.length?(i.scale(n),a.scale(.35*n),u.scale(n),t.translate(i.translate())):i.scale()},t.translate=function(n){if(!arguments.length)return i.translate();var c=i.scale(),l=+n[0],f=+n[1];return e=i.translate(n).clipExtent([[l-.455*c,f-.238*c],[l+.455*c,f+.238*c]]).stream(s).point,r=a.translate([l-.307*c,f+.201*c]).clipExtent([[l-.425*c+fi,f+.12*c+fi],[l-.214*c-fi,f+.234*c-fi]]).stream(s).point,o=u.translate([l-.205*c,f+.212*c]).clipExtent([[l-.214*c+fi,f+.166*c+fi],[l-.115*c-fi,f+.234*c-fi]]).stream(s).point,t},t.scale(1070)},eo.geo.bounds=function(){function t(t,n){w.push(b=[l=t,h=t]),f>n&&(f=n),n>d&&(d=n)}function n(n,e){var r=Ne([n*di,e*di]);if(v){var o=Re(v,r),i=[o[1],-o[0],0],a=Re(i,o);Ue(a),a=xe(a);var s=n-p,c=s>0?1:-1,m=a[0]*pi*c,g=oo(s)>180;if(g^(m>c*p&&c*n>m)){var y=a[1]*pi;y>d&&(d=y)}else if(m=(m+360)%360-180,g^(m>c*p&&c*n>m)){var y=-a[1]*pi;f>y&&(f=y)}else f>e&&(f=e),e>d&&(d=e);g?p>n?u(l,n)>u(l,h)&&(h=n):u(n,h)>u(l,h)&&(l=n):h>=l?(l>n&&(l=n),n>h&&(h=n)):n>p?u(l,n)>u(l,h)&&(h=n):u(n,h)>u(l,h)&&(l=n)}else t(n,e);v=r,p=n}function e(){M.point=n}function r(){b[0]=l,b[1]=h,M.point=t,v=null}function o(t,e){if(v){var r=t-p;y+=oo(r)>180?r+(r>0?360:-360):r}else m=t,g=e;Wi.point(t,e),n(t,e)}function i(){Wi.lineStart()}function a(){o(m,g),Wi.lineEnd(),oo(y)>fi&&(l=-(h=180)),b[0]=l,b[1]=h,v=null}function u(t,n){return 0>(n-=t)?n+360:n}function s(t,n){return t[0]-n[0]}function c(t,n){return n[0]<=n[1]?t>=n[0]&&n[1]>=t:n[0]>t||t>n[1]}var l,f,h,d,p,m,g,v,y,w,b,M={point:t,lineStart:e,lineEnd:r,polygonStart:function(){M.point=o,M.lineStart=i,M.lineEnd=a,y=0,Wi.polygonStart()},polygonEnd:function(){Wi.polygonEnd(),M.point=t,M.lineStart=e,M.lineEnd=r,0>Ki?(l=-(h=180),f=-(d=90)):y>fi?d=90:-fi>y&&(f=-90),b[0]=l,b[1]=h}};return function(t){d=h=-(l=f=1/0),w=[],eo.geo.stream(t,M);var n=w.length;if(n){w.sort(s);for(var e,r=1,o=w[0],i=[o];n>r;++r)e=w[r],c(e[0],o)||c(e[1],o)?(u(o[0],e[1])>u(o[0],o[1])&&(o[1]=e[1]),u(e[0],o[1])>u(o[0],o[1])&&(o[0]=e[0])):i.push(o=e);for(var a,e,p=-1/0,n=i.length-1,r=0,o=i[n];n>=r;o=e,++r)e=i[r],(a=u(o[1],e[0]))>p&&(p=a,l=e[0],h=o[1])}return w=b=null,1/0===l||1/0===f?[[0/0,0/0],[0/0,0/0]]:[[l,f],[h,d]]}}(),eo.geo.centroid=function(t){$i=Vi=Ji=ta=na=ea=ra=oa=ia=aa=ua=0,eo.geo.stream(t,pa);var n=ia,e=aa,r=ua,o=n*n+e*e+r*r;return hi>o&&(n=ea,e=ra,r=oa,fi>Vi&&(n=Ji,e=ta,r=na),o=n*n+e*e+r*r,hi>o)?[0/0,0/0]:[Math.atan2(e,n)*pi,Sn(r/Math.sqrt(o))*pi]};var $i,Vi,Ji,ta,na,ea,ra,oa,ia,aa,ua,sa,ca,la,fa,ha,da,pa={sphere:s,point:pr,lineStart:gr,lineEnd:vr,polygonStart:function(){pa.lineStart=yr},polygonEnd:function(){pa.lineStart=gr}},ma={point:s,lineStart:s,lineEnd:s,polygonStart:function(){ca=0,ma.lineStart=wr},polygonEnd:function(){ma.lineStart=ma.lineEnd=ma.point=s,sa+=oo(ca/2)}},ga={point:br,lineStart:s,lineEnd:s,polygonStart:s,polygonEnd:s},va={point:xr,lineStart:zr,lineEnd:Cr,polygonStart:function(){va.lineStart=Er},polygonEnd:function(){va.point=xr,va.lineStart=zr,va.lineEnd=Cr}};eo.geo.path=function(){function t(t){return t&&("function"==typeof u&&i.pointRadius(+u.apply(this,arguments)),a&&a.valid||(a=o(i)),eo.geo.stream(t,a)),i.result()}function n(){return a=null,t}var e,r,o,i,a,u=4.5;return t.area=function(t){return sa=0,eo.geo.stream(t,o(ma)),sa},t.centroid=function(t){return Ji=ta=na=ea=ra=oa=ia=aa=ua=0,eo.geo.stream(t,o(va)),ua?[ia/ua,aa/ua]:oa?[ea/oa,ra/oa]:na?[Ji/na,ta/na]:[0/0,0/0]},t.bounds=function(t){return ha=da=-(la=fa=1/0),eo.geo.stream(t,o(ga)),[[la,fa],[ha,da]]},t.projection=function(t){return arguments.length?(o=(e=t)?t.stream||Sr(t):re,n()):e},t.context=function(t){return arguments.length?(i=null==(r=t)?new Mr:new kr(t),"function"!=typeof u&&i.pointRadius(u),n()):r},t.pointRadius=function(n){return arguments.length?(u="function"==typeof n?n:(i.pointRadius(+n),+n),t):u},t.projection(eo.geo.albersUsa()).context(null)};var ya=function(){return re},wa=eo.map({linear:ya,poly:Fr,quad:function(){return Ar},cubic:function(){return jr},sin:function(){return Ir},exp:function(){return Or},circle:function(){return Nr},elastic:Dr,back:Rr,bounce:function(){return Br}}),ba=eo.map({"in":re,out:Lr,"in-out":Pr,"out-in":function(t){return Pr(Lr(t))}});eo.ease=function(t){var n=t.indexOf("-"),e=n>=0?t.substring(0,n):t,r=n>=0?t.substring(n+1):"in";return e=wa.get(e)||ya,r=ba.get(r)||re,Tr(r(e.apply(null,uo.call(arguments,1))))};var Ma,_a,xa=[],za=0;xa.call=Mo.call,xa.empty=Mo.empty,xa.node=Mo.node,xa.size=Mo.size,eo.transition=function(t){return arguments.length?Ma?t.transition():t:zo.transition()},eo.transition.prototype=xa,xa.select=function(t){var n,e,r,o=this.id,i=[];t=m(t);for(var a=-1,u=this.length;u>++a;){i.push(n=[]);for(var s=this[a],c=-1,l=s.length;l>++c;)(r=s[c])&&(e=t.call(r,r.__data__,c,a))?("__data__"in r&&(e.__data__=r.__data__),Qr(e,c,o,r.__transition__[o]),n.push(e)):n.push(null)}return Hr(i,o)},xa.selectAll=function(t){var n,e,r,o,i,a=this.id,u=[];t=g(t);for(var s=-1,c=this.length;c>++s;)for(var l=this[s],f=-1,h=l.length;h>++f;)if(r=l[f]){i=r.__transition__[a],e=t.call(r,r.__data__,f,s),u.push(n=[]);for(var d=-1,p=e.length;p>++d;)(o=e[d])&&Qr(o,d,a,i),n.push(o)}return Hr(u,a)},xa.filter=function(t){var n,e,r,o=[];"function"!=typeof t&&(t=E(t));for(var i=0,a=this.length;a>i;i++){o.push(n=[]);for(var e=this[i],u=0,s=e.length;s>u;u++)(r=e[u])&&t.call(r,r.__data__,u,i)&&n.push(r)}return Hr(o,this.id)},eo.transform=function(t){var n=co.createElementNS(eo.ns.prefix.svg,"g");return(eo.transform=function(t){if(null!=t){n.setAttribute("transform",t);var e=n.transform.baseVal.consolidate()}return new Ur(e?e.matrix:Ca)})(t)},Ur.prototype.toString=function(){return"translate("+this.translate+")rotate("+this.rotate+")skewX("+this.skew+")scale("+this.scale+")"};var Ca={a:1,b:0,c:0,d:1,e:0,f:0};return eo.interpolateTransform=Kr,xa.tween=function(t,n){var e=this.id;return 2>arguments.length?this.node().__transition__[e].tween.get(t):S(this,null==n?function(n){n.__transition__[e].tween.remove(t)}:function(r){r.__transition__[e].tween.set(t,n)})},xa.attr=function(t,n){function e(){this.removeAttribute(u)}function r(){this.removeAttributeNS(u.space,u.local)}function o(t){return null==t?e:(t+="",function(){var n,e=this.getAttribute(u);return e!==t&&(n=a(e,t),function(t){this.setAttribute(u,n(t))})})}function i(t){return null==t?r:(t+="",function(){var n,e=this.getAttributeNS(u.space,u.local);return e!==t&&(n=a(e,t),function(t){this.setAttributeNS(u.space,u.local,n(t))})})}if(2>arguments.length){for(n in t)this.attr(n,t[n]);return this}var a="transform"==t?Kr:Jn,u=eo.ns.qualify(t);return Wr(this,"attr."+t,n,u.local?i:o)},xa.attrTween=function(t,n){function e(t,e){var r=n.call(this,t,e,this.getAttribute(o));return r&&function(t){this.setAttribute(o,r(t))}}function r(t,e){var r=n.call(this,t,e,this.getAttributeNS(o.space,o.local));return r&&function(t){this.setAttributeNS(o.space,o.local,r(t))}}var o=eo.ns.qualify(t);return this.tween("attr."+t,o.local?r:e)},xa.style=function(t,n,e){function r(){this.style.removeProperty(t)}function o(n){return null==n?r:(n+="",function(){var r,o=fo.getComputedStyle(this,null).getPropertyValue(t);return o!==n&&(r=Jn(o,n),function(n){this.style.setProperty(t,r(n),e)})})}var i=arguments.length;if(3>i){if("string"!=typeof t){2>i&&(n="");for(e in t)this.style(e,t[e],n);return this}e=""}return Wr(this,"style."+t,n,o)},xa.styleTween=function(t,n,e){function r(r,o){var i=n.call(this,r,o,fo.getComputedStyle(this,null).getPropertyValue(t));return i&&function(n){this.style.setProperty(t,i(n),e)}}return 3>arguments.length&&(e=""),this.tween("style."+t,r)},xa.text=function(t){return Wr(this,"text",t,Gr)},xa.remove=function(){return this.each("end.transition",function(){var t;2>this.__transition__.count&&(t=this.parentNode)&&t.removeChild(this)})},xa.ease=function(t){var n=this.id;return 1>arguments.length?this.node().__transition__[n].ease:("function"!=typeof t&&(t=eo.ease.apply(eo,arguments)),S(this,function(e){e.__transition__[n].ease=t}))},xa.delay=function(t){var n=this.id;return S(this,"function"==typeof t?function(e,r,o){e.__transition__[n].delay=+t.call(e,e.__data__,r,o)}:(t=+t,function(e){e.__transition__[n].delay=t}))},xa.duration=function(t){var n=this.id;return S(this,"function"==typeof t?function(e,r,o){e.__transition__[n].duration=Math.max(1,t.call(e,e.__data__,r,o))}:(t=Math.max(1,t),function(e){e.__transition__[n].duration=t}))},xa.each=function(t,n){var e=this.id;if(2>arguments.length){var r=_a,o=Ma;Ma=e,S(this,function(n,r,o){_a=n.__transition__[e],t.call(n,n.__data__,r,o)}),_a=r,Ma=o}else S(this,function(r){var o=r.__transition__[e];(o.event||(o.event=eo.dispatch("start","end"))).on(t,n)});return this},xa.transition=function(){for(var t,n,e,r,o=this.id,i=++za,a=[],u=0,s=this.length;s>u;u++){a.push(t=[]);for(var n=this[u],c=0,l=n.length;l>c;c++)(e=n[c])&&(r=Object.create(e.__transition__[o]),r.delay+=r.duration,Qr(e,c,i,r)),t.push(e)}return Hr(a,i)},eo.xhr=$r(re),eo.text=$r(function(t){return t.responseText}),eo.json=function(t,n){return Vr(t,"application/json",to,n)},eo.html=function(t,n){return Vr(t,"text/html",no,n)},eo.xml=$r(function(t){return t.responseXML}),eo.dsv=function(t,n){function e(t,e,i){3>arguments.length&&(i=e,e=null);var a=eo.xhr(t,n,i);return a.row=function(t){return arguments.length?a.response(null==(e=t)?r:o(t)):e},a.row(e)}function r(t){return e.parse(t.responseText)}function o(t){return function(n){return e.parse(n.responseText,t)}}function a(n){return n.map(u).join(t)}function u(t){return s.test(t)?'"'+t.replace(/\"/g,'""')+'"':t}var s=RegExp('["'+t+"\n]"),c=t.charCodeAt(0);return e.parse=function(t,n){var r;return e.parseRows(t,function(t,e){if(r)return r(t,e-1);var o=Function("d","return {"+t.map(function(t,n){return JSON.stringify(t)+": d["+n+"]"}).join(",")+"}");r=n?function(t,e){return n(o(t),e)}:o})},e.parseRows=function(t,n){function e(){if(l>=s)return a;if(o)return o=!1,i;var n=l;if(34===t.charCodeAt(n)){for(var e=n;s>e++;)if(34===t.charCodeAt(e)){if(34!==t.charCodeAt(e+1))break;++e}l=e+2;var r=t.charCodeAt(e+1);return 13===r?(o=!0,10===t.charCodeAt(e+2)&&++l):10===r&&(o=!0),t.substring(n+1,e).replace(/""/g,'"')}for(;s>l;){var r=t.charCodeAt(l++),u=1;if(10===r)o=!0;else if(13===r)o=!0,10===t.charCodeAt(l)&&(++l,++u);else if(r!==c)continue;return t.substring(n,l-u)}return t.substring(n)}for(var r,o,i={},a={},u=[],s=t.length,l=0,f=0;(r=e())!==a;){for(var h=[];r!==i&&r!==a;)h.push(r),r=e();(!n||(h=n(h,f++)))&&u.push(h)}return u},e.format=function(n){if(Array.isArray(n[0]))return e.formatRows(n);var r=new i,o=[];return n.forEach(function(t){for(var n in t)r.has(n)||o.push(r.add(n))}),[o.map(u).join(t)].concat(n.map(function(n){return o.map(function(t){return u(n[t])}).join(t)})).join("\n")},e.formatRows=function(t){return t.map(a).join("\n")},e},eo.csv=eo.dsv(",","text/csv"),eo.tsv=eo.dsv("	","text/tab-separated-values"),eo}(),function(){function t(t,n,e){for(var r=(e||0)-1,o=t?t.length:0;o>++r;)if(t[r]===n)return r;return-1}function n(n,e){var r=typeof e;if(n=n.cache,"boolean"==r||null==e)return n[e]?0:-1;"number"!=r&&"string"!=r&&(r="object");var o="number"==r?e:v+e;return n=(n=n[r])&&n[o],"object"==r?n&&t(n,e)>-1?0:-1:n?0:-1}function e(t){var n=this.cache,e=typeof t;if("boolean"==e||null==t)n[t]=!0;else{"number"!=e&&"string"!=e&&(e="object");var r="number"==e?t:v+t,o=n[e]||(n[e]={});"object"==e?(o[r]||(o[r]=[])).push(t):o[r]=!0}}function r(t){return t.charCodeAt(0)}function o(t,n){for(var e=t.criteria,r=n.criteria,o=-1,i=e.length;i>++o;){var a=e[o],u=r[o];if(a!==u){if(a>u||a===d)return 1;if(u>a||u===d)return-1}}return t.index-n.index}function i(t){var n=-1,r=t.length,o=t[0],i=t[0|r/2],a=t[r-1];if(o&&"object"==typeof o&&i&&"object"==typeof i&&a&&"object"==typeof a)return!1;var u=s();u["false"]=u["null"]=u["true"]=u.undefined=!1;var c=s();for(c.array=t,c.cache=u,c.push=e;r>++n;)c.push(t[n]);return c}function a(t){return"\\"+K[t]}function u(){return p.pop()||[]}function s(){return m.pop()||{array:null,cache:null,criteria:null,"false":!1,index:0,"null":!1,number:null,object:null,push:null,string:null,"true":!1,undefined:!1,value:null}}function c(t){t.length=0,w>p.length&&p.push(t)}function l(t){var n=t.cache;n&&l(n),t.array=t.cache=t.criteria=t.object=t.number=t.string=t.value=null,w>m.length&&m.push(t)}function f(t,n,e){n||(n=0),e===d&&(e=t?t.length:0);for(var r=-1,o=e-n||0,i=Array(0>o?0:o);o>++r;)i[r]=t[n+r];return i}function h(e){function p(t){return t&&"object"==typeof t&&!Vr(t)&&qr.call(t,"__wrapped__")?t:new m(t)}function m(t,n){this.__chain__=!!n,this.__wrapped__=t}function w(t){function n(){if(r){var t=f(r);Fr.apply(t,arguments)}if(this instanceof n){var i=G(e.prototype),a=e.apply(i,t||arguments);return Pn(a)?a:i}return e.apply(o,t||arguments)}var e=t[0],r=t[2],o=t[4];return $r(n,t),n}function K(t,n,e,r,o){if(e){var i=e(t);if(i!==d)return i}var a=Pn(t);if(!a)return t;var s=kr.call(t);if(!U[s])return t;var l=Gr[s];switch(s){case I:case O:return new l(+t);case D:case H:return new l(t);case B:return i=l(t.source,C.exec(t)),i.lastIndex=t.lastIndex,i}var h=Vr(t);if(n){var p=!r;r||(r=u()),o||(o=u());for(var m=r.length;m--;)if(r[m]==t)return o[m];i=h?l(t.length):{}}else i=h?f(t):io({},t);return h&&(qr.call(t,"index")&&(i.index=t.index),qr.call(t,"input")&&(i.input=t.input)),n?(r.push(t),o.push(i),(h?$n:so)(t,function(t,a){i[a]=K(t,n,e,r,o)}),p&&(c(r),c(o)),i):i}function G(t){return Pn(t)?Rr(t):{}}function Q(t,n,e){if("function"!=typeof t)return Ve;if(n===d||!("prototype"in t))return t;var r=t.__bindData__;if(r===d&&(Qr.funcNames&&(r=!t.name),r=r||!Qr.funcDecomp,!r)){var o=Ar.call(t);Qr.funcNames||(r=!E.test(o)),r||(r=L.test(o),$r(t,r))}if(r===!1||r!==!0&&1&r[1])return t;switch(e){case 1:return function(e){return t.call(n,e)};case 2:return function(e,r){return t.call(n,e,r)};case 3:return function(e,r,o){return t.call(n,e,r,o)};case 4:return function(e,r,o,i){return t.call(n,e,r,o,i)}}return Fe(t,n)}function $(t){function n(){var t=s?a:this;if(o){var p=f(o);Fr.apply(p,arguments)}if((i||l)&&(p||(p=f(arguments)),i&&Fr.apply(p,i),l&&u>p.length))return r|=16,$([e,h?r:-4&r,p,null,a,u]);if(p||(p=arguments),c&&(e=t[d]),this instanceof n){t=G(e.prototype);var m=e.apply(t,p);return Pn(m)?m:t}return e.apply(t,p)}var e=t[0],r=t[1],o=t[2],i=t[3],a=t[4],u=t[5],s=1&r,c=2&r,l=4&r,h=8&r,d=e;return $r(n,t),n}function V(e,r){var o=-1,a=cn(),u=e?e.length:0,s=u>=y&&a===t,c=[];if(s){var f=i(r);f?(a=n,r=f):s=!1}for(;u>++o;){var h=e[o];0>a(r,h)&&c.push(h)}return s&&l(r),c}function tn(t,n,e,r){for(var o=(r||0)-1,i=t?t.length:0,a=[];i>++o;){var u=t[o];if(u&&"object"==typeof u&&"number"==typeof u.length&&(Vr(u)||dn(u))){n||(u=tn(u,n,e));var s=-1,c=u.length,l=a.length;for(a.length+=c;c>++s;)a[l++]=u[s]}else e||a.push(u)}return a}function nn(t,n,e,r,o,i){if(e){var a=e(t,n);if(a!==d)return!!a}if(t===n)return 0!==t||1/t==1/n;var s=typeof t,l=typeof n;if(!(t!==t||t&&Z[s]||n&&Z[l]))return!1;if(null==t||null==n)return t===n;var f=kr.call(t),h=kr.call(n);if(f==q&&(f=R),h==q&&(h=R),f!=h)return!1;switch(f){case I:case O:return+t==+n;case D:return t!=+t?n!=+n:0==t?1/t==1/n:t==+n;case B:case H:return t==_r(n)}var p=f==F;if(!p){var m=qr.call(t,"__wrapped__"),g=qr.call(n,"__wrapped__");if(m||g)return nn(m?t.__wrapped__:t,g?n.__wrapped__:n,e,r,o,i);if(f!=R)return!1;var v=t.constructor,y=n.constructor;if(v!=y&&!(Ln(v)&&v instanceof v&&Ln(y)&&y instanceof y)&&"constructor"in t&&"constructor"in n)return!1}var w=!o;o||(o=u()),i||(i=u());for(var b=o.length;b--;)if(o[b]==t)return i[b]==n;var M=0;if(a=!0,o.push(t),i.push(n),p){if(b=t.length,M=n.length,a=M==b,a||r)for(;M--;){var _=b,x=n[M];if(r)for(;_--&&!(a=nn(t[_],x,e,r,o,i)););else if(!(a=nn(t[M],x,e,r,o,i)))break}}else uo(n,function(n,u,s){return qr.call(s,u)?(M++,a=qr.call(t,u)&&nn(t[u],n,e,r,o,i)):d}),a&&!r&&uo(t,function(t,n,e){return qr.call(e,n)?a=--M>-1:d});return o.pop(),i.pop(),w&&(c(o),c(i)),a}function en(t,n,e,r,o){(Vr(n)?$n:so)(n,function(n,i){var a,u,s=n,c=t[i];if(n&&((u=Vr(n))||co(n))){for(var l=r.length;l--;)if(a=r[l]==n){c=o[l];break}if(!a){var f;e&&(s=e(c,n),(f=s!==d)&&(c=s)),f||(c=u?Vr(c)?c:[]:co(c)?c:{}),r.push(n),o.push(c),f||en(c,n,e,r,o)}}else e&&(s=e(c,n),s===d&&(s=n)),s!==d&&(c=s);t[i]=c})}function rn(t,n){return t+Pr(Wr()*(n-t+1))}function on(e,r,o){var a=-1,s=cn(),f=e?e.length:0,h=[],d=!r&&f>=y&&s===t,p=o||d?u():h;if(d){var m=i(p);s=n,p=m}for(;f>++a;){var g=e[a],v=o?o(g,a,e):g;(r?!a||p[p.length-1]!==v:0>s(p,v))&&((o||d)&&p.push(v),h.push(g))}return d?(c(p.array),l(p)):o&&c(p),h}function an(t){return function(n,e,r){var o={};e=p.createCallback(e,r,3);var i=-1,a=n?n.length:0;if("number"==typeof a)for(;a>++i;){var u=n[i];t(o,u,e(u,i,n),n)}else so(n,function(n,r,i){t(o,n,e(n,r,i),i)});return o}}function un(t,n,e,r,o,i){var a=1&n,u=2&n,s=4&n,c=16&n,l=32&n;if(!u&&!Ln(t))throw new xr;c&&!e.length&&(n&=-17,c=e=!1),l&&!r.length&&(n&=-33,l=r=!1);var h=t&&t.__bindData__;if(h&&h!==!0)return h=f(h),h[2]&&(h[2]=f(h[2])),h[3]&&(h[3]=f(h[3])),!a||1&h[1]||(h[4]=o),!a&&1&h[1]&&(n|=8),!s||4&h[1]||(h[5]=i),c&&Fr.apply(h[2]||(h[2]=[]),e),l&&Nr.apply(h[3]||(h[3]=[]),r),h[1]|=n,un.apply(null,h);var d=1==n||17===n?w:$;return d([t,n,e,r,o,i])}function sn(t){return no[t]}function cn(){var n=(n=p.indexOf)===ye?t:n;return n}function ln(t){return"function"==typeof t&&Sr.test(t)}function fn(t){var n,e;return t&&kr.call(t)==R&&(n=t.constructor,!Ln(n)||n instanceof n)?(uo(t,function(t,n){e=n}),e===d||qr.call(t,e)):!1}function hn(t){return eo[t]}function dn(t){return t&&"object"==typeof t&&"number"==typeof t.length&&kr.call(t)==q||!1}function pn(t,n,e,r){return"boolean"!=typeof n&&null!=n&&(r=e,e=n,n=!1),K(t,n,"function"==typeof e&&Q(e,r,1))}function mn(t,n,e){return K(t,!0,"function"==typeof n&&Q(n,e,1))}function gn(t,n){var e=G(t);return n?io(e,n):e}function vn(t,n,e){var r;return n=p.createCallback(n,e,3),so(t,function(t,e,o){return n(t,e,o)?(r=e,!1):d}),r}function yn(t,n,e){var r;return n=p.createCallback(n,e,3),bn(t,function(t,e,o){return n(t,e,o)?(r=e,!1):d}),r}function wn(t,n,e){var r=[];uo(t,function(t,n){r.push(n,t)});var o=r.length;for(n=Q(n,e,3);o--&&n(r[o--],r[o],t)!==!1;);return t}function bn(t,n,e){var r=to(t),o=r.length;for(n=Q(n,e,3);o--;){var i=r[o];if(n(t[i],i,t)===!1)break}return t}function Mn(t){var n=[];return uo(t,function(t,e){Ln(t)&&n.push(e)}),n.sort()}function _n(t,n){return t?qr.call(t,n):!1}function xn(t){for(var n=-1,e=to(t),r=e.length,o={};r>++n;){var i=e[n];o[t[i]]=i}return o}function zn(t){return t===!0||t===!1||t&&"object"==typeof t&&kr.call(t)==I||!1}function Cn(t){return t&&"object"==typeof t&&kr.call(t)==O||!1}function En(t){return t&&1===t.nodeType||!1}function kn(t){var n=!0;if(!t)return n;var e=kr.call(t),r=t.length;return e==F||e==H||e==q||e==R&&"number"==typeof r&&Ln(t.splice)?!r:(so(t,function(){return n=!1}),n)}function Sn(t,n,e,r){return nn(t,n,"function"==typeof e&&Q(e,r,2))}function Tn(t){return Hr(t)&&!Ur(parseFloat(t))}function Ln(t){return"function"==typeof t}function Pn(t){return!(!t||!Z[typeof t])}function An(t){return qn(t)&&t!=+t}function jn(t){return null===t}function qn(t){return"number"==typeof t||t&&"object"==typeof t&&kr.call(t)==D||!1}function Fn(t){return t&&"object"==typeof t&&kr.call(t)==B||!1}function In(t){return"string"==typeof t||t&&"object"==typeof t&&kr.call(t)==H||!1}function On(t){return t===d}function Nn(t,n,e){var r={};return n=p.createCallback(n,e,3),so(t,function(t,e,o){r[e]=n(t,e,o)}),r}function Dn(t){var n=arguments,e=2;if(!Pn(t))return t;if("number"!=typeof n[2]&&(e=n.length),e>3&&"function"==typeof n[e-2])var r=Q(n[--e-1],n[e--],2);else e>2&&"function"==typeof n[e-1]&&(r=n[--e]);for(var o=f(arguments,1,e),i=-1,a=u(),s=u();e>++i;)en(t,o[i],r,a,s);return c(a),c(s),t}function Rn(t,n,e){var r={};if("function"!=typeof n){var o=[];uo(t,function(t,n){o.push(n)}),o=V(o,tn(arguments,!0,!1,1));for(var i=-1,a=o.length;a>++i;){var u=o[i];r[u]=t[u]}}else n=p.createCallback(n,e,3),uo(t,function(t,e,o){n(t,e,o)||(r[e]=t)});return r}function Bn(t){for(var n=-1,e=to(t),r=e.length,o=pr(r);r>++n;){var i=e[n];o[n]=[i,t[i]]}return o}function Hn(t,n,e){var r={};if("function"!=typeof n)for(var o=-1,i=tn(arguments,!0,!1,1),a=Pn(t)?i.length:0;a>++o;){var u=i[o];u in t&&(r[u]=t[u])}else n=p.createCallback(n,e,3),uo(t,function(t,e,o){n(t,e,o)&&(r[e]=t)});return r}function Un(t,n,e,r){var o=Vr(t);if(null==e)if(o)e=[];else{var i=t&&t.constructor,a=i&&i.prototype;e=G(a)}return n&&(n=p.createCallback(n,r,4),(o?$n:so)(t,function(t,r,o){return n(e,t,r,o)})),e}function Yn(t){for(var n=-1,e=to(t),r=e.length,o=pr(r);r>++n;)o[n]=t[e[n]];return o}function Xn(t){for(var n=arguments,e=-1,r=tn(n,!0,!1,1),o=n[2]&&n[2][n[1]]===t?1:r.length,i=pr(o);o>++e;)i[e]=t[r[e]];return i}function Zn(t,n,e){var r=-1,o=cn(),i=t?t.length:0,a=!1;return e=(0>e?Xr(0,i+e):e)||0,Vr(t)?a=o(t,n,e)>-1:"number"==typeof i?a=(In(t)?t.indexOf(n,e):o(t,n,e))>-1:so(t,function(t){return++r>=e?!(a=t===n):d}),a}function Kn(t,n,e){var r=!0;n=p.createCallback(n,e,3);var o=-1,i=t?t.length:0;if("number"==typeof i)for(;i>++o&&(r=!!n(t[o],o,t)););else so(t,function(t,e,o){return r=!!n(t,e,o)});return r}function Wn(t,n,e){var r=[];n=p.createCallback(n,e,3);var o=-1,i=t?t.length:0;if("number"==typeof i)for(;i>++o;){var a=t[o];n(a,o,t)&&r.push(a)}else so(t,function(t,e,o){n(t,e,o)&&r.push(t)});return r}function Gn(t,n,e){n=p.createCallback(n,e,3);var r=-1,o=t?t.length:0;if("number"!=typeof o){var i;return so(t,function(t,e,r){return n(t,e,r)?(i=t,!1):d}),i}for(;o>++r;){var a=t[r];if(n(a,r,t))return a}}function Qn(t,n,e){var r;return n=p.createCallback(n,e,3),Vn(t,function(t,e,o){return n(t,e,o)?(r=t,!1):d}),r}function $n(t,n,e){var r=-1,o=t?t.length:0;if(n=n&&e===d?n:Q(n,e,3),"number"==typeof o)for(;o>++r&&n(t[r],r,t)!==!1;);else so(t,n);return t}function Vn(t,n,e){var r=t?t.length:0;if(n=n&&e===d?n:Q(n,e,3),"number"==typeof r)for(;r--&&n(t[r],r,t)!==!1;);else{var o=to(t);r=o.length,so(t,function(t,e,i){return e=o?o[--r]:--r,n(i[e],e,i)})}return t}function Jn(t,n){var e=f(arguments,2),r=-1,o="function"==typeof n,i=t?t.length:0,a=pr("number"==typeof i?i:0);return $n(t,function(t){a[++r]=(o?n:t[n]).apply(t,e)}),a}function te(t,n,e){var r=-1,o=t?t.length:0;if(n=p.createCallback(n,e,3),"number"==typeof o)for(var i=pr(o);o>++r;)i[r]=n(t[r],r,t);else i=[],so(t,function(t,e,o){i[++r]=n(t,e,o)});return i}function ne(t,n,e){var o=-1/0,i=o;if("function"!=typeof n&&e&&e[n]===t&&(n=null),null==n&&Vr(t))for(var a=-1,u=t.length;u>++a;){var s=t[a];s>i&&(i=s)}else n=null==n&&In(t)?r:p.createCallback(n,e,3),$n(t,function(t,e,r){var a=n(t,e,r);a>o&&(o=a,i=t)});return i}function ee(t,n,e){var o=1/0,i=o;if("function"!=typeof n&&e&&e[n]===t&&(n=null),null==n&&Vr(t))for(var a=-1,u=t.length;u>++a;){var s=t[a];i>s&&(i=s)}else n=null==n&&In(t)?r:p.createCallback(n,e,3),$n(t,function(t,e,r){var a=n(t,e,r);o>a&&(o=a,i=t)});return i}function re(t,n,e,r){if(!t)return e;var o=3>arguments.length;n=p.createCallback(n,r,4);var i=-1,a=t.length;if("number"==typeof a)for(o&&(e=t[++i]);a>++i;)e=n(e,t[i],i,t);else so(t,function(t,r,i){e=o?(o=!1,t):n(e,t,r,i)});return e}function oe(t,n,e,r){var o=3>arguments.length;return n=p.createCallback(n,r,4),Vn(t,function(t,r,i){e=o?(o=!1,t):n(e,t,r,i)}),e}function ie(t,n,e){return n=p.createCallback(n,e,3),Wn(t,function(t,e,r){return!n(t,e,r)})}function ae(t,n,e){if(t&&"number"!=typeof t.length&&(t=Yn(t)),null==n||e)return t?t[rn(0,t.length-1)]:d;var r=ue(t);return r.length=Zr(Xr(0,n),r.length),r}function ue(t){var n=-1,e=t?t.length:0,r=pr("number"==typeof e?e:0);return $n(t,function(t){var e=rn(0,++n);r[n]=r[e],r[e]=t}),r}function se(t){var n=t?t.length:0;return"number"==typeof n?n:to(t).length}function ce(t,n,e){var r;n=p.createCallback(n,e,3);var o=-1,i=t?t.length:0;if("number"==typeof i)for(;i>++o&&!(r=n(t[o],o,t)););else so(t,function(t,e,o){return!(r=n(t,e,o))});return!!r}function le(t,n,e){var r=-1,i=Vr(n),a=t?t.length:0,f=pr("number"==typeof a?a:0);for(i||(n=p.createCallback(n,e,3)),$n(t,function(t,e,o){var a=f[++r]=s();i?a.criteria=te(n,function(n){return t[n]}):(a.criteria=u())[0]=n(t,e,o),a.index=r,a.value=t}),a=f.length,f.sort(o);a--;){var h=f[a];f[a]=h.value,i||c(h.criteria),l(h)}return f}function fe(t){return t&&"number"==typeof t.length?f(t):Yn(t)}function he(t){for(var n=-1,e=t?t.length:0,r=[];e>++n;){var o=t[n];o&&r.push(o)}return r}function de(t){return V(t,tn(arguments,!0,!0,1))}function pe(t,n,e){var r=-1,o=t?t.length:0;for(n=p.createCallback(n,e,3);o>++r;)if(n(t[r],r,t))return r;return-1}function me(t,n,e){var r=t?t.length:0;for(n=p.createCallback(n,e,3);r--;)if(n(t[r],r,t))return r;return-1}function ge(t,n,e){var r=0,o=t?t.length:0;if("number"!=typeof n&&null!=n){var i=-1;for(n=p.createCallback(n,e,3);o>++i&&n(t[i],i,t);)r++}else if(r=n,null==r||e)return t?t[0]:d;return f(t,0,Zr(Xr(0,r),o))}function ve(t,n,e,r){return"boolean"!=typeof n&&null!=n&&(r=e,e="function"!=typeof n&&r&&r[n]===t?null:n,n=!1),null!=e&&(t=te(t,e,r)),tn(t,n)}function ye(n,e,r){if("number"==typeof r){var o=n?n.length:0;r=0>r?Xr(0,o+r):r||0}else if(r){var i=ke(n,e);return n[i]===e?i:-1}return t(n,e,r)}function we(t,n,e){var r=0,o=t?t.length:0;if("number"!=typeof n&&null!=n){var i=o;for(n=p.createCallback(n,e,3);i--&&n(t[i],i,t);)r++}else r=null==n||e?1:n||r;return f(t,0,Zr(Xr(0,o-r),o))}function be(){for(var e=[],r=-1,o=arguments.length,a=u(),s=cn(),f=s===t,h=u();o>++r;){var d=arguments[r];(Vr(d)||dn(d))&&(e.push(d),a.push(f&&d.length>=y&&i(r?e[r]:h)))}var p=e[0],m=-1,g=p?p.length:0,v=[];t:for(;g>++m;){var w=a[0];if(d=p[m],0>(w?n(w,d):s(h,d))){for(r=o,(w||h).push(d);--r;)if(w=a[r],0>(w?n(w,d):s(e[r],d)))continue t;v.push(d)}}for(;o--;)w=a[o],w&&l(w);return c(a),c(h),v}function Me(t,n,e){var r=0,o=t?t.length:0;if("number"!=typeof n&&null!=n){var i=o;for(n=p.createCallback(n,e,3);i--&&n(t[i],i,t);)r++}else if(r=n,null==r||e)return t?t[o-1]:d;
return f(t,Xr(0,o-r))}function _e(t,n,e){var r=t?t.length:0;for("number"==typeof e&&(r=(0>e?Xr(0,r+e):Zr(e,r-1))+1);r--;)if(t[r]===n)return r;return-1}function xe(t){for(var n=arguments,e=0,r=n.length,o=t?t.length:0;r>++e;)for(var i=-1,a=n[e];o>++i;)t[i]===a&&(Or.call(t,i--,1),o--);return t}function ze(t,n,e){t=+t||0,e="number"==typeof e?e:+e||1,null==n&&(n=t,t=0);for(var r=-1,o=Xr(0,Tr((n-t)/(e||1))),i=pr(o);o>++r;)i[r]=t,t+=e;return i}function Ce(t,n,e){var r=-1,o=t?t.length:0,i=[];for(n=p.createCallback(n,e,3);o>++r;){var a=t[r];n(a,r,t)&&(i.push(a),Or.call(t,r--,1),o--)}return i}function Ee(t,n,e){if("number"!=typeof n&&null!=n){var r=0,o=-1,i=t?t.length:0;for(n=p.createCallback(n,e,3);i>++o&&n(t[o],o,t);)r++}else r=null==n||e?1:Xr(0,n);return f(t,r)}function ke(t,n,e,r){var o=0,i=t?t.length:o;for(e=e?p.createCallback(e,r,1):Ve,n=e(n);i>o;){var a=o+i>>>1;n>e(t[a])?o=a+1:i=a}return o}function Se(){return on(tn(arguments,!0,!0))}function Te(t,n,e,r){return"boolean"!=typeof n&&null!=n&&(r=e,e="function"!=typeof n&&r&&r[n]===t?null:n,n=!1),null!=e&&(e=p.createCallback(e,r,3)),on(t,n,e)}function Le(t){return V(t,f(arguments,1))}function Pe(){for(var t=-1,n=arguments.length;n>++t;){var e=arguments[t];if(Vr(e)||dn(e))var r=r?on(V(r,e).concat(V(e,r))):e}return r||[]}function Ae(){for(var t=arguments.length>1?arguments:arguments[0],n=-1,e=t?ne(po(t,"length")):0,r=pr(0>e?0:e);e>++n;)r[n]=po(t,n);return r}function je(t,n){var e=-1,r=t?t.length:0,o={};for(n||!r||Vr(t[0])||(n=[]);r>++e;){var i=t[e];n?o[i]=n[e]:i&&(o[i[0]]=i[1])}return o}function qe(t,n){if(!Ln(n))throw new xr;return function(){return 1>--t?n.apply(this,arguments):d}}function Fe(t,n){return arguments.length>2?un(t,17,f(arguments,2),null,n):un(t,1,null,null,n)}function Ie(t){for(var n=arguments.length>1?tn(arguments,!0,!1,1):Mn(t),e=-1,r=n.length;r>++e;){var o=n[e];t[o]=un(t[o],1,null,null,t)}return t}function Oe(t,n){return arguments.length>2?un(n,19,f(arguments,2),null,t):un(n,3,null,null,t)}function Ne(){for(var t=arguments,n=t.length;n--;)if(!Ln(t[n]))throw new xr;return function(){for(var n=arguments,e=t.length;e--;)n=[t[e].apply(this,n)];return n[0]}}function De(t,n){return n="number"==typeof n?n:+n||t.length,un(t,4,null,null,null,n)}function Re(t,n,e){var r,o,i,a,u,s,c,l=0,f=!1,h=!0;if(!Ln(t))throw new xr;if(n=Xr(0,n)||0,e===!0){var p=!0;h=!1}else Pn(e)&&(p=e.leading,f="maxWait"in e&&(Xr(n,e.maxWait)||0),h="trailing"in e?e.trailing:h);var m=function(){var e=n-(go()-a);if(0>=e){o&&Lr(o);var f=c;o=s=c=d,f&&(l=go(),i=t.apply(u,r),s||o||(r=u=null))}else s=Ir(m,e)},g=function(){s&&Lr(s),o=s=c=d,(h||f!==n)&&(l=go(),i=t.apply(u,r),s||o||(r=u=null))};return function(){if(r=arguments,a=go(),u=this,c=h&&(s||!p),f===!1)var e=p&&!s;else{o||p||(l=a);var d=f-(a-l),v=0>=d;v?(o&&(o=Lr(o)),l=a,i=t.apply(u,r)):o||(o=Ir(g,d))}return v&&s?s=Lr(s):s||n===f||(s=Ir(m,n)),e&&(v=!0,i=t.apply(u,r)),!v||s||o||(r=u=null),i}}function Be(t){if(!Ln(t))throw new xr;var n=f(arguments,1);return Ir(function(){t.apply(d,n)},1)}function He(t,n){if(!Ln(t))throw new xr;var e=f(arguments,2);return Ir(function(){t.apply(d,e)},n)}function Ue(t,n){if(!Ln(t))throw new xr;var e=function(){var r=e.cache,o=n?n.apply(this,arguments):v+arguments[0];return qr.call(r,o)?r[o]:r[o]=t.apply(this,arguments)};return e.cache={},e}function Ye(t){var n,e;if(!Ln(t))throw new xr;return function(){return n?e:(n=!0,e=t.apply(this,arguments),t=null,e)}}function Xe(t){return un(t,16,f(arguments,1))}function Ze(t){return un(t,32,null,f(arguments,1))}function Ke(t,n,e){var r=!0,o=!0;if(!Ln(t))throw new xr;return e===!1?r=!1:Pn(e)&&(r="leading"in e?e.leading:r,o="trailing"in e?e.trailing:o),Y.leading=r,Y.maxWait=n,Y.trailing=o,Re(t,n,Y)}function We(t,n){return un(n,16,[t])}function Ge(t){return function(){return t}}function Qe(t,n,e){var r=typeof t;if(null==t||"function"==r)return Q(t,n,e);if("object"!=r)return er(t);var o=to(t),i=o[0],a=t[i];return 1!=o.length||a!==a||Pn(a)?function(n){for(var e=o.length,r=!1;e--&&(r=nn(n[o[e]],t[o[e]],null,!0)););return r}:function(t){var n=t[i];return a===n&&(0!==a||1/a==1/n)}}function $e(t){return null==t?"":_r(t).replace(oo,sn)}function Ve(t){return t}function Je(t,n,e){var r=!0,o=n&&Mn(n);n&&(e||o.length)||(null==e&&(e=n),i=m,n=t,t=p,o=Mn(n)),e===!1?r=!1:Pn(e)&&"chain"in e&&(r=e.chain);var i=t,a=Ln(i);$n(o,function(e){var o=t[e]=n[e];a&&(i.prototype[e]=function(){var n=this.__chain__,e=this.__wrapped__,a=[e];Fr.apply(a,arguments);var u=o.apply(t,a);if(r||n){if(e===u&&Pn(u))return this;u=new i(u),u.__chain__=n}return u})})}function tr(){return e._=Er,this}function nr(){}function er(t){return function(n){return n[t]}}function rr(t,n,e){var r=null==t,o=null==n;if(null==e&&("boolean"==typeof t&&o?(e=t,t=1):o||"boolean"!=typeof n||(e=n,o=!0)),r&&o&&(n=1),t=+t||0,o?(n=t,t=0):n=+n||0,e||t%1||n%1){var i=Wr();return Zr(t+i*(n-t+parseFloat("1e-"+((i+"").length-1))),n)}return rn(t,n)}function or(t,n){if(t){var e=t[n];return Ln(e)?t[n]():e}}function ir(t,n,e){var r=p.templateSettings;t=_r(t||""),e=ao({},e,r);var o,i=ao({},e.imports,r.imports),u=to(i),s=Yn(i),c=0,l=e.interpolate||T,f="__p += '",h=Mr((e.escape||T).source+"|"+l.source+"|"+(l===k?z:T).source+"|"+(e.evaluate||T).source+"|$","g");t.replace(h,function(n,e,r,i,u,s){return r||(r=i),f+=t.slice(c,s).replace(P,a),e&&(f+="' +\n__e("+e+") +\n'"),u&&(o=!0,f+="';\n"+u+";\n__p += '"),r&&(f+="' +\n((__t = ("+r+")) == null ? '' : __t) +\n'"),c=s+n.length,n}),f+="';\n";var m=e.variable,g=m;g||(m="obj",f="with ("+m+") {\n"+f+"\n}\n"),f=(o?f.replace(M,""):f).replace(_,"$1").replace(x,"$1;"),f="function("+m+") {\n"+(g?"":m+" || ("+m+" = {});\n")+"var __t, __p = '', __e = _.escape"+(o?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+f+"return __p\n}";var v="\n/*\n//# sourceURL="+(e.sourceURL||"/lodash/template/source["+j++ +"]")+"\n*/";try{var y=vr(u,"return "+f+v).apply(d,s)}catch(w){throw w.source=f,w}return n?y(n):(y.source=f,y)}function ar(t,n,e){t=(t=+t)>-1?t:0;var r=-1,o=pr(t);for(n=Q(n,e,1);t>++r;)o[r]=n(r);return o}function ur(t){return null==t?"":_r(t).replace(ro,hn)}function sr(t){var n=++g;return _r(null==t?"":t)+n}function cr(t){return t=new m(t),t.__chain__=!0,t}function lr(t,n){return n(t),t}function fr(){return this.__chain__=!0,this}function hr(){return _r(this.__wrapped__)}function dr(){return this.__wrapped__}e=e?J.defaults(W.Object(),e,J.pick(W,A)):W;var pr=e.Array,mr=e.Boolean,gr=e.Date,vr=e.Function,yr=e.Math,wr=e.Number,br=e.Object,Mr=e.RegExp,_r=e.String,xr=e.TypeError,zr=[],Cr=br.prototype,Er=e._,kr=Cr.toString,Sr=Mr("^"+_r(kr).replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/toString| for [^\]]+/g,".*?")+"$"),Tr=yr.ceil,Lr=e.clearTimeout,Pr=yr.floor,Ar=vr.prototype.toString,jr=ln(jr=br.getPrototypeOf)&&jr,qr=Cr.hasOwnProperty,Fr=zr.push,Ir=e.setTimeout,Or=zr.splice,Nr=zr.unshift,Dr=function(){try{var t={},n=ln(n=br.defineProperty)&&n,e=n(t,t,t)&&n}catch(r){}return e}(),Rr=ln(Rr=br.create)&&Rr,Br=ln(Br=pr.isArray)&&Br,Hr=e.isFinite,Ur=e.isNaN,Yr=ln(Yr=br.keys)&&Yr,Xr=yr.max,Zr=yr.min,Kr=e.parseInt,Wr=yr.random,Gr={};Gr[F]=pr,Gr[I]=mr,Gr[O]=gr,Gr[N]=vr,Gr[R]=br,Gr[D]=wr,Gr[B]=Mr,Gr[H]=_r,m.prototype=p.prototype;var Qr=p.support={};Qr.funcDecomp=!ln(e.WinRTError)&&L.test(h),Qr.funcNames="string"==typeof vr.name,p.templateSettings={escape:/<%-([\s\S]+?)%>/g,evaluate:/<%([\s\S]+?)%>/g,interpolate:k,variable:"",imports:{_:p}},Rr||(G=function(){function t(){}return function(n){if(Pn(n)){t.prototype=n;var r=new t;t.prototype=null}return r||e.Object()}}());var $r=Dr?function(t,n){X.value=n,Dr(t,"__bindData__",X)}:nr,Vr=Br||function(t){return t&&"object"==typeof t&&"number"==typeof t.length&&kr.call(t)==F||!1},Jr=function(t){var n,e=t,r=[];if(!e)return r;if(!Z[typeof t])return r;for(n in e)qr.call(e,n)&&r.push(n);return r},to=Yr?function(t){return Pn(t)?Yr(t):[]}:Jr,no={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},eo=xn(no),ro=Mr("("+to(eo).join("|")+")","g"),oo=Mr("["+to(no).join("")+"]","g"),io=function(t,n,e){var r,o=t,i=o;if(!o)return i;var a=arguments,u=0,s="number"==typeof e?2:a.length;if(s>3&&"function"==typeof a[s-2])var c=Q(a[--s-1],a[s--],2);else s>2&&"function"==typeof a[s-1]&&(c=a[--s]);for(;s>++u;)if(o=a[u],o&&Z[typeof o])for(var l=-1,f=Z[typeof o]&&to(o),h=f?f.length:0;h>++l;)r=f[l],i[r]=c?c(i[r],o[r]):o[r];return i},ao=function(t,n,e){var r,o=t,i=o;if(!o)return i;for(var a=arguments,u=0,s="number"==typeof e?2:a.length;s>++u;)if(o=a[u],o&&Z[typeof o])for(var c=-1,l=Z[typeof o]&&to(o),f=l?l.length:0;f>++c;)r=l[c],i[r]===d&&(i[r]=o[r]);return i},uo=function(t,n,e){var r,o=t,i=o;if(!o)return i;if(!Z[typeof o])return i;n=n&&e===d?n:Q(n,e,3);for(r in o)if(n(o[r],r,t)===!1)return i;return i},so=function(t,n,e){var r,o=t,i=o;if(!o)return i;if(!Z[typeof o])return i;n=n&&e===d?n:Q(n,e,3);for(var a=-1,u=Z[typeof o]&&to(o),s=u?u.length:0;s>++a;)if(r=u[a],n(o[r],r,t)===!1)return i;return i},co=jr?function(t){if(!t||kr.call(t)!=R)return!1;var n=t.valueOf,e=ln(n)&&(e=jr(n))&&jr(e);return e?t==e||jr(t)==e:fn(t)}:fn,lo=an(function(t,n,e){qr.call(t,e)?t[e]++:t[e]=1}),fo=an(function(t,n,e){(qr.call(t,e)?t[e]:t[e]=[]).push(n)}),ho=an(function(t,n,e){t[e]=n}),po=te,mo=Wn,go=ln(go=gr.now)&&go||function(){return(new gr).getTime()},vo=8==Kr(b+"08")?Kr:function(t,n){return Kr(In(t)?t.replace(S,""):t,n||0)};return p.after=qe,p.assign=io,p.at=Xn,p.bind=Fe,p.bindAll=Ie,p.bindKey=Oe,p.chain=cr,p.compact=he,p.compose=Ne,p.constant=Ge,p.countBy=lo,p.create=gn,p.createCallback=Qe,p.curry=De,p.debounce=Re,p.defaults=ao,p.defer=Be,p.delay=He,p.difference=de,p.filter=Wn,p.flatten=ve,p.forEach=$n,p.forEachRight=Vn,p.forIn=uo,p.forInRight=wn,p.forOwn=so,p.forOwnRight=bn,p.functions=Mn,p.groupBy=fo,p.indexBy=ho,p.initial=we,p.intersection=be,p.invert=xn,p.invoke=Jn,p.keys=to,p.map=te,p.mapValues=Nn,p.max=ne,p.memoize=Ue,p.merge=Dn,p.min=ee,p.omit=Rn,p.once=Ye,p.pairs=Bn,p.partial=Xe,p.partialRight=Ze,p.pick=Hn,p.pluck=po,p.property=er,p.pull=xe,p.range=ze,p.reject=ie,p.remove=Ce,p.rest=Ee,p.shuffle=ue,p.sortBy=le,p.tap=lr,p.throttle=Ke,p.times=ar,p.toArray=fe,p.transform=Un,p.union=Se,p.uniq=Te,p.values=Yn,p.where=mo,p.without=Le,p.wrap=We,p.xor=Pe,p.zip=Ae,p.zipObject=je,p.collect=te,p.drop=Ee,p.each=$n,p.eachRight=Vn,p.extend=io,p.methods=Mn,p.object=je,p.select=Wn,p.tail=Ee,p.unique=Te,p.unzip=Ae,Je(p),p.clone=pn,p.cloneDeep=mn,p.contains=Zn,p.escape=$e,p.every=Kn,p.find=Gn,p.findIndex=pe,p.findKey=vn,p.findLast=Qn,p.findLastIndex=me,p.findLastKey=yn,p.has=_n,p.identity=Ve,p.indexOf=ye,p.isArguments=dn,p.isArray=Vr,p.isBoolean=zn,p.isDate=Cn,p.isElement=En,p.isEmpty=kn,p.isEqual=Sn,p.isFinite=Tn,p.isFunction=Ln,p.isNaN=An,p.isNull=jn,p.isNumber=qn,p.isObject=Pn,p.isPlainObject=co,p.isRegExp=Fn,p.isString=In,p.isUndefined=On,p.lastIndexOf=_e,p.mixin=Je,p.noConflict=tr,p.noop=nr,p.now=go,p.parseInt=vo,p.random=rr,p.reduce=re,p.reduceRight=oe,p.result=or,p.runInContext=h,p.size=se,p.some=ce,p.sortedIndex=ke,p.template=ir,p.unescape=ur,p.uniqueId=sr,p.all=Kn,p.any=ce,p.detect=Gn,p.findWhere=Gn,p.foldl=re,p.foldr=oe,p.include=Zn,p.inject=re,Je(function(){var t={};return so(p,function(n,e){p.prototype[e]||(t[e]=n)}),t}(),!1),p.first=ge,p.last=Me,p.sample=ae,p.take=ge,p.head=ge,so(p,function(t,n){var e="sample"!==n;p.prototype[n]||(p.prototype[n]=function(n,r){var o=this.__chain__,i=t(this.__wrapped__,n,r);return o||null!=n&&(!r||e&&"function"==typeof n)?new m(i,o):i})}),p.VERSION="2.4.1",p.prototype.chain=fr,p.prototype.toString=hr,p.prototype.value=dr,p.prototype.valueOf=dr,$n(["join","pop","shift"],function(t){var n=zr[t];p.prototype[t]=function(){var t=this.__chain__,e=n.apply(this.__wrapped__,arguments);return t?new m(e,t):e}}),$n(["push","reverse","sort","unshift"],function(t){var n=zr[t];p.prototype[t]=function(){return n.apply(this.__wrapped__,arguments),this}}),$n(["concat","slice","splice"],function(t){var n=zr[t];p.prototype[t]=function(){return new m(n.apply(this.__wrapped__,arguments),this.__chain__)}}),p}var d,p=[],m=[],g=0,v=+new Date+"",y=75,w=40,b=" 	\f\n\r\u2028\u2029",M=/\b__p \+= '';/g,_=/\b(__p \+=) '' \+/g,x=/(__e\(.*?\)|\b__t\)) \+\n'';/g,z=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,C=/\w*$/,E=/^\s*function[ \n\r\t]+\w/,k=/<%=([\s\S]+?)%>/g,S=RegExp("^["+b+"]*0+(?=.$)"),T=/($^)/,L=/\bthis\b/,P=/['\n\r\t\u2028\u2029\\]/g,A=["Array","Boolean","Date","Function","Math","Number","Object","RegExp","String","_","attachEvent","clearTimeout","isFinite","isNaN","parseInt","setTimeout"],j=0,q="[object Arguments]",F="[object Array]",I="[object Boolean]",O="[object Date]",N="[object Function]",D="[object Number]",R="[object Object]",B="[object RegExp]",H="[object String]",U={};U[N]=!1,U[q]=U[F]=U[I]=U[O]=U[D]=U[R]=U[B]=U[H]=!0;var Y={leading:!1,maxWait:0,trailing:!1},X={configurable:!1,enumerable:!1,value:null,writable:!1},Z={"boolean":!1,"function":!0,object:!0,number:!1,string:!1,undefined:!1},K={"\\":"\\","'":"'","\n":"n","\r":"r","	":"t","\u2028":"u2028","\u2029":"u2029"},W=Z[typeof window]&&window||this,G=Z[typeof exports]&&exports&&!exports.nodeType&&exports,Q=Z[typeof module]&&module&&!module.nodeType&&module,$=Q&&Q.exports===G&&G,V=Z[typeof global]&&global;!V||V.global!==V&&V.window!==V||(W=V);var J=h();"function"==typeof define&&"object"==typeof define.amd&&define.amd?(W._=J,define(function(){return J})):G&&Q?$?(Q.exports=J)._=J:G._=J:W._=J}.call(this),Date.now||(Date.now=function(){return(new Date).getTime()}),function(){for(var t=["webkit","moz"],n=0;t.length>n&&!window.requestAnimationFrame;++n){var e=t[n];window.requestAnimationFrame=window[e+"RequestAnimationFrame"],window.cancelAnimationFrame=window[e+"CancelAnimationFrame"]||window[e+"CancelRequestAnimationFrame"]}if(/iP(ad|hone|od).*OS 6/.test(window.navigator.userAgent)||!window.requestAnimationFrame||!window.cancelAnimationFrame){var r=0;window.requestAnimationFrame=function(t){var n=Date.now(),e=Math.max(r+16,n);return setTimeout(function(){t(r=e)},e-n)},window.cancelAnimationFrame=clearTimeout}}();var previousMM=MM;if(!com){var com={};com.modestmaps||(com.modestmaps={})}var MM=com.modestmaps={noConflict:function(){return MM=previousMM,this}};(function(t){t.extend=function(t,n){for(var e in n.prototype)t.prototype[e]===void 0&&(t.prototype[e]=n.prototype[e]);return t},t.getFrame=function(){return function(t){(window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){window.setTimeout(function(){t(+new Date)},10)})(t)}}(),t.transformProperty=function(t){if(this.document){for(var n=document.documentElement.style,e=0;t.length>e;e++)if(t[e]in n)return t[e];return!1}}(["transform","WebkitTransform","OTransform","MozTransform","msTransform"]),t.matrixString=function(n){var e=n.scale||1;return t._browser.webkit3d?(10*e*n.width%1&&(e=~~(1+10*e*n.width)/n.width/10),"translate3d("+~~(10*n.x)/10+"px,"+~~(10*n.y)/10+"px, 0px)"+"scale3d("+e+","+e+", 1)"):(e*n.width%1&&(e+=(1-e*n.width%1)/n.width),"translate("+Math.round(n.x)+"px,"+Math.round(n.y)+"px)"+"scale("+e+","+e+")")},t._browser=function(t){return{webkit:"WebKitCSSMatrix"in t,webkit3d:"WebKitCSSMatrix"in t&&"m11"in new WebKitCSSMatrix}}(this),t.moveElement=function(n,e){if(t.transformProperty){e.scale||(e.scale=1),e.width||(e.width=0),e.height||(e.height=0);var r=t.matrixString(e);n[t.transformProperty]!==r&&(n.style[t.transformProperty]=n[t.transformProperty]=r)}else n.style.left=e.x+"px",n.style.top=e.y+"px",e.width&&e.height&&e.scale&&(n.style.width=Math.ceil(e.width*e.scale)+"px",n.style.height=Math.ceil(e.height*e.scale)+"px")},t.cancelEvent=function(t){return t.cancelBubble=!0,t.cancel=!0,t.returnValue=!1,t.stopPropagation&&t.stopPropagation(),t.preventDefault&&t.preventDefault(),!1},t.coerceLayer=function(n){return"string"==typeof n?new t.Layer(new t.TemplatedLayer(n)):"draw"in n&&"function"==typeof n.draw?n:new t.Layer(n)},t.addEvent=function(t,n,e){t.addEventListener?(t.addEventListener(n,e,!1),"mousewheel"==n&&t.addEventListener("DOMMouseScroll",e,!1)):t.attachEvent&&(t["e"+n+e]=e,t[n+e]=function(){t["e"+n+e](window.event)},t.attachEvent("on"+n,t[n+e]))},t.removeEvent=function(t,n,e){t.removeEventListener?(t.removeEventListener(n,e,!1),"mousewheel"==n&&t.removeEventListener("DOMMouseScroll",e,!1)):t.detachEvent&&(t.detachEvent("on"+n,t[n+e]),t[n+e]=null)},t.getStyle=function(t,n){return t.currentStyle?t.currentStyle[n]:window.getComputedStyle?document.defaultView.getComputedStyle(t,null).getPropertyValue(n):void 0},t.Point=function(t,n){this.x=parseFloat(t),this.y=parseFloat(n)},t.Point.prototype={x:0,y:0,toString:function(){return"("+this.x.toFixed(3)+", "+this.y.toFixed(3)+")"},copy:function(){return new t.Point(this.x,this.y)}},t.Point.distance=function(t,n){return Math.sqrt(Math.pow(n.x-t.x,2)+Math.pow(n.y-t.y,2))},t.Point.interpolate=function(n,e,r){return new t.Point(n.x+(e.x-n.x)*r,n.y+(e.y-n.y)*r)},t.Coordinate=function(t,n,e){this.row=t,this.column=n,this.zoom=e},t.Coordinate.prototype={row:0,column:0,zoom:0,toString:function(){return"("+this.row.toFixed(3)+", "+this.column.toFixed(3)+" @"+this.zoom.toFixed(3)+")"},toKey:function(){return this.zoom+","+this.row+","+this.column},copy:function(){return new t.Coordinate(this.row,this.column,this.zoom)},container:function(){return new t.Coordinate(Math.floor(this.row),Math.floor(this.column),Math.floor(this.zoom))},zoomTo:function(n){var e=Math.pow(2,n-this.zoom);return new t.Coordinate(this.row*e,this.column*e,n)},zoomBy:function(n){var e=Math.pow(2,n);return new t.Coordinate(this.row*e,this.column*e,this.zoom+n)},up:function(n){return void 0===n&&(n=1),new t.Coordinate(this.row-n,this.column,this.zoom)},right:function(n){return void 0===n&&(n=1),new t.Coordinate(this.row,this.column+n,this.zoom)},down:function(n){return void 0===n&&(n=1),new t.Coordinate(this.row+n,this.column,this.zoom)},left:function(n){return void 0===n&&(n=1),new t.Coordinate(this.row,this.column-n,this.zoom)}},t.Location=function(t,n){this.lat=parseFloat(t),this.lon=parseFloat(n)},t.Location.prototype={lat:0,lon:0,toString:function(){return"("+this.lat.toFixed(3)+", "+this.lon.toFixed(3)+")"},copy:function(){return new t.Location(this.lat,this.lon)}},t.Location.distance=function(t,n,e){e||(e=6378e3);var r=Math.PI/180,o=t.lat*r,i=t.lon*r,a=n.lat*r,u=n.lon*r,s=Math.cos(o)*Math.cos(i)*Math.cos(a)*Math.cos(u),c=Math.cos(o)*Math.sin(i)*Math.cos(a)*Math.sin(u),l=Math.sin(o)*Math.sin(a);return Math.acos(s+c+l)*e},t.Location.interpolate=function(n,e,r){if(n.lat===e.lat&&n.lon===e.lon)return new t.Location(n.lat,n.lon);var o=Math.PI/180,i=n.lat*o,a=n.lon*o,u=e.lat*o,s=e.lon*o,c=2*Math.asin(Math.sqrt(Math.pow(Math.sin(.5*(i-u)),2)+Math.cos(i)*Math.cos(u)*Math.pow(Math.sin(.5*(a-s)),2))),l=Math.sin((1-r)*c)/Math.sin(c),f=Math.sin(r*c)/Math.sin(c),h=l*Math.cos(i)*Math.cos(a)+f*Math.cos(u)*Math.cos(s),d=l*Math.cos(i)*Math.sin(a)+f*Math.cos(u)*Math.sin(s),p=l*Math.sin(i)+f*Math.sin(u),m=Math.atan2(p,Math.sqrt(Math.pow(h,2)+Math.pow(d,2))),g=Math.atan2(d,h);return new t.Location(m/o,g/o)},t.Location.bearing=function(t,n){var e=Math.PI/180,r=t.lat*e,o=t.lon*e,i=n.lat*e,a=n.lon*e,u=Math.atan2(Math.sin(o-a)*Math.cos(i),Math.cos(r)*Math.sin(i)-Math.sin(r)*Math.cos(i)*Math.cos(o-a))/-(Math.PI/180);return 0>u?u+360:u},t.Extent=function(n,e,r,o){if(n instanceof t.Location&&e instanceof t.Location){var i=n,a=e;n=i.lat,e=i.lon,r=a.lat,o=a.lon}isNaN(r)&&(r=n),isNaN(o)&&(o=e),this.north=Math.max(n,r),this.south=Math.min(n,r),this.east=Math.max(o,e),this.west=Math.min(o,e)},t.Extent.prototype={north:0,south:0,east:0,west:0,copy:function(){return new t.Extent(this.north,this.west,this.south,this.east)},toString:function(t){return isNaN(t)&&(t=3),[this.north.toFixed(t),this.west.toFixed(t),this.south.toFixed(t),this.east.toFixed(t)].join(", ")},northWest:function(){return new t.Location(this.north,this.west)},southEast:function(){return new t.Location(this.south,this.east)},northEast:function(){return new t.Location(this.north,this.east)},southWest:function(){return new t.Location(this.south,this.west)},center:function(){return new t.Location(this.south+.5*(this.north-this.south),this.east+.5*(this.west-this.east))},encloseLocation:function(t){t.lat>this.north&&(this.north=t.lat),t.lat<this.south&&(this.south=t.lat),t.lon>this.east&&(this.east=t.lon),t.lon<this.west&&(this.west=t.lon)},encloseLocations:function(t){for(var n=t.length,e=0;n>e;e++)this.encloseLocation(t[e])},setFromLocations:function(t){var n=t.length,e=t[0];this.north=this.south=e.lat,this.east=this.west=e.lon;for(var r=1;n>r;r++)this.encloseLocation(t[r])},encloseExtent:function(t){t.north>this.north&&(this.north=t.north),t.south<this.south&&(this.south=t.south),t.east>this.east&&(this.east=t.east),t.west<this.west&&(this.west=t.west)},containsLocation:function(t){return t.lat>=this.south&&t.lat<=this.north&&t.lon>=this.west&&t.lon<=this.east},toArray:function(){return[this.northWest(),this.southEast()]}},t.Extent.fromString=function(n){var e=n.split(/\s*,\s*/);if(4!=e.length)throw"Invalid extent string (expecting 4 comma-separated numbers)";return new t.Extent(parseFloat(e[0]),parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3]))},t.Extent.fromArray=function(n){var e=new t.Extent;return e.setFromLocations(n),e},t.Transformation=function(t,n,e,r,o,i){this.ax=t,this.bx=n,this.cx=e,this.ay=r,this.by=o,this.cy=i},t.Transformation.prototype={ax:0,bx:0,cx:0,ay:0,by:0,cy:0,transform:function(n){return new t.Point(this.ax*n.x+this.bx*n.y+this.cx,this.ay*n.x+this.by*n.y+this.cy)},untransform:function(n){return new t.Point((n.x*this.by-n.y*this.bx-this.cx*this.by+this.cy*this.bx)/(this.ax*this.by-this.ay*this.bx),(n.x*this.ay-n.y*this.ax-this.cx*this.ay+this.cy*this.ax)/(this.bx*this.ay-this.by*this.ax))}},t.deriveTransformation=function(n,e,r,o,i,a,u,s,c,l,f,h){var d=t.linearSolution(n,e,r,i,a,u,c,l,f),p=t.linearSolution(n,e,o,i,a,s,c,l,h);return new t.Transformation(d[0],d[1],d[2],p[0],p[1],p[2])},t.linearSolution=function(t,n,e,r,o,i,a,u,s){t=parseFloat(t),n=parseFloat(n),e=parseFloat(e),r=parseFloat(r),o=parseFloat(o),i=parseFloat(i),a=parseFloat(a),u=parseFloat(u),s=parseFloat(s);var c=((i-s)*(n-o)-(e-i)*(o-u))/((r-a)*(n-o)-(t-r)*(o-u)),l=((i-s)*(t-r)-(e-i)*(r-a))/((o-u)*(t-r)-(n-o)*(r-a)),f=e-t*c-n*l;return[c,l,f]},t.Projection=function(n,e){e||(e=new t.Transformation(1,0,0,0,1,0)),this.zoom=n,this.transformation=e},t.Projection.prototype={zoom:0,transformation:null,rawProject:function(){throw"Abstract method not implemented by subclass."},rawUnproject:function(){throw"Abstract method not implemented by subclass."},project:function(t){return t=this.rawProject(t),this.transformation&&(t=this.transformation.transform(t)),t},unproject:function(t){return this.transformation&&(t=this.transformation.untransform(t)),t=this.rawUnproject(t)},locationCoordinate:function(n){var e=new t.Point(Math.PI*n.lon/180,Math.PI*n.lat/180);return e=this.project(e),new t.Coordinate(e.y,e.x,this.zoom)},coordinateLocation:function(n){n=n.zoomTo(this.zoom);var e=new t.Point(n.column,n.row);return e=this.unproject(e),new t.Location(180*e.y/Math.PI,180*e.x/Math.PI)}},t.LinearProjection=function(n,e){t.Projection.call(this,n,e)},t.LinearProjection.prototype={rawProject:function(n){return new t.Point(n.x,n.y)},rawUnproject:function(n){return new t.Point(n.x,n.y)}},t.extend(t.LinearProjection,t.Projection),t.MercatorProjection=function(n,e){t.Projection.call(this,n,e)},t.MercatorProjection.prototype={rawProject:function(n){return new t.Point(n.x,Math.log(Math.tan(.25*Math.PI+.5*n.y)))},rawUnproject:function(n){return new t.Point(n.x,2*Math.atan(Math.pow(Math.E,n.y))-.5*Math.PI)}},t.extend(t.MercatorProjection,t.Projection),t.MapProvider=function(t){t&&(this.getTile=t)},t.MapProvider.prototype={tileLimits:[new t.Coordinate(0,0,0),new t.Coordinate(1,1,0).zoomTo(18)],getTileUrl:function(){throw"Abstract method not implemented by subclass."},getTile:function(){throw"Abstract method not implemented by subclass."},releaseTile:function(){},setZoomRange:function(t,n){this.tileLimits[0]=this.tileLimits[0].zoomTo(t),this.tileLimits[1]=this.tileLimits[1].zoomTo(n)},sourceCoordinate:function(n){var e,r=this.tileLimits[0].zoomTo(n.zoom).container(),o=this.tileLimits[1].zoomTo(n.zoom),i=Math.pow(2,n.zoom);return o=new t.Coordinate(Math.ceil(o.row),Math.ceil(o.column),Math.floor(o.zoom)),e=0>n.column?(n.column%i+i)%i:n.column%i,n.row<r.row||n.row>=o.row?null:r.column>e||e>=o.column?null:new t.Coordinate(n.row,e,n.zoom)}},t.Template=function(n,e){function r(t,n,e){for(var r="",o=1;e>=o;o++)r+=(1&t>>e-o)<<1|1&n>>e-o;return r||"0"}var o=n.match(/{(Q|quadkey)}/);o&&(n=n.replace("{subdomain}","{S}").replace("{zoom}","{Z}").replace("{quadkey}","{Q}"));var i=e&&e.length&&n.indexOf("{S}")>=0,a=function(t){var a=this.sourceCoordinate(t);if(!a)return null;var u=n;if(i){var s=parseInt(a.zoom+a.row+a.column,10)%e.length;u=u.replace("{S}",e[s])}return o?u.replace("{Z}",a.zoom.toFixed(0)).replace("{Q}",r(a.row,a.column,a.zoom)):u.replace("{Z}",a.zoom.toFixed(0)).replace("{X}",a.column.toFixed(0)).replace("{Y}",a.row.toFixed(0))};t.MapProvider.call(this,a)},t.Template.prototype={getTile:function(t){return this.getTileUrl(t)}},t.extend(t.Template,t.MapProvider),t.TemplatedLayer=function(n,e,r){return new t.Layer(new t.Template(n,e),null,r)},t.getMousePoint=function(n,e){var r=new t.Point(n.clientX,n.clientY);r.x+=document.body.scrollLeft+document.documentElement.scrollLeft,r.y+=document.body.scrollTop+document.documentElement.scrollTop;for(var o=e.parent;o;o=o.offsetParent)r.x-=o.offsetLeft,r.y-=o.offsetTop;return r},t.MouseWheelHandler=function(){function n(n){var i=0;o=o||(new Date).getTime();try{r.scrollTop=1e3,r.dispatchEvent(n),i=1e3-r.scrollTop}catch(u){i=n.wheelDelta||5*-n.detail}var s=(new Date).getTime()-o,c=t.getMousePoint(n,e);return Math.abs(i)>0&&s>200&&!a?(e.zoomByAbout(i>0?1:-1,c),o=(new Date).getTime()):a&&e.zoomByAbout(.001*i,c),t.cancelEvent(n)}var e,r,o,i={id:"MouseWheelHandler"},a=!1;return i.init=function(o){e=o,r=document.body.appendChild(document.createElement("div")),r.style.cssText="visibility:hidden;top:0;height:0;width:0;overflow-y:scroll";var a=r.appendChild(document.createElement("div"));return a.style.height="2000px",t.addEvent(e.parent,"mousewheel",n),i},i.precise=function(t){return arguments.length?(a=t,i):a},i.remove=function(){t.removeEvent(e.parent,"mousewheel",n),r.parentNode.removeChild(r)},i},t.DoubleClickHandler=function(){function n(n){var r=t.getMousePoint(n,e);return e.zoomByAbout(n.shiftKey?-1:1,r),t.cancelEvent(n)}var e,r={id:"DoubleClickHandler"};return r.init=function(o){return e=o,t.addEvent(e.parent,"dblclick",n),r},r.remove=function(){t.removeEvent(e.parent,"dblclick",n)},r},t.DragHandler=function(){function n(n){return n.shiftKey||2==n.button?void 0:(t.addEvent(document,"mouseup",e),t.addEvent(document,"mousemove",r),o=new t.Point(n.clientX,n.clientY),i.parent.style.cursor="move",t.cancelEvent(n))}function e(n){return t.removeEvent(document,"mouseup",e),t.removeEvent(document,"mousemove",r),o=null,i.parent.style.cursor="",t.cancelEvent(n)}function r(n){return o&&(i.panBy(n.clientX-o.x,n.clientY-o.y),o.x=n.clientX,o.y=n.clientY,o.t=+new Date),t.cancelEvent(n)}var o,i,a={id:"DragHandler"};return a.init=function(e){return i=e,t.addEvent(i.parent,"mousedown",n),a},a.remove=function(){t.removeEvent(i.parent,"mousedown",n)},a},t.MouseHandler=function(){var n,e={id:"MouseHandler",handlers:[]};return e.init=function(r){return n=r,e.handlers=[t.DragHandler().init(n),t.DoubleClickHandler().init(n),t.MouseWheelHandler().init(n)],e},e.remove=function(){for(var t=0;e.handlers.length>t;t++)e.handlers[t].remove();return e.handlers=[],e},e},t.TouchHandler=function(){function n(){var t=document.createElement("div");return t.setAttribute("ongesturestart","return;"),"function"==typeof t.ongesturestart}function e(t){for(var n=0;t.touches.length>n;n+=1){var e=t.touches[n];if(e.identifier in v){var r=v[e.identifier];r.x=e.clientX,r.y=e.clientY,r.scale=t.scale}else v[e.identifier]={scale:t.scale,startPos:{x:e.clientX,y:e.clientY},x:e.clientX,y:e.clientY,time:(new Date).getTime()}}}function r(t){e(t)}function o(n){switch(n.touches.length){case 1:c(n.touches[0]);break;case 2:l(n)}return e(n),t.cancelEvent(n)}function i(n){var e=(new Date).getTime();0===n.touches.length&&b&&f(M);for(var r=0;n.changedTouches.length>r;r+=1){var o=n.changedTouches[r],i=v[o.identifier];if(i&&!i.wasPinch){var s={x:o.clientX,y:o.clientY},c=e-i.time,l=t.Point.distance(s,i.startPos);l>m||(c>p?(s.end=e,s.duration=c,a(s)):(s.time=e,u(s)))}}for(var h={},d=0;n.touches.length>d;d++)h[n.touches[d].identifier]=!0;for(var g in v)g in h||delete h[g];return t.cancelEvent(n)}function a(){}function u(t){return y.length&&g>t.time-y[0].time?(s(t),y=[],void 0):(y=[t],void 0)}function s(n){var e=h.getZoom(),r=Math.round(e)+1,o=r-e,i=new t.Point(n.x,n.y);h.zoomByAbout(o,i)}function c(t){var n={x:t.clientX,y:t.clientY},e=v[t.identifier];h.panBy(n.x-e.x,n.y-e.y)}function l(n){var e=n.touches[0],r=n.touches[1],o=new t.Point(e.clientX,e.clientY),i=new t.Point(r.clientX,r.clientY),a=v[e.identifier],u=v[r.identifier];a.wasPinch=!0,u.wasPinch=!0;var s=t.Point.interpolate(o,i,.5);h.zoomByAbout(Math.log(n.scale)/Math.LN2-Math.log(a.scale)/Math.LN2,s);var c=t.Point.interpolate(a,u,.5);h.panBy(s.x-c.x,s.y-c.y),b=!0,M=s}function f(t){if(w){var n=h.getZoom(),e=Math.round(n);h.zoomByAbout(e-n,t)}b=!1}var h,d={id:"TouchHandler"},p=250,m=30,g=350,v={},y=[],w=!0,b=!1,M=null;return d.init=function(e){return h=e,n()?(t.addEvent(h.parent,"touchstart",r),t.addEvent(h.parent,"touchmove",o),t.addEvent(h.parent,"touchend",i),d):d},d.remove=function(){return n()?(t.removeEvent(h.parent,"touchstart",r),t.removeEvent(h.parent,"touchmove",o),t.removeEvent(h.parent,"touchend",i),d):d},d},t.CallbackManager=function(t,n){this.owner=t,this.callbacks={};for(var e=0;n.length>e;e++)this.callbacks[n[e]]=[]},t.CallbackManager.prototype={owner:null,callbacks:null,addCallback:function(t,n){"function"==typeof n&&this.callbacks[t]&&this.callbacks[t].push(n)},removeCallback:function(t,n){if("function"==typeof n&&this.callbacks[t])for(var e=this.callbacks[t],r=e.length,o=0;r>o;o++)if(e[o]===n){e.splice(o,1);break}},dispatchCallback:function(t,n){if(this.callbacks[t])for(var e=0;this.callbacks[t].length>e;e+=1)try{this.callbacks[t][e](this.owner,n)}catch(r){}}},t.RequestManager=function(){this.loadingBay=document.createDocumentFragment(),this.requestsById={},this.openRequestCount=0,this.maxOpenRequests=4,this.requestQueue=[],this.callbackManager=new t.CallbackManager(this,["requestcomplete","requesterror"])},t.RequestManager.prototype={loadingBay:null,requestQueue:null,openRequestCount:null,maxOpenRequests:null,callbackManager:null,addCallback:function(t,n){this.callbackManager.addCallback(t,n)},removeCallback:function(t,n){this.callbackManager.removeCallback(t,n)},dispatchCallback:function(t,n){this.callbackManager.dispatchCallback(t,n)},clear:function(){this.clearExcept({})},clearRequest:function(t){t in this.requestsById&&delete this.requestsById[t];for(var n=0;this.requestQueue.length>n;n++){var e=this.requestQueue[n];e&&e.id==t&&(this.requestQueue[n]=null)}},clearExcept:function(t){for(var n=0;this.requestQueue.length>n;n++){var e=this.requestQueue[n];!e||e.id in t||(this.requestQueue[n]=null)}for(var r=this.loadingBay.childNodes,o=r.length-1;o>=0;o--){var i=r[o];i.id in t||(this.loadingBay.removeChild(i),this.openRequestCount--,i.coord=i.onload=i.onerror=null,i.src="")}for(var a in this.requestsById)if(!(a in t)&&this.requestsById.hasOwnProperty(a)){var u=this.requestsById[a];delete this.requestsById[a],null!==u&&(u=u.id=u.coord=u.url=null)}},hasRequest:function(t){return t in this.requestsById},requestTile:function(t,n,e){if(!(t in this.requestsById)){var r={id:t,coord:n.copy(),url:e};this.requestsById[t]=r,e&&this.requestQueue.push(r)}},getProcessQueue:function(){if(!this._processQueue){var t=this;this._processQueue=function(){t.processQueue()}}return this._processQueue
},processQueue:function(t){for(t&&this.requestQueue.length>8&&this.requestQueue.sort(t);this.openRequestCount<this.maxOpenRequests&&this.requestQueue.length>0;){var n=this.requestQueue.pop();if(n){this.openRequestCount++;var e=document.createElement("img");e.id=n.id,e.style.position="absolute",e.coord=n.coord,this.loadingBay.appendChild(e),e.onload=e.onerror=this.getLoadComplete(),e.src=n.url,n=n.id=n.coord=n.url=null}}},_loadComplete:null,getLoadComplete:function(){if(!this._loadComplete){var t=this;this._loadComplete=function(n){n=n||window.event;var e=n.srcElement||n.target;e.onload=e.onerror=null,t.loadingBay.removeChild(e),t.openRequestCount--,delete t.requestsById[e.id],"load"===n.type&&(e.complete||e.readyState&&"complete"==e.readyState)?t.dispatchCallback("requestcomplete",e):(t.dispatchCallback("requesterror",{element:e,url:""+e.src}),e.src=null),setTimeout(t.getProcessQueue(),0)}}return this._loadComplete}},t.Layer=function(n,e,r){this.parent=e||document.createElement("div"),this.parent.style.cssText="position: absolute; top: 0px; left: 0px; width: 100%; height: 100%; margin: 0; padding: 0; z-index: 0",this.name=r,this.levels={},this.requestManager=new t.RequestManager,this.requestManager.addCallback("requestcomplete",this.getTileComplete()),this.requestManager.addCallback("requesterror",this.getTileError()),n&&this.setProvider(n)},t.Layer.prototype={map:null,parent:null,name:null,enabled:!0,tiles:null,levels:null,requestManager:null,provider:null,_tileComplete:null,getTileComplete:function(){if(!this._tileComplete){var t=this;this._tileComplete=function(n,e){t.tiles[e.id]=e,t.positionTile(e),e.style.visibility="inherit",e.className="map-tile-loaded"}}return this._tileComplete},getTileError:function(){if(!this._tileError){var t=this;this._tileError=function(n,e){e.onload=e.onerror=null,t.tiles[e.element.id]=e.element,t.positionTile(e.element),e.element.style.visibility="hidden"}}return this._tileError},draw:function(){function n(t,n){if(t&&n){var r=t.coord,o=n.coord;if(r.zoom==o.zoom){var i=Math.abs(e.row-r.row-.5)+Math.abs(e.column-r.column-.5),a=Math.abs(e.row-o.row-.5)+Math.abs(e.column-o.column-.5);return a>i?1:i>a?-1:0}return r.zoom<o.zoom?1:r.zoom>o.zoom?-1:0}return t?1:n?-1:0}if(this.enabled&&this.map){var e=this.map.coordinate.zoomTo(Math.round(this.map.coordinate.zoom)),r=Math.round(this.map.coordinate.zoom),o=this.map.pointCoordinate(new t.Point(0,0)).zoomTo(r).container(),i=this.map.pointCoordinate(this.map.dimensions).zoomTo(r).container().right().down(),a={},u=this.createOrGetLevel(o.zoom),s=o.copy();for(s.column=o.column;s.column<i.column;s.column++)for(s.row=o.row;s.row<i.row;s.row++)for(var c=this.inventoryVisibleTile(u,s);c.length;)a[c.pop()]=!0;for(var l in this.levels)if(this.levels.hasOwnProperty(l)){var f=parseInt(l,10);if(f>=o.zoom-5&&o.zoom+2>f)continue;var h=this.levels[l];h.style.display="none";for(var d=this.tileElementsInLevel(h);d.length;)this.provider.releaseTile(d[0].coord),this.requestManager.clearRequest(d[0].coord.toKey()),h.removeChild(d[0]),d.shift()}for(var p=o.zoom-5,m=o.zoom+2,g=p;m>g;g++)this.adjustVisibleLevel(this.levels[g],g,a);this.requestManager.clearExcept(a),this.requestManager.processQueue(n)}},inventoryVisibleTile:function(t,n){var e,r,o=n.toKey(),i=[o];if(o in this.tiles){var a=this.tiles[o];return a.parentNode==t||a.__composited__||(t.appendChild(a),"reAddTile"in this.provider&&this.provider.reAddTile(o,n,a)),e=n.zoomBy(-1).container(),r=e.toKey(),r in this.tiles&&i.push(r),i}if(!this.requestManager.hasRequest(o)){var u=this.provider.getTile(n);"string"==typeof u?this.addTileImage(o,n,u):u&&this.addTileElement(o,n,u)}for(var s=!1,c=n.zoom,l=1;c>=l;l++)if(e=n.zoomBy(-l).container(),r=e.toKey(),r in this.tiles){i.push(r),s=!0;break}if(!s){var f=n.zoomBy(1);i.push(f.toKey()),f.column+=1,i.push(f.toKey()),f.row+=1,i.push(f.toKey()),f.column-=1,i.push(f.toKey())}return i},tileElementsInLevel:function(t){for(var n=[],e=t.firstChild;e;e=e.nextSibling)1==e.nodeType&&n.push(e);return n},adjustVisibleLevel:function(n,e,r){if(n){var o=1,i=this.map.coordinate.copy();if(!(n.childNodes.length>0))return n.style.display="none",!1;n.style.display="block",o=Math.pow(2,this.map.coordinate.zoom-e),i=i.zoomTo(e);for(var a=this.map.tileSize.x*o,u=this.map.tileSize.y*o,s=new t.Point(.5*this.map.dimensions.x,.5*this.map.dimensions.y),c=this.tileElementsInLevel(n);c.length;){var l=c.pop();r[l.id]?t.moveElement(l,{x:s.x+(l.coord.column-i.column)*a,y:s.y+(l.coord.row-i.row)*u,scale:o,width:this.map.tileSize.x,height:this.map.tileSize.y}):(this.provider.releaseTile(l.coord),this.requestManager.clearRequest(l.coord.toKey()),n.removeChild(l))}}},createOrGetLevel:function(t){if(t in this.levels)return this.levels[t];var n=document.createElement("div");return n.id=this.parent.id+"-zoom-"+t,n.style.cssText="position: absolute; top: 0px; left: 0px; width: 100%; height: 100%; margin: 0; padding: 0;",n.style.zIndex=t,this.parent.appendChild(n),this.levels[t]=n,n},addTileImage:function(t,n,e){this.requestManager.requestTile(t,n,e)},addTileElement:function(t,n,e){e.id=t,e.coord=n.copy(),this.positionTile(e)},positionTile:function(n){var e=this.map.coordinate.zoomTo(n.coord.zoom);n.style.cssText="position:absolute;-webkit-user-select:none;-webkit-user-drag:none;-moz-user-drag:none;-webkit-transform-origin:0 0;-moz-transform-origin:0 0;-o-transform-origin:0 0;-ms-transform-origin:0 0;width:"+this.map.tileSize.x+"px; height: "+this.map.tileSize.y+"px;",n.ondragstart=function(){return!1};var r=Math.pow(2,this.map.coordinate.zoom-n.coord.zoom);t.moveElement(n,{x:.5*this.map.dimensions.x+(n.coord.column-e.column)*this.map.tileSize.x*r,y:.5*this.map.dimensions.y+(n.coord.row-e.row)*this.map.tileSize.y*r,scale:r,width:this.map.tileSize.x,height:this.map.tileSize.y});var o=this.levels[n.coord.zoom];o.appendChild(n),Math.round(this.map.coordinate.zoom)==n.coord.zoom&&(o.style.display="block"),this.requestRedraw()},_redrawTimer:void 0,requestRedraw:function(){this._redrawTimer||(this._redrawTimer=setTimeout(this.getRedraw(),1e3))},_redraw:null,getRedraw:function(){if(!this._redraw){var t=this;this._redraw=function(){t.draw(),t._redrawTimer=0}}return this._redraw},setProvider:function(t){var n=null===this.provider;if(!n){this.requestManager.clear();for(var e in this.levels)if(this.levels.hasOwnProperty(e))for(var r=this.levels[e];r.firstChild;)this.provider.releaseTile(r.firstChild.coord),r.removeChild(r.firstChild)}this.tiles={},this.provider=t,n||this.draw()},enable:function(){return this.enabled=!0,this.parent.style.display="",this.draw(),this},disable:function(){return this.enabled=!1,this.requestManager.clear(),this.parent.style.display="none",this},destroy:function(){this.requestManager.clear(),this.requestManager.removeCallback("requestcomplete",this.getTileComplete()),this.requestManager.removeCallback("requesterror",this.getTileError()),this.provider=null,this.parent.parentNode&&this.parent.parentNode.removeChild(this.parent),this.map=null}},t.Map=function(n,e,r,o){if("string"==typeof n&&(n=document.getElementById(n),!n))throw"The ID provided to modest maps could not be found.";this.parent=n,this.parent.style.padding="0",this.parent.style.overflow="hidden";var i=t.getStyle(this.parent,"position");"relative"!=i&&"absolute"!=i&&(this.parent.style.position="relative"),this.layers=[],e||(e=[]),e instanceof Array||(e=[e]);for(var a=0;e.length>a;a++)this.addLayer(e[a]);if(this.projection=new t.MercatorProjection(0,t.deriveTransformation(-Math.PI,Math.PI,0,0,Math.PI,Math.PI,1,0,-Math.PI,-Math.PI,0,1)),this.tileSize=new t.Point(256,256),this.coordLimits=[new t.Coordinate(0,-1/0,0),new t.Coordinate(1,1/0,0).zoomTo(18)],this.coordinate=new t.Coordinate(.5,.5,0),r?(this.autoSize=!1,this.parent.style.width=Math.round(r.x)+"px",this.parent.style.height=Math.round(r.y)+"px"):(r=new t.Point(this.parent.offsetWidth,this.parent.offsetHeight),this.autoSize=!0,t.addEvent(window,"resize",this.windowResize())),this.dimensions=r,this.callbackManager=new t.CallbackManager(this,["zoomed","panned","centered","extentset","resized","drawn"]),void 0===o)this.eventHandlers=[t.MouseHandler().init(this),t.TouchHandler().init(this)];else if(this.eventHandlers=o,o instanceof Array)for(var u=0;o.length>u;u++)o[u].init(this)},t.Map.prototype={parent:null,dimensions:null,projection:null,coordinate:null,tileSize:null,coordLimits:null,layers:null,callbackManager:null,eventHandlers:null,autoSize:null,toString:function(){return"Map(#"+this.parent.id+")"},addCallback:function(t,n){return this.callbackManager.addCallback(t,n),this},removeCallback:function(t,n){return this.callbackManager.removeCallback(t,n),this},dispatchCallback:function(t,n){return this.callbackManager.dispatchCallback(t,n),this},getHandler:function(t,n){var e=null,r=this.eventHandlers;if(n===!0){if(r=this.getHandler("MouseHandler",!1),!r)return e;r=r.handlers}if(!r)return e;for(var o=0;r.length>o;o++)if("string"==typeof r[o].id&&r[o].id===t){e=r[o];break}return e||"boolean"==typeof n?e:this.getHandler(t,!0)},disableHandler:function(t){var n=this.getHandler(t);return n&&"function"==typeof n.remove&&n.remove(),this},enableHandler:function(t){var n=this.getHandler(t);return n&&"function"==typeof n.remove&&n.init(this),this},removeHandler:function(t){var n=this.getHandler(t),e=this.eventHandlers.indexOf(n);if(-1===e){var r=this.getHandler("MouseHandler");return e=r.handlers.indexOf(n),-1!==e&&(n.remove(),r.handlers.splice(e,1)),void 0}return n.remove(),this.eventHandlers.splice(e,1),n},addHandler:function(t){if(t.init(this),"string"!=typeof t.id)throw Error("Handler lacks the required id attribute");return this.eventHandlers.push(t),this},windowResize:function(){if(!this._windowResize){var n=this;this._windowResize=function(){n.dimensions=new t.Point(n.parent.offsetWidth,n.parent.offsetHeight),n.draw(),n.dispatchCallback("resized",[n.dimensions])}}return this._windowResize},setZoomRange:function(t,n){return this.coordLimits[0]=this.coordLimits[0].zoomTo(t),this.coordLimits[1]=this.coordLimits[1].zoomTo(n),this},zoomBy:function(n){return this.coordinate=this.enforceLimits(this.coordinate.zoomBy(n)),t.getFrame(this.getRedraw()),this.dispatchCallback("zoomed",n),this},zoomIn:function(){return this.zoomBy(1)},zoomOut:function(){return this.zoomBy(-1)},setZoom:function(t){return this.zoomBy(t-this.coordinate.zoom)},zoomByAbout:function(t,n){var e=this.pointLocation(n);this.coordinate=this.enforceLimits(this.coordinate.zoomBy(t));var r=this.locationPoint(e);return this.dispatchCallback("zoomed",t),this.panBy(n.x-r.x,n.y-r.y)},panBy:function(n,e){return this.coordinate.column-=n/this.tileSize.x,this.coordinate.row-=e/this.tileSize.y,this.coordinate=this.enforceLimits(this.coordinate),t.getFrame(this.getRedraw()),this.dispatchCallback("panned",[n,e]),this},panLeft:function(){return this.panBy(100,0)},panRight:function(){return this.panBy(-100,0)},panDown:function(){return this.panBy(0,-100)},panUp:function(){return this.panBy(0,100)},setCenter:function(t){return this.setCenterZoom(t,this.coordinate.zoom)},setCenterZoom:function(n,e){return this.coordinate=this.projection.locationCoordinate(n).zoomTo(parseFloat(e)||0),this.coordinate=this.enforceLimits(this.coordinate),t.getFrame(this.getRedraw()),this.dispatchCallback("centered",[n,e]),this},extentCoordinate:function(n,e){n instanceof t.Extent&&(n=n.toArray());for(var r,o,i=0;n.length>i;i++){var a=this.projection.locationCoordinate(n[i]);r?(r.row=Math.min(r.row,a.row),r.column=Math.min(r.column,a.column),r.zoom=Math.min(r.zoom,a.zoom),o.row=Math.max(o.row,a.row),o.column=Math.max(o.column,a.column),o.zoom=Math.max(o.zoom,a.zoom)):(r=a.copy(),o=a.copy())}var u=this.dimensions.x+1,s=this.dimensions.y+1,c=(o.column-r.column)/(u/this.tileSize.x),l=Math.log(c)/Math.log(2),f=r.zoom-(e?l:Math.ceil(l)),h=(o.row-r.row)/(s/this.tileSize.y),d=Math.log(h)/Math.log(2),p=r.zoom-(e?d:Math.ceil(d)),m=Math.min(f,p);m=Math.min(m,this.coordLimits[1].zoom),m=Math.max(m,this.coordLimits[0].zoom);var g=(r.row+o.row)/2,v=(r.column+o.column)/2,y=r.zoom;return new t.Coordinate(g,v,y).zoomTo(m)},setExtent:function(n,e){return this.coordinate=this.extentCoordinate(n,e),this.coordinate=this.enforceLimits(this.coordinate),t.getFrame(this.getRedraw()),this.dispatchCallback("extentset",n),this},setSize:function(n){return this.dimensions=new t.Point(n.x,n.y),this.parent.style.width=Math.round(this.dimensions.x)+"px",this.parent.style.height=Math.round(this.dimensions.y)+"px",this.autoSize&&(t.removeEvent(window,"resize",this.windowResize()),this.autoSize=!1),this.draw(),this.dispatchCallback("resized",this.dimensions),this},coordinatePoint:function(n){n.zoom!=this.coordinate.zoom&&(n=n.zoomTo(this.coordinate.zoom));var e=new t.Point(this.dimensions.x/2,this.dimensions.y/2);return e.x+=this.tileSize.x*(n.column-this.coordinate.column),e.y+=this.tileSize.y*(n.row-this.coordinate.row),e},pointCoordinate:function(t){var n=this.coordinate.copy();return n.column+=(t.x-this.dimensions.x/2)/this.tileSize.x,n.row+=(t.y-this.dimensions.y/2)/this.tileSize.y,n},locationCoordinate:function(t){return this.projection.locationCoordinate(t)},coordinateLocation:function(t){return this.projection.coordinateLocation(t)},locationPoint:function(t){return this.coordinatePoint(this.locationCoordinate(t))},pointLocation:function(t){return this.coordinateLocation(this.pointCoordinate(t))},getExtent:function(){return new t.Extent(this.pointLocation(new t.Point(0,0)),this.pointLocation(this.dimensions))},extent:function(t,n){return t?this.setExtent(t,n):this.getExtent()},getCenter:function(){return this.projection.coordinateLocation(this.coordinate)},center:function(t){return t?this.setCenter(t):this.getCenter()},getZoom:function(){return this.coordinate.zoom},zoom:function(t){return void 0!==t?this.setZoom(t):this.getZoom()},getLayers:function(){return this.layers.slice()},getLayer:function(t){for(var n=0;this.layers.length>n;n++)if(t==this.layers[n].name)return this.layers[n]},getLayerAt:function(t){return this.layers[t]},addLayer:function(n){return this.layers.push(n),this.parent.appendChild(n.parent),n.map=this,this.coordinate&&t.getFrame(this.getRedraw()),this},removeLayer:function(t){for(var n=0;this.layers.length>n;n++)if(t==this.layers[n]||t==this.layers[n].name){this.removeLayerAt(n);break}return this},setLayerAt:function(n,e){if(0>n||n>=this.layers.length)throw Error("invalid index in setLayerAt(): "+n);if(this.layers[n]!=e){if(this.layers.length>n){var r=this.layers[n];this.parent.insertBefore(e.parent,r.parent),r.destroy()}else this.parent.appendChild(e.parent);this.layers[n]=e,e.map=this,t.getFrame(this.getRedraw())}return this},insertLayerAt:function(n,e){if(0>n||n>this.layers.length)throw Error("invalid index in insertLayerAt(): "+n);if(n==this.layers.length)this.layers.push(e),this.parent.appendChild(e.parent);else{var r=this.layers[n];this.parent.insertBefore(e.parent,r.parent),this.layers.splice(n,0,e)}return e.map=this,t.getFrame(this.getRedraw()),this},removeLayerAt:function(t){if(0>t||t>=this.layers.length)throw Error("invalid index in removeLayer(): "+t);var n=this.layers[t];return this.layers.splice(t,1),n.destroy(),this},swapLayersAt:function(t,n){if(0>t||t>=this.layers.length||0>n||n>=this.layers.length)throw Error("invalid index in swapLayersAt(): "+index);var e=this.layers[t],r=this.layers[n],o=document.createElement("div");return this.parent.replaceChild(o,r.parent),this.parent.replaceChild(r.parent,e.parent),this.parent.replaceChild(e.parent,o),this.layers[t]=r,this.layers[n]=e,this},enableLayer:function(t){var n=this.getLayer(t);return n&&n.enable(),this},enableLayerAt:function(t){var n=this.getLayerAt(t);return n&&n.enable(),this},disableLayer:function(t){var n=this.getLayer(t);return n&&n.disable(),this},disableLayerAt:function(t){var n=this.getLayerAt(t);return n&&n.disable(),this},enforceZoomLimits:function(t){var n=this.coordLimits;if(n){var e=n[0].zoom,r=n[1].zoom;e>t.zoom?t=t.zoomTo(e):t.zoom>r&&(t=t.zoomTo(r))}return t},enforcePanLimits:function(n){if(this.coordLimits){n=n.copy();var e=this.coordLimits[0].zoomTo(n.zoom),r=this.coordLimits[1].zoomTo(n.zoom),o=this.pointCoordinate(new t.Point(0,0)).zoomTo(n.zoom),i=this.pointCoordinate(this.dimensions).zoomTo(n.zoom);r.row-e.row<i.row-o.row?n.row=(r.row+e.row)/2:o.row<e.row?n.row+=e.row-o.row:i.row>r.row&&(n.row-=i.row-r.row),r.column-e.column<i.column-o.column?n.column=(r.column+e.column)/2:o.column<e.column?n.column+=e.column-o.column:i.column>r.column&&(n.column-=i.column-r.column)}return n},enforceLimits:function(t){return this.enforcePanLimits(this.enforceZoomLimits(t))},draw:function(){if(this.coordinate=this.enforceLimits(this.coordinate),0>=this.dimensions.x||0>=this.dimensions.y){if(!this.autoSize)return;var n=this.parent.offsetWidth,e=this.parent.offsetHeight;if(this.dimensions=new t.Point(n,e),0>=n||0>=e)return}for(var r=0;this.layers.length>r;r++)this.layers[r].draw();this.dispatchCallback("drawn")},_redrawTimer:void 0,requestRedraw:function(){this._redrawTimer||(this._redrawTimer=setTimeout(this.getRedraw(),1e3))},_redraw:null,getRedraw:function(){if(!this._redraw){var t=this;this._redraw=function(){t.draw(),t._redrawTimer=0}}return this._redraw},destroy:function(){for(var n=0;this.layers.length>n;n++)this.layers[n].destroy();this.layers=[],this.projection=null;for(var e=0;this.eventHandlers.length>e;e++)this.eventHandlers[e].remove();this.autoSize&&t.removeEvent(window,"resize",this.windowResize())}},t.mapByCenterZoom=function(n,e,r,o){var i=t.coerceLayer(e),a=new t.Map(n,i,!1);return a.setCenterZoom(r,o).draw(),a},t.mapByExtent=function(n,e,r,o){var i=t.coerceLayer(e),a=new t.Map(n,i,!1);return a.setExtent([r,o]).draw(),a},"undefined"!=typeof module&&module.exports&&(module.exports={Point:t.Point,Projection:t.Projection,MercatorProjection:t.MercatorProjection,LinearProjection:t.LinearProjection,Transformation:t.Transformation,Location:t.Location,MapProvider:t.MapProvider,Template:t.Template,Coordinate:t.Coordinate,deriveTransformation:t.deriveTransformation})})(MM);var wax=wax||{};wax.mm=wax.mm||{},wax.mm._provider=function(t){this.options={tiles:t.tiles,scheme:t.scheme||"xyz",minzoom:t.minzoom||0,maxzoom:t.maxzoom||22,bounds:t.bounds||[-180,-90,180,90]}},wax.mm._provider.prototype={outerLimits:function(){return[this.locationCoordinate(new MM.Location(this.options.bounds[0],this.options.bounds[1])).zoomTo(this.options.minzoom),this.locationCoordinate(new MM.Location(this.options.bounds[2],this.options.bounds[3])).zoomTo(this.options.maxzoom)]},getTile:function(t){var n;if(!(n=this.sourceCoordinate(t)))return null;if(n.zoom<this.options.minzoom||n.zoom>this.options.maxzoom)return null;n.row="tms"===this.options.scheme?Math.pow(2,n.zoom)-n.row-1:n.row;var e=this.options.tiles[parseInt(Math.pow(2,n.zoom)*n.row+n.column,10)%this.options.tiles.length].replace("{z}",n.zoom.toFixed(0)).replace("{x}",n.column.toFixed(0)).replace("{y}",n.row.toFixed(0));return wax._&&wax._.bw&&(e=e.replace(".png",wax._.bw_png).replace(".jpg",wax._.bw_jpg)),e}},MM&&MM.extend(wax.mm._provider,MM.MapProvider),wax.mm.connector=function(t){var n=new wax.mm._provider(t);return new MM.Layer(n)},function(t,n){var e=function(){function t(t,n,e){return 0===e?t:1===e?n:t+(n-t)*e}var e,r,o,i,a,u,s={},c=!1,l=!1,f={easeIn:function(t){return t*t},easeOut:function(t){return Math.sin(t*Math.PI/2)},easeInOut:function(t){return(1-Math.cos(Math.PI*t))/2},linear:function(t){return t},easeCubicInOut:function(t){return t>1?1:.5>t?2*t*t:-1+(4-2*t)*t}},h=f.easeOut;s.reset=function(){return r=void 0,o=void 0,s},s.stop=function(t){l=!0,r=void 0,e=t},s.running=function(){return c},s.point=function(t){return o=i.pointCoordinate(t),s},s.zoom=function(t){return o||(o=i.coordinate.copy()),o=i.enforceZoomLimits(o.zoomTo(t)),s},s.location=function(t){return o=i.locationCoordinate(t),s},s.from=function(t){return arguments.length?(r=t.copy(),s):r?r.copy():r},s.to=function(t){return arguments.length?(o=i.enforceZoomLimits(t.copy()),s):o.copy()},s.path=function(t){return m=d[t],s},s.easing=function(t){return h=f[t],s},s.map=function(t){return arguments.length?(i=t,s):i};var d={},p=new n.Coordinate(0,0,0);new n.Coordinate(0,0,0),d.screen=function(e,r,o,i){var a=t(e.zoom,r.zoom,o);return i?(i.row=t(e.row,r.row*Math.pow(2,e.zoom-r.zoom),o)*Math.pow(2,a-e.zoom),i.column=t(e.column,r.column*Math.pow(2,e.zoom-r.zoom),o)*Math.pow(2,a-e.zoom),i.zoom=a,void 0):new n.Coordinate(t(e.row,r.row*Math.pow(2,e.zoom-r.zoom),o)*Math.pow(2,a-e.zoom),t(e.column,r.column*Math.pow(2,e.zoom-r.zoom),o)*Math.pow(2,a-e.zoom),a)},d.about=function(e,r,o,a){var u=t(e.zoom,r.zoom,o),s=i.dimensions.x/2,c=i.dimensions.y/2,l=i.tileSize.x,f=i.tileSize.y,h=s+l*(r.column*Math.pow(2,e.zoom-r.zoom)-e.column),d=c+f*(r.row*Math.pow(2,e.zoom-r.zoom)-e.row),p=s+l*(r.column*Math.pow(2,u-r.zoom)-e.column*Math.pow(2,u-e.zoom)),m=c+f*(r.row*Math.pow(2,u-r.zoom)-e.row*Math.pow(2,u-e.zoom));return a?(a.column=e.column*Math.pow(2,u-e.zoom)-(h-p)/l,a.row=e.row*Math.pow(2,u-e.zoom)-(d-m)/f,a.zoom=u,void 0):new n.Coordinate(e.column*Math.pow(2,u-e.zoom)-(h-p)/l,e.row*Math.pow(2,u-e.zoom)-(d-m)/f,u)};var m=d.screen;s.t=function(t){return m(r,o,h(t),p),i.coordinate=p,i.draw(),s},s.getCoordinate=function(t){return m(r,o,h(t),p),p},s.future=function(t){for(var n=[],e=0;t>e;e++)n.push(m(r,o,e/(t-1)));return n.slice(0)};var g;return s.resetRun=function(){return g=+new Date,s},s.run=function(t,a){function u(){var s=+new Date-g;if(l)return l=c=!1,e(),e=void 0;if(s>t){if(o.zoom!=r.zoom&&i.dispatchCallback("zoomed",o.zoom-r.zoom),c=!1,m(r,o,1,p),i.coordinate=p,o=r=void 0,i.draw(),a)return a(i)}else m(r,o,h(s/t),p),i.coordinate=p.copy(),i.draw(),n.getFrame(u)}return c?s.stop(function(){s.run(t,a)}):(r||(r=i.coordinate.copy()),o||(o=i.coordinate.copy()),t=t||1e3,g=+new Date,c=!0,n.getFrame(u),void 0)},s.optimal=function(t,n,e){return c?s.stop(function(){s.optimal(t,n,e)}):(t=t||.9,n=n||1.42,s.setOptimalPath(t,n),s.run(1e3*(u/t),function(t){m=a,e&&e(t)}),void 0)},s.getOptimalTime=function(t){return t=t||.9,t&&u?1e3*(u/t):null},s.setOptimalPath=function(e,c){function l(t){return t*t}function f(t){return(Math.exp(t)-Math.exp(-t))/2}function h(t){return(Math.exp(t)+Math.exp(-t))/2}function d(t){return f(t)/h(t)}function p(t){var n=l(M)-l(b)+(t?-1:1)*Math.pow(c,4)*l(k-E),e=2*(t?M:b)*l(c)*(k-E);return n/e}function g(t){return Math.log(-p(t)+Math.sqrt(l(p(t))+1))}e=e||.9,c=c||1.42;var v=i.coordinate;r?i.coordinate=r.copy():r=i.coordinate.copy();var y=i.pointCoordinate(new n.Point(0,0)).zoomTo(0),w=i.pointCoordinate(i.dimensions).zoomTo(0),b=Math.max(w.column-y.column,w.row-y.row),M=b*Math.pow(2,r.zoom-o.zoom),_=r.zoomTo(0),x=o.zoomTo(0),z={x:_.column,y:_.row},C={x:x.column,y:x.row},E=0,k=Math.sqrt(l(C.x-z.x)+l(C.y-z.y)),S=g(0),T=g(1);u=(T-S)/c;var L=function(t){return b*h(S)/h(c*t+S)},P=function(t){return b/l(c)*h(S)*d(c*t+S)-b/l(c)*f(S)+E};if(1e-6>Math.abs(k)){if(1e-6>Math.abs(b-M))return s;var A=b>M?-1:1;u=Math.abs(Math.log(M/b))/c,P=function(){return E},L=function(t){return b*Math.exp(A*c*t)}}return a=m,m=function(e,r,i,a){if(1==i)return a&&(a.row=o.row,a.column=o.column,a.zoom=o.zoom),o;var s=i*u,c=P(s),l=e.zoom+Math.log(b/L(s))/Math.LN2,f=t(z.x,C.x,c/k||1),h=t(z.y,C.y,c/k||1),d=Math.pow(2,l);return a?(a.row=h*d,a.column=f*d,a.zoom=l,void 0):new n.Coordinate(h*d,f*d,l)},i.coordinate=v,s},s};this.easey=e,this.mapbox===void 0&&(this.mapbox={}),this.mapbox.ease=e}(this,MM),d3.selection.prototype.dimensions=function(t){if(!arguments.length){var n=this.node();return this.node()&&[n.offsetWidth,n.offsetHeight]}return this.node()&&this.attr({width:t[0],height:t[1]})},d3.keybinding=function(t){function n(t,n){for(var e in t.event)if(n[e]!=t.event[e])return!1;return!t.capture==(n.eventPhase!==Event.CAPTURING_PHASE)}function e(){for(var t=0;i.length>t;t++){var e=i[t];n(e,d3.event)&&e.callback()}}function r(){var t=d3.select(d3.event.target).node().tagName;"INPUT"!=t&&"SELECT"!=t&&"TEXTAREA"!=t&&e()}function o(n){return n=n||d3.select(document),n.on("keydown.capture"+t,e,!0),n.on("keydown.bubble"+t,r,!1),o}var i=[];return o.off=function(n){return n=n||d3.select(document),n.on("keydown.capture"+t,null),n.on("keydown.bubble"+t,null),o},o.on=function(t,n,e){var r={event:{keyCode:0,shiftKey:!1,ctrlKey:!1,altKey:!1,metaKey:!1},capture:e,callback:n};t=t.toLowerCase().match(/(?:(?:[^+])+|[]|\+\+|^\+$)/g);for(var a=0;t.length>a;a++)"++"===t[a]&&(t[a]="+"),t[a]in d3.keybinding.modifierCodes?r.event[d3.keybinding.modifierProperties[d3.keybinding.modifierCodes[t[a]]]]=!0:t[a]in d3.keybinding.keyCodes&&(r.event.keyCode=d3.keybinding.keyCodes[t[a]]);return i.push(r),o},o},function(){d3.keybinding.modifierCodes={"":16,shift:16,"":17,ctrl:17,"":18,alt:18,option:18,"":91,meta:91,cmd:91,"super":91,win:91},d3.keybinding.modifierProperties={16:"shiftKey",17:"ctrlKey",18:"altKey",91:"metaKey"},d3.keybinding.keyCodes={"":8,backspace:8,"":9,"":9,tab:9,"":13,"return":13,enter:13,"":13,pause:19,"pause-break":19,"":20,caps:20,"caps-lock":20,"":27,escape:27,esc:27,space:32,"":33,pgup:33,"page-up":33,"":34,pgdown:34,"page-down":34,"":35,end:35,"":36,home:36,ins:45,insert:45,"":46,del:46,"delete":46,"":37,left:37,"arrow-left":37,"":38,up:38,"arrow-up":38,"":39,right:39,"arrow-right":39,"":40,down:40,"arrow-down":40,"*":106,star:106,asterisk:106,multiply:106,"+":107,plus:107,"-":109,subtract:109,";":186,semicolon:186,"=":187,equals:187,",":188,comma:188,dash:189,".":190,period:190,"full-stop":190,"/":191,slash:191,"forward-slash":191,"`":192,tick:192,"back-quote":192,"[":219,"open-bracket":219,"\\":220,"back-slash":220,"]":221,"close-bracket":221,"'":222,quote:222,apostrophe:222};for(var t=95,n=0;106>++t;)d3.keybinding.keyCodes["num-"+n]=t,++n;for(t=47,n=0;58>++t;)d3.keybinding.keyCodes[n]=t,++n;for(t=111,n=1;136>++t;)d3.keybinding.keyCodes["f"+n]=t,++n;for(t=64;91>++t;)d3.keybinding.keyCodes[String.fromCharCode(t).toLowerCase()]=t}(),!function(){function t(t,n){function e(n){var e=t.arcs[n],r=e[0],o=[0,0];return e.forEach(function(t){o[0]+=t[0],o[1]+=t[1]}),[r,o]}var r={},o={};n.forEach(function(t){var n,i,a=e(t),u=a[0],s=a[1];if(n=o[u])if(delete o[n.end],n.push(t),n.end=s,i=r[s]){delete r[i.start];var c=i===n?n:n.concat(i);r[c.start=n.start]=o[c.end=i.end]=c}else if(i=o[s]){delete r[i.start],delete o[i.end];var c=n.concat(i.map(function(t){return~t}).reverse());r[c.start=n.start]=o[c.end=i.start]=c}else r[n.start]=o[n.end]=n;else if(n=r[s])if(delete r[n.start],n.unshift(t),n.start=u,i=o[u]){delete o[i.end];var l=i===n?n:i.concat(n);r[l.start=i.start]=o[l.end=n.end]=l}else if(i=r[u]){delete r[i.start],delete o[i.end];var l=i.map(function(t){return~t}).reverse().concat(n);r[l.start=i.end]=o[l.end=n.end]=l}else r[n.start]=o[n.end]=n;else if(n=r[u])if(delete r[n.start],n.unshift(~t),n.start=s,i=o[s]){delete o[i.end];var l=i===n?n:i.concat(n);r[l.start=i.start]=o[l.end=n.end]=l}else if(i=r[s]){delete r[i.start],delete o[i.end];var l=i.map(function(t){return~t}).reverse().concat(n);r[l.start=i.end]=o[l.end=n.end]=l}else r[n.start]=o[n.end]=n;else if(n=o[s])if(delete o[n.end],n.push(~t),n.end=u,i=o[u]){delete r[i.start];var c=i===n?n:n.concat(i);r[c.start=n.start]=o[c.end=i.end]=c}else if(i=r[u]){delete r[i.start],delete o[i.end];var c=n.concat(i.map(function(t){return~t}).reverse());r[c.start=n.start]=o[c.end=i.start]=c}else r[n.start]=o[n.end]=n;else n=[t],r[n.start=u]=o[n.end=s]=n});var i=[];for(var a in o)i.push(o[a]);return i}function n(n,e,r){function i(t){0>t&&(t=~t),(f[t]||(f[t]=[])).push(l)}function a(t){t.forEach(i)}function u(t){t.forEach(a)}function s(t){"GeometryCollection"===t.type?t.geometries.forEach(s):t.type in h&&(l=t,h[t.type](t.arcs))}var c=[];if(arguments.length>1){var l,f=[],h={LineString:a,MultiLineString:u,Polygon:u,MultiPolygon:function(t){t.forEach(u)}};s(e),f.forEach(3>arguments.length?function(t,n){c.push(n)}:function(t,n){r(t[0],t[t.length-1])&&c.push(n)})}else for(var d=0,p=n.arcs.length;p>d;++d)c.push(d);return o(n,{type:"MultiLineString",arcs:t(n,c)})}function e(t,n){return"GeometryCollection"===n.type?{type:"FeatureCollection",features:n.geometries.map(function(n){return r(t,n)})}:r(t,n)}function r(t,n){var e={type:"Feature",id:n.id,properties:n.properties||{},geometry:o(t,n)};return null==n.id&&delete e.id,e}function o(t,n){function e(t,n){n.length&&n.pop();for(var e,r=l[0>t?~t:t],o=0,a=r.length;a>o;++o)n.push(e=r[o].slice()),c(e,o);0>t&&i(n,a)}function r(t){return t=t.slice(),c(t,0),t}function o(t){for(var n=[],r=0,o=t.length;o>r;++r)e(t[r],n);return 2>n.length&&n.push(n[0].slice()),n}function a(t){for(var n=o(t);4>n.length;)n.push(n[0].slice());return n}function u(t){return t.map(a)}function s(t){var n=t.type;return"GeometryCollection"===n?{type:n,geometries:t.geometries.map(s)}:n in f?{type:n,coordinates:f[n](t)}:null}var c=h(t.transform),l=t.arcs,f={Point:function(t){return r(t.coordinates)},MultiPoint:function(t){return t.coordinates.map(r)},LineString:function(t){return o(t.arcs)},MultiLineString:function(t){return t.arcs.map(o)},Polygon:function(t){return u(t.arcs)},MultiPolygon:function(t){return t.arcs.map(u)}};return s(n)}function i(t,n){for(var e,r=t.length,o=r-n;--r>o;)e=t[o],t[o++]=t[r],t[r]=e}function a(t,n){for(var e=0,r=t.length;r>e;){var o=e+r>>>1;n>t[o]?e=o+1:r=o}return e}function u(t){function n(t,n){t.forEach(function(t){0>t&&(t=~t);var e=o[t];e?e.push(n):o[t]=[n]})}function e(t,e){t.forEach(function(t){n(t,e)})}function r(t,n){"GeometryCollection"===t.type?t.geometries.forEach(function(t){r(t,n)}):t.type in u&&u[t.type](t.arcs,n)}var o={},i=t.map(function(){return[]}),u={LineString:n,MultiLineString:e,Polygon:e,MultiPolygon:function(t,n){t.forEach(function(t){e(t,n)})}};t.forEach(r);for(var s in o)for(var c=o[s],l=c.length,f=0;l>f;++f)for(var h=f+1;l>h;++h){var d,p=c[f],m=c[h];(d=i[p])[s=a(d,m)]!==m&&d.splice(s,0,m),(d=i[m])[s=a(d,p)]!==p&&d.splice(s,0,p)}return i}function s(t,n){function e(t){a.remove(t),t[1][2]=n(t),a.push(t)}var r,o=h(t.transform),i=d(t.transform),a=f(l),u=0;for(n||(n=c),t.arcs.forEach(function(t){var e=[];t.forEach(o);for(var i=1,u=t.length-1;u>i;++i)r=t.slice(i-1,i+2),r[1][2]=n(r),e.push(r),a.push(r);t[0][2]=t[u][2]=1/0;for(var i=0,u=e.length;u>i;++i)r=e[i],r.previous=e[i-1],r.next=e[i+1]});r=a.pop();){var s=r.previous,p=r.next;u>r[1][2]?r[1][2]=u:u=r[1][2],s&&(s.next=p,s[2]=r[2],e(s)),p&&(p.previous=s,p[0]=r[0],e(p))}return t.arcs.forEach(function(t){t.forEach(i)}),t}function c(t){return Math.abs((t[0][0]-t[2][0])*(t[1][1]-t[0][1])-(t[0][0]-t[1][0])*(t[2][1]-t[0][1]))}function l(t,n){return t[1][2]-n[1][2]}function f(t){function n(n){for(var e=o[n];n>0;){var r=(n+1>>1)-1,i=o[r];if(t(e,i)>=0)break;o[i.index=n]=i,o[e.index=n=r]=e}}function e(n){for(var e=o[n];;){var r=n+1<<1,i=r-1,a=n,u=o[a];if(o.length>i&&0>t(o[i],u)&&(u=o[a=i]),o.length>r&&0>t(o[r],u)&&(u=o[a=r]),a===n)break;o[u.index=n]=u,o[e.index=n=a]=e}}var r={},o=[];return r.push=function(){for(var t=0,e=arguments.length;e>t;++t){var r=arguments[t];n(r.index=o.push(r)-1)}return o.length},r.pop=function(){var t=o[0],n=o.pop();return o.length&&(o[n.index=0]=n,e(0)),t},r.remove=function(r){var i=r.index,a=o.pop();return i!==o.length&&(o[a.index=i]=a,(0>t(a,r)?n:e)(i)),i},r}function h(t){if(!t)return p;var n,e,r=t.scale[0],o=t.scale[1],i=t.translate[0],a=t.translate[1];return function(t,u){u||(n=e=0),t[0]=(n+=t[0])*r+i,t[1]=(e+=t[1])*o+a}}function d(t){if(!t)return p;var n,e,r=t.scale[0],o=t.scale[1],i=t.translate[0],a=t.translate[1];return function(t,u){u||(n=e=0);var s=0|(t[0]-i)/r,c=0|(t[1]-a)/o;t[0]=s-n,t[1]=c-e,n=s,e=c}}function p(){}var m={version:"1.4.6",mesh:n,feature:e,neighbors:u,presimplify:s};"function"==typeof define&&define.amd?define(m):"object"==typeof module&&module.exports?module.exports=m:this.topojson=m}(),window.cwm={launch:function(t){function n(){r++,u.add(this),4===r&&l.initialize()}var e={bingApiKey:"Ajt-JIuGs7jVKkk4yeC5HWByvuHQ4OEISvzK2-77yRcz_EOCAGfooD4eDeZ-aY4l",mapboxId:"gmaclennan.p7hqia4i,gmaclennan.clearwater,gmaclennan.map-y7pgvo15"},r=0,o=d3.select(t).append("div").classed("wrapper",!0),i=o.insert("div",":first-child").attr("id","stories"),a=o.insert("div",":first-child").attr("id","map"),u=cwm.flightplan=cwm.Flightplan().show("featured"),s=cwm.stories=cwm.Stories(i),c=cwm.map=cwm.Map(a).paddingLeft(580),l=cwm.mc=cwm.MissionControl(d3.select(t)).map(c).flightplan(u).stories(s);
cwm.layers.BingLayer(e).addTo(c),cwm.layers.MapboxLayer().id(e.mapboxId).addTo(c);var f=cwm.layers.MarkerLayer().addTo(c),h=cwm.layers.FeatureLayer().addTo(c),d=cwm.layers.FeatureLayer().addTo(c);cwm.Collection("installations").placeId(function(t){return t.attr("_id")}).placeParentId(function(t){return"c-"+t.attr("community")}).url("data/installations.geojson").on("load",f.data).fetch(n),cwm.Collection("communities").placeId(function(t){return"c-"+t.attr("community")}).placeParentId(function(t){return t.attr("nationality")}).extentFromChildren(!0).url("data/communities.topojson").on("load",h.data).fetch(n),cwm.Collection("nationalities").placeId(function(t){return t.attr("nationality")}).placeParentId("Ecuador").zoomOffset(-.5).url("data/nationalities.topojson").fetch(n),cwm.Collection("overview").placeId(function(t){return t.attr("id")}).placeParentId(function(t){return t.attr("parent")}).url("data/other.topojson").on("load",function(t){var n=cwm.Collection("country").add(t.get("Ecuador")).extentFromChildren(!0);d.data(n)}).fetch(n)}},cwm.Map=function(t){var n,e,r={},o={},i=d3.dispatch("click");d3.select(window).on("resize.map",function(){o={}}),t.on("click",function(){var t=d3.select(d3.event.target||d3.event.srcElement).datum();i.click(t)});var a=new MM.Map(t.node(),null,null,[cwm.handlers.DragHandler()]).setZoomRange(3,18);a.addLayer=function(t){return a.layers.push(t),a.coordinate&&MM.getFrame(a.getRedraw()),a};var u=a.ease=mapbox.ease().map(a);return a.to=function(t){if(!arguments.length)return n;n=t,t instanceof cwm.Place&&(t=a.placeExtentCoordinate(t)),u.from()||u.from(a.coordinate),u.to(t);var e=a.coordinateLocation(u.from()),r=a.coordinateLocation(t),o=cwm.util.distance([e.lat,e.lon],[r.lat,r.lon]);return o>7e-4?u.setOptimalPath():u.path("screen"),a},a.from=function(t){return arguments.length?(e=t,t instanceof cwm.Place&&(t=a.placeExtentCoordinate(t)),u.from(t),u.to()&&u.setOptimalPath(),a):e},a.t=function(t){return u.to()?(0===t&&(t+=1e-5),u.t(t),a):a},a.getOptimalTime=u.getOptimalTime,a.stop=u.stop,a.paddingLeft=function(t){return arguments.length?(a._paddingLeft=t,a):a._paddingLeft},a.current=function(t){return arguments.length?(r=t,void 0):r},a.showPopup=function(t){return a.layers.forEach(function(n){n.showPopup&&~n.data().indexOf(t)&&n.showPopup(t)}),a},a.placeExtentCoordinate=function(t){if(o[t.id()])return o[t.id()];var n;return n=!t.children.length||t.geometry.coordinates&&!t.collection.extentFromChildren()?t.extent():t.children.extent()||t.children[0].children[0].collection.extent(),o[t.id()]=a.extentCoordinate(n,!0).zoomBy(t.collection.zoomOffset()),o[t.id()]},a.pointProject=function(){return function(t,n,e){if(!(63.728/Math.pow(2,a.coordinate.zoom+12)>e)){var r=a.locationPoint({lon:t,lat:n});return this.stream?(this.stream.point(~~(.5+r.x),~~(.5+r.y)),void 0):[r.x,r.y]}}},a.pathGenerator=function(){return d3.geo.path().projection(d3.geo.transform({point:a.pointProject()}))},d3.rebind(a,i,"on")},cwm.Stories=function(t){function n(t){return arguments.length?(y.from=t,i(),stories):y.from}function e(t){return arguments.length?(y.to=t,i(),stories):y.to}function r(t){return arguments.length?(m=Math.max(t,o()),stories):m||o()}function o(){return 2*w/g}function i(){y.from instanceof cwm.Place&&y.to instanceof cwm.Place&&(v=y.from._index<=y.to._index?1:-1)}function a(t){if(y.to){y.from&&(y.from._offset=-t*v*r()+w),y.to._offset=(1-t)*v*r()+w,f(),c(),l();var n=u(t);return M.moved(n),0===n.distance&&M.arrived(n.place),stories}}function u(t){arguments.length||(t=1);var n={},e=.5>t?y.from:y.to;for(n.place=e,n.distance=.5>t?t*r():(1-t)*r(),n.section=e?e.collection.id():void 0,n.parent=e?e.parent:void 0;e;)n[e.collection.id()]=e,e=e.parent;return n}function s(t){t.attr("id",function(t){return cwm.util.sanitize(t.id())}).attr("class",function(t){return t.collection.id()}).style("position","absolute").style("bottom","100%").html(_)}function c(){var n=[y.to];y.from&&n.unshift(y.from);var e=t.selectAll("article").data(n,function(t){return t.id()});e.enter().append("article").call(s),e.style(cwm.util.transformProperty,function(t){return p(0,t._offset)}),e.exit().remove()}function l(){if(y.from){var t,n,e=1===v?y.from:y.to,r=1===v?y.to:y.from,o=e._offset-h(e);e.children.length&&~e.children.indexOf(r)?t=e._offset>h(e)-h(e,"div.image-wrapper")?e.parent:e:(t=e.parent,e.parent!==r.parent&&0>=e._offset&&(t=r.parent)),e.parent!==r.parent||e.children.length&&~e.children.indexOf(r)?(n=function(){var t=this.__height__||(this.__height__=d3.select(this).dimensions()[1]);return Math.min(0,o-t)},e.children.length&&~e.children.indexOf(r)||e.parent===r.parent||!(0>=e._offset)?e.children.length&&~e.children.indexOf(r)&&e._offset<=h(e)-h(e,"div.image-wrapper")&&(n=d3.functor(0)):n=function(){var t=this.__height__||(this.__height__=d3.select(this).dimensions()[1]);return Math.min(0,-e._offset-t)}):n=d3.functor(0);var i=t?[t]:[],a=x.selectAll("div").data(i,function(t){return t.id()});a.enter().append("div").on("click",d).html(function(t){return _(t).match(/<h\d.*<\/h\d>/)[0]}).classed("active",!0).call(cwm.render.NavButton),a.style(cwm.util.transformProperty,function(){return p(0,n.call(this))}),a.exit().remove()}}function f(){var t,n=0,e=1===v?y.from?y.from:{}:y.to,r=1===v?y.to:y.from;e._offset+w,r._offset>w+h(r)?t=e._next:r._offset>w+h(r)-h(r,"div.image-wrapper")&&e._next===r?t=e._next:(t=r._next,n=r._offset-w);var o=t?[t]:[],i=z.selectAll("div").data(o,function(t){return t.id()});i.enter().append("div").on("click",d).html(function(t){return _(t).match(/<h\d.*<\/h\d>/)[0]}),i.style(cwm.util.transformProperty,function(){return p(0,n)}).classed("active",0===n),i.exit().remove(),r._offset-=r._next?h(r._next,"h1, h2"):0,e!==r&&(e._offset-=e._next?h(e._next,"h1, h2"):0)}function h(n,e){var r,o,i=e?n.id()+"~"+e:n.id();return b[i]?b[i]:(renderedArticle=d3.select("#"+cwm.util.sanitize(n.id())),renderedArticle.node()||(renderedArticle=t.append("article").datum(n).call(s),o=!0),r="string"==typeof e?renderedArticle.select(e).dimensions()[1]:renderedArticle.dimensions()[1],b[i]=r,o&&renderedArticle.remove(),r)}function d(t){d3.event.preventDefault(),M.click(t)}function p(t,n){return MM._browser.webkit3d?"translate3d("+t+"px,"+n+"px, 0)":"translate("+t+"px,"+n+"px)"}var m,g=1,v=1,y={},w=(d3.ease("cubic-in-out"),d3.select(t.node().parentNode).dimensions()[1]),b={},M=d3.dispatch("click","moved","arrived"),_=cwm.Templates(),x=t.append("div").attr("class","top-headings"),z=t.append("div").attr("class","next-headings");return d3.select(window).on("resize.stories",function(){w=d3.select(t.node().parentNode).dimensions()[1],b={}}),stories={t:a,from:n,to:e,duration:r,getCurrent:u,getOptimalTime:o},d3.rebind(stories,M,"on")},cwm.MissionControl=function(t){function n(){d(w[1]),h(w[0]),b.current(y.getCurrent(0)),l(0),P.data(w.filter(function(t){return t.children.length})),t.selectAll("#map,#stories,#overlay").on(d3_behavior_zoom_wheel,r),d3.select(document).call(d3.keybinding().on("arrow-down",e("down")).on("arrow-up",e("up")).on("space",function(t){A.hide(),g(t)})).on("keyup",function(){C&&window.clearTimeout(C),C=window.setTimeout(o,200)})}function e(t){return function(){A.hide(),C&&window.clearTimeout(C),z||l("down"===t?50:-50)}}function r(){A.hide(),d3.event.preventDefault(),d3.event.stopPropagation(),C&&window.clearTimeout(C),l(-d3_behavior_zoom_delta()),C=window.setTimeout(o,400)}function o(t){if(!z&&!S.duration){t=t||200;var n=y.getCurrent(E/k);t>n.distance&&g(n.place,function(){z&&window.clearTimeout(z),C=z=void 0})}}function i(t){return y=t,y.on("click",function(t){A.hide(),"BUTTON"===d3.event.target.tagName?(d3.event.stopPropagation(),P.toggle()):t&&g(t)}).on("arrived",function(t){b.showPopup(t),A.show(t)}),v}function a(n){return b=n,b.on("click",function(n){z||(A.hide(),n?n.parent&&!n.parent.geometry.coordinates&&b.current().place!==n.parent?g(n.parent):g(n):d3.event.defaultPrevented||s(d3.mouse(t.node())))}),b.addCallback("panned",function(){z||(T=1,u(_))}),b.addCallback("zoomed",function(){z||(T=1,u(_))}),v}function u(t){C&&window.clearTimeout(C),z&&window.clearTimeout(z),z=C=null,b.ease.reset(),b.to(t),S.time=0;var n=1===T?k-E:E;S.duration=Math.max(b.getOptimalTime(),n)}function s(){var t=b.getLayer("installations").data(),n=t.nearest(b.coordinateLocation(b.coordinate));b.coordLimits[1].zoom;var e=b.coordinate.zoom;e>b.placeExtentCoordinate(n.parent).zoom&&g(n.parent)}function c(t){return arguments.length?(w=t,v):w}function l(t){if(!z){if(t=Math.max(-100,Math.min(100,t)),E+=t,0>E&&(!S.duration||0===S.time))w[w.indexOf(M)-1]?(T=-1,S.duration&&u(M._prev),d(M),h(M._prev),E+=k):E=0;else if(E>=k&&(!S.duration||0===S.time))w[w.indexOf(_)+1]?(T=1,S.duration&&u(_._next),E-=k,h(_),d(_._next)):E=k;else if(S.duration){var n=t>0&&-1===T||0>t&&1===T;n?t>0?(T=1,u(_)):0>t&&(T=-1,u(M)):S.time+=Math.abs(t),0>E&&(E=0),E>=k&&(E=k)}return lastDelta=t,f(),v}}function f(t){function n(){var n=Math.max(0,Math.min(1,E/k));if(S.duration){var e=Math.max(0,Math.min(1,S.time/S.duration));b.t(e),(0>S.time||S.time>S.duration)&&(S={},b.from(M),b.to(_))}else b.t(n);y.t(n),b.current(y.getCurrent(n)),x=!1,t&&t(),t=void 0}x||(x=window.requestAnimationFrame(n))}function h(t){return M=t,y.from(t),S.duration||b.from(t),p(),v}function d(t){return _=t,y.to(t),S.duration||b.to(t),p(),v}function p(){_&&(k=Math.max(b.getOptimalTime(),y.getOptimalTime())),y.duration(k)}function m(){z=!1}function g(t,n){function e(){var i=+new Date-r;S.duration&&(S.time=i),E=o+i*T,E>=0&&k>=E||S.duration&&S.time<=S.duration?f(e):(E=1===T?k:0,f(function(){h(t),d(w[w.indexOf(t)+1]||t),E=0,window.clearTimeout(z),z=!1,n&&n(),n=void 0}))}arguments.length||(t=_),"function"!=typeof n&&(n=null);var r=+new Date,o=E;if(z&&window.clearTimeout(z),z=window.setTimeout(m,5e3),t===M)T=-1,S.duration&&u(t),e();else if(t===_)T=1,S.duration&&u(t),e();else{var i=w.indexOf(t);-1===i?b.coordinate.toKey()!==b.placeExtentCoordinate(t).toKey()&&b.to(t).ease.setOptimalPath().run(Math.max(1e3,b.getOptimalTime()),function(){T=1,u(y.to())}):w.indexOf(M)>i?(T=-1,S.duration&&u(t),0===E?(d(M),h(t),E=k,g(t)):E===k?(h(t),E=k,g(t)):g(M,function(){g(t)})):(T=1,S.duration&&u(t),E===k?(h(_),d(t),E=0,g(t)):0===E?(d(t),g(t)):g(_,function(){g(t)}))}return v}var v,y,w,b,M,_,x,z,C,E=0,k=0,S={},T=1,L=(d3.ease("quad-in-out"),d3.dispatch("scroll"));d3.select(window).on("resize",f);var P=cwm.Navigation(t).on("click",function(t){A.hide(),g(t)}),A=cwm.views.Overlay(t);return t.call(cwm.render.NavButton).on("click",function(){"BUTTON"===d3.event.target.tagName&&(d3.event.stopPropagation(),P.toggle())}),"onwheel"in document?(d3_behavior_zoom_wheel="wheel",d3_behavior_zoom_delta=function(){return-d3.event.deltaY*(d3.event.deltaMode?20:1)}):"onmousewheel"in document?(d3_behavior_zoom_wheel="mousewheel",d3_behavior_zoom_delta=function(){return d3.event.wheelDelta}):(d3_behavior_zoom_wheel="MozMousePixelScroll",d3_behavior_zoom_delta=function(){return-d3.event.detail}),v={flightplan:c,stories:i,map:a,go:g,initialize:n},d3.rebind(v,L,"on")},cwm.render={SvgContainer:function(t){var n=t.select("svg");return n.node()||(n=t.append("svg").style("position","absolute")),n},DivContainer:function(t){return t.append("div").attr("position","absolute").attr("top",0).attr("bottom",0).attr("left",0).attr("right",0)},NavButton:function(t){return t.append("button").classed("nav",!0)},Label:function(t,n){var e=n.append("div").attr("class","marker-tooltip").style("width","100%").datum(t);return e.append("div").style("position","absolute").style("pointer-events","none").append("div").attr("class","feature-label").style("pointer-events","auto").text((t.attr("nationality")||t.id())+(t.attr("nationality")!==t.attr("community")?": "+t.attr("community"):"")),e},PopupContainer:function(t){return t.append("div").attr("class","marker-tooltip").style("position","absolute").style("z-index",1).append("div").style("position","absolute").style("pointer-events","none").append("div").attr("class","marker-popup").style("pointer-events","auto")},PopupSmall:function(t,n){var e=t.attr("photo")?t.attr("photo").replace(".jpg","-150.jpg"):cwm.util.emptyGIF;return n.append("div").attr("class","image-wrapper").append("img").attr("src",e),n.append("p").text(t.attr("name")?t.attr("name").split(" and")[0]:""),n},PopupLarge:function(t,n){var e=t.attr("photo")?t.attr("photo").replace(".jpg","-150.jpg"):cwm.util.emptyGIF,r=d3.time.format("%b %e %Y");n.append("div").attr("class","image-wrapper").append("img").attr("src",e);var o=n.append("p").html("<em>"+t.attr("name")+"s</em> rainwater collection system, in the village of <em>"+t.attr("community")+"</em>, was installed on <em>"+r(new Date(t.attr("date")))+"</em>, and provides clean drinking water to <strong>"+t.attr("users")+" people</strong>.");return t.attr("featured")===!0&&o.append("p").html('<a href="'+t.attr("blog_url")+'">Read more about this.</a>'),n}},cwm.Templates=function(){function t(t,o){return o=o||"",t=t||this.attr("story_photo")||this.attr("photo")||this.attr("media"),t&&t.match(e)?(t=t.replace(e,"-"+o+"$&"),n("image")({mediaUrl:t})):t&&t.match(r)?void 0:(t=cwm.util.emptyGIF,n("image")({mediaUrl:t}))}function n(t){return o[t]||_.template(d3.select("#template-"+t).html())}var e=/\.(?:jpg|gif|png)(\?|\#|$)/,r=/\.(?:mp4|m4v|mov)(\?|\#|$)/,o={};return _.templateSettings.interpolate=/{{([\s\S]+?)}}/g,function(e){var r,o;return e instanceof cwm.Place?(o=e.collection.id(),r=cwm.util.extend({renderMedia:t},e),n(o)(r)):function(r){return r=cwm.util.extend({renderMedia:t},r),n(e)(r)}}},cwm.util={sanitize:function(t){return t!==void 0&&null!==t?"id-"+(""+t).toLowerCase().split(" ").join("-").split("/").join("-"):void 0},preloadImages:function(t,n){_.forEach(t.features,function(t){if(n===t.properties.community){var e=new Image;e.src=t.properties.photo}})},emptyGIF:"images/missing_image.png",transformProperty:function(t){if(this.document){for(var n=document.documentElement.style,e=0;t.length>e;e++)if(t[e]in n)return t[e];return!1}}(["transform","-webkit-transform","-o-transform","-moz-transform","-ms-transform"]),fillArray:function(t,n){for(var e,r=[],o=t instanceof Array,i=0;n>i;i++)e=o?t.slice(0):t,r.push(e);return r},d3Bounds:function(t){return[[t[0].lon,t[0].lat],[t[1].lon,t[1].lat]]},asyncMap:function(t,n,e){var r=t.length,o=[],i=[];t.forEach(function(t,a){n(t,function(t,n){i[a]=t,o[a]=n,r--,r||e(i,o)})})},distance:function(t,n){return Math.sqrt(Math.pow(t[0]-n[0],2)+Math.pow(t[1]-n[1],2))},subclass:function(){return{}.__proto__?function(t,n){t.__proto__=n}:function(t,n){for(var e in n)t[e]=n[e]}}(),extend:function(t){return Array.prototype.slice.call(arguments,1).forEach(function(n){if(n)for(var e in n)t[e]=n[e]}),t},extendClass:function(t,n){var e,r=this;e=t&&_.has(t,"constructor")?t.constructor:function(){return r.apply(this,arguments)},cwm.util.extend(e,r,n);var o=function(){this.constructor=e};return o.prototype=r.prototype,e.prototype=new o,t&&cwm.util.extend(e.prototype,t),e.__super__=r.prototype,e}},MM.getMousePoint=function(t){var n=new MM.Point(t.clientX,t.clientY);return n},MM.Map.prototype.centerFromBounds=function(t){var n=new MM.Extent(t[1][1],t[0][0],t[0][1],t[1][0]);return this.extentCoordinate(n,!0)},MM.Extent.prototype.coversBounds=function(t){return!(t[0][0]>this.east||t[0][1]>this.north||t[1][0]<this.west||t[1][1]<this.south)},MM.Extent.prototype.containsBounds=function(t){return t[0][0]>this.west&&t[0][1]>this.south&&t[1][0]<this.east&&t[1][1]<this.north},MM.Extent.prototype.containsCoordinates=function(t){return this.containsLocation(new MM.Location(t[1],t[0]))},MM.Map.prototype.setCoordinate=function(t){return this.coordinate=this.enforceLimits(t),MM.getFrame(this.getRedraw()),this.dispatchCallback("extentset",t),this},MM.Map.prototype.extentCoordinate=function(t,n,e){var r=this._paddingLeft||e||0;t instanceof MM.Extent&&(t=t.toArray());for(var o,i,a=0;t.length>a;a++){var u=this.projection.locationCoordinate(t[a]);o?(o.row=Math.min(o.row,u.row),o.column=Math.min(o.column,u.column),o.zoom=Math.min(o.zoom,u.zoom),i.row=Math.max(i.row,u.row),i.column=Math.max(i.column,u.column),i.zoom=Math.max(i.zoom,u.zoom)):(o=u.copy(),i=u.copy())}var s=this.dimensions.x+1-r,c=this.dimensions.y+1,l=(i.column-o.column)/(s/this.tileSize.x),f=Math.log(l)/Math.log(2),h=o.zoom-(n?f+.1:Math.ceil(f)),d=(i.row-o.row)/(c/this.tileSize.y),p=Math.log(d)/Math.log(2),m=o.zoom-(n?p+.1:Math.ceil(p)),g=Math.min(h,m);g=Math.min(g,this.coordLimits[1].zoom),g=Math.max(g,this.coordLimits[0].zoom);var v=(o.row+i.row)/2,y=(o.column+i.column)/2,w=o.zoom;return new MM.Coordinate(v,y,w).zoomTo(g).left(r/this.tileSize.x/2)},cwm.Base=function(){},cwm.Base.prototype={id:function(t){return arguments.length?(this._id="function"==typeof t?t(this):t,this):this._id},on:function(){var t=this.event.on.apply(this.event,arguments);return t===this.event?this:t},extent:function(){return this._extent!==void 0?this._extent:(this._extent=this.bounds()?new MM.Extent(this.bounds()[1][1],this.bounds()[0][0],this.bounds()[0][1],this.bounds()[1][0]):null,this._extent)},centroid:function(){return this._centroid!==void 0?this._centroid:(this._centroid=d3.geo.centroid(this.asGeoJSON()),this._centroid=isNaN(this._centroid[0])?null:this._centroid,this._centroid)}},cwm.Place=function(t){return this instanceof cwm.Place?(t=t||{},this.properties=t.properties||{},this.geometry=t.geometry||{},this.type=t.type,this.children=cwm.Collection(),this.event=d3.dispatch("changed"),this.id("id").parentId("parent"),void 0):new cwm.Place(t)},cwm.Place.prototype=Object.create(cwm.Base.prototype),cwm.util.extend(cwm.Place.prototype,{parentId:function(t){return arguments.length?(this._parentId="function"==typeof t?t(this):t,this):this._parentId},hasParent:function(t){return this.parent&&(this.parent===t||this.parent.id()===t||this.parent.hasParent(t))},attr:function(t,n){return n?(this.properties[t]=n,this.event.changed(this),this):this.properties[t]},firstNames:function(){var t=this.attr("name").split(" and ");return t[0].split(" ")[0]+(t[1]?" & "+t[1].split(" ")[0]:"")},next:function(){var t=this.collection;return t?t[t.indexOf(this)+1]:void 0},lastDescendant:function(t){if(this._lastDescendant)return this._lastDescendant;var n=this.children&&this.children.filter(t);return n&&n.length?this._lastDescendant=n[n.length-1].lastDescendant(t):this},bounds:function(){return this._bounds!==void 0?this._bounds:(this._bounds=d3.geo.bounds(this.asGeoJSON()),isNaN(this._bounds[0][0])?(this._bounds=this.children?this.children.bounds():null,this._bounds):this._bounds)},asGeoJSON:function(){return{type:this.type,properties:this.properties,geometry:this.geometry}}}),cwm.Collection=function(t){if(!(this instanceof cwm.Collection))return new cwm.Collection(t);var n=[];return cwm.util.subclass(n,cwm.Collection.prototype),cwm.util.extend(n,{_id:t,_byId:{},_byParent:{},_idField:"id",_parentIdField:"parent",event:d3.dispatch("changed","reset","load","add")}),n},cwm.Collection.prototype=Object.create(cwm.util.extend(Object.create(Array.prototype),cwm.Base.prototype)),cwm.util.extend(cwm.Collection.prototype,{model:cwm.Place,add:function(t,n){return n===void 0&&(n=!0),t instanceof Array||(t=[t]),t.forEach(function(t){if(t instanceof this.model||(t=this.model(t).on("changed",this.event.changed).parentId(this._parentIdField).id(this._idField)),this.push(t),n){t.collection=this;var e=t.parentId();e in this._byParent||(this._byParent[e]=cwm.Collection()),this._byParent[e].add(t,!1),this._byId[t.id()]=t}},this),this},reset:function(t){this.length=0,this.add(t),this.event.reset(this)},url:function(t){return arguments.length?(this._url=t,this):this._url},fetch:function(t){var n=this;if(!n._url)throw"Url is not defined on the collection";return d3.json(n._url).get(function(e,r){if(e)throw e.response+": Could not load "+url;"topology"===r.type.toLowerCase()&&(topojson.presimplify(r),r=topojson.feature(r,r.objects.collection)),n.reset(r.features),n.event.load(n),"function"==typeof t&&t.call(n,e,r)}),this},placeId:function(t){return arguments.length?(this._idField=t,this._reindex(),this):this._idField},placeParentId:function(t){return arguments.length?(this._parentIdField=t,this._reindex(),this):this._parentIdField},get:function(t){return this._byId[t]},getByParent:function(t){return arguments.length?this._byParent[t]||[]:this._byParent},count:function(t){return t?this.reduce(function(n,e){return n+(e.attr(t)||0)},0):this.length},nearest:function(t){var n,e;if(t instanceof MM.Location)n=t.lon,e=t.lat;else{if(!(t instanceof Array))return;n=t[0],e=t[1]}var r,o=1/0;return this.forEach(function(t){var i=t.centroid(),a=Math.pow(n-i[0],2)+Math.pow(e-i[1],2);o>a&&(o=a,r=t)}),r},extentFromChildren:function(t){return arguments.length?(this._extentFromChildren=t,this):this._extentFromChildren},zoomOffset:function(t){return arguments.length?(this._zoomOffset=t,this):this._zoomOffset||0},bounds:function(){if(this._bounds!==void 0)return this._bounds;if(this._bounds=d3.geo.bounds(this.asGeoJSON()),isNaN(this._bounds[0][0])){var t=[];this.forEach(function(n){n.children&&(t=t.concat(n.children.asGeoJSON().features))}),this._bounds=d3.geo.bounds({type:"FeatureCollection",features:t}),this._bounds=isNaN(this._bounds[0][0])?null:this._bounds}return this._bounds},asGeoJSON:function(){return{type:"FeatureCollection",features:this.map(function(t){return t.asGeoJSON()})}},_reindex:function(){return this._byId={},this._byParent={},this.forEach(function(t){t.id(this._idField),this._byId[t.id()]=t,t.parentId(this._parentIdField);var n=t.parentId();n in this._byParent||(this._byParent[n]=[]),this._byParent[n].push(t)},this),this}}),cwm.Flightplan=function(){if(!(this instanceof cwm.Flightplan))return new cwm.Flightplan;var t=[];return cwm.util.subclass(t,cwm.Flightplan.prototype),cwm.util.extend(t,{_orphans:{},_filterFn:function(){return!0},event:d3.dispatch("add")}),t},cwm.Flightplan.prototype=Object.create(cwm.util.extend(Object.create(Array.prototype),cwm.Base.prototype)),cwm.util.extend(cwm.Flightplan.prototype,{show:function(t){return arguments.length?("string"==typeof t?this._filterFn=function(n){return n.attr(t)}:"function"==typeof t&&(this._filterFn=t),this):this._filterFn},add:function(t){var n,e,r,o=[],i=t?cwm.util.extend(this._orphans,t.getByParent()):this._orphans;i[void 0]&&(i[void 0].filter(this._filterFn).forEach(function(t){this.push(t),o.push(t)},this),delete i[void 0]);for(var a=0;this.length>a;a++)n=this[a],e=n.id(),r=i[e],r&&(featuredChildren=r.filter(this._filterFn),Array.prototype.splice.apply(this,[a+1,0].concat(featuredChildren)),o=o.concat(featuredChildren),a+=featuredChildren.length,n.children.add(r,!1),r.forEach(function(t){t.parent=n})),delete i[e];return this._orphans=i||{},o.length&&Object.keys(i).length>0&&this.add(),this._addFamily(),o.forEach(function(t){this.event.add(t)},this),this},_addFamily:function(){for(var t=0;this.length>t;t++)this[t]._index=t,this[t]._prev=this[t-1]||this[t],this[t]._next=this[t+1],this[t]._lastDescendant=this[t].lastDescendant(this._filterFn)}}),cwm.Navigation=function(t){function n(){var t=u.selectAll("li").data(e,function(t){return t.id()});t.enter().append("li").on("click",i.click).html(function(t){return s(t).match(/<h\d.*<\/h\d>/)[0]}),t.exit().remove()}var e,r,o={},i=d3.dispatch("click"),a=t.append("nav").style("display","none"),u=a.append("ul").style("opacity",0),s=cwm.Templates();return o.data=function(t){return arguments.length?(e=t,n(),o):e},o.toggle=function(){r?o.close():o.open()},o.close=function(){t.on("click.nav",null),u.transition().duration(500).style("opacity",0).each("end",function(){a.style("display","none")}),t.classed("nav-open",!1),r=!1},o.open=function(){t.on("click.nav",o.close),a.style("display","block"),u.transition().duration(500).style("opacity",1),t.classed("nav-open",!0),r=!0},d3.rebind(o,i,"on")},cwm.views={},cwm.views.Markers=function(){function t(t){return t.attr("featured")===!0?1:0}function n(t){var n=t||new MM.Location(0,0);return function(t,e){var r=t.geometry.coordinates,o=e.geometry.coordinates,i=Math.pow(r[0]-n.lon,2)+Math.pow(r[1]-n.lat,2),a=Math.pow(o[0]-n.lon,2)+Math.pow(o[1]-n.lat,2);return d3.ascending(i,a)}}function e(t){t.attr("featured")===!0&&(u=!0),d3.select(this).classed("grown",!0).transition().duration(500).ease("elastic",1.5).attr("r",1.8*c)}function r(){d3.select(".grown").filter(function(t){return t!==l.active()}).classed("grown",!1).transition().attr("r",c)}function o(t){t.filter(function(t){return t.attr("featured")===!0}).transition().delay(function(t,n){return 3e3+200*n}).duration(180).attr("r",2*c).style("stroke-width",6).each("end",function(){d3.select(this).transition().duration(1800).ease("elastic",1,.2).attr("r",c).style("stroke-width",3),u?u=!1:o(t)})}var i,a,u,s="circle",c=8,l=cwm.views.Popup().on("hide",r).on("changed",r);return{tagName:function(t){return arguments.length?(s=t,void 0):s},show:function(e){e.classed("featured",function(t){return t.attr("featured")}).sort(n(i.getCenter())).attr("r",0).transition().duration(1e3).delay(function(t,n){return 20*n}).ease("elastic",2).attr("r",c),e.sort(t)},addInteraction:function(t){t.on("mouseover.animation",e).on("mouseout.animation",r).on("mouseenter.popup",l.show).on("mouseleave.popup",l.hide).on("click.popup",function(t){d3.event.stopPropagation(),l.show(t),i.on("click").call(this,t)}).call(o)},move:function(t){t.attr("transform",function(t){var n=a.apply(this,t.geometry.coordinates);return"translate("+n[0]+","+n[1]+")"}),l.active()&&l.move()},hide:function(t){t.transition().attr("r",0).each("end",function(){d3.select(this).remove()})},showPopup:l.show,map:function(t){i=t,l.map(i),a=i.pointProject()}}},cwm.views.Popup=function(){var t,n,e,r,o,i,a=d3.dispatch("hide","changed"),u=cwm.Templates();return e={show:function(o){var s=d3.event&&"click"!==d3.event.type?"small":"large";r.classed("large")&&o===r.datum()&&(s="large"),r.datum(o).html(u("popup-"+s)).style("display","block").classed("large","large"===s).transition().duration(20).style("opacity",1),i!==o&&(i=o,a.changed(o),r.classed("scaled",!1)),e.move();var c=r.dimensions()[0],l=r.dimensions()[1],f=t.dimensions.x,h=n.apply(this,i.geometry.coordinates);r.classed("top-right",f-h[0]>c&&h[1]>l).classed("bottom-right",f-h[0]>c&&l>=h[1]).classed("top-left",c>=f-h[0]&&h[1]>l).classed("bottom-left",c>=f-h[0]&&l>=h[1]).classed("scaled",!0)},active:function(){return r.style("opacity")>0&&i},move:function(){var a=t.current(),u=r.datum();if("installations"===a.section||"communities"===a.section&&a.communities===u.parent){var s=n.apply(this,i.geometry.coordinates);MM.moveElement(o.node(),new MM.Point(s[0],s[1]))}else e.hide(u)},hide:function(t){d3.event&&"mouseleave"===d3.event.type&&r.classed("large")||r.transition().duration(20).style("opacity",0).each("end",function(){d3.select(this).classed("large",!1).style("display","none"),a.hide(t)})},map:function(i){t=i,n=t.pointProject();var a=d3.select(t.parent);r=cwm.render.PopupContainer(a).on("mouseenter",e.show).on("mouseleave",e.hide).on("click",function(n){d3.event.stopPropagation(),e.show(n),t.on("click").call(this,n)}),o=a.select("div.marker-tooltip")}},d3.rebind(e,a,"on")},cwm.views.Overlay=function(t){function n(){r||(r=!0,o.selectAll(".overlay").transition().duration(500).style("opacity",0).each("end",function(){d3.select(this).style("display","none"),t.selectAll("svg, button.nav").style("z-index",0)}),window.setTimeout(function(){r=!1},550))}var e,r,o=t.select("#overlay"),i={},a=0,u=0;return t.on("mousemove",function(){var r=d3.mouse(t.node());e&&(u+=cwm.util.distance(r,e)),u>1400&&n(),e=r}),i["overlay-installations"]=!0,o.on("click",function(){n()}),{show:function(n){u=0;var e=cwm.util.sanitize(n.collection.id()).replace(/^id-/,"overlay-");i[e]||o.selectAll("#"+e+".overlay").style("display","block").transition().style("opacity",1).each(function(){t.selectAll("svg, button.nav").style("z-index",2),i[e]=!0}),"overlay-installations"===e&&(a+=1),3===a%5&&15>=a&&(i["overlay-installations"]=!1)},hide:n}},cwm.layers={},cwm.layers.BingLayer=function(t){return this instanceof cwm.layers.BingLayer?(this._subdomains=[0,1,2,3],this._key=t.bingApiKey,this._style=t.style||"Aerial",this._url="",this.meta="",this.parent=document.createElement("div"),this.parent.style.cssText="position: absolute; top: 0px; left: 0px; width: 100%; height: 100%; margin: 0; padding: 0; z-index: 0",this.parent.setAttribute("id","tile-layers"),this.levels={},this.requestManager=new MM.RequestManager,this.requestManager.addCallback("requestcomplete",this.getTileComplete()),this.requestManager.addCallback("requesterror",this.getTileError()),this.setProvider(new wax.mm._provider({tiles:["data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"]})),this.loadMetadata(),void 0):new cwm.layers.BingLayer(t)},cwm.layers.BingLayer.prototype={addTo:function(t){return MM.Map.prototype.addLayer.call(t,this),this},initMetadata:function(){var t=this.meta.resourceSets[0].resources[0];this._subdomains=t.imageUrlSubdomains,this._url=t.imageUrl.replace("{subdomain}","{S}").replace("{quadkey}","{Q}").replace("http:",document.location.protocol).replace("{culture}",""),this.setProvider(new MM.Template(this._url,this._subdomains))},loadMetadata:function(){var t=document.location.protocol+"//dev.virtualearth.net/REST/v1/Imagery/Metadata/"+this._style,n=this;$.ajax({url:t,data:{key:this._key},jsonp:"jsonp",dataType:"jsonp",success:function(t){n.meta=t,n.initMetadata()}})}},MM.extend(cwm.layers.BingLayer,MM.Layer),"undefined"==typeof mapbox&&(mapbox={}),mapbox.MAPBOX_URL="http://a.tiles.mapbox.com/v3/",cwm.layers.MapboxLayer=function(){return this instanceof cwm.layers.MapboxLayer?(this._tilejson={},this._url="",this._id="",this._composite=!1,this.name="",this.parent=document.getElementById("tile-layers")||document.createElement("div"),this.parent.style.cssText="position: absolute; top: 0px; left: 0px; width: 100%; height: 100%; margin: 0; padding: 0; z-index: 0",this.levels={},this.requestManager=new MM.RequestManager,this.requestManager.addCallback("requestcomplete",this.getTileComplete()),this.requestManager.addCallback("requesterror",this.getTileError()),this.setProvider(new wax.mm._provider({tiles:["data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"]})),void 0):new cwm.layers.MapboxLayer(parent)},cwm.layers.MapboxLayer.prototype.addTo=function(t){return t.layers.push(this),this.map=t,this},cwm.layers.MapboxLayer.prototype.refresh=function(t){var n=this;return $.ajax({url:this._url+(~this._url.indexOf("?")?"&":"?")+"callback=?",type:"jsonp",dataType:"jsonp",success:function(e){n.tilejson(e),t&&t(n)}}),this},cwm.layers.MapboxLayer.prototype.url=function(t,n){return arguments.length?(this._mapboxhosting=0===t.indexOf(mapbox.MAPBOX_URL),this._url=t,this.refresh(n)):this._url},cwm.layers.MapboxLayer.prototype.id=function(t,n){return arguments.length?(this.named(t),this._id=t,this.url(mapbox.MAPBOX_URL+t+".jsonp",n)):this._id},cwm.layers.MapboxLayer.prototype.named=function(t){return arguments.length?(this.name=t,this):this.name},cwm.layers.MapboxLayer.prototype.tilejson=function(t){if(!arguments.length)return this._tilejson;if(this._composite&&this._mapboxhosting||this.setProvider(new wax.mm._provider(t)),this._tilejson=t,this.name=this.name||t.id,this._id=this._id||t.id,t.bounds){var n=new MM.MercatorProjection(0,MM.deriveTransformation(-Math.PI,Math.PI,0,0,Math.PI,Math.PI,1,0,-Math.PI,-Math.PI,0,1));this.provider.tileLimits=[n.locationCoordinate(new MM.Location(t.bounds[3],t.bounds[0])).zoomTo(t.minzoom?t.minzoom:0),n.locationCoordinate(new MM.Location(t.bounds[1],t.bounds[2])).zoomTo(t.maxzoom?t.maxzoom:18)]}return this},cwm.layers.MapboxLayer.prototype.positionTile=function(t){var n=this.map.coordinate.zoomTo(t.coord.zoom);t.style.cssText="position:absolute;-webkit-user-select:none;-webkit-user-drag:none;-moz-user-drag:none;-webkit-transform-origin:0 0;-moz-transform-origin:0 0;-o-transform-origin:0 0;-ms-transform-origin:0 0;width:"+this.map.tileSize.x+"px; height: "+this.map.tileSize.y+"px;"+"z-index: 1;",t.ondragstart=function(){return!1
};var e=Math.pow(2,this.map.coordinate.zoom-t.coord.zoom);MM.moveElement(t,{x:.5*this.map.dimensions.x+(t.coord.column-n.column)*this.map.tileSize.x*e,y:.5*this.map.dimensions.y+(t.coord.row-n.row)*this.map.tileSize.y*e,scale:e,width:this.map.tileSize.x,height:this.map.tileSize.y});var r=this.levels[t.coord.zoom];t.__composited__||r.appendChild(t),Math.round(this.map.coordinate.zoom)==t.coord.zoom&&(r.style.display="block"),this.requestRedraw()},cwm.layers.MapboxLayer.prototype.createOrGetLevel=function(t){if(t in this.levels)return this.levels[t];var n=this.parent.id+"-zoom-"+t,e=document.getElementById(n);return e?(this.levels[t]=e,e):(e=document.createElement("div"),e.id=n,e.style.cssText="position: absolute; margin: 0; padding: 0;",e.style.zIndex=t,this.parent.appendChild(e),this.levels[t]=e,e)},cwm.layers.MapboxLayer.prototype.composite=function(t){return arguments.length?(this._composite=t?!0:!1,this):this._composite},cwm.layers.MapboxLayer.prototype.enable=function(t){return MM.Layer.prototype.enable.call(this,t),this.map&&this.map.draw(),this},cwm.layers.MapboxLayer.prototype.disable=function(t){return MM.Layer.prototype.disable.call(this,t),this.map&&this.map.draw(),this},MM.extend(cwm.layers.MapboxLayer,MM.Layer),cwm.layers.FeatureLayer=function(){function t(){var t=this.__data__;h&&h.node().parentNode||(h=cwm.render.Label(t,c),h._feature=this,h.on("mouseover",function(){d=!0}).on("mouseout",function(){d=!1,h.remove()}).on("click",function(){d3.event.stopPropagation(),d=!1,h.remove(),l.on("click").call(h._feature,t)}),n())}function n(){if(h){var t=h.datum(),n=l.locationPoint(new MM.Location(t.centroid()[1],t.centroid()[0]));MM.moveElement(h.node(),n)}}function e(t,n){d3.event.stopPropagation(),l.on("click").call(this,t,n)}function r(){window.setTimeout(function(){d||h.remove()},10)}function o(){return g.forEach(function(t){var n=t.bounds(),e=new MM.Extent(n[1][1],n[0][0],n[0][1],n[1][0]);t._maxZoom=l.extentCoordinate(e,!0).zoom}),y}function i(){if(l&&g){p=l.getZoom();var o=l.getExtent();return g.filter(function(t){return o.coversBounds(t.bounds())&&("Ecuador"!==t.id()||t._maxZoom+1>p)}),f=s.selectAll("path").data(g,function(t){return t.id()}),f.enter().append("path").on("mouseover",t).on("mouseout",r).on("click",e),f.attr("d",m).classed("active",function(t){return l.current().place===t}).classed("parentActive",function(t){return t.parent&&l.current().place===t.parent}).classed("inside",function(t){var n=l.current();for(var e in n)if(n[e]===t&&"place"!==e)return!0}),f.exit().remove(),n(),y}}function a(t){return arguments.length?(y.name=t.id().toLowerCase(),t instanceof Array||(t=[t]),g=t,d3.select(window).on("resize."+y.name,o),s.classed(y.name,!0),o(),i(),y):g}function u(t){return l=t,l.addLayer(y),m=l.pathGenerator(),c=d3.select(l.parent),s=cwm.render.SvgContainer(c).append("g").attr("class",y.name),y}var s,c,l,f,h,d,p,m,g=[],v=d3.dispatch("click"),y={draw:i,data:a,addTo:u};return d3.rebind(y,v,"on")},cwm.layers.MarkerLayer=function(){function t(){if(r&&i){var t=r.current(),n=i.filter(function(n){for(var e in t)if(t[e]===n.parent)return!0}),e=o.selectAll(u.tagName()).data(n,function(t){return t.id()});return e.enter().append(u.tagName()).call(u.show).call(u.addInteraction),e.call(u.move),e.exit().call(u.move).call(u.hide),a}}function n(n){return arguments.length?(i=n,a.name=n.id(),o.classed(a.name,!0),t(),a):i}function e(t){r=t,r.addLayer(a),u.map(r);var n=d3.select(r.parent);return o=cwm.render.SvgContainer(n).append("g").attr("class",a.name),a}var r,o,i,a,u=cwm.views.Markers();return a={draw:t,data:n,addTo:e,showPopup:u.showPopup}},cwm.handlers={},cwm.handlers.DragHandler=function(){function t(){n.panBy(d3.event.dx,d3.event.dy)}var n,e,r={},o=d3.behavior.drag().on("drag",t).on("dragstart",function(){e.classed("dragging",!0),d3.event.sourceEvent.stopPropagation()}).on("dragend",function(){e.classed("dragging",!1)});return r.init=function(t){n=t,e=d3.select(n.parent).call(o)},r.remove=function(){e.on("mousedown.drag",null)},r};