d3=function(){function t(t){return null!=t&&!isNaN(t)}function n(t){return t.length}function e(t){for(var n=1;t*n%1;)n*=10;return n}function r(t,n){try{for(var e in n)Object.defineProperty(t.prototype,e,{value:n[e],enumerable:!1})}catch(r){t.prototype=n}}function o(){}function i(){}function a(t,n,e){return function(){var r=e.apply(n,arguments);return r===n?t:r}}function u(t,n){if(n in t)return n;n=n.charAt(0).toUpperCase()+n.substring(1);for(var e=0,r=po.length;r>e;++e){var o=po[e]+n;if(o in t)return o}}function s(){}function l(){}function c(t){function n(){for(var n,r=e,o=-1,i=r.length;i>++o;)(n=r[o].on)&&n.apply(this,arguments);return t}var e=[],r=new o;return n.on=function(n,o){var i,a=r.get(n);return 2>arguments.length?a&&a.on:(a&&(a.on=null,e=e.slice(0,i=e.indexOf(a)).concat(e.slice(i+1)),r.remove(n)),o&&e.push(r.set(n,{on:o})),t)},n}function h(){eo.event.preventDefault()}function f(){for(var t,n=eo.event;t=n.sourceEvent;)n=t;return n}function d(t){for(var n=new l,e=0,r=arguments.length;r>++e;)n[arguments[e]]=c(n);return n.of=function(e,r){return function(o){try{var i=o.sourceEvent=eo.event;o.target=t,eo.event=o,n[o.type].apply(e,r)}finally{eo.event=i}}},n}function p(t){return go(t,xo),t}function m(t){return"function"==typeof t?t:function(){return vo(t,this)}}function g(t){return"function"==typeof t?t:function(){return yo(t,this)}}function v(t,n){function e(){this.removeAttribute(t)}function r(){this.removeAttributeNS(t.space,t.local)}function o(){this.setAttribute(t,n)}function i(){this.setAttributeNS(t.space,t.local,n)}function a(){var e=n.apply(this,arguments);null==e?this.removeAttribute(t):this.setAttribute(t,e)}function u(){var e=n.apply(this,arguments);null==e?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,e)}return t=eo.ns.qualify(t),null==n?t.local?r:e:"function"==typeof n?t.local?u:a:t.local?i:o}function y(t){return t.trim().replace(/\s+/g," ")}function w(t){return RegExp("(?:^|\\s+)"+eo.requote(t)+"(?:\\s+|$)","g")}function M(t,n){function e(){for(var e=-1;o>++e;)t[e](this,n)}function r(){for(var e=-1,r=n.apply(this,arguments);o>++e;)t[e](this,r)}t=t.trim().split(/\s+/).map(x);var o=t.length;return"function"==typeof n?r:e}function x(t){var n=w(t);return function(e,r){if(o=e.classList)return r?o.add(t):o.remove(t);var o=e.getAttribute("class")||"";r?(n.lastIndex=0,n.test(o)||e.setAttribute("class",y(o+" "+t))):e.setAttribute("class",y(o.replace(n," ")))}}function b(t,n,e){function r(){this.style.removeProperty(t)}function o(){this.style.setProperty(t,n,e)}function i(){var r=n.apply(this,arguments);null==r?this.style.removeProperty(t):this.style.setProperty(t,r,e)}return null==n?r:"function"==typeof n?i:o}function _(t,n){function e(){delete this[t]}function r(){this[t]=n}function o(){var e=n.apply(this,arguments);null==e?delete this[t]:this[t]=e}return null==n?e:"function"==typeof n?o:r}function z(t){return"function"==typeof t?t:(t=eo.ns.qualify(t)).local?function(){return this.ownerDocument.createElementNS(t.space,t.local)}:function(){return this.ownerDocument.createElementNS(this.namespaceURI,t)}}function S(t){return{__data__:t}}function T(t){return function(){return Mo(this,t)}}function E(t){return arguments.length||(t=eo.ascending),function(n,e){return n&&e?t(n.__data__,e.__data__):!n-!e}}function C(t,n){for(var e=0,r=t.length;r>e;e++)for(var o,i=t[e],a=0,u=i.length;u>a;a++)(o=i[a])&&n(o,a,e);return t}function L(t){return go(t,_o),t}function A(t){var n,e;return function(r,o,i){var a,u=t[i].update,s=u.length;for(i!=e&&(e=i,n=0),o>=n&&(n=o+1);!(a=u[n])&&s>++n;);return a}}function P(){var t=this.__transition__;t&&++t.active}function k(t,n,e){function r(){var n=this[a];n&&(this.removeEventListener(t,n,n.$),delete this[a])}function o(){var o=l(n,so(arguments));r.call(this),this.addEventListener(t,this[a]=o,o.$=e),o._=n}function i(){var n,e=RegExp("^__on([^.]+)"+eo.requote(t)+"$");for(var r in this)if(n=r.match(e)){var o=this[r];this.removeEventListener(n[1],o,o.$),delete this[r]}}var a="__on"+t,u=t.indexOf("."),l=q;u>0&&(t=t.substring(0,u));var c=So.get(t);return c&&(t=c,l=H),u?n?o:r:n?s:i}function q(t,n){return function(e){var r=eo.event;eo.event=e,n[0]=this.__data__;try{t.apply(this,n)}finally{eo.event=r}}}function H(t,n){var e=q(t,n);return function(t){var n=this,r=t.relatedTarget;r&&(r===n||8&r.compareDocumentPosition(n))||e.call(n,t)}}function F(){var t=".dragsuppress-"+ ++Eo,n="click"+t,e=eo.select(ho).on("touchmove"+t,h).on("dragstart"+t,h).on("selectstart"+t,h);if(To){var r=co.style,o=r[To];r[To]="none"}return function(i){function a(){e.on(n,null)}e.on(t,null),To&&(r[To]=o),i&&(e.on(n,function(){h(),a()},!0),setTimeout(a,0))}}function I(t,n){n.changedTouches&&(n=n.changedTouches[0]);var e=t.ownerSVGElement||t;if(e.createSVGPoint){var r=e.createSVGPoint();if(0>Co&&(ho.scrollX||ho.scrollY)){e=eo.select("body").append("svg").style({position:"absolute",top:0,left:0,margin:0,padding:0,border:"none"},"important");var o=e[0][0].getScreenCTM();Co=!(o.f||o.e),e.remove()}return Co?(r.x=n.pageX,r.y=n.pageY):(r.x=n.clientX,r.y=n.clientY),r=r.matrixTransform(t.getScreenCTM().inverse()),[r.x,r.y]}var i=t.getBoundingClientRect();return[n.clientX-i.left-t.clientLeft,n.clientY-i.top-t.clientTop]}function O(t){return"function"==typeof t?t:function(){return t}}function B(){var t=D(),n=j()-t;n>24?(isFinite(n)&&(clearTimeout(ko),ko=setTimeout(B,n)),Po=0):(Po=1,Ho(B))}function D(){var t=Date.now();for(qo=Lo;qo;)t>=qo.t&&(qo.f=qo.c(t-qo.t)),qo=qo.n;return t}function j(){for(var t,n=Lo,e=1/0;n;)n.f?n=t?t.n=n.n:Lo=n.n:(e>n.t&&(e=n.t),n=(t=n).n);return Ao=t,e}function N(){this._=new Date(arguments.length>1?Date.UTC.apply(this,arguments):arguments[0])}function R(t,n,e){function r(n){var e=t(n),r=i(e,1);return r-n>n-e?e:r}function o(e){return n(e=t(new Io(e-1)),1),e}function i(t,e){return n(t=new Io(+t),e),t}function a(t,r,i){var a=o(t),u=[];if(i>1)for(;r>a;)e(a)%i||u.push(new Date(+a)),n(a,1);else for(;r>a;)u.push(new Date(+a)),n(a,1);return u}function u(t,n,e){try{Io=N;var r=new N;return r._=t,a(r,n,e)}finally{Io=Date}}t.floor=t,t.round=r,t.ceil=o,t.offset=i,t.range=a;var s=t.utc=Y(t);return s.floor=s,s.round=Y(r),s.ceil=Y(o),s.offset=Y(i),s.range=u,t}function Y(t){return function(n,e){try{Io=N;var r=new N;return r._=n,t(r,e)._}finally{Io=Date}}}function U(t){function n(n){for(var r,o,i,a=[],u=-1,s=0;e>++u;)37===t.charCodeAt(u)&&(a.push(t.substring(s,u)),null!=(o=ni[r=t.charAt(++u)])&&(r=t.charAt(++u)),(i=ei[r])&&(r=i(n,null==o?"e"===r?" ":"0":o)),a.push(r),s=u+1);return a.push(t.substring(s,u)),a.join("")}var e=t.length;return n.parse=function(n){var e={y:1900,m:0,d:1,H:0,M:0,S:0,L:0,Z:null},r=Z(e,t,n,0);if(r!=n.length)return null;"p"in e&&(e.H=e.H%12+12*e.p);var o=null!=e.Z&&Io!==N,i=new(o?N:Io);return"j"in e?i.setFullYear(e.y,0,e.j):"w"in e&&("W"in e||"U"in e)?(i.setFullYear(e.y,0,1),i.setFullYear(e.y,0,"W"in e?(e.w+6)%7+7*e.W-(i.getDay()+5)%7:e.w+7*e.U-(i.getDay()+6)%7)):i.setFullYear(e.y,e.m,e.d),i.setHours(e.H+Math.floor(e.Z/100),e.M+e.Z%100,e.S,e.L),o?i._:i},n.toString=function(){return t},n}function Z(t,n,e,r){for(var o,i,a,u=0,s=n.length,l=e.length;s>u;){if(r>=l)return-1;if(o=n.charCodeAt(u++),37===o){if(a=n.charAt(u++),i=ri[a in ni?n.charAt(u++):a],!i||0>(r=i(t,e,r)))return-1}else if(o!=e.charCodeAt(r++))return-1}return r}function X(t){return RegExp("^(?:"+t.map(eo.requote).join("|")+")","i")}function Q(t){for(var n=new o,e=-1,r=t.length;r>++e;)n.set(t[e].toLowerCase(),e);return n}function W(t,n,e){var r=0>t?"-":"",o=(r?-t:t)+"",i=o.length;return r+(e>i?Array(e-i+1).join(n)+o:o)}function $(t,n,e){Wo.lastIndex=0;var r=Wo.exec(n.substring(e));return r?(t.w=$o.get(r[0].toLowerCase()),e+r[0].length):-1}function K(t,n,e){Xo.lastIndex=0;var r=Xo.exec(n.substring(e));return r?(t.w=Qo.get(r[0].toLowerCase()),e+r[0].length):-1}function V(t,n,e){oi.lastIndex=0;var r=oi.exec(n.substring(e,e+1));return r?(t.w=+r[0],e+r[0].length):-1}function G(t,n,e){oi.lastIndex=0;var r=oi.exec(n.substring(e));return r?(t.U=+r[0],e+r[0].length):-1}function J(t,n,e){oi.lastIndex=0;var r=oi.exec(n.substring(e));return r?(t.W=+r[0],e+r[0].length):-1}function tn(t,n,e){Go.lastIndex=0;var r=Go.exec(n.substring(e));return r?(t.m=Jo.get(r[0].toLowerCase()),e+r[0].length):-1}function nn(t,n,e){Ko.lastIndex=0;var r=Ko.exec(n.substring(e));return r?(t.m=Vo.get(r[0].toLowerCase()),e+r[0].length):-1}function en(t,n,e){return Z(t,""+ei.c,n,e)}function rn(t,n,e){return Z(t,""+ei.x,n,e)}function on(t,n,e){return Z(t,""+ei.X,n,e)}function an(t,n,e){oi.lastIndex=0;var r=oi.exec(n.substring(e,e+4));return r?(t.y=+r[0],e+r[0].length):-1}function un(t,n,e){oi.lastIndex=0;var r=oi.exec(n.substring(e,e+2));return r?(t.y=ln(+r[0]),e+r[0].length):-1}function sn(t,n,e){return/^[+-]\d{4}$/.test(n=n.substring(e,e+5))?(t.Z=+n,e+5):-1}function ln(t){return t+(t>68?1900:2e3)}function cn(t,n,e){oi.lastIndex=0;var r=oi.exec(n.substring(e,e+2));return r?(t.m=r[0]-1,e+r[0].length):-1}function hn(t,n,e){oi.lastIndex=0;var r=oi.exec(n.substring(e,e+2));return r?(t.d=+r[0],e+r[0].length):-1}function fn(t,n,e){oi.lastIndex=0;var r=oi.exec(n.substring(e,e+3));return r?(t.j=+r[0],e+r[0].length):-1}function dn(t,n,e){oi.lastIndex=0;var r=oi.exec(n.substring(e,e+2));return r?(t.H=+r[0],e+r[0].length):-1}function pn(t,n,e){oi.lastIndex=0;var r=oi.exec(n.substring(e,e+2));return r?(t.M=+r[0],e+r[0].length):-1}function mn(t,n,e){oi.lastIndex=0;var r=oi.exec(n.substring(e,e+2));return r?(t.S=+r[0],e+r[0].length):-1}function gn(t,n,e){oi.lastIndex=0;var r=oi.exec(n.substring(e,e+3));return r?(t.L=+r[0],e+r[0].length):-1}function vn(t,n,e){var r=ii.get(n.substring(e,e+=2).toLowerCase());return null==r?-1:(t.p=r,e)}function yn(t){var n=t.getTimezoneOffset(),e=n>0?"-":"+",r=~~(oo(n)/60),o=oo(n)%60;return e+W(r,"0",2)+W(o,"0",2)}function wn(t,n,e){ti.lastIndex=0;var r=ti.exec(n.substring(e,e+1));return r?e+r[0].length:-1}function Mn(t){function n(t){try{Io=N;var n=new Io;return n._=t,e(n)}finally{Io=Date}}var e=U(t);return n.parse=function(t){try{Io=N;var n=e.parse(t);return n&&n._}finally{Io=Date}},n.toString=e.toString,n}function xn(t){return t.toISOString()}function bn(){return!0}function _n(){}function zn(t,n,e){return new Sn(t,n,e)}function Sn(t,n,e){this.h=t,this.s=n,this.l=e}function Tn(t,n,e){function r(t){return t>360?t-=360:0>t&&(t+=360),60>t?i+(a-i)*t/60:180>t?a:240>t?i+(a-i)*(240-t)/60:i}function o(t){return Math.round(255*r(t))}var i,a;return t=isNaN(t)?0:0>(t%=360)?t+360:t,n=isNaN(n)?0:0>n?0:n>1?1:n,e=0>e?0:e>1?1:e,a=.5>=e?e*(1+n):e+n-e*n,i=2*e-a,jn(o(t+120),o(t),o(t-120))}function En(t){return t>1?0:-1>t?si:Math.acos(t)}function Cn(t){return t>1?ci:-1>t?-ci:Math.asin(t)}function Ln(t,n,e){return new An(t,n,e)}function An(t,n,e){this.h=t,this.c=n,this.l=e}function Pn(t,n,e){return isNaN(t)&&(t=0),isNaN(n)&&(n=0),kn(e,Math.cos(t*=di)*n,Math.sin(t)*n)}function kn(t,n,e){return new qn(t,n,e)}function qn(t,n,e){this.l=t,this.a=n,this.b=e}function Hn(t,n,e){var r=(t+16)/116,o=r+n/500,i=r-e/200;return o=In(o)*vi,r=In(r)*yi,i=In(i)*wi,jn(Bn(3.2404542*o-1.5371385*r-.4985314*i),Bn(-.969266*o+1.8760108*r+.041556*i),Bn(.0556434*o-.2040259*r+1.0572252*i))}function Fn(t,n,e){return t>0?Ln(Math.atan2(e,n)*pi,Math.sqrt(n*n+e*e),t):Ln(0/0,0/0,t)}function In(t){return t>.206893034?t*t*t:(t-4/29)/7.787037}function On(t){return t>.008856?Math.pow(t,1/3):7.787037*t+4/29}function Bn(t){return Math.round(255*(.00304>=t?12.92*t:1.055*Math.pow(t,1/2.4)-.055))}function Dn(t){return jn(t>>16,255&t>>8,255&t)}function jn(t,n,e){return new Nn(t,n,e)}function Nn(t,n,e){this.r=t,this.g=n,this.b=e}function Rn(t){return 16>t?"0"+Math.max(0,t).toString(16):Math.min(255,t).toString(16)}function Yn(t,n,e){var r,o,i,a=0,u=0,s=0;if(r=/([a-z]+)\((.*)\)/i.exec(t))switch(o=r[2].split(","),r[1]){case"hsl":return e(parseFloat(o[0]),parseFloat(o[1])/100,parseFloat(o[2])/100);case"rgb":return n(Qn(o[0]),Qn(o[1]),Qn(o[2]))}return(i=bi.get(t))?n(i.r,i.g,i.b):(null!=t&&"#"===t.charAt(0)&&(4===t.length?(a=t.charAt(1),a+=a,u=t.charAt(2),u+=u,s=t.charAt(3),s+=s):7===t.length&&(a=t.substring(1,3),u=t.substring(3,5),s=t.substring(5,7)),a=parseInt(a,16),u=parseInt(u,16),s=parseInt(s,16)),n(a,u,s))}function Un(t,n,e){var r,o,i=Math.min(t/=255,n/=255,e/=255),a=Math.max(t,n,e),u=a-i,s=(a+i)/2;return u?(o=.5>s?u/(a+i):u/(2-a-i),r=t==a?(n-e)/u+(e>n?6:0):n==a?(e-t)/u+2:(t-n)/u+4,r*=60):(r=0/0,o=s>0&&1>s?0:r),zn(r,o,s)}function Zn(t,n,e){t=Xn(t),n=Xn(n),e=Xn(e);var r=On((.4124564*t+.3575761*n+.1804375*e)/vi),o=On((.2126729*t+.7151522*n+.072175*e)/yi),i=On((.0193339*t+.119192*n+.9503041*e)/wi);return kn(116*o-16,500*(r-o),200*(o-i))}function Xn(t){return.04045>=(t/=255)?t/12.92:Math.pow((t+.055)/1.055,2.4)}function Qn(t){var n=parseFloat(t);return"%"===t.charAt(t.length-1)?Math.round(2.55*n):n}function Wn(t,n){t=eo.rgb(t),n=eo.rgb(n);var e=t.r,r=t.g,o=t.b,i=n.r-e,a=n.g-r,u=n.b-o;return function(t){return"#"+Rn(Math.round(e+i*t))+Rn(Math.round(r+a*t))+Rn(Math.round(o+u*t))}}function $n(t,n){var e,r={},o={};for(e in t)e in n?r[e]=Jn(t[e],n[e]):o[e]=t[e];for(e in n)e in t||(o[e]=n[e]);return function(t){for(e in r)o[e]=r[e](t);return o}}function Kn(t,n){var e,r=[],o=[],i=t.length,a=n.length,u=Math.min(t.length,n.length);for(e=0;u>e;++e)r.push(Jn(t[e],n[e]));for(;i>e;++e)o[e]=t[e];for(;a>e;++e)o[e]=n[e];return function(t){for(e=0;u>e;++e)o[e]=r[e](t);return o}}function Vn(t,n){return n-=t=+t,function(e){return t+n*e}}function Gn(t,n){var e,r,o,i,a,u=0,s=0,l=[],c=[];for(t+="",n+="",_i.lastIndex=0,r=0;e=_i.exec(n);++r)e.index&&l.push(n.substring(u,s=e.index)),c.push({i:l.length,x:e[0]}),l.push(null),u=_i.lastIndex;for(n.length>u&&l.push(n.substring(u)),r=0,i=c.length;(e=_i.exec(t))&&i>r;++r)if(a=c[r],a.x==e[0]){if(a.i)if(null==l[a.i+1])for(l[a.i-1]+=a.x,l.splice(a.i,1),o=r+1;i>o;++o)c[o].i--;else for(l[a.i-1]+=a.x+l[a.i+1],l.splice(a.i,2),o=r+1;i>o;++o)c[o].i-=2;else if(null==l[a.i+1])l[a.i]=a.x;else for(l[a.i]=a.x+l[a.i+1],l.splice(a.i+1,1),o=r+1;i>o;++o)c[o].i--;c.splice(r,1),i--,r--}else a.x=Vn(parseFloat(e[0]),parseFloat(a.x));for(;i>r;)a=c.pop(),null==l[a.i+1]?l[a.i]=a.x:(l[a.i]=a.x+l[a.i+1],l.splice(a.i+1,1)),i--;return 1===l.length?null==l[0]?(a=c[0].x,function(t){return a(t)+""}):function(){return n}:function(t){for(r=0;i>r;++r)l[(a=c[r]).i]=a.x(t);return l.join("")}}function Jn(t,n){for(var e,r=eo.interpolators.length;--r>=0&&!(e=eo.interpolators[r](t,n)););return e}function te(t,n){return n-=t,function(e){return Math.round(t+n*e)}}function ne(t,n){return n=n-(t=+t)?1/(n-t):0,function(e){return(e-t)*n}}function ee(t,n){return n=n-(t=+t)?1/(n-t):0,function(e){return Math.max(0,Math.min(1,(e-t)*n))}}function re(t){return t}function oe(t,n){var e=Math.pow(10,3*oo(8-n));return{scale:n>8?function(t){return t/e}:function(t){return t*e},symbol:t}}function ie(t,n){return n-(t?Math.ceil(Math.log(t)/Math.LN10):1)}function ae(t){return t+""}function ue(t,n,e,r){var o=e(t[0],t[1]),i=r(n[0],n[1]);return function(t){return i(o(t))}}function se(t,n){var e,r=0,o=t.length-1,i=t[r],a=t[o];return i>a&&(e=r,r=o,o=e,e=i,i=a,a=e),t[r]=n.floor(i),t[o]=n.ceil(a),t}function le(t){return t?{floor:function(n){return Math.floor(n/t)*t},ceil:function(n){return Math.ceil(n/t)*t}}:qi}function ce(t,n,e,r){var o=[],i=[],a=0,u=Math.min(t.length,n.length)-1;for(t[u]<t[0]&&(t=t.slice().reverse(),n=n.slice().reverse());u>=++a;)o.push(e(t[a-1],t[a])),i.push(r(n[a-1],n[a]));return function(n){var e=eo.bisect(t,n,1,u)-1;return i[e](o[e](n))}}function he(t){var n=t[0],e=t[t.length-1];return e>n?[n,e]:[e,n]}function fe(t,n,e,r){function o(){var o=Math.min(t.length,n.length)>2?ce:ue,s=r?ee:ne;return a=o(t,n,s,e),u=o(n,t,s,Jn),i}function i(t){return a(t)}var a,u;return i.invert=function(t){return u(t)},i.domain=function(n){return arguments.length?(t=n.map(Number),o()):t},i.range=function(t){return arguments.length?(n=t,o()):n},i.rangeRound=function(t){return i.range(t).interpolate(te)},i.clamp=function(t){return arguments.length?(r=t,o()):r},i.interpolate=function(t){return arguments.length?(e=t,o()):e},i.ticks=function(n){return ge(t,n)},i.tickFormat=function(n,e){return ve(t,n,e)},i.nice=function(n){return pe(t,n),o()},i.copy=function(){return fe(t,n,e,r)},o()}function de(t,n){return eo.rebind(t,n,"range","rangeRound","interpolate","clamp")}function pe(t,n){return se(t,le(me(t,n)[2]))}function me(t,n){null==n&&(n=10);var e=he(t),r=e[1]-e[0],o=Math.pow(10,Math.floor(Math.log(r/n)/Math.LN10)),i=n/r*o;return.15>=i?o*=10:.35>=i?o*=5:.75>=i&&(o*=2),e[0]=Math.ceil(e[0]/o)*o,e[1]=Math.floor(e[1]/o)*o+.5*o,e[2]=o,e}function ge(t,n){return eo.range.apply(eo,me(t,n))}function ve(t,n,e){var r=me(t,n);return eo.format(e?e.replace(Li,function(t,n,e,o,i,a,u,s,l,c){return[n,e,o,i,a,u,s,l||"."+we(c,r),c].join("")}):",."+ye(r[2])+"f")}function ye(t){return-Math.floor(Math.log(t)/Math.LN10+.01)}function we(t,n){var e=ye(n[2]);return t in Hi?Math.abs(e-ye(Math.max(Math.abs(n[0]),Math.abs(n[1]))))+ +("e"!==t):e-2*("%"===t)}function Me(t,n,e){function r(n){return t(n)}function o(t,e){var r=t[1]-t[0],o=r/e,i=eo.bisect(Fi,o);return i==Fi.length?[n.year,me(t.map(function(t){return t/31536e6}),e)[2]]:i?n[o/Fi[i-1]<Fi[i]/o?i-1:i]:[Di,me(t,e)[2]]}return r.invert=function(n){return xe(t.invert(n))},r.domain=function(n){return arguments.length?(t.domain(n),r):t.domain().map(xe)},r.nice=function(t,n){function e(e){return!isNaN(e)&&!t.range(e,xe(+e+1),n).length}var i=r.domain(),a=he(i),u=null==t?o(a,10):"number"==typeof t&&o(a,t);return u&&(t=u[0],n=u[1]),r.domain(se(i,n>1?{floor:function(n){for(;e(n=t.floor(n));)n=xe(n-1);return n},ceil:function(n){for(;e(n=t.ceil(n));)n=xe(+n+1);return n}}:t))},r.ticks=function(t,n){var e=he(r.domain()),i=null==t?o(e,10):"number"==typeof t?o(e,t):!t.range&&[{range:t},n];return i&&(t=i[0],n=i[1]),t.range(e[0],xe(+e[1]+1),1>n?1:n)},r.tickFormat=function(){return e},r.copy=function(){return Me(t.copy(),n,e)},de(r,t)}function xe(t){return new Date(t)}function be(t){return function(n){for(var e=t.length-1,r=t[e];!r[1](n);)r=t[--e];return r[0](n)}}function _e(t){return[Math.atan2(t[1],t[0]),Cn(t[2])]}function ze(t,n){return hi>oo(t[0]-n[0])&&hi>oo(t[1]-n[1])}function Se(t,n,e,r,o){var i=[],a=[];if(t.forEach(function(t){if(!(0>=(n=t.length-1))){var n,e=t[0],r=t[n];if(ze(e,r)){o.lineStart();for(var u=0;n>u;++u)o.point((e=t[u])[0],e[1]);return o.lineEnd(),void 0}var s=new Ee(e,t,null,!0),l=new Ee(e,null,s,!1);s.o=l,i.push(s),a.push(l),s=new Ee(r,t,null,!1),l=new Ee(r,null,s,!0),s.o=l,i.push(s),a.push(l)}}),a.sort(n),Te(i),Te(a),i.length){for(var u=0,s=e,l=a.length;l>u;++u)a[u].e=s=!s;for(var c,h,f=i[0];;){for(var d=f,p=!0;d.v;)if((d=d.n)===f)return;c=d.z,o.lineStart();do{if(d.v=d.o.v=!0,d.e){if(p)for(var u=0,l=c.length;l>u;++u)o.point((h=c[u])[0],h[1]);else r(d.x,d.n.x,1,o);d=d.n}else{if(p){c=d.p.z;for(var u=c.length-1;u>=0;--u)o.point((h=c[u])[0],h[1])}else r(d.x,d.p.x,-1,o);d=d.p}d=d.o,c=d.z,p=!p}while(!d.v);o.lineEnd()}}}function Te(t){if(n=t.length){for(var n,e,r=0,o=t[0];n>++r;)o.n=e=t[r],e.p=o,o=e;o.n=e=t[0],e.p=o}}function Ee(t,n,e,r){this.x=t,this.z=n,this.o=e,this.e=r,this.v=!1,this.n=this.p=null}function Ce(t,n,e,r){return function(o,i){function a(n,e){var r=o(n,e);t(n=r[0],e=r[1])&&i.point(n,e)}function u(t,n){var e=o(t,n);g.point(e[0],e[1])}function s(){y.point=u,g.lineStart()}function l(){y.point=a,g.lineEnd()}function c(t,n){m.push([t,n]);var e=o(t,n);M.point(e[0],e[1])}function h(){M.lineStart(),m=[]}function f(){c(m[0][0],m[0][1]),M.lineEnd();var t,n=M.clean(),e=w.buffer(),r=e.length;if(m.pop(),p.push(m),m=null,r){if(1&n){t=e[0];var o,r=t.length-1,a=-1;for(i.lineStart();r>++a;)i.point((o=t[a])[0],o[1]);return i.lineEnd(),void 0}r>1&&2&n&&e.push(e.pop().concat(e.shift())),d.push(e.filter(Le))}}var d,p,m,g=n(i),v=o.invert(r[0],r[1]),y={point:a,lineStart:s,lineEnd:l,polygonStart:function(){y.point=c,y.lineStart=h,y.lineEnd=f,d=[],p=[],i.polygonStart()},polygonEnd:function(){y.point=a,y.lineStart=s,y.lineEnd=l,d=eo.merge(d);var t=Ue(v,p);d.length?Se(d,Pe,t,e,i):t&&(i.lineStart(),e(null,null,1,i),i.lineEnd()),i.polygonEnd(),d=p=null},sphere:function(){i.polygonStart(),i.lineStart(),e(null,null,1,i),i.lineEnd(),i.polygonEnd()}},w=Ae(),M=n(w);return y}}function Le(t){return t.length>1}function Ae(){var t,n=[];return{lineStart:function(){n.push(t=[])},point:function(n,e){t.push([n,e])},lineEnd:s,buffer:function(){var e=n;return n=[],t=null,e},rejoin:function(){n.length>1&&n.push(n.pop().concat(n.shift()))}}}function Pe(t,n){return(0>(t=t.x)[0]?t[1]-ci-hi:ci-t[1])-(0>(n=n.x)[0]?n[1]-ci-hi:ci-n[1])}function ke(){}function qe(t,n,e){var r=e.s=t+n,o=r-t,i=r-o;e.t=t-i+(n-o)}function He(t,n){t&&Zi.hasOwnProperty(t.type)&&Zi[t.type](t,n)}function Fe(t,n,e){var r,o=-1,i=t.length-e;for(n.lineStart();i>++o;)r=t[o],n.point(r[0],r[1],r[2]);n.lineEnd()}function Ie(t,n){var e=-1,r=t.length;for(n.polygonStart();r>++e;)Fe(t[e],n,1);n.polygonEnd()}function Oe(){function t(t,n){t*=di,n=n*di/2+si/4;var e=t-r,a=Math.cos(n),u=Math.sin(n),s=i*u,l=o*a+s*Math.cos(e),c=s*Math.sin(e);Qi.add(Math.atan2(c,l)),r=t,o=a,i=u}var n,e,r,o,i;Wi.point=function(a,u){Wi.point=t,r=(n=a)*di,o=Math.cos(u=(e=u)*di/2+si/4),i=Math.sin(u)},Wi.lineEnd=function(){t(n,e)}}function Be(t){var n=t[0],e=t[1],r=Math.cos(e);return[r*Math.cos(n),r*Math.sin(n),Math.sin(e)]}function De(t,n){return t[0]*n[0]+t[1]*n[1]+t[2]*n[2]}function je(t,n){return[t[1]*n[2]-t[2]*n[1],t[2]*n[0]-t[0]*n[2],t[0]*n[1]-t[1]*n[0]]}function Ne(t,n){t[0]+=n[0],t[1]+=n[1],t[2]+=n[2]}function Re(t,n){return[t[0]*n,t[1]*n,t[2]*n]}function Ye(t){var n=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]/=n,t[1]/=n,t[2]/=n}function Ue(t,n){var e=t[0],r=t[1],o=[Math.sin(e),-Math.cos(e),0],i=0,a=0;Qi.reset();for(var u=0,s=n.length;s>u;++u){var l=n[u],c=l.length;if(c)for(var h=l[0],f=h[0],d=h[1]/2+si/4,p=Math.sin(d),m=Math.cos(d),g=1;;){g===c&&(g=0),t=l[g];var v=t[0],y=t[1]/2+si/4,w=Math.sin(y),M=Math.cos(y),x=v-f,b=oo(x)>si,_=p*w;if(Qi.add(Math.atan2(_*Math.sin(x),m*M+_*Math.cos(x))),i+=b?x+(x>=0?li:-li):x,b^f>=e^v>=e){var z=je(Be(h),Be(t));Ye(z);var S=je(o,z);Ye(S);var T=(b^x>=0?-1:1)*Cn(S[2]);(r>T||r===T&&(z[0]||z[1]))&&(a+=b^x>=0?1:-1)}if(!g++)break;f=v,p=w,m=M,h=t}}return(-hi>i||hi>i&&0>Qi)^1&a}function Ze(t){var n,e=0/0,r=0/0,o=0/0;return{lineStart:function(){t.lineStart(),n=1},point:function(i,a){var u=i>0?si:-si,s=oo(i-e);hi>oo(s-si)?(t.point(e,r=(r+a)/2>0?ci:-ci),t.point(o,r),t.lineEnd(),t.lineStart(),t.point(u,r),t.point(i,r),n=0):o!==u&&s>=si&&(hi>oo(e-o)&&(e-=o*hi),hi>oo(i-u)&&(i-=u*hi),r=Xe(e,r,i,a),t.point(o,r),t.lineEnd(),t.lineStart(),t.point(u,r),n=0),t.point(e=i,r=a),o=u},lineEnd:function(){t.lineEnd(),e=r=0/0},clean:function(){return 2-n}}}function Xe(t,n,e,r){var o,i,a=Math.sin(t-e);return oo(a)>hi?Math.atan((Math.sin(n)*(i=Math.cos(r))*Math.sin(e)-Math.sin(r)*(o=Math.cos(n))*Math.sin(t))/(o*i*a)):(n+r)/2}function Qe(t,n,e,r){var o;if(null==t)o=e*ci,r.point(-si,o),r.point(0,o),r.point(si,o),r.point(si,0),r.point(si,-o),r.point(0,-o),r.point(-si,-o),r.point(-si,0),r.point(-si,o);else if(oo(t[0]-n[0])>hi){var i=t[0]<n[0]?si:-si;o=e*i/2,r.point(-i,o),r.point(0,o),r.point(i,o)}else r.point(n[0],n[1])}function We(t,n){return[t,n]}function $e(t,n){return[t>si?t-li:-si>t?t+li:t,n]}function Ke(t,n,e){return t?n||e?ir(Ge(t),Je(n,e)):Ge(t):n||e?Je(n,e):$e}function Ve(t){return function(n,e){return n+=t,[n>si?n-li:-si>n?n+li:n,e]}}function Ge(t){var n=Ve(t);return n.invert=Ve(-t),n}function Je(t,n){function e(t,n){var e=Math.cos(n),u=Math.cos(t)*e,s=Math.sin(t)*e,l=Math.sin(n),c=l*r+u*o;return[Math.atan2(s*i-c*a,u*r-l*o),Cn(c*i+s*a)]}var r=Math.cos(t),o=Math.sin(t),i=Math.cos(n),a=Math.sin(n);return e.invert=function(t,n){var e=Math.cos(n),u=Math.cos(t)*e,s=Math.sin(t)*e,l=Math.sin(n),c=l*i-s*a;return[Math.atan2(s*i+l*a,u*r+c*o),Cn(c*r-u*o)]},e}function tr(t,n){var e=Math.cos(t),r=Math.sin(t);return function(o,i,a,u){var s=a*n;null!=o?(o=nr(e,o),i=nr(e,i),(a>0?i>o:o>i)&&(o+=a*li)):(o=t+a*li,i=t-.5*s);for(var l,c=o;a>0?c>i:i>c;c-=s)u.point((l=_e([e,-r*Math.cos(c),-r*Math.sin(c)]))[0],l[1])}}function nr(t,n){var e=Be(n);e[0]-=t,Ye(e);var r=En(-e[1]);return((0>-e[2]?-r:r)+2*Math.PI-hi)%(2*Math.PI)}function er(t){function n(t,n){return Math.cos(t)*Math.cos(n)>i}function e(t){var e,i,s,l,c;return{lineStart:function(){l=s=!1,c=1},point:function(h,f){var d,p=[h,f],m=n(h,f),g=a?m?0:o(h,f):m?o(h+(0>h?si:-si),f):0;if(!e&&(l=s=m)&&t.lineStart(),m!==s&&(d=r(e,p),(ze(e,d)||ze(p,d))&&(p[0]+=hi,p[1]+=hi,m=n(p[0],p[1]))),m!==s)c=0,m?(t.lineStart(),d=r(p,e),t.point(d[0],d[1])):(d=r(e,p),t.point(d[0],d[1]),t.lineEnd()),e=d;else if(u&&e&&a^m){var v;g&i||!(v=r(p,e,!0))||(c=0,a?(t.lineStart(),t.point(v[0][0],v[0][1]),t.point(v[1][0],v[1][1]),t.lineEnd()):(t.point(v[1][0],v[1][1]),t.lineEnd(),t.lineStart(),t.point(v[0][0],v[0][1])))}!m||e&&ze(e,p)||t.point(p[0],p[1]),e=p,s=m,i=g},lineEnd:function(){s&&t.lineEnd(),e=null},clean:function(){return c|(l&&s)<<1}}}function r(t,n,e){var r=Be(t),o=Be(n),a=[1,0,0],u=je(r,o),s=De(u,u),l=u[0],c=s-l*l;if(!c)return!e&&t;var h=i*s/c,f=-i*l/c,d=je(a,u),p=Re(a,h),m=Re(u,f);Ne(p,m);var g=d,v=De(p,g),y=De(g,g),w=v*v-y*(De(p,p)-1);if(!(0>w)){var M=Math.sqrt(w),x=Re(g,(-v-M)/y);if(Ne(x,p),x=_e(x),!e)return x;var b,_=t[0],z=n[0],S=t[1],T=n[1];_>z&&(b=_,_=z,z=b);var E=z-_,C=hi>oo(E-si),L=C||hi>E;if(!C&&S>T&&(b=S,S=T,T=b),L?C?S+T>0^x[1]<(hi>oo(x[0]-_)?S:T):x[1]>=S&&T>=x[1]:E>si^(x[0]>=_&&z>=x[0])){var A=Re(g,(-v+M)/y);return Ne(A,p),[x,_e(A)]}}}function o(n,e){var r=a?t:si-t,o=0;return-r>n?o|=1:n>r&&(o|=2),-r>e?o|=4:e>r&&(o|=8),o}var i=Math.cos(t),a=i>0,u=oo(i)>hi,s=tr(t,6*di);return Ce(n,e,s,a?[0,-t]:[-si,t-si])}function rr(t,n,e,r){return function(o){var i,a=o.a,u=o.b,s=a.x,l=a.y,c=u.x,h=u.y,f=0,d=1,p=c-s,m=h-l;if(i=t-s,p||!(i>0)){if(i/=p,0>p){if(f>i)return;d>i&&(d=i)}else if(p>0){if(i>d)return;i>f&&(f=i)}if(i=e-s,p||!(0>i)){if(i/=p,0>p){if(i>d)return;i>f&&(f=i)}else if(p>0){if(f>i)return;d>i&&(d=i)}if(i=n-l,m||!(i>0)){if(i/=m,0>m){if(f>i)return;d>i&&(d=i)}else if(m>0){if(i>d)return;i>f&&(f=i)}if(i=r-l,m||!(0>i)){if(i/=m,0>m){if(i>d)return;i>f&&(f=i)}else if(m>0){if(f>i)return;d>i&&(d=i)}return f>0&&(o.a={x:s+f*p,y:l+f*m}),1>d&&(o.b={x:s+d*p,y:l+d*m}),o}}}}}}function or(t,n,e,r){function o(r,o){return hi>oo(r[0]-t)?o>0?0:3:hi>oo(r[0]-e)?o>0?2:1:hi>oo(r[1]-n)?o>0?1:0:o>0?3:2}function i(t,n){return a(t.x,n.x)}function a(t,n){var e=o(t,1),r=o(n,1);return e!==r?e-r:0===e?n[1]-t[1]:1===e?t[0]-n[0]:2===e?t[1]-n[1]:n[0]-t[0]}return function(u){function s(t){for(var n=0,e=v.length,r=t[1],o=0;e>o;++o)for(var i,a=1,u=v[o],s=u.length,c=u[0];s>a;++a)i=u[a],r>=c[1]?i[1]>r&&l(c,i,t)>0&&++n:r>=i[1]&&0>l(c,i,t)&&--n,c=i;return 0!==n}function l(t,n,e){return(n[0]-t[0])*(e[1]-t[1])-(e[0]-t[0])*(n[1]-t[1])}function c(i,u,s,l){var c=0,h=0;if(null==i||(c=o(i,s))!==(h=o(u,s))||0>a(i,u)^s>0){do l.point(0===c||3===c?t:e,c>1?r:n);while((c=(c+s+4)%4)!==h)}else l.point(u[0],u[1])}function h(o,i){return o>=t&&e>=o&&i>=n&&r>=i}function f(t,n){h(t,n)&&u.point(t,n)}function d(){A.point=m,v&&v.push(y=[]),S=!0,z=!1,b=_=0/0}function p(){g&&(m(w,M),x&&z&&C.rejoin(),g.push(C.buffer())),A.point=f,z&&u.lineEnd()}function m(t,n){t=Math.max(-Ki,Math.min(Ki,t)),n=Math.max(-Ki,Math.min(Ki,n));var e=h(t,n);if(v&&y.push([t,n]),S)w=t,M=n,x=e,S=!1,e&&(u.lineStart(),u.point(t,n));else if(e&&z)u.point(t,n);else{var r={a:{x:b,y:_},b:{x:t,y:n}};L(r)?(z||(u.lineStart(),u.point(r.a.x,r.a.y)),u.point(r.b.x,r.b.y),e||u.lineEnd(),T=!1):e&&(u.lineStart(),u.point(t,n),T=!1)}b=t,_=n,z=e}var g,v,y,w,M,x,b,_,z,S,T,E=u,C=Ae(),L=rr(t,n,e,r),A={point:f,lineStart:d,lineEnd:p,polygonStart:function(){u=C,g=[],v=[],T=!0},polygonEnd:function(){u=E,g=eo.merge(g);var n=s([t,r]),e=T&&n,o=g.length;(e||o)&&(u.polygonStart(),e&&(u.lineStart(),c(null,null,1,u),u.lineEnd()),o&&Se(g,i,n,c,u),u.polygonEnd()),g=v=y=null}};return A}}function ir(t,n){function e(e,r){return e=t(e,r),n(e[0],e[1])}return t.invert&&n.invert&&(e.invert=function(e,r){return e=n.invert(e,r),e&&t.invert(e[0],e[1])}),e}function ar(t){function n(t){return(u?r:e)(t)}function e(n){return sr(n,function(e,r){e=t(e,r),n.point(e[0],e[1])})}function r(n){function e(e,r){e=t(e,r),n.point(e[0],e[1])}function r(){w=0/0,z.point=i,n.lineStart()}function i(e,r){var i=Be([e,r]),a=t(e,r);o(w,M,y,x,b,_,w=a[0],M=a[1],y=e,x=i[0],b=i[1],_=i[2],u,n),n.point(w,M)}function a(){z.point=e,n.lineEnd()}function s(){r(),z.point=l,z.lineEnd=c}function l(t,n){i(h=t,f=n),d=w,p=M,m=x,g=b,v=_,z.point=i}function c(){o(w,M,y,x,b,_,d,p,h,m,g,v,u,n),z.lineEnd=a,a()}var h,f,d,p,m,g,v,y,w,M,x,b,_,z={point:e,lineStart:r,lineEnd:a,polygonStart:function(){n.polygonStart(),z.lineStart=s},polygonEnd:function(){n.polygonEnd(),z.lineStart=r}};return z}function o(n,e,r,u,s,l,c,h,f,d,p,m,g,v){var y=c-n,w=h-e,M=y*y+w*w;if(M>4*i&&g--){var x=u+d,b=s+p,_=l+m,z=Math.sqrt(x*x+b*b+_*_),S=Math.asin(_/=z),T=hi>oo(oo(_)-1)||hi>oo(r-f)?(r+f)/2:Math.atan2(b,x),E=t(T,S),C=E[0],L=E[1],A=C-n,P=L-e,k=w*A-y*P;(k*k/M>i||oo((y*A+w*P)/M-.5)>.3||a>u*d+s*p+l*m)&&(o(n,e,r,u,s,l,C,L,T,x/=z,b/=z,_,g,v),v.point(C,L),o(C,L,T,x,b,_,c,h,f,d,p,m,g,v))}}var i=.5,a=Math.cos(30*di),u=16;return n.precision=function(t){return arguments.length?(u=(i=t*t)>0&&16,n):Math.sqrt(i)},n}function ur(t){this.stream=t}function sr(t,n){return{point:n,sphere:function(){t.sphere()},lineStart:function(){t.lineStart()},lineEnd:function(){t.lineEnd()},polygonStart:function(){t.polygonStart()},polygonEnd:function(){t.polygonEnd()}}}function lr(t){return cr(function(){return t})()}function cr(t){function n(t){return t=u(t[0]*di,t[1]*di),[t[0]*f+s,l-t[1]*f]}function e(t){return t=u.invert((t[0]-s)/f,(l-t[1])/f),t&&[t[0]*pi,t[1]*pi]}function r(){u=ir(a=Ke(v,y,w),i);var t=i(m,g);return s=d-t[0]*f,l=p+t[1]*f,o()}function o(){return c&&(c.valid=!1,c=null),n}var i,a,u,s,l,c,h=ar(function(t,n){return t=i(t,n),[t[0]*f+s,l-t[1]*f]}),f=150,d=480,p=250,m=0,g=0,v=0,y=0,w=0,M=$i,x=re,b=null,_=null;return n.stream=function(t){return c&&(c.valid=!1),c=hr(M(a,h(x(t)))),c.valid=!0,c},n.clipAngle=function(t){return arguments.length?(M=null==t?(b=t,$i):er((b=+t)*di),o()):b},n.clipExtent=function(t){return arguments.length?(_=t,x=t?or(t[0][0],t[0][1],t[1][0],t[1][1]):re,o()):_},n.scale=function(t){return arguments.length?(f=+t,r()):f},n.translate=function(t){return arguments.length?(d=+t[0],p=+t[1],r()):[d,p]},n.center=function(t){return arguments.length?(m=t[0]%360*di,g=t[1]%360*di,r()):[m*pi,g*pi]},n.rotate=function(t){return arguments.length?(v=t[0]%360*di,y=t[1]%360*di,w=t.length>2?t[2]%360*di:0,r()):[v*pi,y*pi,w*pi]},eo.rebind(n,h,"precision"),function(){return i=t.apply(this,arguments),n.invert=i.invert&&e,r()}}function hr(t){return sr(t,function(n,e){t.point(n*di,e*di)})}function fr(t){var n=0,e=si/3,r=cr(t),o=r(n,e);return o.parallels=function(t){return arguments.length?r(n=t[0]*si/180,e=t[1]*si/180):[180*(n/si),180*(e/si)]},o}function dr(t,n){function e(t,n){var e=Math.sqrt(i-2*o*Math.sin(n))/o;return[e*Math.sin(t*=o),a-e*Math.cos(t)]}var r=Math.sin(t),o=(r+Math.sin(n))/2,i=1+r*(2*o-r),a=Math.sqrt(i)/o;return e.invert=function(t,n){var e=a-n;return[Math.atan2(t,e)/o,Cn((i-(t*t+e*e)*o*o)/(2*o))]},e}function pr(t,n){t*=di;var e=Math.cos(n*=di);mr(e*Math.cos(t),e*Math.sin(t),Math.sin(n))}function mr(t,n,e){++Vi,Ji+=(t-Ji)/Vi,ta+=(n-ta)/Vi,na+=(e-na)/Vi}function gr(){function t(t,o){t*=di;var i=Math.cos(o*=di),a=i*Math.cos(t),u=i*Math.sin(t),s=Math.sin(o),l=Math.atan2(Math.sqrt((l=e*s-r*u)*l+(l=r*a-n*s)*l+(l=n*u-e*a)*l),n*a+e*u+r*s);Gi+=l,ea+=l*(n+(n=a)),ra+=l*(e+(e=u)),oa+=l*(r+(r=s)),mr(n,e,r)}var n,e,r;pa.point=function(o,i){o*=di;var a=Math.cos(i*=di);n=a*Math.cos(o),e=a*Math.sin(o),r=Math.sin(i),pa.point=t,mr(n,e,r)}}function vr(){pa.point=pr}function yr(){function t(t,n){t*=di;var e=Math.cos(n*=di),a=e*Math.cos(t),u=e*Math.sin(t),s=Math.sin(n),l=o*s-i*u,c=i*a-r*s,h=r*u-o*a,f=Math.sqrt(l*l+c*c+h*h),d=r*a+o*u+i*s,p=f&&-En(d)/f,m=Math.atan2(f,d);ia+=p*l,aa+=p*c,ua+=p*h,Gi+=m,ea+=m*(r+(r=a)),ra+=m*(o+(o=u)),oa+=m*(i+(i=s)),mr(r,o,i)}var n,e,r,o,i;pa.point=function(a,u){n=a,e=u,pa.point=t,a*=di;var s=Math.cos(u*=di);r=s*Math.cos(a),o=s*Math.sin(a),i=Math.sin(u),mr(r,o,i)},pa.lineEnd=function(){t(n,e),pa.lineEnd=vr,pa.point=pr
}}function wr(){function t(t,n){la+=o*t-r*n,r=t,o=n}var n,e,r,o;ma.point=function(i,a){ma.point=t,n=r=i,e=o=a},ma.lineEnd=function(){t(n,e)}}function Mr(t,n){ca>t&&(ca=t),t>fa&&(fa=t),ha>n&&(ha=n),n>da&&(da=n)}function xr(){function t(t,n){a.push("M",t,",",n,i)}function n(t,n){a.push("M",t,",",n),u.point=e}function e(t,n){a.push("L",t,",",n)}function r(){u.point=t}function o(){a.push("Z")}var i=br(4.5),a=[],u={point:t,lineStart:function(){u.point=n},lineEnd:r,polygonStart:function(){u.lineEnd=o},polygonEnd:function(){u.lineEnd=r,u.point=t},pointRadius:function(t){return i=br(t),u},result:function(){if(a.length){var t=a.join("");return a=[],t}}};return u}function br(t){return"m0,"+t+"a"+t+","+t+" 0 1,1 0,"+-2*t+"a"+t+","+t+" 0 1,1 0,"+2*t+"z"}function _r(t,n){Ji+=t,ta+=n,++na}function zr(){function t(t,r){var o=t-n,i=r-e,a=Math.sqrt(o*o+i*i);ea+=a*(n+t)/2,ra+=a*(e+r)/2,oa+=a,_r(n=t,e=r)}var n,e;va.point=function(r,o){va.point=t,_r(n=r,e=o)}}function Sr(){va.point=_r}function Tr(){function t(t,n){var e=t-r,i=n-o,a=Math.sqrt(e*e+i*i);ea+=a*(r+t)/2,ra+=a*(o+n)/2,oa+=a,a=o*t-r*n,ia+=a*(r+t),aa+=a*(o+n),ua+=3*a,_r(r=t,o=n)}var n,e,r,o;va.point=function(i,a){va.point=t,_r(n=r=i,e=o=a)},va.lineEnd=function(){t(n,e)}}function Er(t){function n(n,e){t.moveTo(n,e),t.arc(n,e,a,0,li)}function e(n,e){t.moveTo(n,e),u.point=r}function r(n,e){t.lineTo(n,e)}function o(){u.point=n}function i(){t.closePath()}var a=4.5,u={point:n,lineStart:function(){u.point=e},lineEnd:o,polygonStart:function(){u.lineEnd=i},polygonEnd:function(){u.lineEnd=o,u.point=n},pointRadius:function(t){return a=t,u},result:s};return u}function Cr(t){var n=ar(function(n,e){return t([n*pi,e*pi])});return function(t){return hr(n(t))}}function Lr(t){return function(n){return 0>=n?0:n>=1?1:t(n)}}function Ar(t){return function(n){return 1-t(1-n)}}function Pr(t){return function(n){return.5*(.5>n?t(2*n):2-t(2-2*n))}}function kr(t){return t*t}function qr(t){return t*t*t}function Hr(t){if(0>=t)return 0;if(t>=1)return 1;var n=t*t,e=n*t;return 4*(.5>t?e:3*(t-n)+e-.75)}function Fr(t){return function(n){return Math.pow(n,t)}}function Ir(t){return 1-Math.cos(t*ci)}function Or(t){return Math.pow(2,10*(t-1))}function Br(t){return 1-Math.sqrt(1-t*t)}function Dr(t,n){var e;return 2>arguments.length&&(n=.45),arguments.length?e=n/li*Math.asin(1/t):(t=1,e=n/4),function(r){return 1+t*Math.pow(2,-10*r)*Math.sin((r-e)*li/n)}}function jr(t){return t||(t=1.70158),function(n){return n*n*((t+1)*n-t)}}function Nr(t){return 1/2.75>t?7.5625*t*t:2/2.75>t?7.5625*(t-=1.5/2.75)*t+.75:2.5/2.75>t?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375}function Rr(t,n){return go(t,_a),t.id=n,t}function Yr(t){var n=[t.a,t.b],e=[t.c,t.d],r=Zr(n),o=Ur(n,e),i=Zr(Xr(e,n,-o))||0;n[0]*e[1]<e[0]*n[1]&&(n[0]*=-1,n[1]*=-1,r*=-1,o*=-1),this.rotate=(r?Math.atan2(n[1],n[0]):Math.atan2(-e[0],e[1]))*pi,this.translate=[t.e,t.f],this.scale=[r,i],this.skew=i?Math.atan2(o,i)*pi:0}function Ur(t,n){return t[0]*n[0]+t[1]*n[1]}function Zr(t){var n=Math.sqrt(Ur(t,t));return n&&(t[0]/=n,t[1]/=n),n}function Xr(t,n,e){return t[0]+=e*n[0],t[1]+=e*n[1],t}function Qr(t,n){var e,r=[],o=[],i=eo.transform(t),a=eo.transform(n),u=i.translate,s=a.translate,l=i.rotate,c=a.rotate,h=i.skew,f=a.skew,d=i.scale,p=a.scale;return u[0]!=s[0]||u[1]!=s[1]?(r.push("translate(",null,",",null,")"),o.push({i:1,x:Vn(u[0],s[0])},{i:3,x:Vn(u[1],s[1])})):s[0]||s[1]?r.push("translate("+s+")"):r.push(""),l!=c?(l-c>180?c+=360:c-l>180&&(l+=360),o.push({i:r.push(r.pop()+"rotate(",null,")")-2,x:Vn(l,c)})):c&&r.push(r.pop()+"rotate("+c+")"),h!=f?o.push({i:r.push(r.pop()+"skewX(",null,")")-2,x:Vn(h,f)}):f&&r.push(r.pop()+"skewX("+f+")"),d[0]!=p[0]||d[1]!=p[1]?(e=r.push(r.pop()+"scale(",null,",",null,")"),o.push({i:e-4,x:Vn(d[0],p[0])},{i:e-2,x:Vn(d[1],p[1])})):(1!=p[0]||1!=p[1])&&r.push(r.pop()+"scale("+p+")"),e=o.length,function(t){for(var n,i=-1;e>++i;)r[(n=o[i]).i]=n.x(t);return r.join("")}}function Wr(t,n,e,r){var o=t.id;return C(t,"function"==typeof e?function(t,i,a){t.__transition__[o].tween.set(n,r(e.call(t,t.__data__,i,a)))}:(e=r(e),function(t){t.__transition__[o].tween.set(n,e)}))}function $r(t){return null==t&&(t=""),function(){this.textContent=t}}function Kr(t,n,e,r){var i=t.__transition__||(t.__transition__={active:0,count:0}),a=i[e];if(!a){var u=r.time;a=i[e]={tween:new o,time:u,ease:r.ease,delay:r.delay,duration:r.duration},++i.count,eo.timer(function(r){function o(r){return i.active>e?l():(i.active=e,a.event&&a.event.start.call(t,c,n),a.tween.forEach(function(e,r){(r=r.call(t,c,n))&&m.push(r)}),eo.timer(function(){return p.c=s(r||1)?bn:s,1},0,u),void 0)}function s(r){if(i.active!==e)return l();for(var o=r/d,u=h(o),s=m.length;s>0;)m[--s].call(t,u);return o>=1?(a.event&&a.event.end.call(t,c,n),l()):void 0}function l(){return--i.count?delete i[e]:delete t.__transition__,1}var c=t.__data__,h=a.ease,f=a.delay,d=a.duration,p=qo,m=[];return p.t=f+u,r>=f?o(r-f):(p.c=o,void 0)},0,u)}}function Vr(t){return function(n,e,r){return 2===arguments.length&&"function"==typeof e&&(r=e,e=null),Gr(n,e,t,r)}}function Gr(t,n,e,r){function o(){var t,n=s.status;if(!n&&s.responseText||n>=200&&300>n||304===n){try{t=e.call(i,s)}catch(r){return a.error.call(i,r),void 0}a.load.call(i,t)}else a.error.call(i,s)}var i={},a=eo.dispatch("beforesend","progress","load","error"),u={},s=new XMLHttpRequest,l=null;return!ho.XDomainRequest||"withCredentials"in s||!/^(http(s)?:)?\/\//.test(t)||(s=new XDomainRequest),"onload"in s?s.onload=s.onerror=o:s.onreadystatechange=function(){s.readyState>3&&o()},s.onprogress=function(t){var n=eo.event;eo.event=t;try{a.progress.call(i,s)}finally{eo.event=n}},i.header=function(t,n){return t=(t+"").toLowerCase(),2>arguments.length?u[t]:(null==n?delete u[t]:u[t]=n+"",i)},i.mimeType=function(t){return arguments.length?(n=null==t?null:t+"",i):n},i.responseType=function(t){return arguments.length?(l=t,i):l},i.response=function(t){return e=t,i},["get","post"].forEach(function(t){i[t]=function(){return i.send.apply(i,[t].concat(so(arguments)))}}),i.send=function(e,r,o){if(2===arguments.length&&"function"==typeof r&&(o=r,r=null),s.open(e,t,!0),null==n||"accept"in u||(u.accept=n+",*/*"),s.setRequestHeader)for(var c in u)s.setRequestHeader(c,u[c]);return null!=n&&s.overrideMimeType&&s.overrideMimeType(n),null!=l&&(s.responseType=l),null!=o&&i.on("error",o).on("load",function(t){o(null,t)}),a.beforesend.call(i,s),s.send(null==r?null:r),i},i.abort=function(){return s.abort(),i},eo.rebind(i,a,"on"),null==r?i:i.get(Jr(r))}function Jr(t){return 1===t.length?function(n,e){t(null==n?e:null)}:t}function to(t){return JSON.parse(t.responseText)}function no(t){var n=lo.createRange();return n.selectNode(lo.body),n.createContextualFragment(t.responseText)}var eo={version:"3.3.10"};eo.ascending=function(t,n){return n>t?-1:t>n?1:t>=n?0:0/0},eo.descending=function(t,n){return t>n?-1:n>t?1:n>=t?0:0/0},eo.min=function(t,n){var e,r,o=-1,i=t.length;if(1===arguments.length){for(;i>++o&&!(null!=(e=t[o])&&e>=e);)e=void 0;for(;i>++o;)null!=(r=t[o])&&e>r&&(e=r)}else{for(;i>++o&&!(null!=(e=n.call(t,t[o],o))&&e>=e);)e=void 0;for(;i>++o;)null!=(r=n.call(t,t[o],o))&&e>r&&(e=r)}return e},eo.max=function(t,n){var e,r,o=-1,i=t.length;if(1===arguments.length){for(;i>++o&&!(null!=(e=t[o])&&e>=e);)e=void 0;for(;i>++o;)null!=(r=t[o])&&r>e&&(e=r)}else{for(;i>++o&&!(null!=(e=n.call(t,t[o],o))&&e>=e);)e=void 0;for(;i>++o;)null!=(r=n.call(t,t[o],o))&&r>e&&(e=r)}return e},eo.extent=function(t,n){var e,r,o,i=-1,a=t.length;if(1===arguments.length){for(;a>++i&&!(null!=(e=o=t[i])&&e>=e);)e=o=void 0;for(;a>++i;)null!=(r=t[i])&&(e>r&&(e=r),r>o&&(o=r))}else{for(;a>++i&&!(null!=(e=o=n.call(t,t[i],i))&&e>=e);)e=void 0;for(;a>++i;)null!=(r=n.call(t,t[i],i))&&(e>r&&(e=r),r>o&&(o=r))}return[e,o]},eo.sum=function(t,n){var e,r=0,o=t.length,i=-1;if(1===arguments.length)for(;o>++i;)isNaN(e=+t[i])||(r+=e);else for(;o>++i;)isNaN(e=+n.call(t,t[i],i))||(r+=e);return r},eo.mean=function(n,e){var r,o=n.length,i=0,a=-1,u=0;if(1===arguments.length)for(;o>++a;)t(r=n[a])&&(i+=(r-i)/++u);else for(;o>++a;)t(r=e.call(n,n[a],a))&&(i+=(r-i)/++u);return u?i:void 0},eo.quantile=function(t,n){var e=(t.length-1)*n+1,r=Math.floor(e),o=+t[r-1],i=e-r;return i?o+i*(t[r]-o):o},eo.median=function(n,e){return arguments.length>1&&(n=n.map(e)),n=n.filter(t),n.length?eo.quantile(n.sort(eo.ascending),.5):void 0},eo.bisector=function(t){return{left:function(n,e,r,o){for(3>arguments.length&&(r=0),4>arguments.length&&(o=n.length);o>r;){var i=r+o>>>1;e>t.call(n,n[i],i)?r=i+1:o=i}return r},right:function(n,e,r,o){for(3>arguments.length&&(r=0),4>arguments.length&&(o=n.length);o>r;){var i=r+o>>>1;t.call(n,n[i],i)>e?o=i:r=i+1}return r}}};var ro=eo.bisector(function(t){return t});eo.bisectLeft=ro.left,eo.bisect=eo.bisectRight=ro.right,eo.shuffle=function(t){for(var n,e,r=t.length;r;)e=0|Math.random()*r--,n=t[r],t[r]=t[e],t[e]=n;return t},eo.permute=function(t,n){for(var e=n.length,r=Array(e);e--;)r[e]=t[n[e]];return r},eo.pairs=function(t){for(var n,e=0,r=t.length-1,o=t[0],i=Array(0>r?0:r);r>e;)i[e]=[n=o,o=t[++e]];return i},eo.zip=function(){if(!(o=arguments.length))return[];for(var t=-1,e=eo.min(arguments,n),r=Array(e);e>++t;)for(var o,i=-1,a=r[t]=Array(o);o>++i;)a[i]=arguments[i][t];return r},eo.transpose=function(t){return eo.zip.apply(eo,t)},eo.keys=function(t){var n=[];for(var e in t)n.push(e);return n},eo.values=function(t){var n=[];for(var e in t)n.push(t[e]);return n},eo.entries=function(t){var n=[];for(var e in t)n.push({key:e,value:t[e]});return n},eo.merge=function(t){for(var n,e,r,o=t.length,i=-1,a=0;o>++i;)a+=t[i].length;for(e=Array(a);--o>=0;)for(r=t[o],n=r.length;--n>=0;)e[--a]=r[n];return e};var oo=Math.abs;eo.range=function(t,n,r){if(3>arguments.length&&(r=1,2>arguments.length&&(n=t,t=0)),1/0===(n-t)/r)throw Error("infinite range");var o,i=[],a=e(oo(r)),u=-1;if(t*=a,n*=a,r*=a,0>r)for(;(o=t+r*++u)>n;)i.push(o/a);else for(;n>(o=t+r*++u);)i.push(o/a);return i},eo.map=function(t){var n=new o;if(t instanceof o)t.forEach(function(t,e){n.set(t,e)});else for(var e in t)n.set(e,t[e]);return n},r(o,{has:function(t){return io+t in this},get:function(t){return this[io+t]},set:function(t,n){return this[io+t]=n},remove:function(t){return t=io+t,t in this&&delete this[t]},keys:function(){var t=[];return this.forEach(function(n){t.push(n)}),t},values:function(){var t=[];return this.forEach(function(n,e){t.push(e)}),t},entries:function(){var t=[];return this.forEach(function(n,e){t.push({key:n,value:e})}),t},forEach:function(t){for(var n in this)n.charCodeAt(0)===ao&&t.call(this,n.substring(1),this[n])}});var io="\0",ao=io.charCodeAt(0);eo.nest=function(){function t(n,u,s){if(s>=a.length)return r?r.call(i,u):e?u.sort(e):u;for(var l,c,h,f,d=-1,p=u.length,m=a[s++],g=new o;p>++d;)(f=g.get(l=m(c=u[d])))?f.push(c):g.set(l,[c]);return n?(c=n(),h=function(e,r){c.set(e,t(n,r,s))}):(c={},h=function(e,r){c[e]=t(n,r,s)}),g.forEach(h),c}function n(t,e){if(e>=a.length)return t;var r=[],o=u[e++];return t.forEach(function(t,o){r.push({key:t,values:n(o,e)})}),o?r.sort(function(t,n){return o(t.key,n.key)}):r}var e,r,i={},a=[],u=[];return i.map=function(n,e){return t(e,n,0)},i.entries=function(e){return n(t(eo.map,e,0),0)},i.key=function(t){return a.push(t),i},i.sortKeys=function(t){return u[a.length-1]=t,i},i.sortValues=function(t){return e=t,i},i.rollup=function(t){return r=t,i},i},eo.set=function(t){var n=new i;if(t)for(var e=0,r=t.length;r>e;++e)n.add(t[e]);return n},r(i,{has:function(t){return io+t in this},add:function(t){return this[io+t]=!0,t},remove:function(t){return t=io+t,t in this&&delete this[t]},values:function(){var t=[];return this.forEach(function(n){t.push(n)}),t},forEach:function(t){for(var n in this)n.charCodeAt(0)===ao&&t.call(this,n.substring(1))}}),eo.behavior={};var uo=[].slice,so=function(t){return uo.call(t)},lo=document,co=lo.documentElement,ho=window;try{so(co.childNodes)[0].nodeType}catch(fo){so=function(t){for(var n=t.length,e=Array(n);n--;)e[n]=t[n];return e}}eo.rebind=function(t,n){for(var e,r=1,o=arguments.length;o>++r;)t[e=arguments[r]]=a(t,n,n[e]);return t};var po=["webkit","ms","moz","Moz","o","O"];eo.dispatch=function(){for(var t=new l,n=-1,e=arguments.length;e>++n;)t[arguments[n]]=c(t);return t},l.prototype.on=function(t,n){var e=t.indexOf("."),r="";if(e>=0&&(r=t.substring(e+1),t=t.substring(0,e)),t)return 2>arguments.length?this[t].on(r):this[t].on(r,n);if(2===arguments.length){if(null==n)for(t in this)this.hasOwnProperty(t)&&this[t].on(r,null);return this}},eo.event=null,eo.requote=function(t){return t.replace(mo,"\\$&")};var mo=/[\\\^\$\*\+\?\|\[\]\(\)\.\{\}]/g,go={}.__proto__?function(t,n){t.__proto__=n}:function(t,n){for(var e in n)t[e]=n[e]},vo=function(t,n){return n.querySelector(t)},yo=function(t,n){return n.querySelectorAll(t)},wo=co[u(co,"matchesSelector")],Mo=function(t,n){return wo.call(t,n)};"function"==typeof Sizzle&&(vo=function(t,n){return Sizzle(t,n)[0]||null},yo=function(t,n){return Sizzle.uniqueSort(Sizzle(t,n))},Mo=Sizzle.matchesSelector),eo.selection=function(){return zo};var xo=eo.selection.prototype=[];xo.select=function(t){var n,e,r,o,i=[];t=m(t);for(var a=-1,u=this.length;u>++a;){i.push(n=[]),n.parentNode=(r=this[a]).parentNode;for(var s=-1,l=r.length;l>++s;)(o=r[s])?(n.push(e=t.call(o,o.__data__,s,a)),e&&"__data__"in o&&(e.__data__=o.__data__)):n.push(null)}return p(i)},xo.selectAll=function(t){var n,e,r=[];t=g(t);for(var o=-1,i=this.length;i>++o;)for(var a=this[o],u=-1,s=a.length;s>++u;)(e=a[u])&&(r.push(n=so(t.call(e,e.__data__,u,o))),n.parentNode=e);return p(r)};var bo={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};eo.ns={prefix:bo,qualify:function(t){var n=t.indexOf(":"),e=t;return n>=0&&(e=t.substring(0,n),t=t.substring(n+1)),bo.hasOwnProperty(e)?{space:bo[e],local:t}:t}},xo.attr=function(t,n){if(2>arguments.length){if("string"==typeof t){var e=this.node();return t=eo.ns.qualify(t),t.local?e.getAttributeNS(t.space,t.local):e.getAttribute(t)}for(n in t)this.each(v(n,t[n]));return this}return this.each(v(t,n))},xo.classed=function(t,n){if(2>arguments.length){if("string"==typeof t){var e=this.node(),r=(t=t.trim().split(/^|\s+/g)).length,o=-1;if(n=e.classList){for(;r>++o;)if(!n.contains(t[o]))return!1}else for(n=e.getAttribute("class");r>++o;)if(!w(t[o]).test(n))return!1;return!0}for(n in t)this.each(M(n,t[n]));return this}return this.each(M(t,n))},xo.style=function(t,n,e){var r=arguments.length;if(3>r){if("string"!=typeof t){2>r&&(n="");for(e in t)this.each(b(e,t[e],n));return this}if(2>r)return ho.getComputedStyle(this.node(),null).getPropertyValue(t);e=""}return this.each(b(t,n,e))},xo.property=function(t,n){if(2>arguments.length){if("string"==typeof t)return this.node()[t];for(n in t)this.each(_(n,t[n]));return this}return this.each(_(t,n))},xo.text=function(t){return arguments.length?this.each("function"==typeof t?function(){var n=t.apply(this,arguments);this.textContent=null==n?"":n}:null==t?function(){this.textContent=""}:function(){this.textContent=t}):this.node().textContent},xo.html=function(t){return arguments.length?this.each("function"==typeof t?function(){var n=t.apply(this,arguments);this.innerHTML=null==n?"":n}:null==t?function(){this.innerHTML=""}:function(){this.innerHTML=t}):this.node().innerHTML},xo.append=function(t){return t=z(t),this.select(function(){return this.appendChild(t.apply(this,arguments))})},xo.insert=function(t,n){return t=z(t),n=m(n),this.select(function(){return this.insertBefore(t.apply(this,arguments),n.apply(this,arguments)||null)})},xo.remove=function(){return this.each(function(){var t=this.parentNode;t&&t.removeChild(this)})},xo.data=function(t,n){function e(t,e){var r,i,a,u=t.length,h=e.length,f=Math.min(u,h),d=Array(h),p=Array(h),m=Array(u);if(n){var g,v=new o,y=new o,w=[];for(r=-1;u>++r;)g=n.call(i=t[r],i.__data__,r),v.has(g)?m[r]=i:v.set(g,i),w.push(g);for(r=-1;h>++r;)g=n.call(e,a=e[r],r),(i=v.get(g))?(d[r]=i,i.__data__=a):y.has(g)||(p[r]=S(a)),y.set(g,a),v.remove(g);for(r=-1;u>++r;)v.has(w[r])&&(m[r]=t[r])}else{for(r=-1;f>++r;)i=t[r],a=e[r],i?(i.__data__=a,d[r]=i):p[r]=S(a);for(;h>r;++r)p[r]=S(e[r]);for(;u>r;++r)m[r]=t[r]}p.update=d,p.parentNode=d.parentNode=m.parentNode=t.parentNode,s.push(p),l.push(d),c.push(m)}var r,i,a=-1,u=this.length;if(!arguments.length){for(t=Array(u=(r=this[0]).length);u>++a;)(i=r[a])&&(t[a]=i.__data__);return t}var s=L([]),l=p([]),c=p([]);if("function"==typeof t)for(;u>++a;)e(r=this[a],t.call(r,r.parentNode.__data__,a));else for(;u>++a;)e(r=this[a],t);return l.enter=function(){return s},l.exit=function(){return c},l},xo.datum=function(t){return arguments.length?this.property("__data__",t):this.property("__data__")},xo.filter=function(t){var n,e,r,o=[];"function"!=typeof t&&(t=T(t));for(var i=0,a=this.length;a>i;i++){o.push(n=[]),n.parentNode=(e=this[i]).parentNode;for(var u=0,s=e.length;s>u;u++)(r=e[u])&&t.call(r,r.__data__,u,i)&&n.push(r)}return p(o)},xo.order=function(){for(var t=-1,n=this.length;n>++t;)for(var e,r=this[t],o=r.length-1,i=r[o];--o>=0;)(e=r[o])&&(i&&i!==e.nextSibling&&i.parentNode.insertBefore(e,i),i=e);return this},xo.sort=function(t){t=E.apply(this,arguments);for(var n=-1,e=this.length;e>++n;)this[n].sort(t);return this.order()},xo.each=function(t){return C(this,function(n,e,r){t.call(n,n.__data__,e,r)})},xo.call=function(t){var n=so(arguments);return t.apply(n[0]=this,n),this},xo.empty=function(){return!this.node()},xo.node=function(){for(var t=0,n=this.length;n>t;t++)for(var e=this[t],r=0,o=e.length;o>r;r++){var i=e[r];if(i)return i}return null},xo.size=function(){var t=0;return this.each(function(){++t}),t};var _o=[];eo.selection.enter=L,eo.selection.enter.prototype=_o,_o.append=xo.append,_o.empty=xo.empty,_o.node=xo.node,_o.call=xo.call,_o.size=xo.size,_o.select=function(t){for(var n,e,r,o,i,a=[],u=-1,s=this.length;s>++u;){r=(o=this[u]).update,a.push(n=[]),n.parentNode=o.parentNode;for(var l=-1,c=o.length;c>++l;)(i=o[l])?(n.push(r[l]=e=t.call(o.parentNode,i.__data__,l,u)),e.__data__=i.__data__):n.push(null)}return p(a)},_o.insert=function(t,n){return 2>arguments.length&&(n=A(this)),xo.insert.call(this,t,n)},xo.transition=function(){for(var t,n,e=xa||++za,r=[],o=ba||{time:Date.now(),ease:Hr,delay:0,duration:250},i=-1,a=this.length;a>++i;){r.push(t=[]);for(var u=this[i],s=-1,l=u.length;l>++s;)(n=u[s])&&Kr(n,s,e,o),t.push(n)}return Rr(r,e)},xo.interrupt=function(){return this.each(P)},eo.select=function(t){var n=["string"==typeof t?vo(t,lo):t];return n.parentNode=co,p([n])},eo.selectAll=function(t){var n=so("string"==typeof t?yo(t,lo):t);return n.parentNode=co,p([n])};var zo=eo.select(co);xo.on=function(t,n,e){var r=arguments.length;if(3>r){if("string"!=typeof t){2>r&&(n=!1);for(e in t)this.each(k(e,t[e],n));return this}if(2>r)return(r=this.node()["__on"+t])&&r._;e=!1}return this.each(k(t,n,e))};var So=eo.map({mouseenter:"mouseover",mouseleave:"mouseout"});So.forEach(function(t){"on"+t in lo&&So.remove(t)});var To="onselectstart"in lo?null:u(co.style,"userSelect"),Eo=0;eo.mouse=function(t){return I(t,f())};var Co=/WebKit/.test(ho.navigator.userAgent)?-1:0;eo.touches=function(t,n){return 2>arguments.length&&(n=f().touches),n?so(n).map(function(n){var e=I(t,n);return e.identifier=n.identifier,e}):[]},eo.behavior.drag=function(){function t(){this.on("mousedown.drag",a).on("touchstart.drag",u)}function n(){return eo.event.changedTouches[0].identifier}function e(t,n){return eo.touches(t).filter(function(t){return t.identifier===n})[0]}function r(t,n,e,r){return function(){function a(){var t=n(c,d),e=t[0]-m[0],r=t[1]-m[1];g|=e|r,m=t,h({type:"drag",x:t[0]+s[0],y:t[1]+s[1],dx:e,dy:r})}function u(){v.on(e+"."+p,null).on(r+"."+p,null),y(g&&eo.event.target===f),h({type:"dragend"})}var s,l=this,c=l.parentNode,h=o.of(l,arguments),f=eo.event.target,d=t(),p=null==d?"drag":"drag-"+d,m=n(c,d),g=0,v=eo.select(ho).on(e+"."+p,a).on(r+"."+p,u),y=F();i?(s=i.apply(l,arguments),s=[s.x-m[0],s.y-m[1]]):s=[0,0],h({type:"dragstart"})}}var o=d(t,"drag","dragstart","dragend"),i=null,a=r(s,eo.mouse,"mousemove","mouseup"),u=r(n,e,"touchmove","touchend");return t.origin=function(n){return arguments.length?(i=n,t):i},eo.rebind(t,o,"on")},eo.functor=O;var Lo,Ao,Po,ko,qo,Ho=ho[u(ho,"requestAnimationFrame")]||function(t){setTimeout(t,17)};eo.timer=function(t,n,e){var r=arguments.length;2>r&&(n=0),3>r&&(e=Date.now());var o=e+n,i={c:t,t:o,f:!1,n:null};Ao?Ao.n=i:Lo=i,Ao=i,Po||(ko=clearTimeout(ko),Po=1,Ho(B))},eo.timer.flush=function(){D(),j()};var Fo=eo.time={},Io=Date,Oo=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];N.prototype={getDate:function(){return this._.getUTCDate()},getDay:function(){return this._.getUTCDay()},getFullYear:function(){return this._.getUTCFullYear()},getHours:function(){return this._.getUTCHours()},getMilliseconds:function(){return this._.getUTCMilliseconds()},getMinutes:function(){return this._.getUTCMinutes()},getMonth:function(){return this._.getUTCMonth()},getSeconds:function(){return this._.getUTCSeconds()},getTime:function(){return this._.getTime()},getTimezoneOffset:function(){return 0},valueOf:function(){return this._.valueOf()},setDate:function(){Bo.setUTCDate.apply(this._,arguments)},setDay:function(){Bo.setUTCDay.apply(this._,arguments)},setFullYear:function(){Bo.setUTCFullYear.apply(this._,arguments)},setHours:function(){Bo.setUTCHours.apply(this._,arguments)},setMilliseconds:function(){Bo.setUTCMilliseconds.apply(this._,arguments)},setMinutes:function(){Bo.setUTCMinutes.apply(this._,arguments)},setMonth:function(){Bo.setUTCMonth.apply(this._,arguments)},setSeconds:function(){Bo.setUTCSeconds.apply(this._,arguments)},setTime:function(){Bo.setTime.apply(this._,arguments)}};var Bo=Date.prototype,Do="%a %b %e %X %Y",jo="%m/%d/%Y",No="%H:%M:%S",Ro=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],Yo=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],Uo=["January","February","March","April","May","June","July","August","September","October","November","December"],Zo=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];Fo.year=R(function(t){return t=Fo.day(t),t.setMonth(0,1),t},function(t,n){t.setFullYear(t.getFullYear()+n)},function(t){return t.getFullYear()}),Fo.years=Fo.year.range,Fo.years.utc=Fo.year.utc.range,Fo.day=R(function(t){var n=new Io(2e3,0);return n.setFullYear(t.getFullYear(),t.getMonth(),t.getDate()),n},function(t,n){t.setDate(t.getDate()+n)},function(t){return t.getDate()-1}),Fo.days=Fo.day.range,Fo.days.utc=Fo.day.utc.range,Fo.dayOfYear=function(t){var n=Fo.year(t);return Math.floor((t-n-6e4*(t.getTimezoneOffset()-n.getTimezoneOffset()))/864e5)},Oo.forEach(function(t,n){t=t.toLowerCase(),n=7-n;var e=Fo[t]=R(function(t){return(t=Fo.day(t)).setDate(t.getDate()-(t.getDay()+n)%7),t},function(t,n){t.setDate(t.getDate()+7*Math.floor(n))},function(t){var e=Fo.year(t).getDay();return Math.floor((Fo.dayOfYear(t)+(e+n)%7)/7)-(e!==n)});Fo[t+"s"]=e.range,Fo[t+"s"].utc=e.utc.range,Fo[t+"OfYear"]=function(t){var e=Fo.year(t).getDay();return Math.floor((Fo.dayOfYear(t)+(e+n)%7)/7)}}),Fo.week=Fo.sunday,Fo.weeks=Fo.sunday.range,Fo.weeks.utc=Fo.sunday.utc.range,Fo.weekOfYear=Fo.sundayOfYear,Fo.format=U;var Xo=X(Ro),Qo=Q(Ro),Wo=X(Yo),$o=Q(Yo),Ko=X(Uo),Vo=Q(Uo),Go=X(Zo),Jo=Q(Zo),ti=/^%/,ni={"-":"",_:" ",0:"0"},ei={a:function(t){return Yo[t.getDay()]},A:function(t){return Ro[t.getDay()]},b:function(t){return Zo[t.getMonth()]},B:function(t){return Uo[t.getMonth()]},c:U(Do),d:function(t,n){return W(t.getDate(),n,2)},e:function(t,n){return W(t.getDate(),n,2)},H:function(t,n){return W(t.getHours(),n,2)},I:function(t,n){return W(t.getHours()%12||12,n,2)},j:function(t,n){return W(1+Fo.dayOfYear(t),n,3)},L:function(t,n){return W(t.getMilliseconds(),n,3)},m:function(t,n){return W(t.getMonth()+1,n,2)},M:function(t,n){return W(t.getMinutes(),n,2)},p:function(t){return t.getHours()>=12?"PM":"AM"},S:function(t,n){return W(t.getSeconds(),n,2)},U:function(t,n){return W(Fo.sundayOfYear(t),n,2)},w:function(t){return t.getDay()},W:function(t,n){return W(Fo.mondayOfYear(t),n,2)},x:U(jo),X:U(No),y:function(t,n){return W(t.getFullYear()%100,n,2)},Y:function(t,n){return W(t.getFullYear()%1e4,n,4)},Z:yn,"%":function(){return"%"}},ri={a:$,A:K,b:tn,B:nn,c:en,d:hn,e:hn,H:dn,I:dn,j:fn,L:gn,m:cn,M:pn,p:vn,S:mn,U:G,w:V,W:J,x:rn,X:on,y:un,Y:an,Z:sn,"%":wn},oi=/^\s*\d+/,ii=eo.map({am:0,pm:1});U.utc=Mn;var ai=Mn("%Y-%m-%dT%H:%M:%S.%LZ");U.iso=Date.prototype.toISOString&&+new Date("2000-01-01T00:00:00.000Z")?xn:ai,xn.parse=function(t){var n=new Date(t);return isNaN(n)?null:n},xn.toString=ai.toString,Fo.second=R(function(t){return new Io(1e3*Math.floor(t/1e3))},function(t,n){t.setTime(t.getTime()+1e3*Math.floor(n))},function(t){return t.getSeconds()}),Fo.seconds=Fo.second.range,Fo.seconds.utc=Fo.second.utc.range,Fo.minute=R(function(t){return new Io(6e4*Math.floor(t/6e4))},function(t,n){t.setTime(t.getTime()+6e4*Math.floor(n))},function(t){return t.getMinutes()}),Fo.minutes=Fo.minute.range,Fo.minutes.utc=Fo.minute.utc.range,Fo.hour=R(function(t){var n=t.getTimezoneOffset()/60;return new Io(36e5*(Math.floor(t/36e5-n)+n))},function(t,n){t.setTime(t.getTime()+36e5*Math.floor(n))},function(t){return t.getHours()}),Fo.hours=Fo.hour.range,Fo.hours.utc=Fo.hour.utc.range,Fo.month=R(function(t){return t=Fo.day(t),t.setDate(1),t},function(t,n){t.setMonth(t.getMonth()+n)},function(t){return t.getMonth()}),Fo.months=Fo.month.range,Fo.months.utc=Fo.month.utc.range,_n.prototype.toString=function(){return this.rgb()+""},eo.hsl=function(t,n,e){return 1===arguments.length?t instanceof Sn?zn(t.h,t.s,t.l):Yn(""+t,Un,zn):zn(+t,+n,+e)};var ui=Sn.prototype=new _n;ui.brighter=function(t){return t=Math.pow(.7,arguments.length?t:1),zn(this.h,this.s,this.l/t)},ui.darker=function(t){return t=Math.pow(.7,arguments.length?t:1),zn(this.h,this.s,t*this.l)},ui.rgb=function(){return Tn(this.h,this.s,this.l)};var si=Math.PI,li=2*si,ci=si/2,hi=1e-6,fi=hi*hi,di=si/180,pi=180/si;eo.hcl=function(t,n,e){return 1===arguments.length?t instanceof An?Ln(t.h,t.c,t.l):t instanceof qn?Fn(t.l,t.a,t.b):Fn((t=Zn((t=eo.rgb(t)).r,t.g,t.b)).l,t.a,t.b):Ln(+t,+n,+e)};var mi=An.prototype=new _n;mi.brighter=function(t){return Ln(this.h,this.c,Math.min(100,this.l+gi*(arguments.length?t:1)))},mi.darker=function(t){return Ln(this.h,this.c,Math.max(0,this.l-gi*(arguments.length?t:1)))},mi.rgb=function(){return Pn(this.h,this.c,this.l).rgb()},eo.lab=function(t,n,e){return 1===arguments.length?t instanceof qn?kn(t.l,t.a,t.b):t instanceof An?Pn(t.l,t.c,t.h):Zn((t=eo.rgb(t)).r,t.g,t.b):kn(+t,+n,+e)};var gi=18,vi=.95047,yi=1,wi=1.08883,Mi=qn.prototype=new _n;Mi.brighter=function(t){return kn(Math.min(100,this.l+gi*(arguments.length?t:1)),this.a,this.b)},Mi.darker=function(t){return kn(Math.max(0,this.l-gi*(arguments.length?t:1)),this.a,this.b)},Mi.rgb=function(){return Hn(this.l,this.a,this.b)},eo.rgb=function(t,n,e){return 1===arguments.length?t instanceof Nn?jn(t.r,t.g,t.b):Yn(""+t,jn,Tn):jn(~~t,~~n,~~e)};var xi=Nn.prototype=new _n;xi.brighter=function(t){t=Math.pow(.7,arguments.length?t:1);var n=this.r,e=this.g,r=this.b,o=30;return n||e||r?(n&&o>n&&(n=o),e&&o>e&&(e=o),r&&o>r&&(r=o),jn(Math.min(255,~~(n/t)),Math.min(255,~~(e/t)),Math.min(255,~~(r/t)))):jn(o,o,o)},xi.darker=function(t){return t=Math.pow(.7,arguments.length?t:1),jn(~~(t*this.r),~~(t*this.g),~~(t*this.b))},xi.hsl=function(){return Un(this.r,this.g,this.b)},xi.toString=function(){return"#"+Rn(this.r)+Rn(this.g)+Rn(this.b)};var bi=eo.map({aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074});bi.forEach(function(t,n){bi.set(t,Dn(n))}),eo.interpolateRgb=Wn,eo.interpolateObject=$n,eo.interpolateArray=Kn,eo.interpolateNumber=Vn,eo.interpolateString=Gn;var _i=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g;eo.interpolate=Jn,eo.interpolators=[function(t,n){var e=typeof n;return("string"===e?bi.has(n)||/^(#|rgb\(|hsl\()/.test(n)?Wn:Gn:n instanceof _n?Wn:"object"===e?Array.isArray(n)?Kn:$n:Vn)(t,n)}],eo.interpolateRound=te;var zi=".",Si=",",Ti=[3,3],Ei="$",Ci=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"].map(oe);eo.formatPrefix=function(t,n){var e=0;return t&&(0>t&&(t*=-1),n&&(t=eo.round(t,ie(t,n))),e=1+Math.floor(1e-12+Math.log(t)/Math.LN10),e=Math.max(-24,Math.min(24,3*Math.floor((0>=e?e+1:e-1)/3)))),Ci[8+e/3]},eo.round=function(t,n){return n?Math.round(t*(n=Math.pow(10,n)))/n:Math.round(t)},eo.format=function(t){var n=Li.exec(t),e=n[1]||" ",r=n[2]||">",o=n[3]||"",i=n[4]||"",a=n[5],u=+n[6],s=n[7],l=n[8],c=n[9],h=1,f="",d=!1;switch(l&&(l=+l.substring(1)),(a||"0"===e&&"="===r)&&(a=e="0",r="=",s&&(u-=Math.floor((u-1)/4))),c){case"n":s=!0,c="g";break;case"%":h=100,f="%",c="f";break;case"p":h=100,f="%",c="r";break;case"b":case"o":case"x":case"X":"#"===i&&(i="0"+c.toLowerCase());case"c":case"d":d=!0,l=0;break;case"s":h=-1,c="r"}"#"===i?i="":"$"===i&&(i=Ei),"r"!=c||l||(c="g"),null!=l&&("g"==c?l=Math.max(1,Math.min(21,l)):("e"==c||"f"==c)&&(l=Math.max(0,Math.min(20,l)))),c=Ai.get(c)||ae;var p=a&&s;return function(t){if(d&&t%1)return"";var n=0>t||0===t&&0>1/t?(t=-t,"-"):o;if(0>h){var m=eo.formatPrefix(t,l);t=m.scale(t),f=m.symbol}else t*=h;t=c(t,l);var g=t.lastIndexOf("."),v=0>g?t:t.substring(0,g),y=0>g?"":zi+t.substring(g+1);!a&&s&&(v=Pi(v));var w=i.length+v.length+y.length+(p?0:n.length),M=u>w?Array(w=u-w+1).join(e):"";return p&&(v=Pi(M+v)),n+=i,t=v+y,("<"===r?n+t+M:">"===r?M+n+t:"^"===r?M.substring(0,w>>=1)+n+t+M.substring(w):n+(p?t:M+t))+f
}};var Li=/(?:([^{])?([<>=^]))?([+\- ])?([$#])?(0)?(\d+)?(,)?(\.-?\d+)?([a-z%])?/i,Ai=eo.map({b:function(t){return t.toString(2)},c:function(t){return String.fromCharCode(t)},o:function(t){return t.toString(8)},x:function(t){return t.toString(16)},X:function(t){return t.toString(16).toUpperCase()},g:function(t,n){return t.toPrecision(n)},e:function(t,n){return t.toExponential(n)},f:function(t,n){return t.toFixed(n)},r:function(t,n){return(t=eo.round(t,ie(t,n))).toFixed(Math.max(0,Math.min(20,ie(t*(1+1e-15),n))))}}),Pi=re;if(Ti){var ki=Ti.length;Pi=function(t){for(var n=t.length,e=[],r=0,o=Ti[0];n>0&&o>0;)e.push(t.substring(n-=o,n+o)),o=Ti[r=(r+1)%ki];return e.reverse().join(Si)}}var qi={floor:re,ceil:re};eo.scale={},eo.scale.linear=function(){return fe([0,1],[0,1],Jn,!1)};var Hi={s:1,g:1,p:1,r:1,e:1},Fi=[1e3,5e3,15e3,3e4,6e4,3e5,9e5,18e5,36e5,108e5,216e5,432e5,864e5,1728e5,6048e5,2592e6,7776e6,31536e6],Ii=[[Fo.second,1],[Fo.second,5],[Fo.second,15],[Fo.second,30],[Fo.minute,1],[Fo.minute,5],[Fo.minute,15],[Fo.minute,30],[Fo.hour,1],[Fo.hour,3],[Fo.hour,6],[Fo.hour,12],[Fo.day,1],[Fo.day,2],[Fo.week,1],[Fo.month,1],[Fo.month,3],[Fo.year,1]],Oi=[[U("%Y"),bn],[U("%B"),function(t){return t.getMonth()}],[U("%b %d"),function(t){return 1!=t.getDate()}],[U("%a %d"),function(t){return t.getDay()&&1!=t.getDate()}],[U("%I %p"),function(t){return t.getHours()}],[U("%I:%M"),function(t){return t.getMinutes()}],[U(":%S"),function(t){return t.getSeconds()}],[U(".%L"),function(t){return t.getMilliseconds()}]],Bi=be(Oi);Ii.year=Fo.year,Fo.scale=function(){return Me(eo.scale.linear(),Ii,Bi)};var Di={range:function(t,n,e){return eo.range(+t,+n,e).map(xe)}},ji=Ii.map(function(t){return[t[0].utc,t[1]]}),Ni=[[Mn("%Y"),bn],[Mn("%B"),function(t){return t.getUTCMonth()}],[Mn("%b %d"),function(t){return 1!=t.getUTCDate()}],[Mn("%a %d"),function(t){return t.getUTCDay()&&1!=t.getUTCDate()}],[Mn("%I %p"),function(t){return t.getUTCHours()}],[Mn("%I:%M"),function(t){return t.getUTCMinutes()}],[Mn(":%S"),function(t){return t.getUTCSeconds()}],[Mn(".%L"),function(t){return t.getUTCMilliseconds()}]],Ri=be(Ni);ji.year=Fo.year.utc,Fo.scale.utc=function(){return Me(eo.scale.linear(),ji,Ri)},eo.geo={},ke.prototype={s:0,t:0,add:function(t){qe(t,this.t,Yi),qe(Yi.s,this.s,this),this.s?this.t+=Yi.t:this.s=Yi.t},reset:function(){this.s=this.t=0},valueOf:function(){return this.s}};var Yi=new ke;eo.geo.stream=function(t,n){t&&Ui.hasOwnProperty(t.type)?Ui[t.type](t,n):He(t,n)};var Ui={Feature:function(t,n){He(t.geometry,n)},FeatureCollection:function(t,n){for(var e=t.features,r=-1,o=e.length;o>++r;)He(e[r].geometry,n)}},Zi={Sphere:function(t,n){n.sphere()},Point:function(t,n){t=t.coordinates,n.point(t[0],t[1],t[2])},MultiPoint:function(t,n){for(var e=t.coordinates,r=-1,o=e.length;o>++r;)t=e[r],n.point(t[0],t[1],t[2])},LineString:function(t,n){Fe(t.coordinates,n,0)},MultiLineString:function(t,n){for(var e=t.coordinates,r=-1,o=e.length;o>++r;)Fe(e[r],n,0)},Polygon:function(t,n){Ie(t.coordinates,n)},MultiPolygon:function(t,n){for(var e=t.coordinates,r=-1,o=e.length;o>++r;)Ie(e[r],n)},GeometryCollection:function(t,n){for(var e=t.geometries,r=-1,o=e.length;o>++r;)He(e[r],n)}};eo.geo.area=function(t){return Xi=0,eo.geo.stream(t,Wi),Xi};var Xi,Qi=new ke,Wi={sphere:function(){Xi+=4*si},point:s,lineStart:s,lineEnd:s,polygonStart:function(){Qi.reset(),Wi.lineStart=Oe},polygonEnd:function(){var t=2*Qi;Xi+=0>t?4*si+t:t,Wi.lineStart=Wi.lineEnd=Wi.point=s}},$i=Ce(bn,Ze,Qe,[-si,-si/2]);(eo.geo.equirectangular=function(){return lr(We)}).raw=We.invert=We,eo.geo.rotation=function(t){function n(n){return n=t(n[0]*di,n[1]*di),n[0]*=pi,n[1]*=pi,n}return t=Ke(t[0]%360*di,t[1]*di,t.length>2?t[2]*di:0),n.invert=function(n){return n=t.invert(n[0]*di,n[1]*di),n[0]*=pi,n[1]*=pi,n},n},$e.invert=We,eo.geo.circle=function(){function t(){var t="function"==typeof r?r.apply(this,arguments):r,n=Ke(-t[0]*di,-t[1]*di,0).invert,o=[];return e(null,null,1,{point:function(t,e){o.push(t=n(t,e)),t[0]*=pi,t[1]*=pi}}),{type:"Polygon",coordinates:[o]}}var n,e,r=[0,0],o=6;return t.origin=function(n){return arguments.length?(r=n,t):r},t.angle=function(r){return arguments.length?(e=tr((n=+r)*di,o*di),t):n},t.precision=function(r){return arguments.length?(e=tr(n*di,(o=+r)*di),t):o},t.angle(90)};var Ki=1e9;eo.geo.clipExtent=function(){var t,n,e,r,o,i,a={stream:function(t){return o&&(o.valid=!1),o=i(t),o.valid=!0,o},extent:function(u){return arguments.length?(i=or(t=+u[0][0],n=+u[0][1],e=+u[1][0],r=+u[1][1]),o&&(o.valid=!1,o=null),a):[[t,n],[e,r]]}};return a.extent([[0,0],[960,500]])},eo.geo.transform=function(t){return{stream:function(n){var e=new ur(n);for(var r in t)e[r]=t[r];return e}}},ur.prototype={point:function(t,n){this.stream.point(t,n)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}},eo.geo.projection=lr,eo.geo.projectionMutator=cr,(eo.geo.conicEqualArea=function(){return fr(dr)}).raw=dr,eo.geo.albers=function(){return eo.geo.conicEqualArea().rotate([96,0]).center([-.6,38.7]).parallels([29.5,45.5]).scale(1070)},eo.geo.albersUsa=function(){function t(t){var i=t[0],a=t[1];return n=null,e(i,a),n||(r(i,a),n)||o(i,a),n}var n,e,r,o,i=eo.geo.albers(),a=eo.geo.conicEqualArea().rotate([154,0]).center([-2,58.5]).parallels([55,65]),u=eo.geo.conicEqualArea().rotate([157,0]).center([-3,19.9]).parallels([8,18]),s={point:function(t,e){n=[t,e]}};return t.invert=function(t){var n=i.scale(),e=i.translate(),r=(t[0]-e[0])/n,o=(t[1]-e[1])/n;return(o>=.12&&.234>o&&r>=-.425&&-.214>r?a:o>=.166&&.234>o&&r>=-.214&&-.115>r?u:i).invert(t)},t.stream=function(t){var n=i.stream(t),e=a.stream(t),r=u.stream(t);return{point:function(t,o){n.point(t,o),e.point(t,o),r.point(t,o)},sphere:function(){n.sphere(),e.sphere(),r.sphere()},lineStart:function(){n.lineStart(),e.lineStart(),r.lineStart()},lineEnd:function(){n.lineEnd(),e.lineEnd(),r.lineEnd()},polygonStart:function(){n.polygonStart(),e.polygonStart(),r.polygonStart()},polygonEnd:function(){n.polygonEnd(),e.polygonEnd(),r.polygonEnd()}}},t.precision=function(n){return arguments.length?(i.precision(n),a.precision(n),u.precision(n),t):i.precision()},t.scale=function(n){return arguments.length?(i.scale(n),a.scale(.35*n),u.scale(n),t.translate(i.translate())):i.scale()},t.translate=function(n){if(!arguments.length)return i.translate();var l=i.scale(),c=+n[0],h=+n[1];return e=i.translate(n).clipExtent([[c-.455*l,h-.238*l],[c+.455*l,h+.238*l]]).stream(s).point,r=a.translate([c-.307*l,h+.201*l]).clipExtent([[c-.425*l+hi,h+.12*l+hi],[c-.214*l-hi,h+.234*l-hi]]).stream(s).point,o=u.translate([c-.205*l,h+.212*l]).clipExtent([[c-.214*l+hi,h+.166*l+hi],[c-.115*l-hi,h+.234*l-hi]]).stream(s).point,t},t.scale(1070)},eo.geo.bounds=function(){function t(t,n){w.push(M=[c=t,f=t]),h>n&&(h=n),n>d&&(d=n)}function n(n,e){var r=Be([n*di,e*di]);if(v){var o=je(v,r),i=[o[1],-o[0],0],a=je(i,o);Ye(a),a=_e(a);var s=n-p,l=s>0?1:-1,m=a[0]*pi*l,g=oo(s)>180;if(g^(m>l*p&&l*n>m)){var y=a[1]*pi;y>d&&(d=y)}else if(m=(m+360)%360-180,g^(m>l*p&&l*n>m)){var y=-a[1]*pi;h>y&&(h=y)}else h>e&&(h=e),e>d&&(d=e);g?p>n?u(c,n)>u(c,f)&&(f=n):u(n,f)>u(c,f)&&(c=n):f>=c?(c>n&&(c=n),n>f&&(f=n)):n>p?u(c,n)>u(c,f)&&(f=n):u(n,f)>u(c,f)&&(c=n)}else t(n,e);v=r,p=n}function e(){x.point=n}function r(){M[0]=c,M[1]=f,x.point=t,v=null}function o(t,e){if(v){var r=t-p;y+=oo(r)>180?r+(r>0?360:-360):r}else m=t,g=e;Wi.point(t,e),n(t,e)}function i(){Wi.lineStart()}function a(){o(m,g),Wi.lineEnd(),oo(y)>hi&&(c=-(f=180)),M[0]=c,M[1]=f,v=null}function u(t,n){return 0>(n-=t)?n+360:n}function s(t,n){return t[0]-n[0]}function l(t,n){return n[0]<=n[1]?t>=n[0]&&n[1]>=t:n[0]>t||t>n[1]}var c,h,f,d,p,m,g,v,y,w,M,x={point:t,lineStart:e,lineEnd:r,polygonStart:function(){x.point=o,x.lineStart=i,x.lineEnd=a,y=0,Wi.polygonStart()},polygonEnd:function(){Wi.polygonEnd(),x.point=t,x.lineStart=e,x.lineEnd=r,0>Qi?(c=-(f=180),h=-(d=90)):y>hi?d=90:-hi>y&&(h=-90),M[0]=c,M[1]=f}};return function(t){d=f=-(c=h=1/0),w=[],eo.geo.stream(t,x);var n=w.length;if(n){w.sort(s);for(var e,r=1,o=w[0],i=[o];n>r;++r)e=w[r],l(e[0],o)||l(e[1],o)?(u(o[0],e[1])>u(o[0],o[1])&&(o[1]=e[1]),u(e[0],o[1])>u(o[0],o[1])&&(o[0]=e[0])):i.push(o=e);for(var a,e,p=-1/0,n=i.length-1,r=0,o=i[n];n>=r;o=e,++r)e=i[r],(a=u(o[1],e[0]))>p&&(p=a,c=e[0],f=o[1])}return w=M=null,1/0===c||1/0===h?[[0/0,0/0],[0/0,0/0]]:[[c,h],[f,d]]}}(),eo.geo.centroid=function(t){Vi=Gi=Ji=ta=na=ea=ra=oa=ia=aa=ua=0,eo.geo.stream(t,pa);var n=ia,e=aa,r=ua,o=n*n+e*e+r*r;return fi>o&&(n=ea,e=ra,r=oa,hi>Gi&&(n=Ji,e=ta,r=na),o=n*n+e*e+r*r,fi>o)?[0/0,0/0]:[Math.atan2(e,n)*pi,Cn(r/Math.sqrt(o))*pi]};var Vi,Gi,Ji,ta,na,ea,ra,oa,ia,aa,ua,sa,la,ca,ha,fa,da,pa={sphere:s,point:pr,lineStart:gr,lineEnd:vr,polygonStart:function(){pa.lineStart=yr},polygonEnd:function(){pa.lineStart=gr}},ma={point:s,lineStart:s,lineEnd:s,polygonStart:function(){la=0,ma.lineStart=wr},polygonEnd:function(){ma.lineStart=ma.lineEnd=ma.point=s,sa+=oo(la/2)}},ga={point:Mr,lineStart:s,lineEnd:s,polygonStart:s,polygonEnd:s},va={point:_r,lineStart:zr,lineEnd:Sr,polygonStart:function(){va.lineStart=Tr},polygonEnd:function(){va.point=_r,va.lineStart=zr,va.lineEnd=Sr}};eo.geo.path=function(){function t(t){return t&&("function"==typeof u&&i.pointRadius(+u.apply(this,arguments)),a&&a.valid||(a=o(i)),eo.geo.stream(t,a)),i.result()}function n(){return a=null,t}var e,r,o,i,a,u=4.5;return t.area=function(t){return sa=0,eo.geo.stream(t,o(ma)),sa},t.centroid=function(t){return Ji=ta=na=ea=ra=oa=ia=aa=ua=0,eo.geo.stream(t,o(va)),ua?[ia/ua,aa/ua]:oa?[ea/oa,ra/oa]:na?[Ji/na,ta/na]:[0/0,0/0]},t.bounds=function(t){return fa=da=-(ca=ha=1/0),eo.geo.stream(t,o(ga)),[[ca,ha],[fa,da]]},t.projection=function(t){return arguments.length?(o=(e=t)?t.stream||Cr(t):re,n()):e},t.context=function(t){return arguments.length?(i=null==(r=t)?new xr:new Er(t),"function"!=typeof u&&i.pointRadius(u),n()):r},t.pointRadius=function(n){return arguments.length?(u="function"==typeof n?n:(i.pointRadius(+n),+n),t):u},t.projection(eo.geo.albersUsa()).context(null)};var ya=function(){return re},wa=eo.map({linear:ya,poly:Fr,quad:function(){return kr},cubic:function(){return qr},sin:function(){return Ir},exp:function(){return Or},circle:function(){return Br},elastic:Dr,back:jr,bounce:function(){return Nr}}),Ma=eo.map({"in":re,out:Ar,"in-out":Pr,"out-in":function(t){return Pr(Ar(t))}});eo.ease=function(t){var n=t.indexOf("-"),e=n>=0?t.substring(0,n):t,r=n>=0?t.substring(n+1):"in";return e=wa.get(e)||ya,r=Ma.get(r)||re,Lr(r(e.apply(null,uo.call(arguments,1))))};var xa,ba,_a=[],za=0;_a.call=xo.call,_a.empty=xo.empty,_a.node=xo.node,_a.size=xo.size,eo.transition=function(t){return arguments.length?xa?t.transition():t:zo.transition()},eo.transition.prototype=_a,_a.select=function(t){var n,e,r,o=this.id,i=[];t=m(t);for(var a=-1,u=this.length;u>++a;){i.push(n=[]);for(var s=this[a],l=-1,c=s.length;c>++l;)(r=s[l])&&(e=t.call(r,r.__data__,l,a))?("__data__"in r&&(e.__data__=r.__data__),Kr(e,l,o,r.__transition__[o]),n.push(e)):n.push(null)}return Rr(i,o)},_a.selectAll=function(t){var n,e,r,o,i,a=this.id,u=[];t=g(t);for(var s=-1,l=this.length;l>++s;)for(var c=this[s],h=-1,f=c.length;f>++h;)if(r=c[h]){i=r.__transition__[a],e=t.call(r,r.__data__,h,s),u.push(n=[]);for(var d=-1,p=e.length;p>++d;)(o=e[d])&&Kr(o,d,a,i),n.push(o)}return Rr(u,a)},_a.filter=function(t){var n,e,r,o=[];"function"!=typeof t&&(t=T(t));for(var i=0,a=this.length;a>i;i++){o.push(n=[]);for(var e=this[i],u=0,s=e.length;s>u;u++)(r=e[u])&&t.call(r,r.__data__,u,i)&&n.push(r)}return Rr(o,this.id)},eo.transform=function(t){var n=lo.createElementNS(eo.ns.prefix.svg,"g");return(eo.transform=function(t){if(null!=t){n.setAttribute("transform",t);var e=n.transform.baseVal.consolidate()}return new Yr(e?e.matrix:Sa)})(t)},Yr.prototype.toString=function(){return"translate("+this.translate+")rotate("+this.rotate+")skewX("+this.skew+")scale("+this.scale+")"};var Sa={a:1,b:0,c:0,d:1,e:0,f:0};return eo.interpolateTransform=Qr,_a.tween=function(t,n){var e=this.id;return 2>arguments.length?this.node().__transition__[e].tween.get(t):C(this,null==n?function(n){n.__transition__[e].tween.remove(t)}:function(r){r.__transition__[e].tween.set(t,n)})},_a.attr=function(t,n){function e(){this.removeAttribute(u)}function r(){this.removeAttributeNS(u.space,u.local)}function o(t){return null==t?e:(t+="",function(){var n,e=this.getAttribute(u);return e!==t&&(n=a(e,t),function(t){this.setAttribute(u,n(t))})})}function i(t){return null==t?r:(t+="",function(){var n,e=this.getAttributeNS(u.space,u.local);return e!==t&&(n=a(e,t),function(t){this.setAttributeNS(u.space,u.local,n(t))})})}if(2>arguments.length){for(n in t)this.attr(n,t[n]);return this}var a="transform"==t?Qr:Jn,u=eo.ns.qualify(t);return Wr(this,"attr."+t,n,u.local?i:o)},_a.attrTween=function(t,n){function e(t,e){var r=n.call(this,t,e,this.getAttribute(o));return r&&function(t){this.setAttribute(o,r(t))}}function r(t,e){var r=n.call(this,t,e,this.getAttributeNS(o.space,o.local));return r&&function(t){this.setAttributeNS(o.space,o.local,r(t))}}var o=eo.ns.qualify(t);return this.tween("attr."+t,o.local?r:e)},_a.style=function(t,n,e){function r(){this.style.removeProperty(t)}function o(n){return null==n?r:(n+="",function(){var r,o=ho.getComputedStyle(this,null).getPropertyValue(t);return o!==n&&(r=Jn(o,n),function(n){this.style.setProperty(t,r(n),e)})})}var i=arguments.length;if(3>i){if("string"!=typeof t){2>i&&(n="");for(e in t)this.style(e,t[e],n);return this}e=""}return Wr(this,"style."+t,n,o)},_a.styleTween=function(t,n,e){function r(r,o){var i=n.call(this,r,o,ho.getComputedStyle(this,null).getPropertyValue(t));return i&&function(n){this.style.setProperty(t,i(n),e)}}return 3>arguments.length&&(e=""),this.tween("style."+t,r)},_a.text=function(t){return Wr(this,"text",t,$r)},_a.remove=function(){return this.each("end.transition",function(){var t;2>this.__transition__.count&&(t=this.parentNode)&&t.removeChild(this)})},_a.ease=function(t){var n=this.id;return 1>arguments.length?this.node().__transition__[n].ease:("function"!=typeof t&&(t=eo.ease.apply(eo,arguments)),C(this,function(e){e.__transition__[n].ease=t}))},_a.delay=function(t){var n=this.id;return C(this,"function"==typeof t?function(e,r,o){e.__transition__[n].delay=+t.call(e,e.__data__,r,o)}:(t=+t,function(e){e.__transition__[n].delay=t}))},_a.duration=function(t){var n=this.id;return C(this,"function"==typeof t?function(e,r,o){e.__transition__[n].duration=Math.max(1,t.call(e,e.__data__,r,o))}:(t=Math.max(1,t),function(e){e.__transition__[n].duration=t}))},_a.each=function(t,n){var e=this.id;if(2>arguments.length){var r=ba,o=xa;xa=e,C(this,function(n,r,o){ba=n.__transition__[e],t.call(n,n.__data__,r,o)}),ba=r,xa=o}else C(this,function(r){var o=r.__transition__[e];(o.event||(o.event=eo.dispatch("start","end"))).on(t,n)});return this},_a.transition=function(){for(var t,n,e,r,o=this.id,i=++za,a=[],u=0,s=this.length;s>u;u++){a.push(t=[]);for(var n=this[u],l=0,c=n.length;c>l;l++)(e=n[l])&&(r=Object.create(e.__transition__[o]),r.delay+=r.duration,Kr(e,l,i,r)),t.push(e)}return Rr(a,i)},eo.xhr=Vr(re),eo.text=Vr(function(t){return t.responseText}),eo.json=function(t,n){return Gr(t,"application/json",to,n)},eo.html=function(t,n){return Gr(t,"text/html",no,n)},eo.xml=Vr(function(t){return t.responseXML}),eo}(),Date.now||(Date.now=function(){return(new Date).getTime()}),function(){for(var t=["webkit","moz"],n=0;t.length>n&&!window.requestAnimationFrame;++n){var e=t[n];window.requestAnimationFrame=window[e+"RequestAnimationFrame"],window.cancelAnimationFrame=window[e+"CancelAnimationFrame"]||window[e+"CancelRequestAnimationFrame"]}if(/iP(ad|hone|od).*OS 6/.test(window.navigator.userAgent)||!window.requestAnimationFrame||!window.cancelAnimationFrame){var r=0;window.requestAnimationFrame=function(t){var n=Date.now(),e=Math.max(r+16,n);return setTimeout(function(){t(r=e)},e-n)},window.cancelAnimationFrame=clearTimeout}}();var previousMM=MM;if(!com){var com={};com.modestmaps||(com.modestmaps={})}var MM=com.modestmaps={noConflict:function(){return MM=previousMM,this}};(function(t){t.extend=function(t,n){for(var e in n.prototype)t.prototype[e]===void 0&&(t.prototype[e]=n.prototype[e]);return t},t.getFrame=function(){return function(t){(window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){window.setTimeout(function(){t(+new Date)},10)})(t)}}(),t.transformProperty=function(t){if(this.document){for(var n=document.documentElement.style,e=0;t.length>e;e++)if(t[e]in n)return t[e];return!1}}(["transform","WebkitTransform","OTransform","MozTransform","msTransform"]),t.matrixString=function(n){var e=n.scale||1;return t._browser.webkit3d?(10*e*n.width%1&&(e=~~(1+10*e*n.width)/n.width/10),"translate3d("+~~(10*n.x)/10+"px,"+~~(10*n.y)/10+"px, 0px)"+"scale3d("+e+","+e+", 1)"):(e*n.width%1&&(e+=(1-e*n.width%1)/n.width),"translate("+Math.round(n.x)+"px,"+Math.round(n.y)+"px)"+"scale("+e+","+e+")")},t._browser=function(t){return{webkit:"WebKitCSSMatrix"in t,webkit3d:"WebKitCSSMatrix"in t&&"m11"in new WebKitCSSMatrix}}(this),t.moveElement=function(n,e){if(t.transformProperty){e.scale||(e.scale=1),e.width||(e.width=0),e.height||(e.height=0);var r=t.matrixString(e);n[t.transformProperty]!==r&&(n.style[t.transformProperty]=n[t.transformProperty]=r)}else n.style.left=e.x+"px",n.style.top=e.y+"px",e.width&&e.height&&e.scale&&(n.style.width=Math.ceil(e.width*e.scale)+"px",n.style.height=Math.ceil(e.height*e.scale)+"px")},t.cancelEvent=function(t){return t.cancelBubble=!0,t.cancel=!0,t.returnValue=!1,t.stopPropagation&&t.stopPropagation(),t.preventDefault&&t.preventDefault(),!1},t.coerceLayer=function(n){return"string"==typeof n?new t.Layer(new t.TemplatedLayer(n)):"draw"in n&&"function"==typeof n.draw?n:new t.Layer(n)},t.addEvent=function(t,n,e){t.addEventListener?(t.addEventListener(n,e,!1),"mousewheel"==n&&t.addEventListener("DOMMouseScroll",e,!1)):t.attachEvent&&(t["e"+n+e]=e,t[n+e]=function(){t["e"+n+e](window.event)},t.attachEvent("on"+n,t[n+e]))},t.removeEvent=function(t,n,e){t.removeEventListener?(t.removeEventListener(n,e,!1),"mousewheel"==n&&t.removeEventListener("DOMMouseScroll",e,!1)):t.detachEvent&&(t.detachEvent("on"+n,t[n+e]),t[n+e]=null)},t.getStyle=function(t,n){return t.currentStyle?t.currentStyle[n]:window.getComputedStyle?document.defaultView.getComputedStyle(t,null).getPropertyValue(n):void 0},t.Point=function(t,n){this.x=parseFloat(t),this.y=parseFloat(n)},t.Point.prototype={x:0,y:0,toString:function(){return"("+this.x.toFixed(3)+", "+this.y.toFixed(3)+")"},copy:function(){return new t.Point(this.x,this.y)}},t.Point.distance=function(t,n){return Math.sqrt(Math.pow(n.x-t.x,2)+Math.pow(n.y-t.y,2))},t.Point.interpolate=function(n,e,r){return new t.Point(n.x+(e.x-n.x)*r,n.y+(e.y-n.y)*r)},t.Coordinate=function(t,n,e){this.row=t,this.column=n,this.zoom=e},t.Coordinate.prototype={row:0,column:0,zoom:0,toString:function(){return"("+this.row.toFixed(3)+", "+this.column.toFixed(3)+" @"+this.zoom.toFixed(3)+")"},toKey:function(){return this.zoom+","+this.row+","+this.column},copy:function(){return new t.Coordinate(this.row,this.column,this.zoom)},container:function(){return new t.Coordinate(Math.floor(this.row),Math.floor(this.column),Math.floor(this.zoom))},zoomTo:function(n){var e=Math.pow(2,n-this.zoom);return new t.Coordinate(this.row*e,this.column*e,n)},zoomBy:function(n){var e=Math.pow(2,n);return new t.Coordinate(this.row*e,this.column*e,this.zoom+n)},up:function(n){return void 0===n&&(n=1),new t.Coordinate(this.row-n,this.column,this.zoom)},right:function(n){return void 0===n&&(n=1),new t.Coordinate(this.row,this.column+n,this.zoom)},down:function(n){return void 0===n&&(n=1),new t.Coordinate(this.row+n,this.column,this.zoom)},left:function(n){return void 0===n&&(n=1),new t.Coordinate(this.row,this.column-n,this.zoom)}},t.Location=function(t,n){this.lat=parseFloat(t),this.lon=parseFloat(n)},t.Location.prototype={lat:0,lon:0,toString:function(){return"("+this.lat.toFixed(3)+", "+this.lon.toFixed(3)+")"},copy:function(){return new t.Location(this.lat,this.lon)}},t.Location.distance=function(t,n,e){e||(e=6378e3);var r=Math.PI/180,o=t.lat*r,i=t.lon*r,a=n.lat*r,u=n.lon*r,s=Math.cos(o)*Math.cos(i)*Math.cos(a)*Math.cos(u),l=Math.cos(o)*Math.sin(i)*Math.cos(a)*Math.sin(u),c=Math.sin(o)*Math.sin(a);return Math.acos(s+l+c)*e},t.Location.interpolate=function(n,e,r){if(n.lat===e.lat&&n.lon===e.lon)return new t.Location(n.lat,n.lon);var o=Math.PI/180,i=n.lat*o,a=n.lon*o,u=e.lat*o,s=e.lon*o,l=2*Math.asin(Math.sqrt(Math.pow(Math.sin(.5*(i-u)),2)+Math.cos(i)*Math.cos(u)*Math.pow(Math.sin(.5*(a-s)),2))),c=Math.sin((1-r)*l)/Math.sin(l),h=Math.sin(r*l)/Math.sin(l),f=c*Math.cos(i)*Math.cos(a)+h*Math.cos(u)*Math.cos(s),d=c*Math.cos(i)*Math.sin(a)+h*Math.cos(u)*Math.sin(s),p=c*Math.sin(i)+h*Math.sin(u),m=Math.atan2(p,Math.sqrt(Math.pow(f,2)+Math.pow(d,2))),g=Math.atan2(d,f);return new t.Location(m/o,g/o)},t.Location.bearing=function(t,n){var e=Math.PI/180,r=t.lat*e,o=t.lon*e,i=n.lat*e,a=n.lon*e,u=Math.atan2(Math.sin(o-a)*Math.cos(i),Math.cos(r)*Math.sin(i)-Math.sin(r)*Math.cos(i)*Math.cos(o-a))/-(Math.PI/180);return 0>u?u+360:u},t.Extent=function(n,e,r,o){if(n instanceof t.Location&&e instanceof t.Location){var i=n,a=e;n=i.lat,e=i.lon,r=a.lat,o=a.lon}isNaN(r)&&(r=n),isNaN(o)&&(o=e),this.north=Math.max(n,r),this.south=Math.min(n,r),this.east=Math.max(o,e),this.west=Math.min(o,e)},t.Extent.prototype={north:0,south:0,east:0,west:0,copy:function(){return new t.Extent(this.north,this.west,this.south,this.east)},toString:function(t){return isNaN(t)&&(t=3),[this.north.toFixed(t),this.west.toFixed(t),this.south.toFixed(t),this.east.toFixed(t)].join(", ")},northWest:function(){return new t.Location(this.north,this.west)},southEast:function(){return new t.Location(this.south,this.east)},northEast:function(){return new t.Location(this.north,this.east)},southWest:function(){return new t.Location(this.south,this.west)},center:function(){return new t.Location(this.south+.5*(this.north-this.south),this.east+.5*(this.west-this.east))},encloseLocation:function(t){t.lat>this.north&&(this.north=t.lat),t.lat<this.south&&(this.south=t.lat),t.lon>this.east&&(this.east=t.lon),t.lon<this.west&&(this.west=t.lon)},encloseLocations:function(t){for(var n=t.length,e=0;n>e;e++)this.encloseLocation(t[e])},setFromLocations:function(t){var n=t.length,e=t[0];this.north=this.south=e.lat,this.east=this.west=e.lon;for(var r=1;n>r;r++)this.encloseLocation(t[r])},encloseExtent:function(t){t.north>this.north&&(this.north=t.north),t.south<this.south&&(this.south=t.south),t.east>this.east&&(this.east=t.east),t.west<this.west&&(this.west=t.west)},containsLocation:function(t){return t.lat>=this.south&&t.lat<=this.north&&t.lon>=this.west&&t.lon<=this.east},toArray:function(){return[this.northWest(),this.southEast()]}},t.Extent.fromString=function(n){var e=n.split(/\s*,\s*/);if(4!=e.length)throw"Invalid extent string (expecting 4 comma-separated numbers)";return new t.Extent(parseFloat(e[0]),parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3]))},t.Extent.fromArray=function(n){var e=new t.Extent;return e.setFromLocations(n),e},t.Transformation=function(t,n,e,r,o,i){this.ax=t,this.bx=n,this.cx=e,this.ay=r,this.by=o,this.cy=i},t.Transformation.prototype={ax:0,bx:0,cx:0,ay:0,by:0,cy:0,transform:function(n){return new t.Point(this.ax*n.x+this.bx*n.y+this.cx,this.ay*n.x+this.by*n.y+this.cy)},untransform:function(n){return new t.Point((n.x*this.by-n.y*this.bx-this.cx*this.by+this.cy*this.bx)/(this.ax*this.by-this.ay*this.bx),(n.x*this.ay-n.y*this.ax-this.cx*this.ay+this.cy*this.ax)/(this.bx*this.ay-this.by*this.ax))}},t.deriveTransformation=function(n,e,r,o,i,a,u,s,l,c,h,f){var d=t.linearSolution(n,e,r,i,a,u,l,c,h),p=t.linearSolution(n,e,o,i,a,s,l,c,f);return new t.Transformation(d[0],d[1],d[2],p[0],p[1],p[2])},t.linearSolution=function(t,n,e,r,o,i,a,u,s){t=parseFloat(t),n=parseFloat(n),e=parseFloat(e),r=parseFloat(r),o=parseFloat(o),i=parseFloat(i),a=parseFloat(a),u=parseFloat(u),s=parseFloat(s);var l=((i-s)*(n-o)-(e-i)*(o-u))/((r-a)*(n-o)-(t-r)*(o-u)),c=((i-s)*(t-r)-(e-i)*(r-a))/((o-u)*(t-r)-(n-o)*(r-a)),h=e-t*l-n*c;return[l,c,h]},t.Projection=function(n,e){e||(e=new t.Transformation(1,0,0,0,1,0)),this.zoom=n,this.transformation=e},t.Projection.prototype={zoom:0,transformation:null,rawProject:function(){throw"Abstract method not implemented by subclass."},rawUnproject:function(){throw"Abstract method not implemented by subclass."},project:function(t){return t=this.rawProject(t),this.transformation&&(t=this.transformation.transform(t)),t},unproject:function(t){return this.transformation&&(t=this.transformation.untransform(t)),t=this.rawUnproject(t)},locationCoordinate:function(n){var e=new t.Point(Math.PI*n.lon/180,Math.PI*n.lat/180);return e=this.project(e),new t.Coordinate(e.y,e.x,this.zoom)},coordinateLocation:function(n){n=n.zoomTo(this.zoom);var e=new t.Point(n.column,n.row);return e=this.unproject(e),new t.Location(180*e.y/Math.PI,180*e.x/Math.PI)}},t.LinearProjection=function(n,e){t.Projection.call(this,n,e)},t.LinearProjection.prototype={rawProject:function(n){return new t.Point(n.x,n.y)},rawUnproject:function(n){return new t.Point(n.x,n.y)}},t.extend(t.LinearProjection,t.Projection),t.MercatorProjection=function(n,e){t.Projection.call(this,n,e)},t.MercatorProjection.prototype={rawProject:function(n){return new t.Point(n.x,Math.log(Math.tan(.25*Math.PI+.5*n.y)))},rawUnproject:function(n){return new t.Point(n.x,2*Math.atan(Math.pow(Math.E,n.y))-.5*Math.PI)}},t.extend(t.MercatorProjection,t.Projection),t.MapProvider=function(t){t&&(this.getTile=t)},t.MapProvider.prototype={tileLimits:[new t.Coordinate(0,0,0),new t.Coordinate(1,1,0).zoomTo(18)],getTileUrl:function(){throw"Abstract method not implemented by subclass."},getTile:function(){throw"Abstract method not implemented by subclass."},releaseTile:function(){},setZoomRange:function(t,n){this.tileLimits[0]=this.tileLimits[0].zoomTo(t),this.tileLimits[1]=this.tileLimits[1].zoomTo(n)},sourceCoordinate:function(n){var e,r=this.tileLimits[0].zoomTo(n.zoom).container(),o=this.tileLimits[1].zoomTo(n.zoom),i=Math.pow(2,n.zoom);return o=new t.Coordinate(Math.ceil(o.row),Math.ceil(o.column),Math.floor(o.zoom)),e=0>n.column?(n.column%i+i)%i:n.column%i,n.row<r.row||n.row>=o.row?null:r.column>e||e>=o.column?null:new t.Coordinate(n.row,e,n.zoom)}},t.Template=function(n,e){function r(t,n,e){for(var r="",o=1;e>=o;o++)r+=(1&t>>e-o)<<1|1&n>>e-o;return r||"0"}var o=n.match(/{(Q|quadkey)}/);o&&(n=n.replace("{subdomain}","{S}").replace("{zoom}","{Z}").replace("{quadkey}","{Q}"));var i=e&&e.length&&n.indexOf("{S}")>=0,a=function(t){var a=this.sourceCoordinate(t);if(!a)return null;var u=n;if(i){var s=parseInt(a.zoom+a.row+a.column,10)%e.length;u=u.replace("{S}",e[s])}return o?u.replace("{Z}",a.zoom.toFixed(0)).replace("{Q}",r(a.row,a.column,a.zoom)):u.replace("{Z}",a.zoom.toFixed(0)).replace("{X}",a.column.toFixed(0)).replace("{Y}",a.row.toFixed(0))};t.MapProvider.call(this,a)},t.Template.prototype={getTile:function(t){return this.getTileUrl(t)}},t.extend(t.Template,t.MapProvider),t.TemplatedLayer=function(n,e,r){return new t.Layer(new t.Template(n,e),null,r)},t.getMousePoint=function(n,e){var r=new t.Point(n.clientX,n.clientY);r.x+=document.body.scrollLeft+document.documentElement.scrollLeft,r.y+=document.body.scrollTop+document.documentElement.scrollTop;for(var o=e.parent;o;o=o.offsetParent)r.x-=o.offsetLeft,r.y-=o.offsetTop;return r},t.MouseWheelHandler=function(){function n(n){var i=0;o=o||(new Date).getTime();try{r.scrollTop=1e3,r.dispatchEvent(n),i=1e3-r.scrollTop}catch(u){i=n.wheelDelta||5*-n.detail}var s=(new Date).getTime()-o,l=t.getMousePoint(n,e);return Math.abs(i)>0&&s>200&&!a?(e.zoomByAbout(i>0?1:-1,l),o=(new Date).getTime()):a&&e.zoomByAbout(.001*i,l),t.cancelEvent(n)}var e,r,o,i={id:"MouseWheelHandler"},a=!1;return i.init=function(o){e=o,r=document.body.appendChild(document.createElement("div")),r.style.cssText="visibility:hidden;top:0;height:0;width:0;overflow-y:scroll";var a=r.appendChild(document.createElement("div"));return a.style.height="2000px",t.addEvent(e.parent,"mousewheel",n),i},i.precise=function(t){return arguments.length?(a=t,i):a},i.remove=function(){t.removeEvent(e.parent,"mousewheel",n),r.parentNode.removeChild(r)},i},t.DoubleClickHandler=function(){function n(n){var r=t.getMousePoint(n,e);return e.zoomByAbout(n.shiftKey?-1:1,r),t.cancelEvent(n)}var e,r={id:"DoubleClickHandler"};return r.init=function(o){return e=o,t.addEvent(e.parent,"dblclick",n),r},r.remove=function(){t.removeEvent(e.parent,"dblclick",n)},r},t.DragHandler=function(){function n(n){return n.shiftKey||2==n.button?void 0:(t.addEvent(document,"mouseup",e),t.addEvent(document,"mousemove",r),o=new t.Point(n.clientX,n.clientY),i.parent.style.cursor="move",t.cancelEvent(n))}function e(n){return t.removeEvent(document,"mouseup",e),t.removeEvent(document,"mousemove",r),o=null,i.parent.style.cursor="",t.cancelEvent(n)}function r(n){return o&&(i.panBy(n.clientX-o.x,n.clientY-o.y),o.x=n.clientX,o.y=n.clientY,o.t=+new Date),t.cancelEvent(n)}var o,i,a={id:"DragHandler"};return a.init=function(e){return i=e,t.addEvent(i.parent,"mousedown",n),a},a.remove=function(){t.removeEvent(i.parent,"mousedown",n)},a},t.MouseHandler=function(){var n,e={id:"MouseHandler",handlers:[]};return e.init=function(r){return n=r,e.handlers=[t.DragHandler().init(n),t.DoubleClickHandler().init(n),t.MouseWheelHandler().init(n)],e},e.remove=function(){for(var t=0;e.handlers.length>t;t++)e.handlers[t].remove();return e.handlers=[],e},e},t.TouchHandler=function(){function n(){var t=document.createElement("div");return t.setAttribute("ongesturestart","return;"),"function"==typeof t.ongesturestart}function e(t){for(var n=0;t.touches.length>n;n+=1){var e=t.touches[n];if(e.identifier in v){var r=v[e.identifier];r.x=e.clientX,r.y=e.clientY,r.scale=t.scale}else v[e.identifier]={scale:t.scale,startPos:{x:e.clientX,y:e.clientY},x:e.clientX,y:e.clientY,time:(new Date).getTime()}}}function r(t){e(t)}function o(n){switch(n.touches.length){case 1:l(n.touches[0]);break;case 2:c(n)}return e(n),t.cancelEvent(n)}function i(n){var e=(new Date).getTime();0===n.touches.length&&M&&h(x);for(var r=0;n.changedTouches.length>r;r+=1){var o=n.changedTouches[r],i=v[o.identifier];if(i&&!i.wasPinch){var s={x:o.clientX,y:o.clientY},l=e-i.time,c=t.Point.distance(s,i.startPos);c>m||(l>p?(s.end=e,s.duration=l,a(s)):(s.time=e,u(s)))}}for(var f={},d=0;n.touches.length>d;d++)f[n.touches[d].identifier]=!0;for(var g in v)g in f||delete f[g];return t.cancelEvent(n)}function a(){}function u(t){return y.length&&g>t.time-y[0].time?(s(t),y=[],void 0):(y=[t],void 0)}function s(n){var e=f.getZoom(),r=Math.round(e)+1,o=r-e,i=new t.Point(n.x,n.y);f.zoomByAbout(o,i)}function l(t){var n={x:t.clientX,y:t.clientY},e=v[t.identifier];f.panBy(n.x-e.x,n.y-e.y)}function c(n){var e=n.touches[0],r=n.touches[1],o=new t.Point(e.clientX,e.clientY),i=new t.Point(r.clientX,r.clientY),a=v[e.identifier],u=v[r.identifier];a.wasPinch=!0,u.wasPinch=!0;var s=t.Point.interpolate(o,i,.5);f.zoomByAbout(Math.log(n.scale)/Math.LN2-Math.log(a.scale)/Math.LN2,s);var l=t.Point.interpolate(a,u,.5);f.panBy(s.x-l.x,s.y-l.y),M=!0,x=s}function h(t){if(w){var n=f.getZoom(),e=Math.round(n);f.zoomByAbout(e-n,t)}M=!1}var f,d={id:"TouchHandler"},p=250,m=30,g=350,v={},y=[],w=!0,M=!1,x=null;return d.init=function(e){return f=e,n()?(t.addEvent(f.parent,"touchstart",r),t.addEvent(f.parent,"touchmove",o),t.addEvent(f.parent,"touchend",i),d):d},d.remove=function(){return n()?(t.removeEvent(f.parent,"touchstart",r),t.removeEvent(f.parent,"touchmove",o),t.removeEvent(f.parent,"touchend",i),d):d},d},t.CallbackManager=function(t,n){this.owner=t,this.callbacks={};for(var e=0;n.length>e;e++)this.callbacks[n[e]]=[]},t.CallbackManager.prototype={owner:null,callbacks:null,addCallback:function(t,n){"function"==typeof n&&this.callbacks[t]&&this.callbacks[t].push(n)
},removeCallback:function(t,n){if("function"==typeof n&&this.callbacks[t])for(var e=this.callbacks[t],r=e.length,o=0;r>o;o++)if(e[o]===n){e.splice(o,1);break}},dispatchCallback:function(t,n){if(this.callbacks[t])for(var e=0;this.callbacks[t].length>e;e+=1)try{this.callbacks[t][e](this.owner,n)}catch(r){}}},t.RequestManager=function(){this.loadingBay=document.createDocumentFragment(),this.requestsById={},this.openRequestCount=0,this.maxOpenRequests=4,this.requestQueue=[],this.callbackManager=new t.CallbackManager(this,["requestcomplete","requesterror"])},t.RequestManager.prototype={loadingBay:null,requestQueue:null,openRequestCount:null,maxOpenRequests:null,callbackManager:null,addCallback:function(t,n){this.callbackManager.addCallback(t,n)},removeCallback:function(t,n){this.callbackManager.removeCallback(t,n)},dispatchCallback:function(t,n){this.callbackManager.dispatchCallback(t,n)},clear:function(){this.clearExcept({})},clearRequest:function(t){t in this.requestsById&&delete this.requestsById[t];for(var n=0;this.requestQueue.length>n;n++){var e=this.requestQueue[n];e&&e.id==t&&(this.requestQueue[n]=null)}},clearExcept:function(t){for(var n=0;this.requestQueue.length>n;n++){var e=this.requestQueue[n];!e||e.id in t||(this.requestQueue[n]=null)}for(var r=this.loadingBay.childNodes,o=r.length-1;o>=0;o--){var i=r[o];i.id in t||(this.loadingBay.removeChild(i),this.openRequestCount--,i.coord=i.onload=i.onerror=null,i.src="")}for(var a in this.requestsById)if(!(a in t)&&this.requestsById.hasOwnProperty(a)){var u=this.requestsById[a];delete this.requestsById[a],null!==u&&(u=u.id=u.coord=u.url=null)}},hasRequest:function(t){return t in this.requestsById},requestTile:function(t,n,e){if(!(t in this.requestsById)){var r={id:t,coord:n.copy(),url:e};this.requestsById[t]=r,e&&this.requestQueue.push(r)}},getProcessQueue:function(){if(!this._processQueue){var t=this;this._processQueue=function(){t.processQueue()}}return this._processQueue},processQueue:function(t){for(t&&this.requestQueue.length>8&&this.requestQueue.sort(t);this.openRequestCount<this.maxOpenRequests&&this.requestQueue.length>0;){var n=this.requestQueue.pop();if(n){this.openRequestCount++;var e=document.createElement("img");e.id=n.id,e.style.position="absolute",e.coord=n.coord,this.loadingBay.appendChild(e),e.onload=e.onerror=this.getLoadComplete(),e.src=n.url,n=n.id=n.coord=n.url=null}}},_loadComplete:null,getLoadComplete:function(){if(!this._loadComplete){var t=this;this._loadComplete=function(n){n=n||window.event;var e=n.srcElement||n.target;e.onload=e.onerror=null,t.loadingBay.removeChild(e),t.openRequestCount--,delete t.requestsById[e.id],"load"===n.type&&(e.complete||e.readyState&&"complete"==e.readyState)?t.dispatchCallback("requestcomplete",e):(t.dispatchCallback("requesterror",{element:e,url:""+e.src}),e.src=null),setTimeout(t.getProcessQueue(),0)}}return this._loadComplete}},t.Layer=function(n,e,r){this.parent=e||document.createElement("div"),this.parent.style.cssText="position: absolute; top: 0px; left: 0px; width: 100%; height: 100%; margin: 0; padding: 0; z-index: 0",this.name=r,this.levels={},this.requestManager=new t.RequestManager,this.requestManager.addCallback("requestcomplete",this.getTileComplete()),this.requestManager.addCallback("requesterror",this.getTileError()),n&&this.setProvider(n)},t.Layer.prototype={map:null,parent:null,name:null,enabled:!0,tiles:null,levels:null,requestManager:null,provider:null,_tileComplete:null,getTileComplete:function(){if(!this._tileComplete){var t=this;this._tileComplete=function(n,e){t.tiles[e.id]=e,t.positionTile(e),e.style.visibility="inherit",e.className="map-tile-loaded"}}return this._tileComplete},getTileError:function(){if(!this._tileError){var t=this;this._tileError=function(n,e){e.onload=e.onerror=null,t.tiles[e.element.id]=e.element,t.positionTile(e.element),e.element.style.visibility="hidden"}}return this._tileError},draw:function(){function n(t,n){if(t&&n){var r=t.coord,o=n.coord;if(r.zoom==o.zoom){var i=Math.abs(e.row-r.row-.5)+Math.abs(e.column-r.column-.5),a=Math.abs(e.row-o.row-.5)+Math.abs(e.column-o.column-.5);return a>i?1:i>a?-1:0}return r.zoom<o.zoom?1:r.zoom>o.zoom?-1:0}return t?1:n?-1:0}if(this.enabled&&this.map){var e=this.map.coordinate.zoomTo(Math.round(this.map.coordinate.zoom)),r=Math.round(this.map.coordinate.zoom),o=this.map.pointCoordinate(new t.Point(0,0)).zoomTo(r).container(),i=this.map.pointCoordinate(this.map.dimensions).zoomTo(r).container().right().down(),a={},u=this.createOrGetLevel(o.zoom),s=o.copy();for(s.column=o.column;s.column<i.column;s.column++)for(s.row=o.row;s.row<i.row;s.row++)for(var l=this.inventoryVisibleTile(u,s);l.length;)a[l.pop()]=!0;for(var c in this.levels)if(this.levels.hasOwnProperty(c)){var h=parseInt(c,10);if(h>=o.zoom-5&&o.zoom+2>h)continue;var f=this.levels[c];f.style.display="none";for(var d=this.tileElementsInLevel(f);d.length;)this.provider.releaseTile(d[0].coord),this.requestManager.clearRequest(d[0].coord.toKey()),f.removeChild(d[0]),d.shift()}for(var p=o.zoom-5,m=o.zoom+2,g=p;m>g;g++)this.adjustVisibleLevel(this.levels[g],g,a);this.requestManager.clearExcept(a),this.requestManager.processQueue(n)}},inventoryVisibleTile:function(t,n){var e,r,o=n.toKey(),i=[o];if(o in this.tiles){var a=this.tiles[o];return a.parentNode==t||a.__composited__||(t.appendChild(a),"reAddTile"in this.provider&&this.provider.reAddTile(o,n,a)),e=n.zoomBy(-1).container(),r=e.toKey(),r in this.tiles&&i.push(r),i}if(!this.requestManager.hasRequest(o)){var u=this.provider.getTile(n);"string"==typeof u?this.addTileImage(o,n,u):u&&this.addTileElement(o,n,u)}for(var s=!1,l=n.zoom,c=1;l>=c;c++)if(e=n.zoomBy(-c).container(),r=e.toKey(),r in this.tiles){i.push(r),s=!0;break}if(!s){var h=n.zoomBy(1);i.push(h.toKey()),h.column+=1,i.push(h.toKey()),h.row+=1,i.push(h.toKey()),h.column-=1,i.push(h.toKey())}return i},tileElementsInLevel:function(t){for(var n=[],e=t.firstChild;e;e=e.nextSibling)1==e.nodeType&&n.push(e);return n},adjustVisibleLevel:function(n,e,r){if(n){var o=1,i=this.map.coordinate.copy();if(!(n.childNodes.length>0))return n.style.display="none",!1;n.style.display="block",o=Math.pow(2,this.map.coordinate.zoom-e),i=i.zoomTo(e);for(var a=this.map.tileSize.x*o,u=this.map.tileSize.y*o,s=new t.Point(.5*this.map.dimensions.x,.5*this.map.dimensions.y),l=this.tileElementsInLevel(n);l.length;){var c=l.pop();r[c.id]?t.moveElement(c,{x:s.x+(c.coord.column-i.column)*a,y:s.y+(c.coord.row-i.row)*u,scale:o,width:this.map.tileSize.x,height:this.map.tileSize.y}):(this.provider.releaseTile(c.coord),this.requestManager.clearRequest(c.coord.toKey()),n.removeChild(c))}}},createOrGetLevel:function(t){if(t in this.levels)return this.levels[t];var n=document.createElement("div");return n.id=this.parent.id+"-zoom-"+t,n.style.cssText="position: absolute; top: 0px; left: 0px; width: 100%; height: 100%; margin: 0; padding: 0;",n.style.zIndex=t,this.parent.appendChild(n),this.levels[t]=n,n},addTileImage:function(t,n,e){this.requestManager.requestTile(t,n,e)},addTileElement:function(t,n,e){e.id=t,e.coord=n.copy(),this.positionTile(e)},positionTile:function(n){var e=this.map.coordinate.zoomTo(n.coord.zoom);n.style.cssText="position:absolute;-webkit-user-select:none;-webkit-user-drag:none;-moz-user-drag:none;-webkit-transform-origin:0 0;-moz-transform-origin:0 0;-o-transform-origin:0 0;-ms-transform-origin:0 0;width:"+this.map.tileSize.x+"px; height: "+this.map.tileSize.y+"px;",n.ondragstart=function(){return!1};var r=Math.pow(2,this.map.coordinate.zoom-n.coord.zoom);t.moveElement(n,{x:.5*this.map.dimensions.x+(n.coord.column-e.column)*this.map.tileSize.x*r,y:.5*this.map.dimensions.y+(n.coord.row-e.row)*this.map.tileSize.y*r,scale:r,width:this.map.tileSize.x,height:this.map.tileSize.y});var o=this.levels[n.coord.zoom];o.appendChild(n),Math.round(this.map.coordinate.zoom)==n.coord.zoom&&(o.style.display="block"),this.requestRedraw()},_redrawTimer:void 0,requestRedraw:function(){this._redrawTimer||(this._redrawTimer=setTimeout(this.getRedraw(),1e3))},_redraw:null,getRedraw:function(){if(!this._redraw){var t=this;this._redraw=function(){t.draw(),t._redrawTimer=0}}return this._redraw},setProvider:function(t){var n=null===this.provider;if(!n){this.requestManager.clear();for(var e in this.levels)if(this.levels.hasOwnProperty(e))for(var r=this.levels[e];r.firstChild;)this.provider.releaseTile(r.firstChild.coord),r.removeChild(r.firstChild)}this.tiles={},this.provider=t,n||this.draw()},enable:function(){return this.enabled=!0,this.parent.style.display="",this.draw(),this},disable:function(){return this.enabled=!1,this.requestManager.clear(),this.parent.style.display="none",this},destroy:function(){this.requestManager.clear(),this.requestManager.removeCallback("requestcomplete",this.getTileComplete()),this.requestManager.removeCallback("requesterror",this.getTileError()),this.provider=null,this.parent.parentNode&&this.parent.parentNode.removeChild(this.parent),this.map=null}},t.Map=function(n,e,r,o){if("string"==typeof n&&(n=document.getElementById(n),!n))throw"The ID provided to modest maps could not be found.";this.parent=n,this.parent.style.padding="0",this.parent.style.overflow="hidden";var i=t.getStyle(this.parent,"position");"relative"!=i&&"absolute"!=i&&(this.parent.style.position="relative"),this.layers=[],e||(e=[]),e instanceof Array||(e=[e]);for(var a=0;e.length>a;a++)this.addLayer(e[a]);if(this.projection=new t.MercatorProjection(0,t.deriveTransformation(-Math.PI,Math.PI,0,0,Math.PI,Math.PI,1,0,-Math.PI,-Math.PI,0,1)),this.tileSize=new t.Point(256,256),this.coordLimits=[new t.Coordinate(0,-1/0,0),new t.Coordinate(1,1/0,0).zoomTo(18)],this.coordinate=new t.Coordinate(.5,.5,0),r?(this.autoSize=!1,this.parent.style.width=Math.round(r.x)+"px",this.parent.style.height=Math.round(r.y)+"px"):(r=new t.Point(this.parent.offsetWidth,this.parent.offsetHeight),this.autoSize=!0,t.addEvent(window,"resize",this.windowResize())),this.dimensions=r,this.callbackManager=new t.CallbackManager(this,["zoomed","panned","centered","extentset","resized","drawn"]),void 0===o)this.eventHandlers=[t.MouseHandler().init(this),t.TouchHandler().init(this)];else if(this.eventHandlers=o,o instanceof Array)for(var u=0;o.length>u;u++)o[u].init(this)},t.Map.prototype={parent:null,dimensions:null,projection:null,coordinate:null,tileSize:null,coordLimits:null,layers:null,callbackManager:null,eventHandlers:null,autoSize:null,toString:function(){return"Map(#"+this.parent.id+")"},addCallback:function(t,n){return this.callbackManager.addCallback(t,n),this},removeCallback:function(t,n){return this.callbackManager.removeCallback(t,n),this},dispatchCallback:function(t,n){return this.callbackManager.dispatchCallback(t,n),this},getHandler:function(t,n){var e=null,r=this.eventHandlers;if(n===!0){if(r=this.getHandler("MouseHandler",!1),!r)return e;r=r.handlers}if(!r)return e;for(var o=0;r.length>o;o++)if("string"==typeof r[o].id&&r[o].id===t){e=r[o];break}return e||"boolean"==typeof n?e:this.getHandler(t,!0)},disableHandler:function(t){var n=this.getHandler(t);return n&&"function"==typeof n.remove&&n.remove(),this},enableHandler:function(t){var n=this.getHandler(t);return n&&"function"==typeof n.remove&&n.init(this),this},removeHandler:function(t){var n=this.getHandler(t),e=this.eventHandlers.indexOf(n);if(-1===e){var r=this.getHandler("MouseHandler");return e=r.handlers.indexOf(n),-1!==e&&(n.remove(),r.handlers.splice(e,1)),void 0}return n.remove(),this.eventHandlers.splice(e,1),n},addHandler:function(t){if(t.init(this),"string"!=typeof t.id)throw Error("Handler lacks the required id attribute");return this.eventHandlers.push(t),this},windowResize:function(){if(!this._windowResize){var n=this;this._windowResize=function(){n.dimensions=new t.Point(n.parent.offsetWidth,n.parent.offsetHeight),n.draw(),n.dispatchCallback("resized",[n.dimensions])}}return this._windowResize},setZoomRange:function(t,n){return this.coordLimits[0]=this.coordLimits[0].zoomTo(t),this.coordLimits[1]=this.coordLimits[1].zoomTo(n),this},zoomBy:function(n){return this.coordinate=this.enforceLimits(this.coordinate.zoomBy(n)),t.getFrame(this.getRedraw()),this.dispatchCallback("zoomed",n),this},zoomIn:function(){return this.zoomBy(1)},zoomOut:function(){return this.zoomBy(-1)},setZoom:function(t){return this.zoomBy(t-this.coordinate.zoom)},zoomByAbout:function(t,n){var e=this.pointLocation(n);this.coordinate=this.enforceLimits(this.coordinate.zoomBy(t));var r=this.locationPoint(e);return this.dispatchCallback("zoomed",t),this.panBy(n.x-r.x,n.y-r.y)},panBy:function(n,e){return this.coordinate.column-=n/this.tileSize.x,this.coordinate.row-=e/this.tileSize.y,this.coordinate=this.enforceLimits(this.coordinate),t.getFrame(this.getRedraw()),this.dispatchCallback("panned",[n,e]),this},panLeft:function(){return this.panBy(100,0)},panRight:function(){return this.panBy(-100,0)},panDown:function(){return this.panBy(0,-100)},panUp:function(){return this.panBy(0,100)},setCenter:function(t){return this.setCenterZoom(t,this.coordinate.zoom)},setCenterZoom:function(n,e){return this.coordinate=this.projection.locationCoordinate(n).zoomTo(parseFloat(e)||0),this.coordinate=this.enforceLimits(this.coordinate),t.getFrame(this.getRedraw()),this.dispatchCallback("centered",[n,e]),this},extentCoordinate:function(n,e){n instanceof t.Extent&&(n=n.toArray());for(var r,o,i=0;n.length>i;i++){var a=this.projection.locationCoordinate(n[i]);r?(r.row=Math.min(r.row,a.row),r.column=Math.min(r.column,a.column),r.zoom=Math.min(r.zoom,a.zoom),o.row=Math.max(o.row,a.row),o.column=Math.max(o.column,a.column),o.zoom=Math.max(o.zoom,a.zoom)):(r=a.copy(),o=a.copy())}var u=this.dimensions.x+1,s=this.dimensions.y+1,l=(o.column-r.column)/(u/this.tileSize.x),c=Math.log(l)/Math.log(2),h=r.zoom-(e?c:Math.ceil(c)),f=(o.row-r.row)/(s/this.tileSize.y),d=Math.log(f)/Math.log(2),p=r.zoom-(e?d:Math.ceil(d)),m=Math.min(h,p);m=Math.min(m,this.coordLimits[1].zoom),m=Math.max(m,this.coordLimits[0].zoom);var g=(r.row+o.row)/2,v=(r.column+o.column)/2,y=r.zoom;return new t.Coordinate(g,v,y).zoomTo(m)},setExtent:function(n,e){return this.coordinate=this.extentCoordinate(n,e),this.coordinate=this.enforceLimits(this.coordinate),t.getFrame(this.getRedraw()),this.dispatchCallback("extentset",n),this},setSize:function(n){return this.dimensions=new t.Point(n.x,n.y),this.parent.style.width=Math.round(this.dimensions.x)+"px",this.parent.style.height=Math.round(this.dimensions.y)+"px",this.autoSize&&(t.removeEvent(window,"resize",this.windowResize()),this.autoSize=!1),this.draw(),this.dispatchCallback("resized",this.dimensions),this},coordinatePoint:function(n){n.zoom!=this.coordinate.zoom&&(n=n.zoomTo(this.coordinate.zoom));var e=new t.Point(this.dimensions.x/2,this.dimensions.y/2);return e.x+=this.tileSize.x*(n.column-this.coordinate.column),e.y+=this.tileSize.y*(n.row-this.coordinate.row),e},pointCoordinate:function(t){var n=this.coordinate.copy();return n.column+=(t.x-this.dimensions.x/2)/this.tileSize.x,n.row+=(t.y-this.dimensions.y/2)/this.tileSize.y,n},locationCoordinate:function(t){return this.projection.locationCoordinate(t)},coordinateLocation:function(t){return this.projection.coordinateLocation(t)},locationPoint:function(t){return this.coordinatePoint(this.locationCoordinate(t))},pointLocation:function(t){return this.coordinateLocation(this.pointCoordinate(t))},getExtent:function(){return new t.Extent(this.pointLocation(new t.Point(0,0)),this.pointLocation(this.dimensions))},extent:function(t,n){return t?this.setExtent(t,n):this.getExtent()},getCenter:function(){return this.projection.coordinateLocation(this.coordinate)},center:function(t){return t?this.setCenter(t):this.getCenter()},getZoom:function(){return this.coordinate.zoom},zoom:function(t){return void 0!==t?this.setZoom(t):this.getZoom()},getLayers:function(){return this.layers.slice()},getLayer:function(t){for(var n=0;this.layers.length>n;n++)if(t==this.layers[n].name)return this.layers[n]},getLayerAt:function(t){return this.layers[t]},addLayer:function(n){return this.layers.push(n),this.parent.appendChild(n.parent),n.map=this,this.coordinate&&t.getFrame(this.getRedraw()),this},removeLayer:function(t){for(var n=0;this.layers.length>n;n++)if(t==this.layers[n]||t==this.layers[n].name){this.removeLayerAt(n);break}return this},setLayerAt:function(n,e){if(0>n||n>=this.layers.length)throw Error("invalid index in setLayerAt(): "+n);if(this.layers[n]!=e){if(this.layers.length>n){var r=this.layers[n];this.parent.insertBefore(e.parent,r.parent),r.destroy()}else this.parent.appendChild(e.parent);this.layers[n]=e,e.map=this,t.getFrame(this.getRedraw())}return this},insertLayerAt:function(n,e){if(0>n||n>this.layers.length)throw Error("invalid index in insertLayerAt(): "+n);if(n==this.layers.length)this.layers.push(e),this.parent.appendChild(e.parent);else{var r=this.layers[n];this.parent.insertBefore(e.parent,r.parent),this.layers.splice(n,0,e)}return e.map=this,t.getFrame(this.getRedraw()),this},removeLayerAt:function(t){if(0>t||t>=this.layers.length)throw Error("invalid index in removeLayer(): "+t);var n=this.layers[t];return this.layers.splice(t,1),n.destroy(),this},swapLayersAt:function(t,n){if(0>t||t>=this.layers.length||0>n||n>=this.layers.length)throw Error("invalid index in swapLayersAt(): "+index);var e=this.layers[t],r=this.layers[n],o=document.createElement("div");return this.parent.replaceChild(o,r.parent),this.parent.replaceChild(r.parent,e.parent),this.parent.replaceChild(e.parent,o),this.layers[t]=r,this.layers[n]=e,this},enableLayer:function(t){var n=this.getLayer(t);return n&&n.enable(),this},enableLayerAt:function(t){var n=this.getLayerAt(t);return n&&n.enable(),this},disableLayer:function(t){var n=this.getLayer(t);return n&&n.disable(),this},disableLayerAt:function(t){var n=this.getLayerAt(t);return n&&n.disable(),this},enforceZoomLimits:function(t){var n=this.coordLimits;if(n){var e=n[0].zoom,r=n[1].zoom;e>t.zoom?t=t.zoomTo(e):t.zoom>r&&(t=t.zoomTo(r))}return t},enforcePanLimits:function(n){if(this.coordLimits){n=n.copy();var e=this.coordLimits[0].zoomTo(n.zoom),r=this.coordLimits[1].zoomTo(n.zoom),o=this.pointCoordinate(new t.Point(0,0)).zoomTo(n.zoom),i=this.pointCoordinate(this.dimensions).zoomTo(n.zoom);r.row-e.row<i.row-o.row?n.row=(r.row+e.row)/2:o.row<e.row?n.row+=e.row-o.row:i.row>r.row&&(n.row-=i.row-r.row),r.column-e.column<i.column-o.column?n.column=(r.column+e.column)/2:o.column<e.column?n.column+=e.column-o.column:i.column>r.column&&(n.column-=i.column-r.column)}return n},enforceLimits:function(t){return this.enforcePanLimits(this.enforceZoomLimits(t))},draw:function(){if(this.coordinate=this.enforceLimits(this.coordinate),0>=this.dimensions.x||0>=this.dimensions.y){if(!this.autoSize)return;var n=this.parent.offsetWidth,e=this.parent.offsetHeight;if(this.dimensions=new t.Point(n,e),0>=n||0>=e)return}for(var r=0;this.layers.length>r;r++)this.layers[r].draw();this.dispatchCallback("drawn")},_redrawTimer:void 0,requestRedraw:function(){this._redrawTimer||(this._redrawTimer=setTimeout(this.getRedraw(),1e3))},_redraw:null,getRedraw:function(){if(!this._redraw){var t=this;this._redraw=function(){t.draw(),t._redrawTimer=0}}return this._redraw},destroy:function(){for(var n=0;this.layers.length>n;n++)this.layers[n].destroy();this.layers=[],this.projection=null;for(var e=0;this.eventHandlers.length>e;e++)this.eventHandlers[e].remove();this.autoSize&&t.removeEvent(window,"resize",this.windowResize())}},t.mapByCenterZoom=function(n,e,r,o){var i=t.coerceLayer(e),a=new t.Map(n,i,!1);return a.setCenterZoom(r,o).draw(),a},t.mapByExtent=function(n,e,r,o){var i=t.coerceLayer(e),a=new t.Map(n,i,!1);return a.setExtent([r,o]).draw(),a},"undefined"!=typeof module&&module.exports&&(module.exports={Point:t.Point,Projection:t.Projection,MercatorProjection:t.MercatorProjection,LinearProjection:t.LinearProjection,Transformation:t.Transformation,Location:t.Location,MapProvider:t.MapProvider,Template:t.Template,Coordinate:t.Coordinate,deriveTransformation:t.deriveTransformation})})(MM);var wax=wax||{};wax.mm=wax.mm||{},wax.mm._provider=function(t){this.options={tiles:t.tiles,scheme:t.scheme||"xyz",minzoom:t.minzoom||0,maxzoom:t.maxzoom||22,bounds:t.bounds||[-180,-90,180,90]}},wax.mm._provider.prototype={outerLimits:function(){return[this.locationCoordinate(new MM.Location(this.options.bounds[0],this.options.bounds[1])).zoomTo(this.options.minzoom),this.locationCoordinate(new MM.Location(this.options.bounds[2],this.options.bounds[3])).zoomTo(this.options.maxzoom)]},getTile:function(t){var n;if(!(n=this.sourceCoordinate(t)))return null;if(n.zoom<this.options.minzoom||n.zoom>this.options.maxzoom)return null;n.row="tms"===this.options.scheme?Math.pow(2,n.zoom)-n.row-1:n.row;var e=this.options.tiles[parseInt(Math.pow(2,n.zoom)*n.row+n.column,10)%this.options.tiles.length].replace("{z}",n.zoom.toFixed(0)).replace("{x}",n.column.toFixed(0)).replace("{y}",n.row.toFixed(0));return wax._&&wax._.bw&&(e=e.replace(".png",wax._.bw_png).replace(".jpg",wax._.bw_jpg)),e}},MM&&MM.extend(wax.mm._provider,MM.MapProvider),wax.mm.connector=function(t){var n=new wax.mm._provider(t);return new MM.Layer(n)},function(t,n){var e=function(){function t(t,n,e){return 0===e?t:1===e?n:t+(n-t)*e}var e,r,o,i,a,u,s={},l=!1,c=!1,h={easeIn:function(t){return t*t},easeOut:function(t){return Math.sin(t*Math.PI/2)},easeInOut:function(t){return(1-Math.cos(Math.PI*t))/2},linear:function(t){return t},easeCubicInOut:function(t){return t>1?1:.5>t?2*t*t:-1+(4-2*t)*t}},f=h.easeOut;s.stop=function(t){c=!0,r=void 0,e=t},s.running=function(){return l},s.point=function(t){return o=i.pointCoordinate(t),s},s.zoom=function(t){return o||(o=i.coordinate.copy()),o=i.enforceZoomLimits(o.zoomTo(t)),s},s.location=function(t){return o=i.locationCoordinate(t),s},s.from=function(t){return arguments.length?(r=t.copy(),s):r?r.copy():r},s.to=function(t){return arguments.length?(o=i.enforceZoomLimits(t.copy()),s):o.copy()},s.path=function(t){return m=d[t],s},s.easing=function(t){return f=h[t],s},s.map=function(t){return arguments.length?(i=t,s):i};var d={},p=new n.Coordinate(0,0,0);d.screen=function(e,r,o,i){var a=t(e.zoom,r.zoom,o);return i?(i.row=t(e.row,r.row*Math.pow(2,e.zoom-r.zoom),o)*Math.pow(2,a-e.zoom),i.column=t(e.column,r.column*Math.pow(2,e.zoom-r.zoom),o)*Math.pow(2,a-e.zoom),i.zoom=a,void 0):new n.Coordinate(t(e.row,r.row*Math.pow(2,e.zoom-r.zoom),o)*Math.pow(2,a-e.zoom),t(e.column,r.column*Math.pow(2,e.zoom-r.zoom),o)*Math.pow(2,a-e.zoom),a)},d.about=function(e,r,o,a){var u=t(e.zoom,r.zoom,o),s=i.dimensions.x/2,l=i.dimensions.y/2,c=i.tileSize.x,h=i.tileSize.y,f=s+c*(r.column*Math.pow(2,e.zoom-r.zoom)-e.column),d=l+h*(r.row*Math.pow(2,e.zoom-r.zoom)-e.row),p=s+c*(r.column*Math.pow(2,u-r.zoom)-e.column*Math.pow(2,u-e.zoom)),m=l+h*(r.row*Math.pow(2,u-r.zoom)-e.row*Math.pow(2,u-e.zoom));return a?(a.column=e.column*Math.pow(2,u-e.zoom)-(f-p)/c,a.row=e.row*Math.pow(2,u-e.zoom)-(d-m)/h,a.zoom=u,void 0):new n.Coordinate(e.column*Math.pow(2,u-e.zoom)-(f-p)/c,e.row*Math.pow(2,u-e.zoom)-(d-m)/h,u)};var m=d.screen;s.t=function(t){return m(r,o,f(t),p),i.coordinate=p,i.draw(),s},s.getCoordinate=function(t){return m(r,o,f(t),p),p},s.future=function(t){for(var n=[],e=0;t>e;e++)n.push(m(r,o,e/(t-1)));return n.slice(0)};var g;return s.resetRun=function(){return g=+new Date,s},s.run=function(t,a){function u(){var s=+new Date-g;if(c)return c=l=!1,e(),e=void 0;if(s>t){if(o.zoom!=r.zoom&&i.dispatchCallback("zoomed",o.zoom-r.zoom),l=!1,m(r,o,1,p),i.coordinate=p,o=r=void 0,i.draw(),a)return a(i)}else m(r,o,f(s/t),p),i.coordinate=p,i.draw(),n.getFrame(u)}return l?s.stop(function(){s.run(t,a)}):(r||(r=i.coordinate.copy()),o||(o=i.coordinate.copy()),t=t||1e3,g=+new Date,l=!0,n.getFrame(u),void 0)},s.optimal=function(t,n,e){return l?s.stop(function(){s.optimal(t,n,e)}):(t=t||.9,n=n||1.42,s.setOptimalPath(t,n),s.run(1e3*(u/t),function(t){m=a,e&&e(t)}),void 0)},s.getOptimalTime=function(t){return t=t||.9,t&&u?1e3*(u/t):null},s.setOptimalPath=function(e,l){function c(t){return t*t}function h(t){return(Math.exp(t)-Math.exp(-t))/2}function f(t){return(Math.exp(t)+Math.exp(-t))/2}function d(t){return h(t)/f(t)}function p(t){var n=c(M)-c(w)+(t?-1:1)*Math.pow(l,4)*c(T-S),e=2*(t?M:w)*c(l)*(T-S);return n/e}function g(t){return Math.log(-p(t)+Math.sqrt(c(p(t))+1))}e=e||.9,l=l||1.42,r?i.coordinate=r:r=i.coordinate.copy();var v=i.pointCoordinate(new n.Point(0,0)).zoomTo(0),y=i.pointCoordinate(i.dimensions).zoomTo(0),w=Math.max(y.column-v.column,y.row-v.row),M=w*Math.pow(2,r.zoom-o.zoom),x=r.zoomTo(0),b=o.zoomTo(0),_={x:x.column,y:x.row},z={x:b.column,y:b.row},S=0,T=Math.sqrt(c(z.x-_.x)+c(z.y-_.y)),E=g(0),C=g(1);u=(C-E)/l;var L=function(t){return w*f(E)/f(l*t+E)},A=function(t){return w/c(l)*f(E)*d(l*t+E)-w/c(l)*h(E)+S};if(1e-6>Math.abs(T)){if(1e-6>Math.abs(w-M))return s;var P=w>M?-1:1;u=Math.abs(Math.log(M/w))/l,A=function(){return S},L=function(t){return w*Math.exp(P*l*t)}}return a=m,m=function(e,r,i,a){if(1==i)return a&&(a.row=o.row,a.column=o.column,a.zoom=o.zoom),o;var s=i*u,l=A(s),c=e.zoom+Math.log(w/L(s))/Math.LN2,h=t(_.x,z.x,l/T||1),f=t(_.y,z.y,l/T||1),d=Math.pow(2,c);return a?(a.row=f*d,a.column=h*d,a.zoom=c,void 0):new n.Coordinate(f*d,h*d,c)},s},s};this.easey=e,this.mapbox===void 0&&(this.mapbox={}),this.mapbox.ease=e}(this,MM),window.cwm={init:function(){var t="http://clearwater.cartodb.com/api/v2/sql?format=geojson&q=",n={bingApiKey:"Ajt-JIuGs7jVKkk4yeC5HWByvuHQ4OEISvzK2-77yRcz_EOCAGfooD4eDeZ-aY4l",mapboxId:"gmaclennan.clearwater,gmaclennan.map-y7pgvo15",startBounds:[{lat:-55,lon:-90},{lat:14,lon:-33}],communityUrl:t+"SELECT ST_Simplify(the_geom, 0.0002) AS the_geom, c.cartodb_id, c.community, c.nationality, systems, users "+"FROM communities AS c LEFT JOIN (SELECT COUNT(*) AS systems, SUM(users) AS users, community "+"FROM clearwater_well_installations GROUP BY community) AS cwi ON c.community = cwi.community WHERE active",installationUrl:t+"SELECT *, to_char(date, 'YYYY-MM-DD') AS date FROM clearwater_well_installations WHERE photo IS NOT NULL",padding:580};cwm.map=cwm.Map("map",n),cwm.scrollHandler=cwm.handlers.ScrollHandler(cwm.map),cwm.Stories("stories").map(cwm.map)}},cwm.Map=function(t,n){function e(){h.bounds.communities&&c.bounds&&(r(),o(),i()),d3.select(d.parent).on("click",function(){var t=18;if(!d3.event.defaultPrevented&&p.classed("markers-shown")){var n=d.pointLocation(new MM.Point(d3.event.x,d3.event.y)),e=c.closest(n),r=c.getBounds(function(t){return t.properties.community===e.properties.community}),o=new MM.Extent(r[1][1],r[0][0],r[0][1],r[1][0]),i=d.extentCoordinate(o,!0);i.zoom>t-2&&(i=i.zoomTo(t-2)),d.flightHandler.pause();var a=d.s.scrollTo(cwm.util.sanitize(e.properties.community)+"-overview",function(){d.flightHandler.resume()});if(a!==cwm.scrollHandler.currentScroll()||d.getZoom()>=t)d.ease.to(i).path("screen").setOptimalPath().run(1500,function(){d.flightHandler.setOverride()}),p.classed("zoomed-in",!1);else{var u=new MM.Point(d3.event.x,d3.event.y),s=d.pointCoordinate(u).zoomTo(t);d.ease.to(s).path("about").run(500,function(){d.flightHandler.setOverride()}),p.classed("zoomed-in",!0)}}})}function r(){var t=c.getLocations(function(t){return cwm.util.sanitize(t.properties.featured_url)},function(t){return t.properties.featured&&!0}),n=c.getOverviewLocations(function(t){return cwm.util.sanitize(t)+"-overview"},function(t){return t.properties.community});m=m.concat([{id:"project-overview",bounds:h.bounds.communities}]).concat(h.getLocations("community")).concat(n).concat(t)}function o(){d3.selectAll("#"+t+" a").on("click",function(){void 0!==a&&a.scrollTo(this.getAttribute("href").split("#")[1])}),d3.selectAll(".markers circle").on("click",function(t){function n(){var t=18,n=new MM.Point(d3.event.clientX,d3.event.clientY),e=d.pointCoordinate(n).zoomTo(t);d.ease.to(e).path("about").run(500,function(){d.flightHandler.setOverride()})}if(!d3.event.defaultPrevented){var e=cwm.util.sanitize(t.properties.featured_url);e?a.scrollTo(e):n()}})}function i(){d.paddingLeft=s,d.flightHandler.locations(m).enable()}var a,u=0,s=n.padding||0,l=cwm.render.LayerContainer("layers"),c=cwm.layers.MarkerLayer(l,"markers"),h=cwm.layers.FeatureLayer(l,"features"),f=cwm.layers.BingLayer({apiKey:n.bingApiKey}),d=new MM.Map(t,[f,cwm.layers.MapboxLayer(f.parent).id(n.mapboxId),c,h],null,[cwm.handlers.DragHandler()]).setExtent(n.startBounds,!1,s).setZoomRange(3,18),p=d3.select(d.parent);h.add(cwm.data.ecuador,{id:"ecuador",maxZoom:7,scrollTo:function(){return"project-overview"}}),h.load(n.communityUrl,{id:"communities",maxZoom:12.5,scrollTo:function(t){return cwm.util.sanitize(t.properties.community)}},e),c.load(n.installationUrl,{minZoom:12.5},e),d.ease=mapbox.ease().map(d),d.flightHandler=cwm.handlers.FlightHandler().map(d),d.stories=function(t){return a=t,d},window.onresize=function(){$("html,body").stop(!0),Date.now()-u>1e3/30&&i(),u=Date.now()};var m=[{id:"ecuador",bounds:cwm.util.d3Bounds(n.startBounds)}];return d},cwm.Stories=function(){function t(){d3.selectAll('a[href*="#"]').on("click",function(){e.scrollTo(this.getAttribute("href").split("#")[1])}),d3.selectAll("#stories h1, #stories h2").on("click",function(){e.scrollTo($x(this).parent("section")[0].getAttribute("id"))})}var n,e={};t(),e.map=function(t){return n=t.stories(e),n.s=e,e};var r=document.getElementsByTagName("h1")[0].offsetHeight;return document.getElementsByTagName("h2")[0].offsetHeight,cwm.handlers.StoryHandler("#stories").affixTop("#stories h1",function(){return $x(this).parent("article").next().offsetTop()-this.offsetHeight}).affixBottom("#stories h2, #stories h1",function(){return $x(this).parent("section").previousSiblingOrCousin().offsetBottom()-window.innerHeight+this.offsetHeight}).fadeIn(".image",function(){return $x(this).offsetTop()-window.innerHeight},function(){return $x(this).offsetTop()-window.innerHeight+this.offsetHeight}).fadeOut("#stories article > section:not(:first-child)",function(){return $x(this).offsetTop()+this.offsetHeight-window.innerHeight+r},function(){return window.innerHeight-this.offsetHeight>200?$x(this).offsetTop():$x(this).offsetTop()+this.offsetHeight-window.innerHeight+200}).enable(),d3.selectAll("#stories article > section").call(cwm.scrollHandler.spy),e.scrollTo=function(t,n){var e,r=document.getElementById(t),o=$x(r).nextSiblingOrCousin()[0]?$x(r).nextSiblingOrCousin()[0].children[1].children[0].offsetHeight:0;return r&&(e=r.offsetTop+r.offsetHeight+o,cwm.scrollHandler.scrollTo(e,n)),e},e},cwm.render={LayerContainer:function(t){var n=d3.select(document.body).append("div").style("position","absolute").style("width","100%").style("height","100%").attr("id",t);return n.append("svg").style("position","absolute"),n},Markers:function(t,n){return n.selectAll("circle").data(t).enter().append("circle").attr("r",0).style("cursor","pointer")},Label:function(t,n){var e=n.append("div").attr("class","marker-tooltip").style("width","100%").datum(t);return e.append("div").style("position","absolute").style("pointer-events","none").append("div").attr("class","feature-label").style("pointer-events","auto").text(t.properties.community||t.properties.description),e},Popup:function(t,n){var e=n.append("div").attr("class","marker-tooltip").style("width","100%").datum(t);return e.append("div").style("position","absolute").style("pointer-events","none").append("div").attr("class","marker-popup").style("pointer-events","auto").classed("featured",function(){return t.properties.featured===!0}),e},PopupSmall:function(t,n){return n.append("div").attr("class","image-wrapper").append("img").attr("src",t.properties.photo),n.append("p").text(t.properties.name.split(" and")[0]),n},PopupLarge:function(t,n){var e=d3.time.format("%b %e %Y");n.append("div").attr("class","image-wrapper").append("img").attr("src",t.properties.photo);var r=n.append("table"),o=r.append("tr");return o.append("th").text("Family:"),o.append("td").text(t.properties.name),o=r.append("tr"),o.append("th").text("Village:"),o.append("td").text(t.properties.community),o=r.append("tr"),o.append("th").text("Installed:"),o.append("td").text(e(new Date(t.properties.date))),o=r.append("tr"),o.append("th").text("Users:"),o.append("td").text(t.properties.users),t.properties.featured===!0&&(o=r.append("tr"),o.append("th").text("Story:"),o.append("td").append("a").attr("href",t.properties.featured_url).text("Read more on our blog...")),n
}},cwm.util={sanitize:function(t){return t!==void 0&&null!==t?t.toLowerCase().replace("http://www.giveclearwater.org/","a-").replace("http://beta.giveclearwater.org/","b-").split(" ").join("-").split("/").join("-"):void 0},preloadImages:function(t,n){_.forEach(t.features,function(t){if(n===t.properties.community){var e=new Image;e.src=t.properties.photo}})},fillArray:function(t,n){for(var e,r=[],o=t instanceof Array,i=0;n>i;i++)e=o?t.slice(0):t,r.push(e);return r},d3Bounds:function(t){return[[t[0].lon,t[0].lat],[t[1].lon,t[1].lat]]},transformCSS:function(t,n){if(t=t.split(" "),n=n.split(" "),this.document){for(var e=document.documentElement.style,r=0;t.length>r;r++)if(t[r]in e)return n[r];return!1}}("transform WebkitTransform OTransform MozTransform msTransform","transform -webkit-transform -o-transform -moz-transform -ms-transform")},MM.getMousePoint=function(t){var n=new MM.Point(t.clientX,t.clientY);return n},MM.Map.prototype.centerFromBounds=function(t){var n=new MM.Extent(t[1][1],t[0][0],t[0][1],t[1][0]);return this.extentCoordinate(n,!0)},MM.Extent.prototype.coversBounds=function(t){return!(t[0][0]>this.east||t[0][1]>this.north||t[1][0]<this.west||t[1][1]<this.south)},MM.Extent.prototype.containsBounds=function(t){return t[0][0]>this.west&&t[0][1]>this.south&&t[1][0]<this.east&&t[1][1]<this.north},MM.Extent.prototype.containsCoordinates=function(t){return this.containsLocation(new MM.Location(t[1],t[0]))},MM.Map.prototype.extentCoordinate=function(t,n,e){var e=this.paddingLeft||e||0;t instanceof MM.Extent&&(t=t.toArray());for(var r,o,i=0;t.length>i;i++){var a=this.projection.locationCoordinate(t[i]);r?(r.row=Math.min(r.row,a.row),r.column=Math.min(r.column,a.column),r.zoom=Math.min(r.zoom,a.zoom),o.row=Math.max(o.row,a.row),o.column=Math.max(o.column,a.column),o.zoom=Math.max(o.zoom,a.zoom)):(r=a.copy(),o=a.copy())}var u=this.dimensions.x+1-e,s=this.dimensions.y+1,l=(o.column-r.column)/(u/this.tileSize.x),c=Math.log(l)/Math.log(2),h=r.zoom-(n?c+.1:Math.ceil(c)),f=(o.row-r.row)/(s/this.tileSize.y),d=Math.log(f)/Math.log(2),p=r.zoom-(n?d+.1:Math.ceil(d)),m=Math.min(h,p);m=Math.min(m,this.coordLimits[1].zoom),m=Math.max(m,this.coordLimits[0].zoom);var g=(r.row+o.row)/2,v=(r.column+o.column)/2,y=r.zoom;return new MM.Coordinate(g,v,y).zoomTo(m).left(e/this.tileSize.x/2)},MM.Map.prototype.setExtent=function(t,n,e){return this.coordinate=this.extentCoordinate(t,n,e),this.draw(),this.dispatchCallback("extentset",t),this},function(t,n,e){"undefined"!=typeof module&&module.exports?module.exports=e():"function"==typeof define&&define.amd?define(e):n[t]=e()}("$x",this,function(){function t(n){return n?n.offsetTop+t(n.offsetParent):0}function n(t,r){return"HTML"==t.tagName||t.tagName==r.toUpperCase()?e(t):n(t.parentNode,r)}var e=function(t){return this instanceof e?(this[0]=t,void 0):new e(t)};return e.prototype={get:function(){return this[0]||null},next:function(){return e(this[0].nextElementSibling)},offsetTop:function(){return t(this[0])},offsetBottom:function(){return this[0]&&this[0].offsetHeight+t(this[0])},parent:function(t){return n(this[0],t)},previousSiblingOrCousin:function(){var t=this[0].parentNode.previousElementSibling;return e(this[0].previousElementSibling||t&&t.lastElementChild)},nextSiblingOrCousin:function(){var t=this[0].parentNode.nextElementSibling;return e(this[0].nextElementSibling||t&&t.firstElementChild)}},e}),cwm.layers={},cwm.layers.BingLayer=function(t){return this instanceof cwm.layers.BingLayer?(this._subdomains=[0,1,2,3],this._key=t.apiKey,this._style=t.style||"Aerial",this._url="",this.meta="",this.parent=document.createElement("div"),this.parent.style.cssText="position: absolute; top: 0px; left: 0px; width: 100%; height: 100%; margin: 0; padding: 0; z-index: 0",this.levels={},this.requestManager=new MM.RequestManager,this.requestManager.addCallback("requestcomplete",this.getTileComplete()),this.requestManager.addCallback("requesterror",this.getTileError()),this.setProvider(new wax.mm._provider({tiles:["data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"]})),this.loadMetadata(),void 0):new cwm.layers.BingLayer(t)},cwm.layers.BingLayer.prototype=function(){var t=this;d3.timer(function(){return MM.Layer.prototype.draw.call(t),!0})},cwm.layers.BingLayer.prototype.initMetadata=function(){var t=this.meta.resourceSets[0].resources[0];this._subdomains=t.imageUrlSubdomains,this._url=t.imageUrl.replace("{subdomain}","{S}").replace("{quadkey}","{Q}").replace("http:",document.location.protocol).replace("{culture}",""),this.setProvider(new MM.Template(this._url,this._subdomains))},cwm.layers.BingLayer.prototype.loadMetadata=function(){var t=document.location.protocol+"//dev.virtualearth.net/REST/v1/Imagery/Metadata/"+this._style,n=this;$.ajax({url:t,data:{key:this._key},jsonp:"jsonp",dataType:"jsonp",success:function(t){n.meta=t,n.initMetadata()}})},MM.extend(cwm.layers.BingLayer,MM.Layer),"undefined"==typeof mapbox&&(mapbox={}),mapbox.MAPBOX_URL="http://a.tiles.mapbox.com/v3/",cwm.layers.MapboxLayer=function(t){return this instanceof cwm.layers.MapboxLayer?(this._tilejson={},this._url="",this._id="",this._composite=!1,this.name="",this.parent=t||document.createElement("div"),this.parent.style.cssText="position: absolute; top: 0px; left: 0px; width: 100%; height: 100%; margin: 0; padding: 0; z-index: 0",this.levels={},this.requestManager=new MM.RequestManager,this.requestManager.addCallback("requestcomplete",this.getTileComplete()),this.requestManager.addCallback("requesterror",this.getTileError()),this.setProvider(new wax.mm._provider({tiles:["data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"]})),void 0):new cwm.layers.MapboxLayer(t)},cwm.layers.MapboxLayer.prototype.refresh=function(t){var n=this;return $.ajax({url:this._url+(~this._url.indexOf("?")?"&":"?")+"callback=?",type:"jsonp",dataType:"jsonp",success:function(e){n.tilejson(e),t&&t(n)}}),this},cwm.layers.MapboxLayer.prototype.url=function(t,n){return arguments.length?(this._mapboxhosting=0===t.indexOf(mapbox.MAPBOX_URL),this._url=t,this.refresh(n)):this._url},cwm.layers.MapboxLayer.prototype.id=function(t,n){return arguments.length?(this.named(t),this._id=t,this.url(mapbox.MAPBOX_URL+t+".jsonp",n)):this._id},cwm.layers.MapboxLayer.prototype.named=function(t){return arguments.length?(this.name=t,this):this.name},cwm.layers.MapboxLayer.prototype.tilejson=function(t){if(!arguments.length)return this._tilejson;if(this._composite&&this._mapboxhosting||this.setProvider(new wax.mm._provider(t)),this._tilejson=t,this.name=this.name||t.id,this._id=this._id||t.id,t.bounds){var n=new MM.MercatorProjection(0,MM.deriveTransformation(-Math.PI,Math.PI,0,0,Math.PI,Math.PI,1,0,-Math.PI,-Math.PI,0,1));this.provider.tileLimits=[n.locationCoordinate(new MM.Location(t.bounds[3],t.bounds[0])).zoomTo(t.minzoom?t.minzoom:0),n.locationCoordinate(new MM.Location(t.bounds[1],t.bounds[2])).zoomTo(t.maxzoom?t.maxzoom:18)]}return this},cwm.layers.MapboxLayer.prototype.positionTile=function(t){var n=this.map.coordinate.zoomTo(t.coord.zoom);t.style.cssText="position:absolute;-webkit-user-select:none;-webkit-user-drag:none;-moz-user-drag:none;-webkit-transform-origin:0 0;-moz-transform-origin:0 0;-o-transform-origin:0 0;-ms-transform-origin:0 0;width:"+this.map.tileSize.x+"px; height: "+this.map.tileSize.y+"px;"+"z-index: 1;",t.ondragstart=function(){return!1};var e=Math.pow(2,this.map.coordinate.zoom-t.coord.zoom);MM.moveElement(t,{x:.5*this.map.dimensions.x+(t.coord.column-n.column)*this.map.tileSize.x*e,y:.5*this.map.dimensions.y+(t.coord.row-n.row)*this.map.tileSize.y*e,scale:e,width:this.map.tileSize.x,height:this.map.tileSize.y});var r=this.levels[t.coord.zoom];t.__composited__||r.appendChild(t),Math.round(this.map.coordinate.zoom)==t.coord.zoom&&(r.style.display="block"),this.requestRedraw()},cwm.layers.MapboxLayer.prototype.createOrGetLevel=function(t){if(t in this.levels)return this.levels[t];var n=this.parent.id+"-zoom-"+t,e=document.getElementById(n);return e?(this.levels[t]=e,e):(e=document.createElement("div"),e.id=n,e.style.cssText="position: absolute; margin: 0; padding: 0;",e.style.zIndex=t,this.parent.appendChild(e),this.levels[t]=e,e)},cwm.layers.MapboxLayer.prototype.composite=function(t){return arguments.length?(this._composite=t?!0:!1,this):this._composite},cwm.layers.MapboxLayer.prototype.enable=function(t){return MM.Layer.prototype.enable.call(this,t),this.map&&this.map.draw(),this},cwm.layers.MapboxLayer.prototype.disable=function(t){return MM.Layer.prototype.disable.call(this,t),this.map&&this.map.draw(),this},MM.extend(cwm.layers.MapboxLayer,MM.Layer),cwm.layers.FeatureLayer=function(t,n){function e(){var n=this.__data__;a&&a.node().parentNode||(a=cwm.render.Label(n,t),a._feature=this,a.on("mouseover",function(){u=!0}).on("mouseout",function(){u=!1,a.remove()}).on("click",function(){d3.event.stopPropagation(),u=!1,a.remove(),d3.select(a._feature).on("click").call(a._feature,n)}),r())}function r(){if(a){var t=a.datum(),n=p.map.locationPoint(new MM.Location(t.properties._labelXY[1],t.properties._labelXY[0]));MM.moveElement(a.node(),n)}}function o(){window.setTimeout(function(){u||a.remove()},10)}var i,a,u,s=0,l=[],c=t.select("svg"),h=c.insert("g",":first-child"),f=d3.geo.transform({point:function(t,n){var e=p.map.locationPoint({lon:t,lat:n});this.stream.point(~~(.5+e.x),~~(.5+e.y))}}),d=d3.geo.path().projection(f),p={parent:t.node(),name:n,bounds:{},draw:function(){if(p.map&&i){var t=p.map.getZoom(),n=p.map.getExtent(),a=l.filter(function(t){return n.coversBounds(t.properties._bounds)});return i.data(a,function(t){return t.properties.cartodb_id}).attr("d",d).style("fill-opacity",function(n){return.6*Math.min(Math.max(n.properties._maxZoom+1-t,0),1)}).style("display","").classed("outline",function(n){return t>n.properties._maxZoom}).on("mouseover",e).on("mouseout",o).exit().style("display","none"),r(),p}},add:function(t,n,e){n=n||{};var r=n.maxZoom||999,o=n.id||s++;return t.features.forEach(function(t){t.properties._maxZoom=r,t.properties._id=o,t.properties._bounds=d3.geo.bounds(t),t.properties._labelXY=d3.geo.centroid(t),t.properties._scrollTo=n.scrollTo(t)}),l=l.concat(t.features),p.bounds[o]=d3.geo.bounds(t),i=h.selectAll("path").data(l),i.enter().append("path").attr("class",o).on("click",function(t){var n=p.map.s.scrollTo(t.properties._scrollTo);n===cwm.scrollHandler.currentScroll()&&p.map.s.scrollTo(t.properties._scrollTo+"-overview")}),e&&e(),p},load:function(t,n,e){return d3.json(t,function(r,o){if(r)throw r.response+": Could not load "+t;p.add(o,n,e)}),p},getLocations:function(t){var n=[];return i.each(function(e){n.push({id:cwm.util.sanitize(e.properties[t]),bounds:d3.geo.bounds(e)})}),n}};return p},cwm.layers.MarkerLayer=function(t,n){function e(t){var n=w.map.locationPoint({lon:t.geometry.coordinates[0],lat:t.geometry.coordinates[1]});return[~~(.5+n.x),~~(.5+n.y)]}function r(t){var n=t||new MM.Location(0,0);return function(t,e){var r=t.geometry.coordinates,o=e.geometry.coordinates,i=Math.pow(r[0]-n.lon,2)+Math.pow(r[1]-n.lat,2),a=Math.pow(o[0]-n.lon,2)+Math.pow(o[1]-n.lat,2);return d3.ascending(i,a)}}function o(){return!0}function i(){v.selectAll("circle").sort(r(w.map.getCenter())).attr("r",0).transition().duration(1e3).delay(function(t,n){return 20*n}).ease("elastic",2).attr("r",c),v.selectAll("circle").sort(s)}function a(){p=v.selectAll("circle"),p.transition().attr("r",0).each("end",function(){d3.select(this).attr("display","none"),p=null})}function u(){var t=18,n=w.map,e=this.getAttribute("cx"),r=this.getAttribute("cy");if(!(d3.event.defaultPrevented||n.getZoom()>=t)){var o=new MM.Point(e,r),i=n.pointCoordinate(o).zoomTo(t);n.ease.to(i).path("about").run(1e3,function(){n.flightHandler.setOverride()}),d3.select(n.parent).classed("zoomed-in",!0)}}function s(t){return t.properties.featured===!0?1:0}function l(){var t=w.map.getExtent(),n=d.filter(function(n){return t.containsCoordinates(n.geometry.coordinates)}),r=v.selectAll("circle").data(n,function(t){return t.properties.cartodb_id});r.enter().append("circle").attr("r",c),r.call(y.add).on("click.zoom",u),r.exit().attr("display","none"),r.attr("cx",function(t){return e(t)[0]}).attr("cy",function(t){return e(t)[1]}).attr("display","")}function c(t,n,e){return e=e||1,t.properties._markerSize*e}var h,f,d,p,m=0,g=t.select("svg"),v=g.append("g").attr("class","markers"),y=cwm.handlers.MarkerInteraction(t),w={parent:t.node(),name:n,draw:function(){if(w.map&&d){var t=t||d3.select(w.map.parent),n=w.map.getZoom();return t.classed("markers-shown",n>=h),h>n&&m>=h?(a(),y.removePopup()):n>=h&&h>m?(l(),y.drawPopup(e),i()):n>=h&&m>=h?(l(),y.drawPopup(e)):h>n&&p&&p.attr("cx",function(t){return e(t)[0]}).attr("cy",function(t){return e(t)[1]}),m=n,w}},add:function(t,n,e){return n=n||{},f=n.markerSize||8,h=n.minZoom||0,t.features.forEach(function(t){t.properties._markerSize=f}),w.bounds=d3.geo.bounds(t),d=t.features,e&&e(),w},load:function(t,n,e){return d3.json(t,function(r,o){if(r)throw r.response+": Could not load "+t;w.add(o,n,e)}),w},getLocations:function(t,n){n=n||o;var e=[];return d.filter(n).forEach(function(n){var r=[[],[]];r[0][0]=r[1][0]=n.geometry.coordinates[0],r[0][1]=r[1][1]=n.geometry.coordinates[1],e.push({id:t(n),bounds:r})}),e},getOverviewLocations:function(t,n){var e=[],r=d3.nest().key(n).entries(d);return r.forEach(function(n){e.push({id:t(n.key),bounds:d3.geo.bounds({type:"FeatureCollection",features:n.values})})}),e},getBounds:function(t){t=t||o;var n=d.filter(t);return d3.geo.bounds({type:"FeatureCollection",features:n})},closest:function(t){return d.sort(r(t))[0]}};return w},cwm.handlers={},cwm.handlers.ScrollHandler=function(t){function n(){d3.event.preventDefault(),y-=p(),y=Math.max(0,y),e()}function e(){a||(a=!0,window.requestAnimationFrame(r))}function r(){var t=~~(.5+y);t!==v&&(m.forEach(function(n){n(t)}),v=t),a=!1}function o(t){return.5*(1-Math.cos(Math.PI*t))}function i(){var t=Date.now();return t-u>=h?(y=l,e(),f&&(f(),f=null),!0):(y=Math.round(s+(l-s)*o((t-u)/h)),e(),void 0)}var a,u,s,l,c,h,f,d,p,m=[],g=[],v=-1,y=0;e(),"onwheel"in document?(d="wheel",p=function(){return-d3.event.deltaY*(d3.event.deltaMode?40:1)}):"onmousewheel"in document?(d="mousewheel",p=function(){return d3.event.wheelDelta}):(d="MozMousePixelScroll",p=function(){return-d3.event.detail}),d3.select(t.parent.parentNode).on(d,n);var w={add:function(t){m.push(t),v=-1,e()},scrollTo:function(n,e){s=Math.round(y),l=Math.round(n),c=Math.abs(s-l),u=Date.now(),f=e,t?(t.flightHandler.setOverride(null,null,Math.min(l,s),Math.max(l,s)),h=t.flightHandler.getOverrideTime()):h=c,5>c&&(h=100),d3.timer(i)},currentScroll:function(){return Math.round(y)},spy:function(t){t.each(function(){g.push({scrollPoint:$x(this).offsetTop()+this.offsetHeight-window.innerHeight,section:this.getAttribute("id"),nationality:this.parentNode.getAttribute("class")})}),g=_.sortBy(g,"scrollPoint").reverse()},currentSection:function(){return _.find(g,function(){return y>g.scrollPoint}).section},currentNationality:function(){return _.find(g,function(){return y>g.scrollPoint}).nationality}};return w},cwm.handlers.DragHandler=function(){function t(){n.panBy(d3.event.dx,d3.event.dy)}var n,e,r={},o=d3.behavior.drag().on("drag",t).on("dragstart",function(){e.classed("dragging",!0),d3.event.sourceEvent.stopPropagation()}).on("dragend",function(){e.classed("dragging",!1),n.flightHandler.setOverride()});return r.init=function(t){n=t,e=d3.select(n.parent).call(o)},r.remove=function(){e.on("mousedown.drag",null)},r},cwm.handlers.FlightHandler=function(){function t(){u=_.chain(u).map(function(t){var n=document.getElementById(t.id);if(n){var e=$x(n).nextSiblingOrCousin()[0]?$x(n).nextSiblingOrCousin()[0].children[1].children[0].offsetHeight:0;t.scrollPoint=Math.max(n.offsetTop+n.offsetHeight+e,0)}else t.scrollPoint=-1;return t}).reject(function(t){return 0>t.scrollPoint}).sortBy("scrollPoint").value()}function n(){var t,n,e,a,s;o=[],_.forEach(u,function(u){n=r.centerFromBounds(u.bounds),a&&(t=i.from(a).to(n).easing("linear").setOptimalPath(),e=_.tail(t.future(u.scrollPoint-s+1)),o=o.concat(e)),a=n,s=u.scrollPoint})}var e,r,o,i,a,u,s,l={},c=!1;if(!mapbox.ease)throw"Mapbox easey library not found";return l.map=function(t){return r=t,i=mapbox.ease().map(r),l},l.locations=function(e){return arguments.length?(u=e,t(),r&&n(),l):u},l.enable=function(){if(s=-1,c)return l;if(!u||!r)throw"Map and locations need to be set";return o||n(),c=!0,cwm.scrollHandler.add(l.easeTo),l},l.easeTo=function(t){return a?l:(t=Math.max(t,0),e?t>e.top&&e.bottom>t?r.coordinate=e.easings[t-e.top]:e=void 0:r.coordinate=o[t]||_.last(o),r.draw(),l)},l.getCoord=function(t){return t=Math.max(t,0),o[t]||_.last(o)},l.setOverride=function(t,n,a,u){t=t||r.coordinate.copy(),n=n||cwm.scrollHandler.currentScroll(),a=Math.max(a||n-200,0),u=u||n+200,l.clearOverride();var s,c,h,f;return e={top:a,bottom:u},h=o[Math.floor(a)]||_.last(o),f=o[Math.floor(u)]||_.last(o),s=i.from(h).to(t).setOptimalPath(),e.easings=s.future(n-a),e.time=s.getOptimalTime(),c=i.from(t).to(f).setOptimalPath(),e.easings=e.easings.concat(c.future(u-n)),e.time+=c.getOptimalTime(),l},l.pause=function(){return a=!0,l},l.resume=function(){return a=!1,l},l.clearOverride=function(){return e=void 0,l},l.getOverrideTime=function(){return Math.floor(e.time)},l},cwm.handlers.StoryHandler=function(t){function n(){var t=[];return t.push.apply(t,arguments),M(t,n.prototype),t}function e(){this.origStyles={},this.length=0,this.wrapped={}}function r(t,n){var e=t,r=n;return function(t){return"opacity:"+c(Math.max(r-t,0)/(r-e)).toFixed(2)+";"}}function o(t,n){var e=t,r=n;return function(t){return"opacity:"+l(Math.min(t-r,e-r)/(e-r)).toFixed(2)+";"}}function i(t,n,e){var i,a,s,l,c,h,f=w(t);for(i=0;f.length>i;i++)a=x.add(f[i]),s=u.call(f[i],n,e),l=s[0],c=s[1],c>l&&c>0?(h=r(l,c),p.push([[l,c],a,h])):l>c&&l>0&&(h=o(l,c),p.push([[c,l],a,h]))}function a(){var t,n,e,r,o,i,a,u,s,l,c,h;e=b.add(cwm.util.fillArray([""],x.length)),r=_.add(cwm.util.fillArray("",z.length));var v=d.length;for(t=v;v+500>t;t++){for(c=cwm.util.fillArray([""],x.length),h=cwm.util.fillArray("",z.length),n=!1,o=0;p.length>o;o++)i=p[o][0][0],a=p[o][0][1],u=p[o][1],s=p[o][2],t>=i&&a>t&&("function"==typeof s?c[u][1]=s:c[u][0]+=s,n=!0);for(n&&(e=b.add(c)),d[t]=e,n=!1,o=0;m.length>o;o++)i=m[o][0][0],a=m[o][0][1],u=m[o][1],l=m[o][2],t>=i&&a>t&&(h[u]+=" "+l,n=!0);n&&(r=_.add(h)),g[t]=r}return d.length>f}function u(t,n){return["function"==typeof t?t.call(this):t,"function"==typeof n?n.call(this):n]}function s(t){return t?t.offsetTop+s(t.offsetParent):0}function l(t){return t*t}function c(t){return 1-l(1-t)}var h=window.innerHeight,f=d3.select("#stories")[0][0].offsetHeight+h,d=[],p=[],m=[],g=[],v=!1,y=cwm.util.transformCSS,w=function(t){return document.querySelectorAll(t)};"function"==typeof Sizzle&&(w=function(t){return Sizzle(t)});var M={}.__proto__?function(t,n){t.__proto__=n}:function(t,n){for(var e in n)t[e]=n[e]};n.prototype=Object.create(Array.prototype),n.prototype.add=function(t){function n(t,e){if(!t||!e)return!1;if(t==e)return!0;if(t instanceof Array&&e instanceof Array){if(t.length!=e.length)return!1;for(var r=0;t.length>r;r++)if(t[r]instanceof Array&&e[r]instanceof Array){if(!n(t[r],e[r]))return!1}else if(t[r]!=e[r])return!1;return!0}return!1}for(var e=0;this.length>e;e++)if(n(this[e],t))return e;return this.push(t)-1},e.prototype.add=function(t){for(var n=0;this.length>n;n++)if(this[n]==t)return n;return this[n]=t,this.origStyles[n]=t.getAttribute("style"),this.length+=1,n};var x=new e,b=new n,_=new n,z=new e,S={addKlass:function(t,n,e,r){var o,i,a,s=w(t);for(o=0;s.length>o;o++)i=z.add(s[o]),a=u.call(s[o],e,r),a[1]>=0&&m.push([a,i,n]);return S},affixTop:function(t,n){var e,r,o=function(){return s(this)};return n&&(r=function(){return d3.functor(n).call(this)-s(this)},S.addTranslateY(t,r,e,999999)),S.addKlass(t,"fixedTop",o,e||999999),S.addTranslateY(t,function(){var t=s(this);return function(n){return y+": translate3d(0,"+(n-t)+"px, 0)"}},o,e||999999),S},affixBottom:function(t,n,e){e=e||0;var r,o,i=function(){return s(this)-h+this.offsetHeight+e};return n&&("function"==typeof n?(r=function(){return n.call(this)-e},o=function(){return n.call(this)-s(this)+h-this.offsetHeight}):(r=function(){return n-e},o=function(){return n-s(this)}),S.addTranslateY(t,o,0,r)),S.addKlass(t,"fixedBottom",r||0,i),S.addTranslateY(t,function(){var t=i.call(this);return function(n){return y+": translate3d(0,"+(n-t)+"px,0)"}},r||0,i),S},fadeIn:function(t,n,e){return i(t,e,n),S.addStyle(t,{opacity:0},0,n),S},fadeOut:function(t,n,e){return i(t,n,e),S.addStyle(t,{opacity:0},e,999999),S},addTranslateY:function(t,n,e,r){var o,i,a,s;return d3.selectAll(t).each(function(){o=x.add(this),i=u.call(this,e,r),a=n.call(this),s="function"==typeof a?a:y+": translate3d(0px,"+a+"px, 0px)",p.push([i,o,s])}),S},addStyle:function(t,n,e,r){var o,i,a,s,l,c,h=w(t);for(o=0;h.length>o;o++)if(i=x.add(h[o]),a=u.call(h[o],e,r),c="",a[1]>=0){for(s in n)l="function"==typeof n[s]?n[s].call(h[o]):n[s],l+="number"==typeof l&&s.match(/top|bottom/)?"px":"",c+=s+":"+l+";";p.push([a,i,c])}return S},enable:function(){return b.length=0,a(),d3.timer(a),v=!0,cwm.scrollHandler.add(S.updateStyles),S}};return S.updateStyles=function(n){d3.select(t).style(cwm.util.transformCSS,"translate3d(0px,-"+n+"px, 0px)");var e,r,o,i,a,u=d[Math.max(n,0)],s=g[Math.max(n,0)],l=b[u],c=_[s];for(e=0;l.length>e;e++){for(r=x[e],o=l[e][0],a=1;l[e].length>a;a++)o+=l[e][a].call(r,n);r.getAttribute("style")!==o&&r.setAttribute("style",o)}for(e=0;c.length>e;e++)r=z[e],i=c[e].trim(),r.getAttribute("class")!==i&&r.setAttribute("class",i)},S},cwm.handlers.MarkerInteraction=function(t){function n(){if(!d3.event.defaultPrevented){var t=this.__data__;t.properties.featured===!0&&window.clearTimeout(l),d3.select(this).transition().duration(500).ease("elastic",1.5).attr("r",function(t){return a(t,2)}),(!u||u&&this!==u._marker)&&r.call(this)}}function e(){d3.event.defaultPrevented||(u&&!s&&(u.remove(),u=null),u&&u._marker===this||d3.select(this).transition().attr("r",a))}function r(){if(!d3.event.defaultPrevented){var n=new MM.Point(this.getAttribute("cx"),this.getAttribute("cy")),o=this,i=this.__data__,l=cwm.map.dimensions;u&&(u._marker!==o&&d3.select(u._marker).transition().attr("r",a),u.remove(),u=null),u=cwm.render.Popup(i,t),u._marker=o;var c=u.select(".marker-popup");"click"===d3.event.type?(d3.event.stopPropagation(),s="large",cwm.render.PopupLarge(i,c.classed("large",!0)),u.on("click.popup",function(){d3.event.defaultPrevented||(d3.event.stopPropagation(),s=!1,e.call(o))}),t.on("click",function(){d3.event.defaultPrevented||(s=!1,e.call(o))})):(cwm.render.PopupSmall(i,c),u.on("click.popup",function(){d3.event.defaultPrevented||(r.call(o),d3.select(o).on("click.zoom").call(o),d3.select(o).on("click.scroll").call(o))}).on("mouseleave.popup",function(){d3.event.defaultPrevented||(s=!1,e.call(o))}).on("mouseenter.popup",function(){s=!0}));var h=c.node().offsetWidth,f=c.node().offsetHeight;c.style("left",function(){return h>l.x-n.x?"auto":0}).style("right",function(){return h>l.x-n.x?0:"auto"}).style("bottom",function(){return f>n.y?"auto":0}),MM.moveElement(u.node(),n)}}function o(t){l&&window.clearTimeout(l),t.transition().delay(2e3).duration(180).attr("r",function(t){return a(t,2)}).style("stroke-width",a).each("end",function(){d3.select(this).transition().duration(1800).ease("elastic",1,.2).attr("r",a).style("stroke-width",3)}),l=window.setTimeout(o,5e3,t)}function i(){var t=this.__data__;t.properties.featured===!0&&(cwm.map.flightHandler.pause(),cwm.map.s.scrollTo(cwm.util.sanitize(t.properties.featured_url),function(){cwm.map.flightHandler.resume()}))}function a(t,n){return n=n||1,t.properties._markerSize*n}var u,s,l;return{add:function(t){t[0][0]&&t.on("mouseout.popup",e).on("mouseover.popup",n).on("click.popup",r).on("click.scroll",i).filter(function(t){return t.properties.featured===!0}).attr("class","featured").call(o)},drawPopup:function(t){if(u){var n=u.datum(),e=new MM.Point(t(n)[0],t(n)[1]);MM.moveElement(u.node(),e)}},removePopup:function(){s=!1,u&&(u.remove(),u=null)}}},cwm.data={},cwm.data.ecuador={type:"FeatureCollection",features:[{type:"Feature",properties:{description:"Ecuador"},geometry:{type:"Polygon",coordinates:[[[-78.80291,1.428007],[-78.731331,1.370628],[-78.693336,1.373506],[-78.647072,1.280454],[-78.559723,1.210047],[-78.431335,1.144838],[-78.373405,1.063676],[-78.314438,1.02976],[-78.197777,.992143],[-78.198547,.951752],[-78.12178,.937733],[-78.088173,.898703],[-78.022369,.87653],[-77.962822,.827145],[-77.864128,.796609],[-77.800056,.82439],[-77.70533,.8385],[-77.661453,.80659],[-77.701866,.744109],[-77.600121,.66735],[-77.523987,.647251],[-77.482231,.606659],[-77.492279,.542308],[-77.464546,.394909],[-77.394417,.35972],[-77.371323,.38657],[-77.272881,.354901],[-77.209908,.34965],[-77.128006,.37047],[-77.083412,.295785],[-76.905678,.248792],[-76.777969,.251208],[-76.730377,.284788],[-76.640106,.265787],[-76.595596,.23153],[-76.539284,.271036],[-76.504364,.249086],[-76.402435,.257127],[-76.395714,.391773],[-76.333206,.392402],[-76.302826,.445522],[-76.265556,.446463],[-76.215401,.390704],[-76.121201,.385877],[-76.087288,.33211],[-76.037033,.347321],[-75.997688,.317091],[-75.874626,.13115],[-75.84597,.136341],[-75.81218,.06598],[-75.76078,.05115],[-75.68119,.059601],[-75.598366,.035041],[-75.574623,-.007299],[-75.521782,-.009959],[-75.394737,-.078611],[-75.367332,-.07465],[-75.253532,-.111829],[-75.291222,-.149239],[-75.40966,-.16819],[-75.513329,-.11755],[-75.551743,-.123197],[-75.474861,-.245111],[-75.471489,-.29181],[-75.3881,-.43334],[-75.316811,-.49167],[-75.249527,-.51953],[-75.227921,-.617979],[-75.27523,-.66199],[-75.279419,-.7166],[-75.227242,-.863039],[-75.233612,-.93606],[-75.201126,-.9737],[-75.28508,-.98658],[-75.384979,-.940539],[-75.545242,-1.549339],[-75.567818,-1.53728],[-75.858643,-1.906222],[-76.055496,-2.136937],[-76.644562,-2.584064],[-77.834099,-2.992182],[-77.948532,-3.089973],[-78.057243,-3.228994],[-78.084396,-3.228419],[-78.109077,-3.289345],[-78.18972,-3.373662],[-78.155006,-3.420929],[-78.151329,-3.477937],[-78.224411,-3.514111],[-78.251358,-3.40314],[-78.343666,-3.391011],[-78.367455,-3.536217],[-78.386459,-3.564658],[-78.391418,-3.679175],[-78.414551,-3.69953],[-78.406563,-3.781707],[-78.458359,-3.841783],[-78.486305,-3.924082],[-78.521881,-3.933235],[-78.56395,-3.988807],[-78.540276,-4.073705],[-78.580116,-4.137621],[-78.576675,-4.197651],[-78.640511,-4.311606],[-78.619797,-4.434476],[-78.658264,-4.534704],[-78.662025,-4.58918],[-78.700859,-4.621726],[-78.839104,-4.652925],[-78.892281,-4.71618],[-78.88633,-4.803651],[-78.913033,-4.855184],[-78.894173,-4.88565],[-78.967598,-4.887013],[-79.011833,-5.014357],[-79.07444,-4.966317],[-79.181847,-4.954967],[-79.258011,-4.970463],[-79.307671,-4.891491],[-79.437088,-4.777666],[-79.42849,-4.735628],[-79.457191,-4.701247],[-79.495697,-4.581492],[-79.487183,-4.528632],[-79.541481,-4.528176],[-79.601189,-4.457758],[-79.641342,-4.435776],[-79.704887,-4.470763],[-79.815117,-4.488859],[-79.868172,-4.414117],[-79.919098,-4.385999],[-79.98912,-4.3822],[-80.061653,-4.310466],[-80.102394,-4.291839],[-80.180489,-4.307921],[-80.188362,-4.336269],[-80.294083,-4.437745],[-80.390839,-4.48537],[-80.446587,-4.44677],[-80.452454,-4.38885],[-80.411293,-4.318601],[-80.330742,-4.225389],[-80.370857,-4.197549],[-80.407806,-4.217127],[-80.448555,-4.198538],[-80.448647,-4.129679],[-80.48185,-4.05697],[-80.43441,-3.989487],[-80.397499,-3.980126],[-80.298286,-4.016385],[-80.12796,-3.896229],[-80.159004,-3.868496],[-80.161377,-3.803233],[-80.18969,-3.773848],[-80.179329,-3.725586],[-80.189201,-3.598421],[-80.240295,-3.461352],[-80.117363,-3.420972],[-80.064857,-3.41875],[-80.02903,-3.363194],[-80.003197,-3.238473],[-79.933197,-3.162917],[-79.909027,-3.162361],[-79.901527,-3.100416],[-79.845139,-3.012916],[-79.852081,-2.877916],[-79.804581,-2.788195],[-79.778473,-2.663472],[-79.990692,-2.651527],[-80.062637,-2.60875],[-80.016251,-2.50875],[-80.082916,-2.489861],[-80.173195,-2.596527],[-80.255692,-2.650695],[-80.256531,-2.74375],[-80.311806,-2.717084],[-80.392082,-2.637084],[-80.450417,-2.630696],[-80.502914,-2.564582],[-80.68708,-2.400416],[-80.802086,-2.379583],[-80.895142,-2.316528],[-80.942917,-2.218751],[-80.85125,-2.194861],[-80.754303,-2.117083],[-80.73542,-2.025973],[-80.763474,-1.975417],[-80.725975,-1.931805],[-80.778198,-1.739305],[-80.80542,-1.709861],[-80.848747,-1.604305],[-80.814026,-1.560972],[-80.816528,-1.509584],[-80.766251,-1.474027],[-80.759583,-1.388473],[-80.736809,-1.356529],[-80.850693,-1.20514],[-80.910141,-1.064027],[-80.830414,-.960139],[-80.76458,-.942916],[-80.630692,-.94736],[-80.547363,-.884306],[-80.505692,-.732916],[-80.469864,-.638749],[-80.429581,-.602361],[-80.461807,-.45264],[-80.491531,-.407638],[-80.476807,-.369305],[-80.404304,-.307361],[-80.380692,-.234027],[-80.32653,-.173473],[-80.287086,-.182361],[-80.155975,-.063195],[-80.064583,.055416],[-80.039024,.132084],[-80.030975,.21375],[-80.037636,.394584],[-80.014305,.404862],[-80.057083,.464026],[-80.019302,.509306],[-80.010696,.565694],[-80.028748,.627917],[-80.100693,.678751],[-80.100136,.752362],[-80.060692,.815139],[-79.950691,.827916],[-79.917358,.857362],[-79.80986,.894029],[-79.739304,.964584],[-79.651527,.99264],[-79.553192,.994028],[-79.392082,1.083751],[-79.346802,1.069584],[-79.258469,1.087639],[-79.244858,1.073194],[-79.159859,1.098472],[-79.119583,1.132916],[-79.046806,1.245417],[-79.000694,1.270973],[-78.966804,1.230694],[-78.901802,1.237084],[-78.879585,1.273195],[-78.876526,1.345694],[-78.832085,1.372916],[-78.80291,1.428007]]]}}]};